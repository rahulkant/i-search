/*!CK:2841144225!*//*1456467013,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["vb2Su"]); }

__d('PhotocropConstraintConstants',[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={BOUNDARY:'boundary',SQUARE:'square',WIDE:'wide'};h.getAspectRatioForType=function(i){switch(i){case h.SQUARE:return 1;case h.WIDE:return 16/9;default:return null;}};f.exports=h;},null);
__d('PhotocropConstraint',['Vector','PhotocropConstraintConstants','clamp'],function a(b,c,d,e,f,g){var h,i,j,k;if(c.__markCompiled)c.__markCompiled();function l(p){'use strict';this.photocrop=p;this.pos=null;}l.prototype.onMouseMove=function(p,q,r){'use strict';var s=p.sub(this.pos);if(q){this.onResize(s,r);}else this.onMove(s);this.pos=this.pos.add(s);};l.prototype.onMouseDown=function(p){'use strict';this.pos=p;};l.prototype.onResize=function(p,q){'use strict';};l.prototype.onMove=function(p){'use strict';var q=this.photocrop.box,r=this.photocrop.wrapper.offsetWidth,s=this.photocrop.wrapper.offsetHeight;p.x=c('clamp')(p.x,-q.l,r-q.r);p.y=c('clamp')(p.y,-q.t,s-q.b);this.photocrop.box=q.add(p);};h=babelHelpers.inherits(m,l);i=h&&h.prototype;m.prototype.onResize=function(p,q){'use strict';var r=this.photocrop.min_width,s=this.photocrop.min_height,t=this.photocrop.box,u=this.photocrop.wrapper.offsetWidth,v=this.photocrop.wrapper.offsetHeight;switch(q){case 'ne':t.r+=p.x=c('clamp')(p.x,t.l+r-t.r,u-t.r);t.t+=p.y=c('clamp')(p.y,-t.t,t.b-s-t.t);break;case 'nw':t.l+=p.x=c('clamp')(p.x,-t.l,t.r-r-t.l);t.t+=p.y=c('clamp')(p.y,-t.t,t.b-s-t.t);break;case 'se':t.r+=p.x=c('clamp')(p.x,t.l+r-t.r,u-t.r);t.b+=p.y=c('clamp')(p.y,t.t+s-t.b,v-t.b);break;case 'sw':t.l+=p.x=c('clamp')(p.x,-t.l,t.r-r-t.l);t.b+=p.y=c('clamp')(p.y,t.t+s-t.b,v-t.b);break;}};function m(){'use strict';h.apply(this,arguments);}j=babelHelpers.inherits(n,l);k=j&&j.prototype;n.prototype.setRatio=function(p){'use strict';this.ratio=p;return this;};n.prototype.onMouseDown=function(p){'use strict';k.onMouseDown.call(this,p);var q=this.photocrop.box,r=q.r-q.l,s=q.b-q.t;this.displacement=new (c('Vector'))(r,s);};n.prototype.$AspectRatioConstraint1=function(p,q,r,s,t,u){'use strict';var v,w,x,y,z;v=this.displacement.x/this.displacement.y;w=y=c('clamp')(q,p,r);x=z=c('clamp')(t,s,u);if(v>this.ratio){x=c('clamp')(w/this.ratio,s,u);w=x*this.ratio;}else{w=c('clamp')(x*this.ratio,p,r);x=w/this.ratio;}return new (c('Vector'))(w,x);};n.prototype.onResize=function(p,q){'use strict';var r=this.photocrop.min_width,s=this.photocrop.min_height,t=this.photocrop.box,u=this.photocrop.wrapper.offsetWidth,v=this.photocrop.wrapper.offsetHeight,w;switch(q){case 'ne':this.displacement=this.displacement.add(p.x,-p.y);w=this.$AspectRatioConstraint1(r,this.displacement.x,u-t.l,s,this.displacement.y,t.b);t.r=t.l+w.x;t.t=t.b-w.y;break;case 'nw':this.displacement=this.displacement.add(-p.x,-p.y);w=this.$AspectRatioConstraint1(r,this.displacement.x,t.r,s,this.displacement.y,t.b);t.l=t.r-w.x;t.t=t.b-w.y;break;case 'se':this.displacement=this.displacement.add(p.x,p.y);w=this.$AspectRatioConstraint1(r,this.displacement.x,u-t.l,s,this.displacement.y,v-t.t);t.r=t.l+w.x;t.b=t.t+w.y;break;case 'sw':this.displacement=this.displacement.add(-p.x,p.y);w=this.$AspectRatioConstraint1(r,this.displacement.x,t.r,s,this.displacement.y,v-t.t);t.l=t.r-w.x;t.b=t.t+w.y;break;}};function n(){'use strict';j.apply(this,arguments);}function o(p,q){var r;switch(q){case c('PhotocropConstraintConstants').BOUNDARY:r=new m(p);break;case c('PhotocropConstraintConstants').WIDE:case c('PhotocropConstraintConstants').SQUARE:r=new n(p).setRatio(c('PhotocropConstraintConstants').getAspectRatioForType(q));break;default:throw Error('unsupported PhotocropConstraint type');}return r;}f.exports=o;},null);
__d('Photocrop2',['ArbiterMixin','PhotocropConstraintConstants','CSS','DOM','Event','PhotosConst','Rect','Style','Vector','mixin','PhotocropConstraint'],function a(b,c,d,e,f,g){var h,i;if(c.__markCompiled)c.__markCompiled();h=babelHelpers.inherits(j,c('mixin')(c('ArbiterMixin')));i=h&&h.prototype;function j(k,l,m){'use strict';i.constructor.call(this);this.photo=k;var n=this.getPhotoDimensions();if(m){this.imageDimensions=new (c('Vector'))(m.x,m.y);}else this.imageDimensions=new (c('Vector'))(n.x,n.y);l.height=l.height||c('PhotosConst').PIC_NORMAL_FBX_SIZE;l.width=l.width||c('PhotosConst').PIC_NORMAL_FBX_SIZE;Object.assign(this,{target:this.photo.parentNode,create_target:false,target_parent:this.photo.parentNode,min_width:c('PhotosConst').PIC_NORMAL_FBX_SIZE,min_height:c('PhotosConst').PIC_NORMAL_FBX_SIZE,center_x:(n.x||l.width)/2,center_y:(n.y||l.height)/2,constraint_type:c('PhotocropConstraintConstants').BOUNDARY},l);this._unscaledMinHeight=this.min_height;this._unscaledMinWidth=this.min_width;this._unscaledHeight=this.height;this._unscaledWidth=this.width;this.setInitialDimensionsAndPos();if(this.create_target){this.target=c('DOM').create('div');c('CSS').addClass(this.target,'stageCropper');this.target_parent.appendChild(this.target);}c('CSS').addClass(this.target,'photocrop');['bg','wrapper','viewport'].forEach(function(o){this[o]=c('DOM').create('div');c('CSS').addClass(this[o],o);}.bind(this));this.highlight=c('DOM').create('img');c('CSS').addClass(this.highlight,'highlight');this.setHighlightSource();c('CSS').addClass(this.wrapper,'photocropWrapper');this.target.appendChild(this.bg);this.target.appendChild(this.wrapper);this.wrapper.appendChild(this.highlight);this.wrapper.appendChild(this.viewport);['ne','nw','sw','se'].forEach(function(o){var p=c('DOM').create('div');c('CSS').addClass(p,o);p.setAttribute('data-cropcorner',o);this.viewport.appendChild(p);c('CSS').addClass(p,'profilePicViewportGrabby');}.bind(this));c('Event').listen(this.viewport,{mousedown:this.mousedown.bind(this),dragstart:c('Event').kill,selectstart:c('Event').kill,click:c('Event').stop});c('Event').listen(document,{mousemove:this.mousemove.bind(this),mouseup:this.mouseup.bind(this)});c('Event').listen(window,{resize:this.adjustForResize.bind(this)});this.realignToPictureSize();this.redraw();}j.prototype.setInitialDimensionsAndPos=function(){'use strict';this._constraint=c('PhotocropConstraint')(this,this.constraint_type);var k=c('PhotocropConstraintConstants').getAspectRatioForType(this.constraint_type),l=this.getPhotoDimensions();if(k){this._unscaledMinHeight=this._unscaledMinWidth/k;this._unscaledHeight=this._unscaledWidth/k;}this.setNewRatio();var m=Math.min(this.width,l.x),n=Math.min(this.height,l.y);this.min_width=Math.min(this.min_width,l.x);this.min_height=Math.min(this.min_height,l.y);if(k)if(l.x/l.y>k){n=Math.min(n,l.y);m=n*k;this.min_width=this.min_height*k;}else{m=Math.min(m,l.x);n=m/k;this.min_height=this.min_width/k;}var o=this.center_x-m/2,p=this.center_y-n/2;this.box=new (c('Rect'))(p,o+m,p+n,o);};j.prototype.getPhotoDimensions=function(){'use strict';return new (c('Vector'))(Math.round(parseFloat(c('Style').get(this.photo,'width'))),Math.round(parseFloat(c('Style').get(this.photo,'height'))));};j.prototype.getPhotoPosition=function(){'use strict';return new (c('Vector'))(this.photo.offsetLeft,this.photo.offsetTop);};j.prototype.setHighlightSource=function(){'use strict';this.highlight.src=this.photo.src;};j.prototype.setConstraintType=function(k){'use strict';this.constraint_type=k;this.setInitialDimensionsAndPos();this.adjustForResize();};j.prototype.adjustForResize=function(){'use strict';var k=this.ratio,l=this.setNewRatio(),m=l/k;this.box.t*=m;this.box.l*=m;this.box.b*=m;this.box.r*=m;this.redraw();this.realignToPictureSize();};j.prototype.setNewRatio=function(){'use strict';this.ratio=this.getPhotoDimensions().x/this.imageDimensions.x;this.min_width=this.ratio*this._unscaledMinWidth;this.min_height=this.ratio*this._unscaledMinHeight;this.width=Math.max(1,this.ratio)*this._unscaledWidth;this.height=Math.max(1,this.ratio)*this._unscaledHeight;return this.ratio;};j.prototype.realignToPictureSize=function(){'use strict';var k=this.photo;if(!k)return;var l=this.getPhotoDimensions(),m=this.getPhotoPosition();[this.bg,this.wrapper].forEach(function(n){n.style.width=l.x+'px';n.style.height=l.y+'px';n.style.top=m.y+'px';n.style.left=m.x+'px';});};j.prototype.redraw=function(){'use strict';var k=[this.box.t,this.box.r,this.box.b,this.box.l],l=this.getPhotoDimensions();this.highlight.style.width=l.x+"px";this.highlight.style.height=l.y+"px";this.highlight.style.clip="rect("+k.join("px ")+"px)";this.viewport.style.top=this.box.t+"px";this.viewport.style.left=this.box.l+"px";this.viewport.style.height=this.box.b-this.box.t+"px";this.viewport.style.width=this.box.r-this.box.l+"px";};j.prototype.done=function(k){'use strict';this.freezeViewport=true;if(!k){[this.bg,this.wrapper].forEach(c('DOM').remove);if(this.create_target){c('DOM').remove(this.target);this.target=null;}else c('CSS').removeClass(this.target,'photocrop');}var l=Math.round(this.box.l*(1/this.ratio)),m=Math.round(this.box.t*(1/this.ratio)),n=Math.round(this.box.r*(1/this.ratio)),o=Math.round(this.box.b*(1/this.ratio));this.inform('done',k);return {x:Math.max(l,0),y:Math.max(m,0),width:n-Math.max(l,0),height:o-Math.max(m,0)};};j.prototype.reset=function(){'use strict';this.freezeViewport=false;};j.prototype.mousedown=function(k){'use strict';if(this.freezeViewport)return;this.mouseTarget=k.getTarget();this._constraint.onMouseDown(c('Vector').getEventPosition(k));c('CSS').addClass(document.body,'draggingMode');return false;};j.prototype.mousemove=function(k){'use strict';if(!this.mouseTarget)return;this._constraint.onMouseMove(c('Vector').getEventPosition(k),this.mouseTarget!==this.viewport,this.mouseTarget.getAttribute('data-cropcorner'));this.redraw();return false;};j.prototype.mouseup=function(k){'use strict';this.mouseTarget=null;c('CSS').removeClass(document.body,'draggingMode');};f.exports=j;},null);
__d("XProfilePicCropAsyncController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/profile\/picture\/crop_profile_pic\/",{photo_id:{type:"Int",required:true},profile_id:{type:"Int",required:true},height:{type:"Float",required:true},width:{type:"Float",required:true},x:{type:"Float",required:true},y:{type:"Float",required:true},source:{type:"Enum",defaultValue:"timeline",enumType:1},method:{type:"Enum",defaultValue:"existing",enumType:1},redirect_uri:{type:"String"},sticker_id:{type:"Int"},expiration_duration:{type:"Int"},caption:{type:"String"}});},null);
__d("XProfilePicMakeAsyncController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/profile\/picture\/make_profile_pic\/",{end_x:{type:"Float"},end_y:{type:"Float"},photo_id:{type:"Int",required:true},profile_id:{type:"Int",required:true},source:{type:"Enum",defaultValue:"timeline",enumType:1},start_x:{type:"Float"},start_y:{type:"Float"},method:{type:"Enum",defaultValue:"existing",enumType:1},expiration_duration:{type:"Int"},caption:{type:"String"}});},null);
__d('XProfilePicSaver',['AsyncRequest','AsyncUploadRequest','ArbiterMixin','ProfilePictureFlowLogging','XProfilePicCropAsyncController','XProfilePicMakeAsyncController','mixin','tidyEvent'],function a(b,c,d,e,f,g){var h,i;if(c.__markCompiled)c.__markCompiled();var j=c('ProfilePictureFlowLogging').step;h=babelHelpers.inherits(k,c('mixin')(c('ArbiterMixin')));i=h&&h.prototype;function k(l,m,n){'use strict';i.constructor.call(this);this.$XProfilePicSaver1=l;this.$XProfilePicSaver2=m;this.$XProfilePicSaver3=n;}k.prototype.setProfilePhotoSource=function(l){'use strict';this.$XProfilePicSaver4=l;return this;};k.prototype.setProfilePhotoMethod=function(l){'use strict';this.$XProfilePicSaver5=l;return this;};k.prototype.setFlowType=function(l){'use strict';this.$XProfilePicSaver6=l;return this;};k.prototype.saveCroppedProfilePic=function(l,m,n){'use strict';var o=c('XProfilePicCropAsyncController').getURIBuilder().setFloat('x',l.x).setFloat('y',l.y).setFloat('width',Math.min(l.width,1)).setFloat('height',Math.min(l.height,1));m&&o.setInt('sticker_id',m.id);this.$XProfilePicSaver7=true;this.$XProfilePicSaver8(o,m,n);this.$XProfilePicSaver9(j.CROP_SAVING);};k.prototype.saveAsProfilePic=function(){'use strict';this.$XProfilePicSaver10();};k.prototype.saveAsProfilePicWithPosition=function(l,m){'use strict';this.$XProfilePicSaver10(l,m);};k.prototype.$XProfilePicSaver10=function(l,m){'use strict';this.$XProfilePicSaver7=false;var n=c('XProfilePicMakeAsyncController').getURIBuilder();if(l)n.setFloat('start_x',100*l.startX).setFloat('start_y',100*l.startY).setFloat('end_x',100*l.endX).setFloat('end_y',100*l.endY);this.$XProfilePicSaver8(n,null,m);this.$XProfilePicSaver9(j.PREVIOUS_PIC_SAVING);};k.prototype.$XProfilePicSaver11=function(l){'use strict';this.inform('error',l);this.$XProfilePicSaver9(this.$XProfilePicSaver7?j.CROP_FAIL:j.PREVIOUS_PIC_FAIL);};k.prototype.$XProfilePicSaver9=function(l){'use strict';this.$XProfilePicSaver6&&c('ProfilePictureFlowLogging').setFlowType(this.$XProfilePicSaver6);c('ProfilePictureFlowLogging').log(l);};k.prototype.$XProfilePicSaver8=function(l,m,n){'use strict';l.setInt('photo_id',this.$XProfilePicSaver1).setInt('profile_id',this.$XProfilePicSaver2).setEnum('source',this.$XProfilePicSaver4||'photo_view').setInt('expiration_duration',this.$XProfilePicSaver3);this.$XProfilePicSaver5&&l.setEnum('method',this.$XProfilePicSaver5);if(n)l.setString('caption',n);if(m){m.canvas.toBlob(function(o){var p=new (c('AsyncUploadRequest'))().setFiles({farr:o}).setAllowCrossOrigin(true).setURI(l.getURI());c('tidyEvent')([p.subscribe('success',this.$XProfilePicSaver12.bind(this)),p.subscribe('failure',this.$XProfilePicSaver13.bind(this))]);p.send();}.bind(this));}else new (c('AsyncRequest'))(l.getURI()).setErrorHandler(this.$XProfilePicSaver11.bind(this)).setHandler(this.$XProfilePicSaver14.bind(this)).send();this.$XProfilePicSaver9(j.LOADING);};k.prototype.$XProfilePicSaver12=function(l,m){'use strict';this.$XProfilePicSaver14(m.getResponse());};k.prototype.$XProfilePicSaver13=function(l,m){'use strict';this.$XProfilePicSaver11(m.getResponse());};k.prototype.$XProfilePicSaver14=function(l){'use strict';this.inform('success',l);this.$XProfilePicSaver9(this.$XProfilePicSaver7?j.CROP_SUCCESS:j.PREVIOUS_PIC_SUCCESS);this.$XProfilePicSaver9(j.SUCCESS);};f.exports=k;},null);
__d('ProfilePicRequestCreator',['URI','XProfilePicSaver','tidyEvent'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(i,j){'use strict';this.saver=new (c('XProfilePicSaver'))(String(i),String(j));c('tidyEvent')([this.saver.subscribe('success',this.$ProfilePicRequestCreator1.bind(this)),this.saver.subscribe('error',this.$ProfilePicRequestCreator2.bind(this))]);this.setSuccessURI(new (c('URI'))('/profile.php').setQueryData({id:j}));this.setErrorURI(new (c('URI'))('/photo.php').setQueryData({pid:i,profile_id:j}));}h.prototype.setSuccessURI=function(i){'use strict';this.$ProfilePicRequestCreator3=i;return this;};h.prototype.setErrorURI=function(i){'use strict';this.$ProfilePicRequestCreator4=i;return this;};h.prototype.setProfilePhotoSource=function(i){'use strict';i&&this.saver.setProfilePhotoSource(i);return this;};h.prototype.setProfilePhotoMethod=function(i){'use strict';i&&this.saver.setProfilePhotoMethod(i);return this;};h.prototype.setFlowType=function(i){'use strict';this.saver.setFlowType(i);return this;};h.prototype.savePic=function(){'use strict';this.saver.saveAsProfilePic();};h.prototype.saveCrop=function(i,j){'use strict';this.saver.saveCroppedProfilePic({x:i.x/j.x,y:i.y/j.y,width:i.width/j.x,height:i.height/j.y});};h.prototype.$ProfilePicRequestCreator1=function(){'use strict';this.$ProfilePicRequestCreator3.go(true);};h.prototype.$ProfilePicRequestCreator2=function(){'use strict';this.$ProfilePicRequestCreator4.go(true);};f.exports=h;},null);
__d('SpotlightViewerBottomBar',['cx','LeftRight.react','React','joinClasses'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=c('React').createClass({displayName:'SpotlightViewerBottomBar',render:function(){var j=Array.isArray(this.props.children)?this.props.children:[this.props.children],k="_4_8n _51an";if(this.props.className)k=c('joinClasses')(k,this.props.className);if(j.length===1)return (c('React').createElement('div',{className:k},j[0]));k=c('joinClasses')(k,"_50-m");return (c('React').createElement(c('LeftRight.react'),{className:k},j[0],j[1]));}});f.exports=i;},null);
__d('SpotlightViewerBottomBarGroup',['cx','React'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=c('React').createClass({displayName:'SpotlightViewerBottomBarGroup',render:function(){var j=this.props.itemmargin||'right',k=(j=='left'?"marginLeft":'')+(j=='right'?' '+"marginRight":'')+(' '+"_4_8i");return (c('React').createElement('div',{className:k},this.props.children));}});f.exports=i;},null);
__d('SpotlightViewerBottomBarLink',['cx','Link.react','React'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=c('React').createClass({displayName:'SpotlightViewerBottomBarLink',render:function(){return (c('React').createElement(c('Link.react'),babelHelpers['extends']({},this.props,{className:"_4_8j _4_8k"}),this.props.children));}});f.exports=i;},null);
__d('SpotlightViewerCheck',['cx','Link.react','React'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=c('React').createClass({displayName:'SpotlightViewerCheck',getInitialState:function(){return {selected:this.props.selected};},render:function(){var j=(this.props.selected?"_4_d3":'')+(' '+"_4_d2")+(' '+"_51an")+(' '+"_4bi")+(this.props.bounce?' '+"_3yk":'');return c('React').createElement(c('Link.react'),{className:j,onClick:this.props.onClick});}});f.exports=i;},null);
__d('SpotlightViewerCroppingBar',['cx','fbt','React','SpotlightViewerBottomBar','SpotlightViewerBottomBarGroup','SpotlightViewerBottomBarLink'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();var j=c('React').createClass({displayName:'SpotlightViewerCroppingBar',_getBarGroupContents:function(){if(this.props.saving)return (c('React').createElement('span',{className:"_4_8j"},i._("Saving your new profile picture")));return [c('React').createElement(c('SpotlightViewerBottomBarLink'),{onClick:this.props.onDone},i._("Done Cropping")),c('React').createElement(c('SpotlightViewerBottomBarLink'),{onClick:this.props.onCancel},i._("Cancel"))];},render:function(){return (c('React').createElement(c('SpotlightViewerBottomBar'),null,c('React').createElement(c('SpotlightViewerBottomBarGroup'),null,this._getBarGroupContents())));}});f.exports=j;},null);
__d('SpotlightViewerOptionsMenu',['fbt','ContextualLayerAutoFlip','React','ReactMenu','PopoverMenu.react','SpotlightViewerBottomBarLink'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=c('ReactMenu').Item,j=c('React').createClass({displayName:'SpotlightViewerOptionsMenu',_onItemClick:function(k,l){this.props.callback&&this.props.callback(l.item.getValue());},render:function(){var k=c('React').createElement(c('ReactMenu'),{onItemClick:this._onItemClick},this.props.items.map(function(l){return (c('React').createElement(i,{value:l.value,title:l.label,href:l.href||'#'},l.label));}));return (c('React').createElement(c('PopoverMenu.react'),{menu:k,layerBehaviors:[c('ContextualLayerAutoFlip')],onShow:this.props.onShow,onHide:this.props.onHide},c('React').createElement(c('SpotlightViewerBottomBarLink'),null,h._("Options"))));}});f.exports=j;},null);
__d('SpotlightViewerUpdateUrlOnNav',['PageTransitions','PhotoUtils','URI','VaultBoxURI','goURI'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(i){'use strict';this._viewer=i;this._registered=false;this._shouldUpdateURL=false;this._suppressNextEvent=false;}h.prototype.enable=function(){'use strict';this._registered=false;this._subscriptions=[this._viewer.subscribe('open',this._onOpen.bind(this)),this._viewer.subscribe('close',this._onClose.bind(this)),this._viewer.subscribe('photo_change',this._onPhotoChange.bind(this))];this._enabled=true;};h.prototype.disable=function(){'use strict';for(var i=0;i<this._subscriptions.length;i++)this._subscriptions[i].unsubscribe();this._subscriptions=[];this._enabled=false;};h.prototype._registerTransition=function(){'use strict';if(this._registered)return;c('PageTransitions').registerHandler(this._handleTransition.bind(this));this._registered=true;};h.prototype._handleTransition=function(i){'use strict';if(!this._enabled)return false;if(this._shouldUpdateURL){this._shouldUpdateURL=false;c('PageTransitions').transitionComplete();return true;}this._suppressNextEvent=true;if(this._viewer.openURL(i)){c('PageTransitions').transitionComplete();return true;}if(this._viewer.isOpen()&&c('VaultBoxURI').isVaultArchiveURI(i)){this._suppressNextEvent=true;this._viewer.close();c('PageTransitions').transitionComplete();return true;}this._suppressNextEvent=false;return false;};h.prototype._onOpen=function(){'use strict';this._registerTransition();this._openURI=c('URI').getMostRecentURI().getUnqualifiedURI();};h.prototype._onClose=function(){'use strict';if(this._suppressNextEvent){this._suppressNextEvent=false;return;}var i=this._viewer.removePermalinkQueryData(this._openURI);this._updateURL(i);};h.prototype._onPhotoChange=function(i,j){'use strict';if(this._suppressNextEvent){this._suppressNextEvent=false;return;}this._updateURL(c('PhotoUtils').getPermalinkFromData(j));};h.prototype._updateURL=function(i){'use strict';this._shouldUpdateURL=true;c('goURI')(i);};f.exports=h;},null);
__d('SpotlightVaultViewer',['cx','fbt','Arbiter','ArbiterMixin','AsyncDialog','AsyncRequest','BadgedButton','CSSAnimations','LoadingIndicator.react','Parent','Photocrop2','PhotosConst','PhotoStore','PhotosUploadWaterfall','PhotoUtils','ProfilePicRequestCreator','ProfilePictureFlowLogging','React','ReactDOM','SpotlightViewer','SpotlightViewerAutoResize','SpotlightViewerBehaviorsMixin','SpotlightViewerBottomBar','SpotlightViewerBottomBarGroup','SpotlightViewerBottomBarLink','SpotlightViewerCheck','SpotlightViewerClose','SpotlightViewerCoreMixin','SpotlightViewerCroppingBar','SpotlightViewerDimensionMixin','SpotlightViewerOptionsMenu','SpotlightViewerPagers','SpotlightViewerPageWithKeys','SpotlightViewerUpdateUrlOnNav','SpotlightViewport','SubscriptionsHandler','URI','VaultBoxURI','VaultPageGrid','Vector'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();var j=c('React').createClass({displayName:'SpotlightVaultViewer',mixins:[c('ArbiterMixin'),c('SpotlightViewerBehaviorsMixin'),c('SpotlightViewerCoreMixin'),c('SpotlightViewerDimensionMixin')],behaviors:[c('SpotlightViewerUpdateUrlOnNav'),c('SpotlightViewerPageWithKeys'),c('SpotlightViewerAutoResize')],getViewerID:function(){return 'vaultbox';},optionsMenuValues:{DOWNLOAD:0,CROP:1,ROTATE_LEFT:2,ROTATE_RIGHT:3,MAKE_COVER_PHOTO:4},getInitialState:function(){this._grid=c('VaultPageGrid').getInstance(this.props.gridid);this._subscriptions=new (c('SubscriptionsHandler'))();return {photoData:this._getInitialPhotoData(),open:true,selectionSet:this._grid.getSelectionSet(),croppingMode:false,savingMode:false,menuOpen:false,bounce:false};},_getInitialPhotoData:function(){var k=c('PhotoStore').getIndexForID(this.props.setid,this.props.photoid),l=c('PhotoStore').getByIndexImmediate(this.props.setid,k);return l?l:this._getThumbnailPhotoData();},_getThumbnailPhotoData:function(){if(!this.props.normaldimensions||!this.props.thumbsrc)return null;var k=c('Vector').deserialize(this.props.normaldimensions),l={id:this.props.photoid,image1:{width:k.x,height:k.y,uri:this.props.thumbsrc}};if(this.props.hiresdimensions){var m=c('Vector').deserialize(this.props.hiresdimensions);l.image2={width:m.x,height:m.y,uri:this.props.thumbsrc};}return l;},_enableSubscriptions:function(){this._subscriptions.addSubscriptions(c('Arbiter').subscribe('VaultSharerDialog/imagesShared',this.close),c('Arbiter').subscribe('SpotlightVaultViewer/imageDeleted',this._onDelete),this.viewState.subscribe('photo_fetch',this.setState.bind(this,{photoData:null},null)));},removePermalinkQueryData:function(k){if(c('VaultBoxURI').isVaultBoxURI(k))return new (c('URI'))(k).removeQueryData('view_image');return k;},_onShareClick:function(event){if(this.state.selectionSet.getLength()===0){this.state.selectionSet.add(this._getCurrentFBID());this.setState({selectionSet:this.state.selectionSet});}this._grid.createPost(event.target);},_onSelect:function(){var k=this._getCurrentFBID();if(!this.state.selectionSet.contains(k)){this.state.selectionSet.add(k);}else this.state.selectionSet.remove(k);this.setState({selectionSet:this.state.selectionSet,bounce:true});setTimeout(this.setState.bind(this,{bounce:false}),c('CSSAnimations').getBounceTimeout());},_onClickOptions:function(k){if(k==this.optionsMenuValues.CROP){this._enableCropping();}else if(k==this.optionsMenuValues.ROTATE_LEFT){this._rotate('left');}else if(k==this.optionsMenuValues.ROTATE_RIGHT){this._rotate('right');}else if(k==this.optionsMenuValues.MAKE_COVER_PHOTO)this.close();},_rotate:function(k){var l=this._getCurrentFBID(),m={fbid:l,cs_ver:c('PhotosConst').VIEWER_VAULTBOX};m[k]=1;var n=this.viewState.getPosition();new (c('AsyncRequest'))('/ajax/photos/photo/rotate/').setAllowCrossPageTransition(true).setData(m).setFinallyHandler(this.rotationComplete.bind(this,n)).setErrorHandler(this.rotationComplete.bind(this,n)).setMethod('POST').setReadOnly(false).send();this.viewState.inform('photo_fetch');},rotationComplete:function(k){if(k==this.viewState.getPosition())c('PhotoStore').getByIndex(this.props.setid,k,this._updatePhoto);},_enableCropping:function(){c('ProfilePictureFlowLogging').setAction(c('ProfilePictureFlowLogging').action.MAKE_PROFILE).setFlowType(c('ProfilePictureFlowLogging').flow.VAULT).log(c('ProfilePictureFlowLogging').step.CROP);var k=this.getDimensions().getOriginalDimensionsFromPhoto(this.state.photoData);this._photocrop=new (c('Photocrop2'))(c('ReactDOM').findDOMNode(this.refs.image),{},k);this.setState({croppingMode:true});},_disableCropping:function(){c('ProfilePictureFlowLogging').setFlowType(c('ProfilePictureFlowLogging').flow.VAULT).log(c('ProfilePictureFlowLogging').step.CANCEL);this._photocrop&&this._photocrop.done(false);this.setState({croppingMode:false});},componentDidMount:function(){if(this.props.enablecropping)this._enableCropping();},_crop:function(){var k=this._getCurrentFBID(),l=this.state.photoData.owner.id,m=this._photocrop.done(),n=this.getDimensions().getOriginalDimensionsFromPhoto(this.state.photoData);new (c('ProfilePicRequestCreator'))(k,l).setErrorURI(c('URI').getRequestURI()).setFlowType(c('ProfilePictureFlowLogging').flow.VAULT).saveCrop(m,n);this.setState({croppingMode:false,savingMode:true});},_isCroppingEnabled:function(){return this.state.croppingMode||this.state.savingMode;},_delete:function(event){var k=new (c('AsyncRequest'))('/ajax/vault/delete.php').setData({vault_image_ids:[this._getCurrentFBID()],source:c('PhotosUploadWaterfall').SPOTLIGHT_VAULT_VIEWER}).setStatusElement(c('Parent').byClass(event.target,'stat_elem')).setRelativeTo(event.target);c('AsyncDialog').send(k);},_onDelete:function(){this.close();c('PhotoStore').clearSetCache(this.props.setid);},openURL:function(k){var l=k.getQueryData('view_image').view_image;if(!l)return false;this.viewState.page(this.viewState.getRelativeMovement(l));return true;},_getBottomBar:function(){if(!this.state.photoData)return null;if(this._isCroppingEnabled())return (c('React').createElement(c('SpotlightViewerCroppingBar'),{onDone:this._crop,onCancel:this._disableCropping,saving:this.state.savingMode}));return (c('React').createElement(c('SpotlightViewerBottomBar'),{className:'stat_elem'},c('React').createElement(c('SpotlightViewerBottomBarGroup'),null,c('React').createElement(c('SpotlightViewerBottomBarLink'),{onClick:this._delete},i._("Delete")),this._getOptionsMenu(),c('React').createElement('div',{className:"_4_8j"},c('React').createElement(c('LoadingIndicator.react'),{size:c('LoadingIndicator.react').SIZES.small,color:c('LoadingIndicator.react').COLORS.blue,showonasync:true,className:"_535k"}))),c('React').createElement(c('SpotlightViewerBottomBarGroup'),{itemmargin:'left'},c('React').createElement(c('BadgedButton'),{onClick:this._onShareClick,className:"_4_8j",count:this.state.selectionSet.getLength(),singularLabel:i._("Share Photo"),pluralLabel:i._("Share Photos"),bounce:this.state.bounce}))));},_getCheck:function(){if(!this.state.photoData||this._isCroppingEnabled())return null;var k=this.state.selectionSet.contains(this._getCurrentFBID());return (c('React').createElement(c('SpotlightViewerCheck'),{bounce:this.state.bounce,selected:k,onClick:this._onSelect}));},_getPagers:function(){if(this._isCroppingEnabled())return null;return c('React').createElement(c('SpotlightViewerPagers'),null);},_getOptionsMenu:function(){if(!this.state.photoData)return null;var k=[],l=c('PhotoUtils').getDownloadURLFromData(this.state.photoData);if(l)k.push({label:i._("Download"),value:this.optionsMenuValues.DOWNLOAD,href:c('PhotoUtils').getDownloadURLFromData(this.state.photoData)});if(this.state.photoData.owner)k.push({label:i._("Make Profile Picture"),value:this.optionsMenuValues.CROP});if(c('PhotoUtils').canViewerMakeCoverPhoto(this.state.photoData))k.push({label:i._("Make Cover Photo"),value:this.optionsMenuValues.MAKE_COVER_PHOTO,href:c('PhotoUtils').getCoverPhotoURLFromData(this.state.photoData)});k.push({label:i._("Rotate Left"),value:this.optionsMenuValues.ROTATE_LEFT});k.push({label:i._("Rotate Right"),value:this.optionsMenuValues.ROTATE_RIGHT});return (c('React').createElement(c('SpotlightViewerOptionsMenu'),{items:k,callback:this._onClickOptions,onShow:this.setState.bind(this,{menuOpen:true},null),onHide:this.setState.bind(this,{menuOpen:false},null)}));},render:function(){var k=this.getMedia(),l=this.getStageDimensions();return (c('React').createElement(c('SpotlightViewer'),{open:this.state.open,onHide:this.close},c('React').createElement(c('SpotlightViewport'),{active:this.state.menuOpen,onClick:this._onClickViewport,stageDimensions:l,media:k,showLoadingIndicator:!this.state.photoData},c('React').createElement(c('SpotlightViewerClose'),{onClick:this.close,position:'left'}),this._getCheck(),this._getBottomBar(),this._getPagers())));}});f.exports=j;},null);
__d('VaultBoxInit',['AsyncRequest','DOM','PhotoStore','React','SpotlightVaultViewer','SpotlightViewerInit','VaultPageGrid'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={setID:'vault:images_by_date_taken',bootstrapWithElem:function(i){c('SpotlightViewerInit').render(c('React').createElement(c('SpotlightVaultViewer'),{open:true,gridid:i.getAttribute('data-grid-id'),setid:h.setID,photoid:i.getAttribute('data-fbid'),thumbsrc:c('DOM').find(i,'img').src,hiresdimensions:i.getAttribute('data-hi-res-dimensions'),normaldimensions:i.getAttribute('data-normal-dimensions')}));if(!c('PhotoStore').hasBeenCreated(h.setID))new (c('AsyncRequest'))('/ajax/photos/vaultbox/init_react.php').setRelativeTo(i).setData({photoID:i.getAttribute('data-fbid')}).send();},bootstrapFromPermalink:function(i,j,k,l){c('VaultPageGrid').getInstanceWithCallback(k,function(){c('SpotlightViewerInit').render(c('React').createElement(c('SpotlightVaultViewer'),{open:true,setid:h.setID,initialpayload:i,photoid:j,gridid:k,enablecropping:l.enableCropping}));});}};f.exports=h;},null);