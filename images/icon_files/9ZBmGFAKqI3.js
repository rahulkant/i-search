/*!CK:303682916!*//*1459353390,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["hnj95"]); }

__d("MessagingRealtimeConstants",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={VIEWER_FBID:"realtime_viewer_fbid"};},null);
__d('AjaxRequest',['ErrorUtils','Keys','PHPQuerySerializer','TimeSlice','URI','UserAgent_DEPRECATED','getSameOriginTransport','setTimeoutAcrossTransitions'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(l,m,n){this.xhr=c('getSameOriginTransport')();if(!(m instanceof c('URI')))m=new (c('URI'))(m);if(n&&l=='GET'){m.setQueryData(n);}else this._params=n;this.method=l;this.uri=m;this.xhr.open(l,m);}var i=window.XMLHttpRequest&&'withCredentials' in new XMLHttpRequest();h.supportsCORS=function(){return i;};h.ERROR='ar:error';h.TIMEOUT='ar:timeout';h.PROXY_ERROR='ar:proxy error';h.TRANSPORT_ERROR='ar:transport error';h.SERVER_ERROR='ar:http error';h.PARSE_ERROR='ar:parse error';h.SERVICE_UNAVAILABLE='ar:noservice';h._inflight=[];function j(){var l=h._inflight;h._inflight=[];l.forEach(function(m){m.abort();});}function k(l){l.onJSON=l.onError=l.onSuccess=null;clearTimeout(l._timer);if(l.xhr&&l.xhr.readyState<4){l.xhr.abort();l.xhr=null;}h._inflight=h._inflight.filter(function(m){return m&&m!=l&&m.xhr&&m.xhr.readyState<4;});}Object.assign(h.prototype,{timeout:60000,streamMode:true,prelude:/^for \(;;\);/,status:null,_eol:-1,_call:function(l){if(this[l])this[l](this);},_parseStatus:function(){var l;try{this.status=this.xhr.status;l=this.xhr.statusText;}catch(m){if(this.xhr.readyState>=4){this.errorType=h.TRANSPORT_ERROR;this.errorText=m.message;}return;}if(this.status===0&&!/^(file|ftp)/.test(this.uri)){this.errorType=h.TRANSPORT_ERROR;}else if(this.status>=100&&this.status<200){this.errorType=h.PROXY_ERROR;}else if(this.status>=200&&this.status<300){return;}else if(this.status>=300&&this.status<400){this.errorType=h.PROXY_ERROR;}else if(this.status>=400&&this.status<500){this.errorType=h.SERVER_ERROR;}else if(this.status===503){this.errorType=h.SERVICE_UNAVAILABLE;}else if(this.status>500&&this.status<600){this.errorType=h.PROXY_ERROR;}else if(this.status==1223){return;}else if(this.status>=12001&&this.status<=12156){this.errorType=h.TRANSPORT_ERROR;}else{l='unrecognized status code: '+this.status;this.errorType=h.ERROR;}if(!this.errorText)this.errorText=l;},_parseResponse:function(){var l,m=this.xhr.readyState;try{l=this.xhr.responseText||'';}catch(n){if(m>=4){this.errorType=h.ERROR;this.errorText='responseText not available - '+n.message;}return;}while(this.xhr){var o=this._eol+1,p=this.streamMode?l.indexOf('\n',o):l.length;if(p<0&&m==4)p=l.length;if(p<=this._eol)break;var q=l;if(this.streamMode)q=l.substr(o,p-o).replace(/^\s*|\s*$/g,'');if(o===0&&this.prelude)if(this.prelude.test(q))q=q.replace(this.prelude,'');this._eol=p;if(q){try{this.json=JSON.parse(q);}catch(n){var r=/(<body[\S\s]+?<\/body>)/i.test(l)&&RegExp.$1,s={message:n.message,'char':o,excerpt:(o===0&&r||q).substr(512)};this.errorType=h.PARSE_ERROR;this.errorText='parse error - '+JSON.stringify(s);return;}c('ErrorUtils').applyWithGuard(this._call,this,['onJSON']);}}},_onReadyState:function(){var l=this.xhr&&this.xhr.readyState||0;if(this.status==null&&l>=2)this._parseStatus();if(!this.errorType&&this.status!=null)if(l==3&&this.streamMode||l==4)this._parseResponse();if(this.errorType||l==4){this._time=Date.now()-this._sentAt;this._call(!this.errorType?'onSuccess':'onError');k(this);}},send:function(l){this.xhr.onreadystatechange=c('TimeSlice').guard(this._onReadyState.bind(this),'AjaxRequest xhr.onreadystatechange');var m=this.timeout;if(m)this._timer=c('setTimeoutAcrossTransitions')(function(){this.errorType=h.TIMEOUT;this.errorText='timeout';this._time=Date.now()-this._sentAt;this._call('onError');k(this);}.bind(this),m);h._inflight.push(this);if(this.method=='POST')this.xhr.setRequestHeader('Content-Type','application/x-www-form-urlencoded');this._sentAt=Date.now();this.xhr.send(l?c('PHPQuerySerializer').serialize(l):'');},abort:function(){k(this);},toString:function(){var l='[AjaxRequest readyState='+this.xhr.readyState;if(this.errorType)l+=' errorType='+this.errorType+' ('+this.errorText+')';return l+']';},toJSON:function(){var l={json:this.json,status:this.status,errorType:this.errorType,errorText:this.errorText,time:this._time};if(this.errorType)l.uri=this.uri;for(var m in l)if(l[m]==null)delete l[m];return l;}});if(window.addEventListener&&c('UserAgent_DEPRECATED').firefox())window.addEventListener('keydown',function(event){if(event.keyCode===c('Keys').ESC)event.prevent();},false);if(window.attachEvent)window.attachEvent('onunload',j);f.exports=h;},null);
__d('ChannelSubdomain',['Event','JSLogger','Run','LogHistory','setTimeoutAcrossTransitions','WebStorage'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=c('LogHistory').getInstance('channel'),i=c('WebStorage').getLocalStorage(),j=c('JSLogger').create('channel'),k='channel_sub:',l=7,m=100*1000,n=null,o;function p(){if(o){clearTimeout(o);o=null;}if(i&&n!=null)i.removeItem(k+n);n=null;}function q(r,s,t){var u=(r-1)*l;if(t){if(o)clearTimeout(o);n=o=null;}if(s==null)s=Math.floor(Math.random()*u);if(n==null)if(i){var v=[];for(var w=0;w<i.length;w++){var x=i.key(w);if(x.indexOf(k)===0){var y=parseInt(x.substr(k.length),10);v[y]=parseInt(i.getItem(x),10);}}var z=Date.now()-m;for(w=0;w<u;w++){var aa=(w+s)%u;if(!v[aa]||v[aa]<z){n=aa;break;}}if(n!=null){var ba=function(){try{i.setItem(k+n,Date.now());}catch(ca){h.warn('subdomain set failed',ca.message);}o=c('setTimeoutAcrossTransitions')(ba,m/2);};ba();}else{h.warn('no channel subdomain',v);j.error('subdomain_overflow');}if(typeof window.onpageshow!='undefined'){c('Event').listen(window,'pagehide',p);}else c('Run').onUnload(p);}else n=s;return n==null?null:n%l;}f.exports={allocate:q,clear:p};},null);
__d('DocRPC',['ErrorUtils'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={_apis:{},_dispatch:function(i){var j;try{i=JSON.parse(i);}catch(k){throw new Error('DocRPC unparsable dispatch: "'+i+'"');}if(h._apis.hasOwnProperty(i.api)){var l=h._apis[i.api];if(l[i.method])j=c('ErrorUtils').applyWithGuard(l[i.method],l,i.args);}if(j===undefined)j=null;return JSON.stringify(j);},publish:function(i,j){h._apis[j]=i;},proxy:function(i,j,k){var l={};k.forEach(function(m){l[m]=function(){var n={api:j,method:m,args:Array.prototype.slice.call(arguments)},o;try{if(i.closed)throw new Error('DocRPC window closed');o=i.DocRPC._dispatch(JSON.stringify(n));}catch(p){c('ErrorUtils').reportError(p);return;}if(typeof o=='string')try{o=JSON.parse(o);}catch(p){throw new Error('DocRPC '+j+'.'+m+' unparsable return: "'+o+'"');}return o;};});return l;}};f.exports=b.DocRPC=h;},null);
__d('ChannelTransport',['AjaxRequest','ChannelConstants','DocRPC','LogHistory','TimeSlice','URI','bind','setTimeoutAcrossTransitions'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=c('LogHistory').getInstance('channel');function i(){return (1048576*Math.random()|0).toString(36);}function j(t,u){var v=t.subdomain;v=v===null?'':v+'-';var w=t.host;w=w===null||w===undefined?'edge-chat':t.host;var x=new (c('URI'))(u).setDomain(v+w+'.'+t.domain).setPort(t.port).setSecure(new (c('URI'))(window.location.href).isSecure());return x;}function k(t){var u={partition:t.partition,cb:i(),failure:t.pingFailuresOnSubdomain};if(t.sticky_token)u.sticky_token=t.sticky_token;if(t.sticky_pool)u.sticky_pool=t.sticky_pool;var v=j(t,'/p').setQueryData(u);h.log('start_p',{uri:v.toString()});var w=new (c('AjaxRequest'))('GET',v);if(c('AjaxRequest').supportsCORS())w.xhr.withCredentials=true;var x=function(y){h.log('finish_p',{xhr:y.toJSON?y.toJSON():y,subdomain:t.subdomain,fullHost:t.fullHost});};w.onError=function(y){x(y);if(t.subdomain===null)return;t.pingFailuresOnSubdomain++;t.subdomain++;if(t.subdomain>6)t.subdomain=0;};w.timeout=t.P_TIMEOUT;w.onSuccess=x;w.send();}function l(t,u,v){var w=new Image(),x=0,y=function(ba){w.abort();return ba?u():v();};w.onload=c('TimeSlice').guard(function(){h.log('ping_ok',{duration:Date.now()-x});y(true);},'ChannelTransport image.onload');w.onerror=c('TimeSlice').guard(function(){k(t);y(false);},'ChannelTransport image.onerror');var z=c('setTimeoutAcrossTransitions')(w.onerror,10000);w.abort=function(){if(z){clearTimeout(z);z=null;}w.onload=w.onerror=null;};var aa={partition:t.partition,cb:i()};if(t.sticky_token)aa.sticky_token=t.sticky_token;if(t.sticky_pool)aa.sticky_pool=t.sticky_pool;if(t.lastRequestErrorReason){aa.reason=t.lastRequestErrorReason;t.lastRequestErrorReason=null;}if(t.uid&&t.viewerUid){aa.uid=t.uid;aa.viewer_uid=t.viewerUid;}x=Date.now();w.src=j(t,'/ping').setQueryData(aa);return w;}function m(t,u){var v={channel:t.user_channel,partition:t.partition,clientid:t.sessionID,cb:i(),cap:0,uid:t.uid,viewer_uid:t.viewerUid};if(t.sticky_token)v.sticky_token=t.sticky_token;if(t.sticky_pool)v.sticky_pool=t.sticky_pool;if(t.profile)v.profile=t.profile;if(t.capabilities)v.cap=t.capabilities;v.id=u;var w=j(t,'/add_bud').setQueryData(v),x=new (c('AjaxRequest'))('GET',w);if(c('AjaxRequest').supportsCORS())x.xhr.withCredentials=true;x.onError=function(y){h.warn('add_buddy_error');};x.onSuccess=function(y){h.log('add_buddy_ok');};x.timeout=t.P_TIMEOUT;x.send();}function n(t){var u={channel:t.user_channel,partition:t.partition,clientid:t.sessionID,cb:i(),cap:0,uid:t.uid,viewer_uid:t.viewerUid};if(t.sticky_token)u.sticky_token=t.sticky_token;if(t.sticky_pool)u.sticky_pool=t.sticky_pool;if(t.is_offline||t.shouldSuppressPresence){u.state='offline';}else u.state='active';if(u.state===t.lastPresenceState)return;t.lastPresenceState=u.state;if(t.profile)u.profile=t.profile;if(t.capabilities)u.cap=t.capabilities;var v=j(t,'/active_ping').setQueryData(u),w=new (c('AjaxRequest'))('GET',v);if(c('AjaxRequest').supportsCORS())w.xhr.withCredentials=true;w.onError=function(x){h.warn('active_ping_error');};w.onSuccess=function(x){h.log('active_ping_ok');};w.timeout=t.P_TIMEOUT;w.send();}function o(t,u,v,w){var x=new Date(),y=-1;if(t.userActive>0){y=(x-t.userActive)/1000|0;if(y<0)h.warn('idle_regression',{idleTime:y,now:x.getTime(),userActive:t.userActive});}var z={channel:t.user_channel,seq:t.seq,partition:t.partition,clientid:t.sessionID,cb:i(),idle:y,qp:'y',cap:0};if(t.state.aiq)z.aiq=t.state.aiq;if(t.ready)if(t.seqTurSentAt==-1||t.seqTurSentAt==t.seq){z.tur=t.timeUntilReady;z.qpmade=t.queueMade;t.seqTurSentAt=t.seq;}z.pws=t.pws;if(t.sequenceId>0)z.isq=t.sequenceId;z.msgs_recv=t.estimatedReceived;if(t.uid&&t.viewerUid){z.uid=t.uid;z.viewer_uid=t.viewerUid;}if(t.sticky_token){z.sticky_token=t.sticky_token;}else{z.request_batch=1;if(t.msgr_region)z.msgr_region=t.msgr_region;}if(t.sticky_pool)z.sticky_pool=t.sticky_pool;if('trace_id' in t)z.traceid=t.trace_id;if(t.is_offline||t.shouldSuppressPresence){z.state='offline';}else if(t.userActive>0&&y<60)z.state='active';t.lastPresenceState=z.state;if(t.streamingCapable){z.mode='stream';z.format='json';}if(t.profile)z.profile=t.profile;if(t.capabilities)z.cap=t.capabilities;var aa=j(t,'/pull').setQueryData(z),ba='GET',ca=new (c('AjaxRequest'))(ba,aa);if(c('AjaxRequest').supportsCORS())ca.xhr.withCredentials=true;ca.timeout=t.streamingCapable?t.STREAMING_TIMEOUT:t.LONGPOLL_TIMEOUT;ca.onJSON=u;ca.onSuccess=v;ca.onError=function(){var da=this.status==12002&&this._time>=t.MIN_12002_TIMEOUT||this.status==504&&this._time>=t.MIN_504_TIMEOUT,ea=da?v:w;return ea&&ea.apply(this,arguments);};ca.send();t.inStreaming=t.streamingCapable;return ca;}function p(t){this.manager=t;this.init&&this.init();}function q(t){p.apply(this,arguments);}Object.assign(q.prototype,{logName:'CORS',enterState:function(t,u){if(this._request){this._request.abort();this._request=null;}if(t=='init')c('setTimeoutAcrossTransitions')(c('bind')(this.manager,'exitState',{status:c('ChannelConstants').OK,stateId:u.stateId}),0);if(!/pull|ping/.test(t))return;var v=this.manager;if(t=='ping'){this._request=l(u,c('bind')(v,'exitState',{status:c('ChannelConstants').OK,stateId:u.stateId}),c('bind')(v,'exitState',{status:c('ChannelConstants').ERROR,stateId:u.stateId}));}else if(t=='pull')this._request=o(u,c('bind')(v,'_processTransportData',u.stateId),c('bind')(v,'exitState',{status:c('ChannelConstants').OK,stateId:u.stateId}),c('bind')(v,'exitState',{status:c('ChannelConstants').ERROR,stateId:u.stateId}));}});function r(t){h.log('iframe_init_constructor');p.apply(this,arguments);this._iframe=document.createElement('iframe');this._iframe.style.display='none';document.body.appendChild(this._iframe);c('DocRPC').publish(this,'outerTransport');}Object.assign(r.prototype,{logName:'iframe',_initIframe:function(t){h.log('iframe_init_start');window.onchanneliframeready=function(){h.log('iframe_resources');return t.resources;};window.onchanneliframeloaded=function(){h.log('iframe_loaded');};if(t){this._iframeURI=j(t,t.path);if(t.resources){var u=this._iframeURI.getDomain();t.resources=t.resources.map(function(w){var x=new (c('URI'))(w);if(x.getPath().startsWith('/intern/rsrc.php')&&x.getQueryData().origin!==undefined)return x.addQueryData('origin',u).toString();return w;});}}else this._iframeURI='about:blank';this._iframeProxy=null;try{this._iframe.contentWindow.location.replace(this._iframeURI);h.log('iframe_uri_set');}catch(v){h.error('iframe_uri_set_error',v);this.exitState({status:c('ChannelConstants').ERROR,stateId:t.stateId},v+'');}},enterState:function(t,u){if(t=='init'){this._initIframe(u);}else if(/idle|ping|pull/.test(t)){if(this._iframeProxy){this._iframeProxy.enterState.apply(this._iframeProxy,arguments);}else if(t!='idle')this.exitState({status:c('ChannelConstants').ERROR,stateId:u.stateId},'iframe not yet loaded');}else if(t=='shutdown')this._initIframe();},_processTransportData:function(){this.manager._processTransportData.apply(this.manager,arguments);},exitState:function(t){if(this.manager.state=='init'&&t.status==c('ChannelConstants').OK)this._iframeProxy=c('DocRPC').proxy(this._iframe.contentWindow,'innerTransport',['enterState'],(this._iframeURI+'').replace(/iframe.*/,''));if(/ping|pull/.test(this.manager.state)&&!this._iframeProxy)return;this.manager.exitState.apply(this.manager,arguments);}});function s(){this.init=this.init.bind(this);p.apply(this,arguments);}Object.assign(s.prototype,{logName:'iframe(inner)',init:function(){c('DocRPC').publish(this,'innerTransport');try{var u=c('DocRPC').proxy(window.parent,'outerTransport',['_processTransportData','exitState'],top.DocRPC.origin);Object.assign(this,u);this.exitState({status:c('ChannelConstants').OK,stateId:1e+06});}catch(t){h.error('iframe_inner_init_error',t);}},enterState:function(t,u){if(this._request){this._request.abort();this._request=null;}if(t=='ping'){this._request=l(u,c('bind')(this,'exitState',{status:c('ChannelConstants').OK,stateId:u.stateId}),c('bind')(this,'exitState',{status:c('ChannelConstants').ERROR,stateId:u.stateId}));}else if(t=='pull')this._request=o(u,c('bind')(this,'_processTransportData',u.stateId),c('bind')(this,'exitState',{status:c('ChannelConstants').OK,stateId:u.stateId}),c('bind')(this,'exitState',{status:c('ChannelConstants').ERROR,stateId:u.stateId}));}});f.exports={getURI:j,Transport:p,CORSTransport:q,IframeTransport:r,IframeInnerTransport:s,sendActivePing:n,sendAdditionalBuddyRequest:m};},null);
__d('ChatProxyConnectionState',['Map'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();'use strict';function h(){'use strict';this.auxiliaryIrisQueues=new (c('Map'))();this.aiq=null;}h.prototype.subscribeIrisQueue=function(i,j){'use strict';this.auxiliaryIrisQueues.set(i,j);this.updateCaches();};h.prototype.unsubscribeIrisQueue=function(i){'use strict';this.auxiliaryIrisQueues['delete'](i);this.updateCaches();};h.prototype.updateCaches=function(){'use strict';var i=[];this.auxiliaryIrisQueues.forEach(function(j,k,l){i.push(k);i.push(j);},this);if(i.length===0){this.aiq=null;}else this.aiq=i.join(',');};f.exports=h;},null);
__d('FBAjaxRequest',['AjaxRequest','getAsyncParams'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(i,j,k){k=babelHelpers['extends']({},c('getAsyncParams')(i),k);var l=new (c('AjaxRequest'))(i,j,k);l.streamMode=false;var m=l._call;l._call=function(n){if(n=='onJSON'&&this.json){if(this.json.error){this.errorType=c('AjaxRequest').SERVER_ERROR;this.errorText='AsyncResponse error: '+this.json.error;}this.json=this.json.payload;}m.apply(this,arguments);};l.ajaxReqSend=l.send;l.send=function(n){this.ajaxReqSend(babelHelpers['extends']({},n,k));};return l;}f.exports=h;},null);
__d('FantailLogger',['FantailConfig'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=c('FantailConfig').FantailLogQueue,i={debug:function(j,k){var l;for(var m=arguments.length,n=Array(m>2?m-2:0),o=2;o<m;o++)n[o-2]=arguments[o];h&&(l=h.get(j)).debug.apply(l,[k].concat(n));},info:function(j,k){var l;for(var m=arguments.length,n=Array(m>2?m-2:0),o=2;o<m;o++)n[o-2]=arguments[o];h&&(l=h.get(j)).info.apply(l,[k].concat(n));},warn:function(j,k){var l;for(var m=arguments.length,n=Array(m>2?m-2:0),o=2;o<m;o++)n[o-2]=arguments[o];h&&(l=h.get(j)).warn.apply(l,[k].concat(n));},error:function(j,k){var l;for(var m=arguments.length,n=Array(m>2?m-2:0),o=2;o<m;o++)n[o-2]=arguments[o];h&&(l=h.get(j)).error.apply(l,[k].concat(n));}};f.exports=i;},null);
__d("MovingStat",[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(i){i=i||60000;var j={t:new Date(),count:0,v:0},k=j,l=0,m=0;function n(){var o=new Date()-i;while(k&&k.next&&k.t<o){l-=k.v;m-=k.count;k=k.next;}}this.add=function(o){l+=o;m++;var p=new Date();if(p-j.t<1000){j.v+=o;j.count++;}else{j.next={t:p,v:o,count:1};j=j.next;n();}};this.tally=function(o){o=o||1000;n();return {sum:l,count:m,timeAverage:l*o/i};};}f.exports=h;},null);
__d('RTISession',['invariant','URI','AjaxRequest','ErrorUtils'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i='.facebook.com';function j(k,l,m,n,o,p,q,r,s){!k?h(0):void 0;!n?h(0):void 0;!o?h(0):void 0;this.domain=k;this.port=l;this.edgePoolName=m;this.stickyToken=n;this.loggedInId=o;this.accountId=p;this.clientProfile=q||'desktop';this.clientId=r;this.capabilities=s;}j.prototype.issueRequest=function(k,l,m,n,o){!k?h(0):void 0;!l?h(0):void 0;!n?h(0):void 0;var p=this.domain.length-i.length,q=p>0&&this.domain.indexOf(i,p)!==-1,r=q?this.domain:this.domain+i,s=(1048576*Math.random()|0).toString(36),t={cb:s,sticky_token:this.stickyToken,uid:this.loggedInId,viewer_uid:this.accountId,sticky_pool:this.edgePoolName,profile:this.clientProfile,clientid:this.clientId,cap:this.capabilities};for(var u in t)!!l[u]?h(0):void 0;Object.assign(t,l);var v=new (c('URI'))(k).setDomain(r).setPort(this.port).setSecure(new (c('URI'))(window.location.href).isSecure()).setQueryData(t),w=m?'POST':'GET',x=new (c('AjaxRequest'))(w,v);x.timeout=o?o*1000:30000;if(x.xhr)x.xhr.withCredentials=true;var y={};x.onSuccess=function(){};x.onJSON=function(){y.data=x.json;y.error=null;c('ErrorUtils').applyWithGuard(n,this,[y]);}.bind(this);x.onError=function(){y.data=null;y.error=x.errorType||'error';c('ErrorUtils').applyWithGuard(n,this,[y]);}.bind(this);x.send(JSON.stringify(m));};f.exports=j;},null);
__d('ChannelManager',['errorCode','AjaxRequest','Arbiter','AsyncRequest','ChannelClientID','ChannelConstants','ChannelInitialData','ChannelSubdomain','ChannelTransport','ChatConfig','ChatVisibility','ChatReliabilityInstrumentation','DTSG','Env','FantailLogger','FBAjaxRequest','FBRTCSupport','ISB','JSLogger','LogHistory','MessagingRealtimeConstants','MovingStat','PresenceCookieManager','PresenceState','PresenceUtil','RTISession','Run','SystemEvents','URI','UserActivity','ChatProxyConnectionState','requestAnimationFrameAcrossTransitions','setIntervalAcrossTransitions','setTimeoutAcrossTransitions'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i,j=c('JSLogger').create('channel'),k=c('LogHistory').getInstance('channel_manager'),l=null;function m(z){l=z;}var n={idle:{ok:'init!'},init:{ok:'pull!',error:'reconnect',sys_online:'init',sys_timetravel:'init'},pull:{ok:'pull!',error:'ping',error_missing:'pull',error_msg_type:'pull',refresh_0:'reconnect',refresh_110:'reconnect',refresh_111:'reconnect',refresh_112:'pull',refresh_113:'pull',refresh_117:'reconnect'},ping:{ok:'pull!',error:'ping',error_stale:'reconnect!'},reconnect:{ok:'init!',error:'reconnect',sys_online:'reconnect',sys_timetravel:'reconnect'},shutdown:{},_all:{error_max:'shutdown!',error_shutdown:'shutdown!',sys_owner:'reconnect',sys_nonowner:'idle!',sys_online:'ping',sys_offline:'idle!',sys_timetravel:'ping'}},o={state:new (c('ChatProxyConnectionState'))(),userActive:Date.now(),created:Date.now(),ready:false,seqTurSentAt:-1,queueMade:'',sequenceId:0,lastPresenceState:null,lastRequestErrorReason:null,seq:0,pingFailuresOnSubdomain:0,pws:'fresh',estimatedReceived:0,sessionID:c('ChannelClientID').getID(),capabilities:c('FBRTCSupport').getCapabilities(),streamingCapable:false,inStreaming:false,shouldSuppressPresence:c('PresenceState').shouldSuppress(),LONGPOLL_TIMEOUT:60000,STREAMING_TIMEOUT:60000,P_TIMEOUT:30000,IFRAME_LOAD_TIMEOUT:30000,MIN_RETRY_INTERVAL:5000,MAX_RETRY_INTERVAL:320000,MIN_12002_TIMEOUT:9000,MIN_504_TIMEOUT:20000,STALL_THRESHOLD:180000,JUMPSTART_THRESHOLD:90000,MIN_INIT_PROBE_DELAY:3000,INIT_PROBE_DELAY_RANDOMIZE_RANGE:12000,CHANNEL_PROXY_REPORTING_MIN_INTERVAL:10000,PROBE_DELAY:60000,PROBE_HEARTBEATS_INTERVAL_LOW:1000,PROBE_HEARTBEATS_INTERVAL_HIGH:5000,STREAMING_EXIT_STATE_ON_CONTINUE:false},p=1,q={},r=0;function s(){return c('AsyncRequest').lastSuccessTime?Math.round((Date.now()-c('AsyncRequest').lastSuccessTime)/1000):-1;}function t(){var z={};if(i.getConfig('host'))z[i.getConfig('user_channel')]=i.getConfig('seq',0);return z;}function u(){var z=Date.now(),aa=Date.now(),ba={total:0},ca='idle',da=false;c('SystemEvents').subscribe([c('SystemEvents').USER,c('SystemEvents').ONLINE,c('SystemEvents').TIME_TRAVEL],function(ga,ha){w(true);aa=null;i.lastPullTime=Date.now();var ia;switch(ga){case c('SystemEvents').USER:ia=c('SystemEvents').isPageOwner()?c('ChannelConstants').SYS_OWNER:c('ChannelConstants').SYS_NONOWNER;break;case c('SystemEvents').ONLINE:ia=ha?c('ChannelConstants').SYS_ONLINE:c('ChannelConstants').SYS_OFFLINE;break;case c('SystemEvents').TIME_TRAVEL:if(0<ha&&ha<180000&&o.reduceTimeTravel){c('FantailLogger').warn(c('ChannelConstants').FANTAIL_SERVICE,'skipping time travel failure. %d',ha);return;}ia=c('ChannelConstants').SYS_TIMETRAVEL;break;}i.exitState({status:ia,stateId:p});});var ea=function(ga,ha){var ia=Date.now(),ja=null;if(ha){z=ia;ja=ha.nextState||ha.state;}else ja=ca;c('SystemEvents').checkTimeTravel();if(aa){var ka=Math.round((ia-aa)/1000);if(ka>0){ba[ca]=(ba[ca]||0)+ka;ba.total+=ka;}}ca=ja;aa=ia;if(!ga){ba.lastSuccessTime=s();ba.online=c('SystemEvents').isOnline();k.log('rollup',JSON.stringify(ba));}};c('Arbiter').subscribe(c('ChannelConstants').ON_ENTER_STATE,ea);c('setIntervalAcrossTransitions')(ea,60000);c('Arbiter').subscribe(c('JSLogger').DUMP_EVENT,function(ga,ha){ha.channelRollup=ba;});var fa=function(){if(i.isShutdown()||i.shouldIdle())return;c('SystemEvents').checkTimeTravel();var ga=Date.now()-(i.lastPullTime||c('Env').start);if(!da&&ga>o.STALL_THRESHOLD){var ha=s();k.error('stall',JSON.stringify({lastSuccessTime:ha,rollupState:ca}));c('ChatReliabilityInstrumentation').logCHANNEL_STALLED(ga.toString());da=true;}var ia=Date.now()-z;if(i.state=='pull'&&ia>o.JUMPSTART_THRESHOLD){z=null;k.warn('jumpstart',JSON.stringify({state:i.state,dormant:ia}));i.enterState('init');}};c('setIntervalAcrossTransitions')(fa,10000);}function v(){var z=Date.now(),aa=1;function ba(){c('setTimeoutAcrossTransitions')(ba,aa*1000);var ga=i.state;if(ga=='idle'&&i.shouldIdle())return;j.bump('conn_t',aa);if(ga=='pull')j.bump('conn_t_pull',aa);}ba();var ca=[15,30,60,120,240],da=false,ea=false;function fa(ga){c('setTimeoutAcrossTransitions')(function(){j.rate('pullenter_'+ga,da);j.rate('pullexit_'+ga,ea);},ga*1000);}while(ca.length)fa(ca.shift());c('Arbiter').subscribe(c('ChannelConstants').ON_ENTER_STATE,function(ga,ha){if(ha.state=='pull')da=true;z=Date.now();});c('Arbiter').subscribe(c('ChannelConstants').ON_EXIT_STATE,function(ga,ha){if(ha.state!='pull'||!z)return;var ia='other';if(ha.status==c('ChannelConstants').OK){ea=true;ia='ok';}else if(ha.xhr&&ha.xhr.errorType){ia=/ar:(\w+)/.test(ha.xhr.errorType)&&RegExp.$1;}else if(/^sys_/.test(ha.status))return;var ja=(Date.now()-z)/1000;if(ja<0){return;}else if(ja>3600)ja=3600;j.bump('conn_num');j.bump('conn_exit',ja);j.bump('conn_num_'+ia);j.bump('conn_exit_'+ia,ja);});}function w(z){if(z){r=0;q={};}else r++;}function x(){var z=!c('AjaxRequest').supportsCORS()||o.forceIframe;if(o.subdomain===null||z){o.fullHost=o.host;}else o.fullHost=o.subdomain+'-'+o.host;}i={state:'idle',nextState:null,proxyDown:false,lastPullTime:Date.now(),lastReportOnMisguidedMsgTime:Date.now(),heartbeats:[],setTestCallback:m,backoff:false,sessionRegistered:false,init:function(z,aa){this.init=function(){};c('Arbiter').subscribe(c('ChannelConstants').GET_RTI_SESSION_REQUEST,function(event,ea){this.informCurrentSession();}.bind(this));c('requestAnimationFrameAcrossTransitions')(function(){c('FantailLogger').info(c('ChannelConstants').FANTAIL_SERVICE,'client initialized');c('FantailLogger').info(c('ChannelConstants').FANTAIL_SERVICE,'using session id: %s at seq: %d with sticky: %s/%s',o.sessionID,o.sequenceId,o.sticky_token,o.sticky_pool);c('UserActivity').subscribe(function(){o.userActive=Date.now();c('ChannelTransport').sendActivePing(o);});});c('PresenceCookieManager').register('ch',t);var ba=this.getConfig('max_conn',2);o.subdomain=c('ChannelSubdomain').allocate(ba);this._transportRate=new (c('MovingStat'))(30000);var ca=c('AjaxRequest').supportsCORS()&&!o.forceIframe?'CORSTransport':'IframeTransport';this.transport=new (c('ChannelTransport')[ca])(this);if(z)this.enterState(z,aa);c('requestAnimationFrameAcrossTransitions')(function(){c('Arbiter').subscribe(c('JSLogger').DUMP_EVENT,function(event,ea){ea.transportRate=this._transportRate.tally();ea.transportType=ca;ea.transportVersion=2;}.bind(this));u();v();}.bind(this));if(i.getConfig('tryStreaming')&&i.getConfig('host')&&c('AjaxRequest').supportsCORS()&&!o.forceIframe){var da=o.MIN_INIT_PROBE_DELAY+Math.random()*o.INIT_PROBE_DELAY_RANDOMIZE_RANGE;c('setTimeoutAcrossTransitions')(this._probeTest,da);}},configure:function(){for(var z=arguments.length,aa=Array(z),ba=0;ba<z;ba++)aa[ba]=arguments[ba];k.log('configure',JSON.stringify(aa));aa.forEach(function(ca){return Object.assign(o,ca);});x();c('Arbiter').inform(c('ChannelConstants').ON_CONFIG,this);},getConfig:function(z,aa){return z in o?o[z]:aa;},getCompleteConfig:function(){return o;},subscribeIrisQueue:function(z,aa){o.state.subscribeIrisQueue(z,aa);this.exitState({status:c('ChannelConstants').OK,stateId:p});},unsubscribeIrisQueue:function(z){o.state.unsubscribeIrisQueue(z);},informCurrentSession:function(){var z=null;if(this.sessionRegistered&&o&&o.fullHost&&o.sticky_token&&o.uid)z=new (c('RTISession'))(o.fullHost,o.port,o.sticky_pool,o.sticky_token,o.uid,o.viewerUid,o.profile,o.sessionID,o.capabilities);c('Arbiter').inform(c('ChannelConstants').RTI_SESSION,z);},isShutdown:function(){return this.state=='shutdown';},shouldIdle:function(){return !(c('SystemEvents').isPageOwner()&&c('SystemEvents').isOnline());},_sendIframeError:function(z){var aa=new (c('AsyncRequest'))().setURI('/ajax/presence/reconnect.php').setData({reason:z,fb_dtsg:c('DTSG').getToken()}).setOption('suppressErrorHandlerWarning',true).setOption('retries',1).setMethod('GET').setReadOnly(true).setAllowCrossPageTransition(true);aa.specifiesWriteRequiredParams()&&aa.send();},_getDelay:function(){var z=Math.min(o.MIN_RETRY_INTERVAL*Math.pow(2,Math.max(0,r-1)),o.MAX_RETRY_INTERVAL);if(this.proxyDown&&'proxy_down_delay_millis' in o)z=o.proxy_down_delay_millis;this.proxyDown=false;return Math.floor(z*(1+Math.random()*.5));},resetDelay:function(){w(true);},enterState:function(){if(this._inEnterState)k.warn('enterstate_recursion','{}');this._inEnterState=true;try{this._enterState.apply(this,arguments);this._inEnterState=false;}catch(z){this._inEnterState=false;throw z;}},_enterState:function(z){var aa=this.backoff?this._getDelay():0;this.backoff=false;if(this.isShutdown()){c('FantailLogger').warn(c('ChannelConstants').FANTAIL_SERVICE,'not executing state due to shutdown mode: %s',z);return;}if(z!='idle!'&&this.shouldIdle()){c('FantailLogger').warn(c('ChannelConstants').FANTAIL_SERVICE,'forced idleness');return;}p++;o.stateId=p;clearTimeout(this._deferredTransition);this._deferredTransition=null;this.transport.enterState('idle');this.state='idle';this.nextState=null;if(/!$/.test(z)){var ba=this._transportRate.tally().timeAverage,ca=i.getConfig('MAX_CHANNEL_STATES_PER_SEC',1);if(ba>=ca){if(!this._throttled){this._throttled=true;k.warn('throttled','{}');}j.bump('throttle');aa=1000/ca;}}else if(!(/#$/.test(z)))aa=this._getDelay();z=z.replace(/\W*$/,'');if(!n[z]){c('FantailLogger').error(c('ChannelConstants').FANTAIL_SERVICE,'invalid state: %s',z);throw new Error('invalid state:'+z);}var da=Array.from(arguments),ea;if(aa<=0){ea={state:z};this._transportRate.add(1);this.state=z;var fa=this['_enter_'+this.state];if(fa){da.shift();fa.apply(this,da);}if(/init|idle|pull|ping/.test(this.state)){if(o.streamingCapable&&/pull/.test(this.state))this.heartbeats=[];o.is_offline=!c('ChatVisibility').isOnline();o.capabilities=c('FBRTCSupport').getCapabilities();c('FantailLogger').info(c('ChannelConstants').FANTAIL_SERVICE,'entering transport state: %s',this.state);this.transport.enterState(this.state,o);if(this.state=='ping'){ea.url=c('ChannelTransport').getURI(o).toString();ea.port=o.port||'undefined';}}}else{this.state='idle';this.nextState=z;ea={state:this.state,delay:aa,nextState:z};da[0]=z+'#';this._deferredTransition=c('setTimeoutAcrossTransitions')(function(){this._deferredTransition=null;this.enterState.apply(this,da);}.bind(this),aa);}if(/pull/.test(z)){ea.client_id=o.sessionID;ea.streaming=o.inStreaming;}c('Arbiter').inform(c('ChannelConstants').ON_ENTER_STATE,ea);},exitState:function(z,aa){var ba=z.stateId,ca=z.status;if(this.isShutdown()||ba<p)return;var da=this.state,ea=Array.from(arguments);ea[0]=z.status;var fa={state:da,status:ca};if(/pull/.test(da)){fa.client_id=o.sessionID;fa.streaming=o.inStreaming;}if(/ping/.test(da)&&ca!=c('ChannelConstants').OK)fa.url=c('ChannelTransport').getURI(o).toString();if(this.nextState)fa.nextState=this.nextState;if(aa&&aa.errorType){o.lastRequestErrorReason=aa.errorType;fa.xhr=aa.toJSON?aa.toJSON():aa;if(aa.errorType==c('AjaxRequest').SERVICE_UNAVAILABLE){c('FantailLogger').error(c('ChannelConstants').FANTAIL_SERVICE,'got 5xx http status code, setting long delay');this.proxyDown=true;}delete fa.xhr.json;}else if(ca!=c('ChannelConstants').OK)o.lastRequestErrorReason=ca;if(aa&&aa.json){if(aa.json.t)fa.t=aa.json.t;if(aa.json.reason)fa.reason=aa.json.reason;if(aa.json.seq)fa.seq=aa.json.seq;}c('Arbiter').inform(c('ChannelConstants').ON_EXIT_STATE,fa);var ga=this['_exit_'+da];if(ga)ca=ga.apply(this,ea)||ca;if(ca!=c('ChannelConstants').OK){w();q[da]=(q[da]||0)+1;}var ha=n[this.nextState||da][ca]||n._all[ca],ia=ha&&ha.replace(/!*$/,'');if(!ia){k.error('terminal_transition',JSON.stringify(fa));this._shutdownHint=c('ChannelConstants').HINT_INVALID_STATE;ha='shutdown!';c('FantailLogger').error(c('ChannelConstants').FANTAIL_SERVICE,'entering shutdown state');}this._lastState=da;this._lastStatus=ca;this.enterState(ha);},_processTransportData:function(z,aa){this._processTransportData0(z,aa,aa.json);},_processTransportData0:function(z,aa,ba){var ca=ba.t;if('s' in ba){ba.seq=ba.s;delete ba.s;}if(ba.u&&o.user&&ba.u!=o.user){k.warn('misguided_msg',JSON.stringify({user:o.user,target:ba.u}));this._reportProxyMisguidedMsg(ba.u,o.user);return;}var da=o.seq;if('seq' in ba){o.seq=ba.seq;c('PresenceState').doSync();}switch(ca){case 'continue':if(o.inStreaming&&this.heartbeats.length<1){o.streamingCapable=false;k.log('switch_to_longpoll','{}');c('setTimeoutAcrossTransitions')(this._probeTest,o.PROBE_DELAY);}w(true);if(!o.inStreaming||o.STREAMING_EXIT_STATE_ON_CONTINUE)this.exitState({status:c('ChannelConstants').OK,stateId:z});break;case 'refresh':case 'refreshDelay':c('FantailLogger').info(c('ChannelConstants').FANTAIL_SERVICE,'got refresh with reason: %s',ba.reason);this.exitState({status:'refresh_'+(ba.reason||0),stateId:z},aa);break;case 'backoff':c('FantailLogger').warn(c('ChannelConstants').FANTAIL_SERVICE,'server told client to back off');w();this.backoff=true;break;case 'lb':var ea=ba.lb_info;if(ea){o.sticky_token=ea.sticky;if('pool' in ea)o.sticky_pool=ea.pool;if('sd' in ea)o.subdomain=ea.subdomain;if('vip' in ea)o.host=ea.vip;x();}else k.error('missing_lb_info','{}');break;case 'test_streaming':c('setTimeoutAcrossTransitions')(this._probeTest,500);break;case 'fullReload':c('PresenceCookieManager').clear();k.log('full_reload','{}');this.sessionRegistered=true;this.informCurrentSession();c('Arbiter').inform(c('ChannelConstants').ON_INVALID_HISTORY);w(true);c('FantailLogger').info(c('ChannelConstants').FANTAIL_SERVICE,'full reload incurred');var fa=c('ChannelConstants').OK;this.exitState({status:fa,stateId:z},aa);if('ms' in ba)this._processMessages(ba,da);break;case 'msg':w(true);this._processMessages(ba,da);break;case 'heartbeat':if(o.inStreaming){var ga=Date.now();if(this.heartbeats.length>0)var ha=ga-this.heartbeats[this.heartbeats.length-1];k.log('heartbeat_interval',JSON.stringify({client_id:o.sessionID,interval:ha}));this.heartbeats.push(ga);}break;case 'batched':var ia=ba.batches,ja;for(ja=0;ja<ia.length;ja++)this._processTransportData0(z,aa,ia[ja]);break;default:c('FantailLogger').error(c('ChannelConstants').FANTAIL_SERVICE,'got an unknown protocol message: %s',ca);k.error('unknown_msg_type',JSON.stringify({type:ca}));break;}},_processMessages:function(z,aa){var ba,ca,da,ea;if('tr' in z)o.trace_id=z.tr;ca=z.ms;da=o.seq-ca.length;for(ba=0;ba<ca.length;ba++,da++){o.estimatedReceived++;if(da>=aa){ea=ca[ba];if(ea.type){var fa=c('ChannelConstants').getArbiterType(ea.type);if(ea.type==='messaging'){var ga={type:'messaging',event:ea.event};if(ea.message){ga.inbox_unread=ea.unread_counts&&ea.unread_counts.inbox;ga.tid=ea.message.tid;ga.mid=ea.message.mid;c('FantailLogger').info(c('ChannelConstants').FANTAIL_SERVICE,'got message with id: %s',ea.message.mid);}}else if(ea.type==='pages_messaging'){if(ea.unread_counts&&ea.unread_counts.inbox)c('Arbiter').inform(c('ChannelConstants').getArbiterType('pages_inbox_count_update'),{page_id:ea[c('MessagingRealtimeConstants').VIEWER_FBID],inbox_unread:ea.unread_counts.inbox});}else if(ea.type==='skywalker'){fa=c('ChannelConstants').SKYWALKER;}else if(ea.type==='qprimer'){ea.first=!o.ready;if(ea.first){o.ready=true;o.timeUntilReady=Date.now()-o.created;o.queueMade=ea.made;}fa=c('ChannelConstants').CHANNEL_ESTABLISHED;}else if(ea.type==='pws'){o.pws=ea.pws;}else if(ea.type==='delta')o.sequenceId=ea.iseq;c('Arbiter').inform(fa,{obj:ea});}}else k.warn('seq_regression',JSON.stringify({last_seq:aa,messages:ca.length,seq:da}));}},_enter_init:function(){if(q.init>=i.getConfig('MAX_INIT_FAILS',2))return setTimeout(this.exitState.bind(this,{status:c('ChannelConstants').ERROR_MAX,stateId:p}),0);this._initTimer=c('setTimeoutAcrossTransitions')(this.exitState.bind(this,{status:c('ChannelConstants').ERROR,stateId:p},'timeout'),o.IFRAME_LOAD_TIMEOUT);},_enter_reconnect:function(z){k.warn('enter_reconnect',z);c('FantailLogger').info(c('ChannelConstants').FANTAIL_SERVICE,'entered reconnect with reason: %s',z);var aa=p;if(!c('PresenceUtil').hasUserCookie()){c('FantailLogger').warn(c('ChannelConstants').FANTAIL_SERVICE,'user has no cookie???');k.warn('no_user_cookie','{}');setTimeout(function(){i._shutdownHint=c('ChannelConstants').HINT_AUTH;i.exitState({status:c('ChannelConstants').ERROR_SHUTDOWN,stateId:aa});},0);return;}var ba={reason:z,fb_dtsg:c('DTSG').getToken()};if(c('ISB').token)ba.fb_isb=c('ISB').token;if(l)l(ba);var ca=new (c('FBAjaxRequest'))('GET','/ajax/presence/reconnect.php',ba);ca.onSuccess=function(){i.configure(ca.json);c('PresenceCookieManager').store();this.exitState({status:c('ChannelConstants').OK,stateId:aa});}.bind(this);ca.onError=function(){var da=ca.json&&ca.json.error;c('FantailLogger').error(c('ChannelConstants').FANTAIL_SERVICE,'reconnect error: %s',ca.errorType);if(ca.errorType==c('AjaxRequest').TRANSPORT_ERROR||ca.errorType==c('AjaxRequest').PROXY_ERROR||ca.errorType==c('AjaxRequest').SERVICE_UNAVAILABLE)this._shutdownHint=c('ChannelConstants').HINT_CONN;if(da&&da==1356007){this._shutdownHint=c('ChannelConstants').HINT_MAINT;}else if(da==1357001||da==1357004||da==1348009){this._shutdownHint=c('ChannelConstants').HINT_AUTH;}else this._shutdownHint=null;this.exitState({status:this._shutdownHint?c('ChannelConstants').ERROR_SHUTDOWN:c('ChannelConstants').ERROR,stateId:aa},ca);}.bind(this);ca.send();},_enter_shutdown:function(){c('Arbiter').inform(c('ChannelConstants').ON_SHUTDOWN,{reason:this._shutdownHint});if('shutdown_recovery_interval_seconds' in o&&o.shutdown_recovery_interval_seconds>0){var z=o.shutdown_recovery_interval_seconds*1000;c('setTimeoutAcrossTransitions')(function(){c('Arbiter').inform(c('ChannelConstants').ATTEMPT_RECONNECT);this.state='reconnect!';this.enterState('reconnect!');}.bind(this),z);}},_exit_init:function(z){if(this._initTimer)this._initTimer=clearTimeout(this._initTimer);if(z==c('ChannelConstants').ERROR_MAX)this._sendIframeError(c('ChannelConstants').reason_IFrameLoadGiveUp);},_exit_pull:function(z,aa){var ba=z==c('ChannelConstants').OK;if(ba){this.lastPullTime=Date.now();}else{var ca='exit status: '+z;if(aa&&aa.errorType)ca+=' ajax request error: '+aa.errorType;c('FantailLogger').error(c('ChannelConstants').FANTAIL_SERVICE,'pull failed with status: %s',ca);}},_exit_ping:function(z){if(z==c('ChannelConstants').OK){var aa=Date.now()-(this.lastPullTime||c('Env').start);if(aa>o.STALL_THRESHOLD){c('FantailLogger').error(c('ChannelConstants').FANTAIL_SERVICE,'didnt complete a successful pull for too long');return c('ChannelConstants').ERROR_STALE;}}else c('FantailLogger').error(c('ChannelConstants').FANTAIL_SERVICE,'ping failed with status: %s',z);},_reportProxyMisguidedMsg:function(z,aa){c('FantailLogger').error(c('ChannelConstants').FANTAIL_SERVICE,'misguided message to %d meant for %d',aa,z);var ba=Date.now();if(ba-this.lastReportOnMisguidedMsgTime<=o.CHANNEL_PROXY_REPORTING_MIN_INTERVAL)return;this.lastReportOnMisguidedMsgTime=ba;var ca={received_uid:z,expected_uid:aa};if(o.sticky_token)ca.sticky_token=o.sticky_token;var da=new (c('URI'))('/err_misguided_msg').setDomain(o.host+'.'+o.domain).setPort(o.port).setSecure(new (c('URI'))(window.location.href).isSecure()).setQueryData(ca),ea=new (c('AjaxRequest'))('GET',da);if(c('AjaxRequest').supportsCORS())ea.xhr.withCredentials=true;ea.onSuccess=function(fa){};ea.onError=function(fa){};ea.onJSON=function(fa,ga){};ea.send();},_probeTest:function(){o.streamingCapable=false;var z=[],aa={mode:'stream',format:'json'};if(o.sticky_token)aa.sticky_token=o.sticky_token;var ba=new (c('URI'))('/probe').setDomain(o.host+'.'+o.domain).setPort(o.port).setSecure(new (c('URI'))(window.location.href).isSecure()).setQueryData(aa),ca=new (c('AjaxRequest'))('GET',ba);ca.onJSON=function(da,ea){if(da&&da.json&&da.json.t==='heartbeat'){z.push(Date.now());if(z.length>=2){var fa=z[1]-z[0];if(fa>=o.PROBE_HEARTBEATS_INTERVAL_LOW&&fa<=o.PROBE_HEARTBEATS_INTERVAL_HIGH){o.streamingCapable=true;k.log('switch_to_streaming','{}');}}}};ca.onSuccess=function(da){if(z.length!=2){o.streamingCapable=false;k.error('probe_error',JSON.stringify({error:'beats.length = '+z.length}));}k.log('probe_success','{}');};ca.onError=function(da){o.streamingCapable=false;k.error('probe_error',JSON.stringify(da));};ca.send();}};f.exports=i;function y(){if(c('ChannelInitialData').channelConfig){i.configure(c('ChannelInitialData').channelConfig);if(/shutdown/.test(c('ChannelInitialData').state))i._shutdownHint=c('ChannelConstants')[c('ChannelInitialData').reason];i.init(c('ChannelInitialData').state,c('ChannelInitialData').reason);c('ChatReliabilityInstrumentation').logCHANNEL_INIT();}else c('ChatReliabilityInstrumentation').logCHANNEL_NOCONFIG();}if(c('ChatConfig').get('early_channel',false)){y();}else c('Run').onAfterLoad(y);},6);
__d('ChannelConnection',['Arbiter','Run','SystemEvents','ChannelConstants','ChannelManager','Visibility','JSLogger','setTimeoutAcrossTransitions'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=c('JSLogger').create('channel_connection'),i=null,j=null,k=null,l=null,m=0,n=Object.assign(new (c('Arbiter'))(),{CONNECTED:'chat-connection/connected',RECONNECTING:'chat-connection/reconnecting',SHUTDOWN:'chat-connection/shutdown',MUTE_WARNING:'chat-connection/mute',UNMUTE_WARNING:'chat-connection/unmute'});c('Run').onBeforeUnload(function(){});function o(){if(j){clearTimeout(j);j=null;}}function p(){o();h.log('unmute_warning');n.inform(n.UNMUTE_WARNING);}function q(v){o();j=c('setTimeoutAcrossTransitions')(p,v);h.log('mute_warning',{time:v});n.inform(n.MUTE_WARNING);}function r(){if(k){clearTimeout(k);k=null;}}function s(v,w){r();if(v===c('ChannelConstants').ON_ENTER_STATE&&(w.nextState||w.state)==='pull'){if(l!==n.CONNECTED){h.log('connected');var x=!l;l=n.CONNECTED;m=0;n.inform(n.CONNECTED,{init:x});}}else if(v===c('ChannelConstants').ON_ENTER_STATE&&((w.nextState||w.state)==='ping'||!w.nextState&&w.state==='idle')){k=c('setTimeoutAcrossTransitions')(function(){var y=null;if(!(w.state==='idle'&&!w.nextState))y=w.delay||0;h.log('reconnecting',{delay:y});if(n.disconnected())h.log('reconnecting_ui',{delay:y});l=n.RECONNECTING;w.state==='idle'&&m++;if(m>1){n.inform(n.RECONNECTING,y);}else if(!w.nextState&&w.state==='idle')s(v,w);},500);}else if(v===c('ChannelConstants').ON_SHUTDOWN){h.log('shutdown',{reason:w.reason});l=n.SHUTDOWN;m=0;n.inform(n.SHUTDOWN,w.reason);}}function t(){if(c('ChannelManager').isShutdown()){s(c('ChannelConstants').ON_SHUTDOWN,c('ChannelManager')._shutdownHint);}else s(c('ChannelConstants').ON_ENTER_STATE,{state:c('ChannelManager').state,nextState:c('ChannelManager').nextState,delay:0});c('Visibility').addListener(c('Visibility').VISIBLE,n.reconnect);}c('Run').onAfterLoad(t);Object.assign(n,{disconnected:function(){return l===n.SHUTDOWN||l===n.RECONNECTING&&!j&&m>1;},isShutdown:function(){return l===n.SHUTDOWN;},reconnect:function(v){if(c('ChannelManager').state==='ping'||c('ChannelManager').state==='pull'||c('ChannelManager').isShutdown())return;h.log('reconnect',{now:v});n.inform(n.RECONNECTING,0);if(!!v){if(i!==null){clearTimeout(i);i=null;}c('ChannelManager').enterState('ping!');}else if(!i)i=c('setTimeoutAcrossTransitions')(function(){c('ChannelManager').enterState('ping!');i=null;},c('ChannelConstants').CHANNEL_MANUAL_RECONNECT_DEFER_MSEC);c('ChannelManager').resetDelay();},unmuteWarning:p});function u(){c('Arbiter').subscribe([c('ChannelConstants').ON_ENTER_STATE,c('ChannelConstants').ON_SHUTDOWN],s);c('Arbiter').subscribe(c('ChannelConstants').ATTEMPT_RECONNECT,function(){if(n.disconnected())n.reconnect();});c('SystemEvents').subscribe(c('SystemEvents').TIME_TRAVEL,function(){n.reconnect();q(c('ChannelConstants').MUTE_WARNING_TIME_MSEC);});c('Run').onBeforeUnload(r,false);}c('Run').onAfterLoad(u);n.mockAfterLoad=function(){t();u();};f.exports=n;},6);
__d('BuddyListNub',['csx','cx','fbt','Arbiter','AsyncRequest','AvailableList','BootloadedComponent.react','ChannelConnection','ChannelConstants','ChatOptions','ChatSidebarActions','ChatSidebarStore','ChatSidebarVisibility','ChatVisibility','CSS','Dock','DOM','Event','JSLogger','JSResource','KeyEventController','Keys','NubController','OrderedFriendsList','Parent','PresencePrivacy','PresenceStatus','PresenceUtil','React','ReactDOM','Run','SidebarType','Style','Toggler','emptyFunction','setTimeoutAcrossTransitions'],function a(b,c,d,e,f,g,h,i,j){var k,l;if(c.__markCompiled)c.__markCompiled();var m=40,n=253,o='285px',p=c('JSLogger').create('buddylist_nub');k=babelHelpers.inherits(q,c('NubController'));l=k&&k.prototype;function q(r,s,t,u){'use strict';l.constructor.call(this);l.init.call(this,r);this.root=r;this.orderedList=s;this.button=c('DOM').find(r,'a.fbNubButton');this.unreadCount=c('DOM').find(r,"span._5ayx");this.label=c('DOM').find(r,'span.label');this.body=c('DOM').scry(r,'div.fbNubFlyoutBody')[0];this.container=c('Parent').bySelector(r,"._56ox");var v=c('DOM').find(r,'div.fbNubFlyoutTitlebar');c('Toggler').createInstance(v).setSticky(false);c('Toggler').createInstance(r).setSticky(true);if(u)c('Run').onAfterLoad(function(){this.dropdown=c('ReactDOM').render(c('React').createElement(c('BootloadedComponent.react'),{bootloadPlaceholder:c('React').createElement('span',null),bootloadLoader:c('JSResource')('ChatSidebarDropdown.react'),onToggleSidebar:function(){},sidebarType:c('SidebarType').BUDDYLIST}),u);}.bind(this));s.subscribeOnce('render',this.flyoutContentChanged.bind(this));c('Run').onAfterLoad(function(){var w=c('DOM').find(v,"div._4k48");if(w)c('ReactDOM').render(c('React').createElement(c('BootloadedComponent.react'),{bootloadPlaceholder:c('React').createElement('span',null),bootloadLoader:c('JSResource')('ChatSidebarComposeLink.react'),className:"_3a-4"}),w);var x=c('DOM').find(this.button,"div._1us9");if(x)c('ReactDOM').render(c('React').createElement(c('BootloadedComponent.react'),{bootloadPlaceholder:c('React').createElement('span',null),bootloadLoader:c('JSResource')('ChatSidebarComposeLink.react'),className:"_3a-4"}),x);var y=c('DOM').find(this.button,"div._1usa");if(y)c('ReactDOM').render(c('React').createElement(c('BootloadedComponent.react'),{bootloadPlaceholder:c('React').createElement('span',null),bootloadLoader:c('JSResource')('ChatSidebarDropdown.react'),onToggleSidebar:function(){},sidebarType:c('SidebarType').BUDDYLIST_NUB}),y);}.bind(this));s.setScrollContainer(this.body);c('AvailableList').subscribe('buddylist/availability-changed',this._updateCount.bind(this));c('Arbiter').subscribe('chat/connect',function(){return this._handleConnect(true);}.bind(this));c('Arbiter').subscribe('chat/option-changed',function(w,x){if(x.name=='hide_groups'){this.onResize();}else if(x.name==='hide_buddylist')x.value?this.hide():this.show();}.bind(this));c('ChannelConnection').subscribe(c('ChannelConnection').CONNECTED,function(){return this._updateView();}.bind(this));c('ChannelConnection').subscribe(c('ChannelConnection').SHUTDOWN,function(){return this._updateView();}.bind(this));c('ChannelConnection').subscribe(c('ChannelConnection').RECONNECTING,function(){return this._updateView();}.bind(this));c('ChannelConnection').subscribe([c('ChannelConnection').MUTE_WARNING,c('ChannelConnection').UNMUTE_WARNING],function(){return this._updateView();}.bind(this));this.subscribe('show',this.onShow.bind(this));this.subscribe('hide',this.onHide.bind(this));this.subscribe('resize',this.onResize.bind(this));c('Event').listen(r,'keydown',this._onKeyDown.bind(this));c('Event').listen(this.button,'click',this.onButtonClick.bind(this));c('KeyEventController').registerKey('q',function(event){if(!(this._isOpen)){this.onButtonClick();this.show();}event.prevent();}.bind(this));c('Arbiter').subscribe('minisidebar/show',this.hide.bind(this));c('Arbiter').subscribe('sidebar/visibility',function(w,x){if(x){this.hide();}else this._onSidebarHide();}.bind(this));this._orderedListCount=c('OrderedFriendsList').getList().length;c('Style').set(this.body,'min-height',o);c('Arbiter').subscribe('sidebar/typeahead/active',function(w,x){if(x){this._typeaheadActive=true;c('CSS').hide(this.body.parentNode);this.orderedList.hide();this.onResize();}else{this._typeaheadActive=false;this.onResize();c('CSS').show(this.body.parentNode);this.orderedList.show();}}.bind(this));if(c('ChatSidebarStore').isEnabled()&&c('ChatSidebarStore').getVisibleType()===c('SidebarType').BUDDYLIST&&!c('ChatOptions').getSetting('hide_buddylist')&&!c('ChannelConnection').disconnected()&&!c('PresencePrivacy').isUserOffline()&&this._orderedListCount>0)this.show();c('Event').listen(v,'click',function(w){if(c('CSS').matchesSelector(w.target,".titlebarTextWrapper"))this._syncHideBuddylist(true);}.bind(this));this._updateView();p.log('buddylist_initialized');}q.prototype._handleVisibilityChange=function(){'use strict';this._updateView();if(!c('ChatVisibility').isOnline())this.hide();};q.prototype._updateView=function(r){'use strict';var s,t;if(!c('ChatVisibility').isOnline()){s=j._("{Chat} (Off)",[j.param('Chat',j._("Chat"))]);}else if(c('ChannelConnection').disconnected()){s=j._("{Chat} (Disconnected)",[j.param('Chat',j._("Chat"))]);}else{var u=c('PresenceStatus').getOnlineCount();if(u){var v=c('DOM').create('span',{className:'count'},'('+u+')');s=j._({"*":"{Chat} {number-available}"},[j.param('Chat',j._("Chat")),j.param('number-available',v,[0,u])]);}else{s=j._("Chat");t=true;}}this._setPresenceIcon();this._setUnread();this._setLabel(s,t);this.buttonContentChanged();};q.prototype._setPresenceIcon=function(){'use strict';c('CSS').conditionClass(this.root,'offline',!c('ChatVisibility').isOnline()||c('ChannelConnection').disconnected());};q.prototype.onButtonClick=function(){'use strict';if(!c('ChatSidebarStore').isInitialized())return true;var r=c('ChatSidebarStore').isEnabled(),s=c('ChatSidebarVisibility').shouldShowSidebarIgnoreEnabled();if(!r&&s){c('ChatSidebarActions').enable();}else c('ChatSidebarActions').show();return !s;};q.prototype.onHide=function(){'use strict';this._isOpen=false;if(this._buddyListRenderSubscription){this.orderedList.unsubscribe(this._buddyListRenderSubscription);this._buddyListRenderSubscription=null;}this._hideBuddyList();c('Arbiter').inform('buddylist/hide');};q.prototype._onKeyDown=function(event){'use strict';var r=c('Event').getKeyCode(event);if(r===c('Keys').ESC&&!c('CSS').hasClass(this.root,'menuOpened')){this.hide();return false;}else if(r==c('Keys').RETURN)c('ChatSidebarActions').enable();};q.prototype._onSidebarHide=function(event){'use strict';if(c('ChatSidebarStore').isEnabled()&&!c('ChatOptions').getSetting('hide_buddylist')&&!c('ChannelConnection').disconnected()&&!c('PresencePrivacy').isUserOffline()){this.show();}else{this.hide();this.button.focus();}};q.prototype.onResize=function(){'use strict';var r=!this._typeaheadActive?n:c('Dock').getMaxFlyoutHeight(this.root)-60;c('Arbiter').inform('buddyList/resized',r,c('Arbiter').BEHAVIOR_PERSISTENT);if(this._typeaheadActive){c('Style').set(this.body,'max-height','none');}else c('Style').set(this.body,'max-height',o);var s=Math.max(250,r),t=Math.floor(s/m);this.orderedList.setNumTopFriends(t);};q.prototype._showBuddyList=function(){'use strict';this._buddyListRenderSubscription=this.orderedList.subscribe('render',function(){if(c('Style').get(this.body,'height')!=o)c('Style').set(this.body,'height',o);}.bind(this));this.orderedList.show();p.bump('buddylist_show');};q.prototype._hideBuddyList=function(){'use strict';this.orderedList.hide();p.bump('buddylist_hide');};q.prototype.onShow=function(){'use strict';this._isOpen=true;if(c('ChannelConnection').disconnected()){this._tryReconnect();this._showBuddyList();}else c('ChatVisibility').goOnline(this._showBuddyList.bind(this));this._syncHideBuddylist(false);};q.prototype._setLabel=function(r,s){'use strict';var t=this.label.textContent||this.label.innerText;if(t!==r){var u=this.label.cloneNode(true);c('DOM').setContent(u,r);c('DOM').replace(this.label,u);this.label=u;}this.throbber&&c('CSS').conditionShow(this.throbber,!!s);};q.prototype._setUnread=function(r){'use strict';c('CSS').conditionShow(this.unreadCount,!!r);};q.prototype._updateCount=function(){'use strict';this._updateView();};q.prototype._syncHideBuddylist=function(r){'use strict';c('ChatOptions').setSetting('hide_buddylist',r,'buddylist');new (c('AsyncRequest'))('/ajax/chat/settings.php').setHandler(c('emptyFunction')).setErrorHandler(c('emptyFunction')).setData({hide_buddylist:r,window_id:c('PresenceUtil').getSessionID()}).setAllowCrossPageTransition(true).send();};f.exports=q;},null);
__d('ChatSearchSource',['requireWeak','AbstractSearchSource','AsyncRequest','CurrentUser','MercuryConfig','MercuryParticipantTypes','SearchableEntry','SearchSourceCallbackManager','ShortProfiles','TokenizeUtil','debounce','emptyFunction','isValidUniqueID'],function a(b,c,d,e,f,g){'use strict';var h,i;if(c.__markCompiled)c.__markCompiled();var j=null;c('requireWeak')('OrderedFriendsList',function(l){j=l;});h=babelHelpers.inherits(k,c('AbstractSearchSource'));i=h&&h.prototype;function k(l){i.constructor.call(this);this.$ChatSearchSource1=new (c('SearchSourceCallbackManager'))({parseFn:c('TokenizeUtil').parse,matchFn:c('TokenizeUtil').isQueryMatch,indexFn:l.indexFn});this.$ChatSearchSource2=l.queryRequests||[];this.$ChatSearchSource3=false;this.$ChatSearchSource4=c('debounce')(this.$ChatSearchSource4,100,this);}k.prototype.bootstrapImpl=function(l){c('ShortProfiles').fetchAll().done(function(){this.$ChatSearchSource3=true;this.$ChatSearchSource5();l();}.bind(this));};k.prototype.searchImpl=function(l,m,n){var o=null,p={},q=n&&n.onQueryFinished,r=n&&n.onQueryStarted;r&&r(l);var s=this.$ChatSearchSource1.search(l,function(v){if(!o){o=v;o.forEach(function(w){return p[w.getUniqueID()]=true;});}else v.forEach(function(w){var x=w.getUniqueID();if(!p[x]){o.push(w);p[x]=true;}});m(o,l);if(l.length===1&&this.$ChatSearchSource3)q&&q(l);}.bind(this),n);if(!s||!this.$ChatSearchSource2||!this.$ChatSearchSource2.length||l.length===0){q&&q(l);return;}if(l.length===1){if(this.$ChatSearchSource3)q&&q(l);return;}var t={value:l,existing_ids:o&&o.map(function(v){return v.getUniqueID();}).join(','),limit:n&&n.threadLimit},u=this.$ChatSearchSource2.length;this.$ChatSearchSource2.forEach(function(v){this.$ChatSearchSource4(t,v,function(w){this.$ChatSearchSource6(this.$ChatSearchSource7(this.$ChatSearchSource8(w)).filter(function(x){return !!x;}),l);u--;if(u===0){this.$ChatSearchSource1.setQueryStringAsExhausted(l);q&&q(l);}}.bind(this));}.bind(this),this);};k.prototype.getAllEntriesMap=function(){return this.$ChatSearchSource1.getAllEntries();};k.prototype.$ChatSearchSource5=function(){var l=c('ShortProfiles').getCachedProfileIDs(),m=l.filter(function(o){var p=c('ShortProfiles').getNow(o);return (o==c('CurrentUser').getID()||p.type===c('MercuryParticipantTypes').FRIEND||p.type===c('MercuryParticipantTypes').PAGE&&c('MercuryConfig').LinkedAgents&&c('MercuryConfig').LinkedAgents.indexOf(o.toString())>-1);}),n=m.map(this.$ChatSearchSource9);if(n.length)this.$ChatSearchSource1.addLocalEntries(n);};k.prototype.$ChatSearchSource7=function(l){return l.map(this.$ChatSearchSource10,this);};k.prototype.$ChatSearchSource10=function(l,m){if(l.mercury_thread){if(!j)return null;return j.normalizeThreadEntry(l,m);}var n=l.text,o=l.uid;if(!n||!c('isValidUniqueID')(o))return null;return new (c('SearchableEntry'))({uniqueID:o,title:n,order:j?j.getActiveRank(o):0,subtitle:l.subtext,type:l.render_type||l.type,photo:l.photo,uri:l.path,auxiliaryData:{isMessengerUser:l.is_messenger_user,alias:l.alias}});};k.prototype.$ChatSearchSource8=function(l){var m=l.getPayload();if(Array.isArray(m)){return m;}else if(m&&m.entries){return m.entries;}else return [];};k.prototype.$ChatSearchSource9=function(l){var m=c('ShortProfiles').getNow(l),n=l==c('CurrentUser').getID()?c('MercuryParticipantTypes').FRIEND:m.type,o=[m.additionalName,m.alternateName].concat(m.searchTokens||[]).join(' '),p=m.name,q=m.additionalName;if(m.threadNickname){p=m.threadNickname;q=m.name;}return new (c('SearchableEntry'))({uniqueID:l,title:p,order:j?j.getActiveRank(l):0,subtitle:q,keywordString:o,type:n,photo:m.thumbSrc,uri:m.uri,auxiliaryData:{isMessengerUser:m.is_messenger_user,alias:m.alias}});};k.prototype.$ChatSearchSource4=function(l,m,n,o){new (c('AsyncRequest'))(m.uri).setData(babelHelpers['extends']({},l,m.data)).setMethod('GET').setReadOnly(true).setHandler(n).setErrorHandler(o||c('emptyFunction')).setAllowCrossPageTransition(true).send();};k.prototype.$ChatSearchSource6=function(l,m){if(l.length)this.$ChatSearchSource1.addQueryEntries(l,m);};k.prototype.addLocalEntries=function(l){this.$ChatSearchSource1.addLocalEntries(l);};k.prototype.refreshData=function(){c('ShortProfiles').fetchAll();};f.exports=k;},null);
__d('ChatSidebarComposeLink.react',['fbt','ChatOpenTab','Link.react','React','TooltipData'],function a(b,c,d,e,f,g,h){'use strict';var i,j;if(c.__markCompiled)c.__markCompiled();i=babelHelpers.inherits(k,c('React').Component);j=i&&i.prototype;function k(l){j.constructor.call(this,l);}k.prototype.render=function(){var l=h._("New Message");return (c('React').createElement(c('Link.react'),babelHelpers['extends']({className:this.props.className,href:'#',onClick:this.$ChatSidebarComposeLink1},c('TooltipData').propsFor(l))));};k.prototype.$ChatSidebarComposeLink1=function(l){c('ChatOpenTab').openEmptyTab(null,'sidebar');l.preventDefault();};f.exports=k;},null);
__d('ChatSidebarSheetChatOffline.react',['fbt','Link.react','React','ReactComponentWithPureRenderMixin'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=c('React').PropTypes,j=c('React').createClass({displayName:'ChatSidebarSheetChatOffline',mixins:[c('ReactComponentWithPureRenderMixin')],propTypes:{onGoOnlineClick:i.func.isRequired},render:function(){return (c('React').createElement('div',null,h._("{=Go online} to see who's available.",[h.param('=Go online',c('React').createElement(c('Link.react'),{className:'fbChatGoOnlineLink',onClick:this.props.onGoOnlineClick},h._("Turn on chat")))])));}});f.exports=j;},null);
__d('MessengerSpinner.react',['cx','fbt','ix','Image.react','ReactComponentWithPureRenderMixin','React','joinClasses'],function a(b,c,d,e,f,g,h,i,j){'use strict';if(c.__markCompiled)c.__markCompiled();var k=c('React').PropTypes,l=j('/images/mercury/clients/messenger/core/LoadingSpinner.png'),m=j('/images/mercury/clients/messenger/core/LoadingSpinnerGrey.png'),n=j('/images/mercury/clients/messenger/core/LoadingSpinnerExtraLarge.png'),o=24,p=32,q=c('React').createClass({displayName:'MessengerSpinner',mixins:[c('ReactComponentWithPureRenderMixin')],propTypes:{color:k.oneOf(['blue','grey']),size:k.oneOf([o,p])},getDefaultProps:function(){return {color:'blue',size:o};},render:function(){return (c('React').createElement(c('Image.react'),{'aria-label':i._("Loading..."),'aria-busy':true,className:c('joinClasses')(this.props.className,"_3u55 _3qh2"),height:this.props.size,src:this._getSpinnerSrc(),width:this.props.size}));},_getSpinnerSrc:function(){return this.props.size===o?this.props.color==='blue'?l:m:n;}});q.Sizes={LARGE:p,MEDIUM:o};f.exports=q;},null);
__d('ChatSidebarSheetChatReconnectMsg.react',['fbt','ChannelConstants','Link.react','MessengerSpinner.react','ReactComponentWithPureRenderMixin','React'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=c('React').PropTypes,j=c('React').createClass({displayName:'ChatSidebarSheetChatReconnectMsg',mixins:[c('ReactComponentWithPureRenderMixin')],propTypes:{isMessenger:i.bool,msecs:i.number,onManuallyConnectClick:i.func},render:function(){var k=this.props,l=k.isMessenger,m=k.msecs,n=c('React').createElement(c('Link.react'),{className:'fbChatReconnectLink',onClick:this.props.onManuallyConnectClick},h._("No Internet Connection"));if(m==null||false===navigator.onLine){return (l?n:c('React').createElement('div',null,h._("Unable to connect to chat. Check your Internet connection.")));}else if(m>c('ChannelConstants').WARNING_COUNTDOWN_THRESHOLD_MSEC){return (l?n:c('React').createElement('div',null,h._("Unable to connect to chat. {try-again-link}",[h.param('try-again-link',c('React').createElement(c('Link.react'),{className:'fbChatReconnectLink',onClick:this.props.onManuallyConnectClick},h._("Try again")))])));}else if(m>1000){return (l?n:c('React').createElement('div',null,h._("Unable to connect to chat. Reconnecting in {seconds}",[h.param('seconds',Math.floor(m/1000))])));}else return (l?c('React').createElement('div',null,c('React').createElement(c('MessengerSpinner.react'),{color:'grey'}),h._("Connecting...")):c('React').createElement('div',null,h._("Unable to connect to chat. Reconnecting...")));}});f.exports=j;},null);
__d('ChatSidebarSheetChatShutdownMsg.react',['fbt','ChannelConstants','ReactComponentWithPureRenderMixin','React'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=c('React').PropTypes,j=c('React').createClass({displayName:'ChatSidebarSheetChatShutdownMsg',mixins:[c('ReactComponentWithPureRenderMixin')],propTypes:{hint:i.string,isMessenger:i.bool},render:function(){var k=this.props,l=k.hint,m=k.isMessenger;switch(l){case c('ChannelConstants').HINT_AUTH:return (c('React').createElement('div',null,h._("Your session has timed out. Please log in.")));case c('ChannelConstants').HINT_MAINT:return (m?c('React').createElement('div',null,h._("Messenger is currently down for maintenance.")):c('React').createElement('div',null,h._("Facebook {Chat} is currently down for maintenance.",[h.param('Chat',h._("Chat"))])));case c('ChannelConstants').HINT_CONN:default:return (m?c('React').createElement('div',null,h._("Messenger is currently unavailable.")):c('React').createElement('div',null,h._("Facebook {Chat} is currently unavailable.",[h.param('Chat',h._("Chat"))])));}}});f.exports=j;},null);
__d('ChatSidebarSheet.react',['fbt','ChannelConnection','ChatBehavior','ChatSidebarSheetChatOffline.react','ChatSidebarSheetChatReconnectMsg.react','ChatSidebarSheetChatShutdownMsg.react','ChatVisibility','CurrentEnvironment','CSS','JSLogger','PresencePrivacy','ReactComponentWithPureRenderMixin','React','SubscriptionsHandler','emptyFunction','joinClasses','setTimeoutAcrossTransitions'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=c('JSLogger').create('sidebar_sheet'),j=c('React').PropTypes,k=c('React').createClass({displayName:'ChatSidebarSheet',mixins:[c('ReactComponentWithPureRenderMixin')],getInitialState:function(){return {channelStatus:null,channelData:null,isConnected:!c('ChannelConnection').disconnected(),isOnline:c('ChatVisibility').isOnline(),notifiesUserMessages:c('ChatBehavior').notifiesUserMessages()};},getDefaultProps:function(){return {onUpdate:c('emptyFunction')};},_subscriptions:c('SubscriptionsHandler'),_showWarningTimeout:null,componentDidMount:function(){this._subscriptions=new (c('SubscriptionsHandler'))();this._subscriptions.addSubscriptions(c('ChannelConnection').subscribe([c('ChannelConnection').CONNECTED,c('ChannelConnection').SHUTDOWN,c('ChannelConnection').RECONNECTING],this._handleConnectionChange),c('ChannelConnection').subscribe([c('ChannelConnection').MUTE_WARNING,c('ChannelConnection').UNMUTE_WARNING],this._calculateState),c('PresencePrivacy').subscribe('privacy-user-presence-changed',this._calculateState),c('ChatBehavior').subscribe(c('ChatBehavior').ON_CHANGED,this._calculateState));},componentWillUpdate:function(){if(this._showWarningTimeout){clearTimeout(this._showWarningTimeout);this._showWarningTimeout=null;}},componentWillUnmount:function(){this._subscriptions&&this._subscriptions.release();},render:function(){var l=c('CurrentEnvironment').messengerdotcom,m=void 0,n=void 0;if(!this.state.isOnline&&!l){m='offline';n=this._renderOffline();}else if(!this.state.isConnected){m='error';n=this._renderChannelDisconnect(l);}else if(!this.state.notifiesUserMessages&&!l){m='notice';n=this._renderNotice();}if(this.state.channelStatus===c('ChannelConnection').RECONNECTING&&this.state.channelData<1000)m=c('joinClasses')(m,'reconnecting');return (c('React').createElement('div',{className:c('joinClasses')(this.props.className,m)},l?null:c('React').createElement('div',{className:'img'}),c('React').createElement('div',{className:'message'},n)));},_handleConnectionChange:function(l,m){this.setState({channelStatus:l,channelData:m});this._calculateState();},_calculateState:function(){this.setState({isConnected:!c('ChannelConnection').disconnected(),isOnline:c('ChatVisibility').isOnline(),notifiesUserMessages:c('ChatBehavior').notifiesUserMessages()});},_renderChannelDisconnect:function(l){if(this.state.channelStatus===c('ChannelConnection').SHUTDOWN){return (c('React').createElement(c('ChatSidebarSheetChatShutdownMsg.react'),{hint:this.state.channelData,isMessenger:l}));}else if(this.state.channelStatus===c('ChannelConnection').RECONNECTING){var m=this.state.channelData;if(m>1000)this._showWarningTimeout=c('setTimeoutAcrossTransitions')(this._handleConnectionChange.bind(this,c('ChannelConnection').RECONNECTING,m-1000),1000);return (c('React').createElement(c('ChatSidebarSheetChatReconnectMsg.react'),{isMessenger:l,msecs:m,onManuallyConnectClick:function(){return c('ChannelConnection').reconnect();}}));}return null;},_renderOffline:function(){return (c('React').createElement(c('ChatSidebarSheetChatOffline.react'),{onGoOnlineClick:function(l){i.log('sidebar_go_online');c('ChatVisibility').goOnline();}}));},_renderNotice:function(){return (c('React').createElement('div',null,h._("Alerts are off while you use another client to chat.")));}});f.exports=k;},null);
__d('MessengerSearchSource',['ChatSearchSource','MercuryIDs','MercuryParticipants','MercuryParticipantTypes','MercurySingletonProvider','MessengerConfig','SearchableEntry','emptyFunction','requireWeak'],function a(b,c,d,e,f,g){'use strict';var h,i;if(c.__markCompiled)c.__markCompiled();var j=50;h=babelHelpers.inherits(k,c('ChatSearchSource'));i=h&&h.prototype;k.getForFBID=function(m){return l.getForFBID(m);};k.get=function(){return l.get();};function k(m){i.constructor.call(this,{queryRequests:[{uri:'/ajax/mercury/composer_query.php'}]});c('requireWeak')('OrderedFriendsList',function(o){return (o.getSearchableEntries(j,function(p){this.$MessengerSearchSource1=p;i.addLocalEntries.call(this,p);}.bind(this)));}.bind(this));var n=c('MercuryIDs').getParticipantIDFromUserID(m);c('MercuryParticipants').get(n,function(o){i.addLocalEntries.call(this,[new (c('SearchableEntry'))({uniqueID:o.fbid.toString(),title:o.name,type:c('MercuryParticipantTypes').FRIEND,photo:o.big_image_src||o.image_src,uri:o.href,auxiliaryData:{isMessengerUser:o.is_messenger_user}})]);}.bind(this));}k.prototype.bootstrapImpl=function(m){i.bootstrapImpl.call(this,c('emptyFunction'));m();};k.prototype.searchImpl=function(m,n,o){o=o||{};if(m===''&&o.showDefaultEntries){n(this.$MessengerSearchSource1,m);var p=o&&o.onQueryFinished;p&&p(m);return;}o.threadLimit=c('MessengerConfig').MaxThreadResults;i.searchImpl.call(this,m,n,o);};var l=new (c('MercurySingletonProvider'))(k);f.exports=k;},null);
__d('MessengerTypeaheadUtils',['fbt','immutable','MercuryConfig','MercuryTypeaheadConstants','ReactDOM','WorkModeConfig','mapObject'],function a(b,c,d,e,f,g,h){'use strict';var i;if(c.__markCompiled)c.__markCompiled();var j=c('immutable').OrderedMap,k=c('WorkModeConfig').is_work_user?[c('MercuryTypeaheadConstants').FRIEND_TYPE,c('MercuryTypeaheadConstants').FB4C_TYPE,c('MercuryTypeaheadConstants').THREAD_TYPE,c('MercuryTypeaheadConstants').PAGE_TYPE,c('MercuryTypeaheadConstants').NON_FRIEND_TYPE,c('MercuryTypeaheadConstants').MEETING_ROOM_PAGE_TYPE]:[c('MercuryTypeaheadConstants').FRIEND_TYPE,c('MercuryTypeaheadConstants').THREAD_TYPE,c('MercuryTypeaheadConstants').FB4C_TYPE,c('MercuryTypeaheadConstants').PAGE_TYPE,c('MercuryTypeaheadConstants').MEETING_ROOM_PAGE_TYPE,c('MercuryTypeaheadConstants').NON_FRIEND_TYPE],l=(i={},i[c('MercuryTypeaheadConstants').FRIEND_TYPE]={header:h._("Friends")},i[c('MercuryTypeaheadConstants').FB4C_TYPE]={header:h._("Co-workers")},i[c('MercuryTypeaheadConstants').THREAD_TYPE]={header:h._("Group Conversations")},i[c('MercuryTypeaheadConstants').PAGE_TYPE]={header:h._("Businesses")},i[c('MercuryTypeaheadConstants').MEETING_ROOM_PAGE_TYPE]={header:h._("Meeting Rooms")},i[c('MercuryTypeaheadConstants').NON_FRIEND_TYPE]={header:h._("More People")},i),m={sortEntries:function(n,o){var p=[],q=[],r=[],s=[],t=[],u=[];n.forEach(function(v){switch(v.getType()){case c('MercuryTypeaheadConstants').FRIEND_TYPE:p.push(v);break;case c('MercuryTypeaheadConstants').FB4C_TYPE:q.push(v);break;case c('MercuryTypeaheadConstants').THREAD_TYPE:r.push(v);break;case c('MercuryTypeaheadConstants').PAGE_TYPE:case c('MercuryTypeaheadConstants').COMMERCE_PAGE_TYPE:t.push(v);break;case c('MercuryTypeaheadConstants').NON_FRIEND_TYPE:s.push(v);break;case c('MercuryTypeaheadConstants').MEETING_ROOM_PAGE_TYPE:u.push(v);break;}});if(m._shouldHoistPages(o))return t.concat(p,q,r,u,s);return p.concat(q,r,t,u,s);},sortEntriesWithoutPages:function(n){var o=[],p=[],q=[],r=[];n.forEach(function(s){switch(s.getType()){case c('MercuryTypeaheadConstants').FRIEND_TYPE:o.push(s);break;case c('MercuryTypeaheadConstants').FB4C_TYPE:p.push(s);break;case c('MercuryTypeaheadConstants').THREAD_TYPE:q.push(s);break;case c('MercuryTypeaheadConstants').NON_FRIEND_TYPE:r.push(s);break;}});return o.concat(p,q,r);},sortEntriesWithoutGroupsOrViewer:function(n,o){var p=[],q=[],r=[];n.forEach(function(s){if(s.getUniqueID()===o)return;switch(s.getType()){case c('MercuryTypeaheadConstants').FRIEND_TYPE:p.push(s);break;case c('MercuryTypeaheadConstants').FB4C_TYPE:q.push(s);break;case c('MercuryTypeaheadConstants').NON_FRIEND_TYPE:r.push(s);break;}});return p.concat(q,r);},getEntryOrder:function(n){var o=arguments.length<=1||arguments[1]===undefined?k:arguments[1];if(m._shouldHoistPages(n)){o=[].concat(o);o.splice(o.indexOf(c('MercuryTypeaheadConstants').PAGE_TYPE));o.unshift(c('MercuryTypeaheadConstants').PAGE_TYPE);}return o;},buildListSections:function(n,o,p){if(!n.length)return j();p=this.getEntryOrder(o,p);var q=c('mapObject')(l,function(r){return babelHelpers['extends']({},r,{entries:[]});});q[c('MercuryTypeaheadConstants').COMMERCE_PAGE_TYPE]=q[c('MercuryTypeaheadConstants').PAGE_TYPE];n.forEach(function(r){var s=r.getType();if(q[s])q[s].entries.push(r);});return j(p.filter(function(r){return q[r].entries.length;}).map(function(r){return [q[r].header,q[r].entries];}));},scrollEntryIntoView:function(n,o){var p=c('ReactDOM').findDOMNode(o),q=o.getScrollTop(),r=n.offsetTop-q,s=p.offsetHeight-n.offsetHeight;if(r>=s){o.scrollToPosition(q+r-s);}else if(r<0)o.scrollToPosition(q+r);},_shouldHoistPages:function(n){if(!n)return false;return !!(c('MercuryConfig').HoistAgentsKeywords&&c('MercuryConfig').HoistAgentsKeywords.indexOf(n.toLowerCase().trim())!==-1);}};f.exports=m;},null);
__d('MessengerContactAdapters',['immutable','ImmutableObject','MercuryTypeaheadConstants'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={fromSearchableEntry:function(i){var j=i.getType(),k={alias:null,isMessengerUser:null,participants:null,photo:i.getPhoto(),subtitle:i.getSubtitle(),thread:null,title:i.getTitle(),type:j,uid:i.getUniqueID()},l=i.getAuxiliaryData();if(l)if(j===c('MercuryTypeaheadConstants').THREAD_TYPE){k.thread=new (c('ImmutableObject'))(l.thread);k.participants=c('immutable').Map().withMutations(function(m){l.participantsToRender.forEach(function(n){m.set(n.id,n);});});}else{k.isMessengerUser=l.isMessengerUser;k.alias=l.alias;}return new (c('ImmutableObject'))(k);},fromMercuryParticipant:function(i){return new (c('ImmutableObject'))({alias:i.alias,uid:i.id,photo:i.image_src,title:i.name,subtitle:'',type:i.type,isMessengerUser:i.is_messenger_user,href:i.href});}};f.exports=h;},null);
__d('MessengerContactActions',['keyMirror'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();f.exports=c('keyMirror')({ADD_OWNER:null,MESSAGE:null,PROFILE:null,REMOVE:null,REMOVE_OWNER:null,SELECT:null});},null);
__d('MessengerAdminGroupUtils',['fbt','MercuryConfig','MercuryIDs'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i={isViewerAdmin:function(j,k){return this.isAdmin(j,c('MercuryIDs').getParticipantIDFromUserID(k));},isAdmin:function(j,k){return j!==null&&j!==undefined&&j.indexOf(k)!==-1;},getLeaveGroupBodyText:function(j){return j&&c('MercuryConfig').AdminV1MasterGK?h._("Leaving this group will remove you as an owner and allow other members to manage the group. You will no longer be able to send or receive new messages."):h._("You will stop receiving messages from this conversation and people will see that you left.");},getLeaveGroupTitleText:function(j){return j&&c('MercuryConfig').AdminV1MasterGK?h._("Leave this conversation?"):h._("Leave Conversation?");},getLeaveGroupButtonText:function(j){return j&&c('MercuryConfig').AdminV1MasterGK?h._("Leave converstaion"):h._("Leave");},getMakeOwnerBodyText:function(j,k){return j?h._("As a group owner, you will be able to manage group ownership and remove members from the conversation. Only owners will be able to add other owners."):h._("As a group owner, \"{owner's name}\" will be able to manage group ownership and remove members from the conversation. They will be able to remove ownership from other owners.",[h.param('owner\'s name',k)]);},getMakeOwnerTitleText:function(j){return j?h._("Become group owner?"):h._("Add group owner?");},getMakeOwnerButtonText:function(j){return j?h._("Become owner"):h._("Make owner");},getRemoveOwnerBodyText:function(j,k,l){var m=void 0;if(j&&k){m=h._("You will no longer manage group ownership and remove members from this conversation. You will still be a participant in the group. Any other member will be able to own the group.");}else if(j&&!k){m=h._("You will no longer manage group ownership and remove members from this conversation. You will still be a participant in the group.");}else m=h._("\"{owner's name}\" will no longer manage group ownership and remove members from the conversation. They will still be a participant in the group.",[h.param('owner\'s name',l)]);return m;}};f.exports=i;},null);
__d('MessengerProfileImageWrapper.react',['cssVar','cx','ReactComponentWithPureRenderMixin','React','getViewportDimensions','joinClasses'],function a(b,c,d,e,f,g,h,i){'use strict';if(c.__markCompiled)c.__markCompiled();var j=c('React').PropTypes,k=c('React').createClass({displayName:'MessengerProfileImageWrapper',mixins:[c('ReactComponentWithPureRenderMixin')],propTypes:{isMessengerUser:j.bool,showBadge:j.bool,size:j.number,tooltipContent:j.string},render:function(){var m={};if(this.props.tooltipContent){m['data-hover']='tooltip';m['data-tooltip-content']=this.props.tooltipContent;var n=c('getViewportDimensions')().width,o=parseInt("640px".replace('px',''),10);m['data-tooltip-content']=this.props.tooltipContent;m['data-tooltip-position']=n<=o?'above':'left';}return (c('React').createElement('div',babelHelpers['extends']({className:c('joinClasses')("_4ldz",this.props.className),style:{width:this.props.size+'px',height:this.props.size+'px'}},m),c('React').createElement('div',{className:"_4ld-",style:{width:this.props.size+'px',height:this.props.size+'px'}},this.props.children),this._renderBadge()));},_renderBadge:function(){if(!this.props.showBadge||this.props.isMessengerUser==null)return null;return (c('React').createElement(l,{className:"_4ld_",isMessengerUser:this.props.isMessengerUser}));}}),l=c('React').createClass({displayName:'MessengerBadge',mixins:[c('ReactComponentWithPureRenderMixin')],propTypes:{isMessengerUser:j.bool,size:j.number},render:function(){return (c('React').createElement('div',{className:c('joinClasses')(this.props.className,"_2pom")},c('React').createElement('div',{className:"_2pon"+(this.props.isMessengerUser?' '+"_2poo":'')+(!this.props.isMessengerUser?' '+"_2pop":'')})));}});f.exports=k;},null);
__d('MessengerContactImage.react',['Image.react','MessengerProfileImageWrapper.react','ReactComponentWithPureRenderMixin','React'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=c('React').PropTypes,i=c('React').createClass({displayName:'MessengerContactImage',mixins:[c('ReactComponentWithPureRenderMixin')],propTypes:{isMessengerUser:h.bool,size:h.number.isRequired,src:h.string.isRequired},render:function(){return (c('React').createElement('div',{className:this.props.className},c('React').createElement(c('MessengerProfileImageWrapper.react'),{isMessengerUser:this.props.isMessengerUser,size:this.props.size,showBadge:true},c('React').createElement(c('Image.react'),{alt:'',height:this.props.size,src:this.props.src,width:this.props.size}))));}});f.exports=i;},null);
__d('MessengerThreadImage.react',['immutable','ImmutableObject','MercuryIDs','MercuryThreadImage.react','MessengerProfileImageWrapper.react','ReactComponentWithPureRenderMixin','React'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h=c('React').PropTypes,i=c('React').createClass({displayName:'MessengerThreadImage',mixins:[c('ReactComponentWithPureRenderMixin')],propTypes:{participants:h.instanceOf(c('immutable').Map).isRequired,showBadge:h.bool,size:h.number,thread:h.instanceOf(c('ImmutableObject')).isRequired,viewer:h.string.isRequired},getDefaultProps:function(){return {showBadge:true};},render:function(){return (c('React').createElement(c('MessengerProfileImageWrapper.react'),{className:this.props.className,isMessengerUser:this._getIsMessengerUser(),size:this.props.size,showBadge:this.props.showBadge&&c('MercuryIDs').isCanonical(this.props.thread.thread_id)},c('React').createElement(c('MercuryThreadImage.react'),{size:this.props.size,thread:this.props.thread,viewer:this.props.viewer,useBackground:true})));},_getIsMessengerUser:function(){if(!c('MercuryIDs').isCanonical(this.props.thread.thread_id)||this.props.participants.size===0)return null;var j=this.props.thread.other_user_fbid,k=c('MercuryIDs').getParticipantIDFromUserID(j),l=this.props.participants.get(k);return l&&l.is_messenger_user;}});f.exports=i;},null);
__d('MessengerContactListRow.react',['cx','fbt','ix','Image.react','ImageBlock.react','ImmutableObject','Link.react','MercuryConfig','MercuryTypeaheadConstants','MessengerAdminGroupUtils','MessengerContactActions','MessengerContactImage.react','MessengerThreadImage.react','ReactComponentWithPureRenderMixin','React','ReactDOM','joinClasses'],function a(b,c,d,e,f,g,h,i,j){'use strict';if(c.__markCompiled)c.__markCompiled();var k=c('React').PropTypes,l=j('/images/mercury/clients/messenger/core/Checkmark.png'),m=32,n=c('React').createClass({displayName:'MessengerContactListRow',mixins:[c('ReactComponentWithPureRenderMixin')],propTypes:{actionsClass:k.func,className:k.string,contact:k.instanceOf(c('ImmutableObject')).isRequired,disableRole:k.bool,extraActionsEnabled:k.bool.isRequired,isHighlighted:k.bool,isOriginal:k.bool,isSelected:k.bool,onMouseEnter:k.func,onScrollIntoView:k.func,onAction:k.func,presenceStatus:k.bool,viewer:k.string.isRequired,adminIds:k.arrayOf(k.string)},getInitialState:function(){return {isActionsOpen:false};},componentDidMount:function(){if(this.props.isHighlighted&&this.props.onScrollIntoView){var o=c('ReactDOM').findDOMNode(this);this.props.onScrollIntoView&&this.props.onScrollIntoView(o);this.props.onRenderHighlight&&this.props.onRenderHighlight(o);}},componentDidUpdate:function(o){if(this.props.isHighlighted&&!o.isHighlighted){var p=c('ReactDOM').findDOMNode(this);this.props.onScrollIntoView&&this.props.onScrollIntoView(p);this.props.onRenderHighlight&&this.props.onRenderHighlight(p);}},render:function(){var o=this.props.disableRole?{}:{'aria-selected':this.props.isHighlighted,role:'option'};return (c('React').createElement('li',babelHelpers['extends']({},o,{className:c('joinClasses')(this.props.className,"_5l37"+(this.props.isHighlighted?' '+"_1k1p":'')+(this.state.isActionsOpen?' '+"_rwn":''))}),c('React').createElement(c('Link.react'),{className:"_5f0v",onClick:this._handleClick,onMouseDown:this._handleMouseDown,onMouseEnter:this.props.onMouseEnter,tabIndex:this.props.actionsClass?0:-1},c('React').createElement(c('ImageBlock.react'),{contentClassName:"_5l38",spacing:'medium'},this._renderContactImage(),this._renderContactText(),this._renderActions()))));},_handleMouseDown:function(o){if(this.props.actionsClass)return;o.stopPropagation();o.preventDefault();},_handleClick:function(o){o.stopPropagation();this._handleContactAction(c('MessengerContactActions').SELECT,o);},_renderContactImage:function(){if(this.props.contact.photo){return (c('React').createElement(c('MessengerContactImage.react'),{className:"_5l39 _5rmm",isMessengerUser:this.props.contact.isMessengerUser,size:m,src:this.props.contact.photo}));}else if(this.props.contact.type===c('MercuryTypeaheadConstants').THREAD_TYPE)return (c('React').createElement(c('MessengerThreadImage.react'),{className:"_5l39",participants:this.props.contact.participants,size:m,thread:this.props.contact.thread,viewer:this.props.viewer}));},_renderContactText:function(){if(this.props.contact.subtitle){return (c('React').createElement('div',null,c('React').createElement('div',{className:"_3q34"},this.props.contact.title),c('React').createElement('div',{className:"_3q35"},this.props.contact.subtitle)));}else return (c('React').createElement('div',{className:"_364g"},this.props.contact.title));},_renderActions:function(){if(this.props.isOriginal)return (c('React').createElement('span',{className:"_5rh4"},i._("Added")));if(this.props.isSelected)return (c('React').createElement(c('Image.react'),{className:"_1kqm",src:l}));if(this.props.presenceStatus)return (c('React').createElement('div',{className:"_jg2"}));var o=null;if(c('MessengerAdminGroupUtils').isAdmin(this.props.adminIds,this.props.contact.uid)&&c('MercuryConfig').AdminV1MasterGK)o=c('React').createElement('span',{className:"_5qsj"},i._("Owner"));if(this.props.actionsClass){var p=this.props.actionsClass;return (c('React').createElement('div',null,o,c('React').createElement(p,{className:"_rwo",adminIds:this.props.adminIds,contact:this.props.contact,extrasEnabled:this.props.extraActionsEnabled,isOpen:this.state.isActionsOpen,onAction:this._handleContactAction,onToggle:this._handleActionsToggle,viewer:this.props.viewer})));}return o;},_handleContactAction:function(o,event){this.props.onAction&&this.props.onAction(o,event);},_handleActionsToggle:function(o){this.setState({isActionsOpen:o});}});f.exports=n;},null);
__d('MessengerContactListRowContainer.react',['AvailableListConstants','immutable','MercuryIDs','MercuryParticipantTypes','MessengerContactActions','MessengerContactListRow.react','PresenceStatus','ReactComponentWithPureRenderMixin','React'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h=c('React').PropTypes,i=c('React').createClass({displayName:'MessengerContactListRowContainer',mixins:[c('ReactComponentWithPureRenderMixin')],propTypes:{actionsClass:h.func,contactAdapter:h.func.isRequired,disableRole:h.bool,extraActionsEnabled:h.bool.isRequired,hasHoverState:h.bool,isHighlighted:h.bool,onAction:h.func,onHighlight:h.func,onScrollIntoView:h.func,onSelect:h.func.isRequired,rawContact:h.object.isRequired,originalEntryIDs:h.instanceOf(c('immutable').Set),rowClassName:h.string,selectedEntryIDs:h.instanceOf(c('immutable').Set),showPresence:h.bool,viewer:h.string.isRequired,adminIds:h.arrayOf(h.string)},getInitialState:function(){return {contact:this.props.contactAdapter(this.props.rawContact)};},componentWillReceiveProps:function(j){if(j.rawContact!==this.props.rawContact)this.setState({contact:j.contactAdapter(j.rawContact)});},render:function(){return (c('React').createElement(c('MessengerContactListRow.react'),{actionsClass:this.props.actionsClass,className:this.props.rowClassName,contact:this.state.contact,disableRole:this.props.disableRole,extraActionsEnabled:this.props.extraActionsEnabled,isHighlighted:this.props.isHighlighted,isOriginal:this.props.originalEntryIDs&&this.props.originalEntryIDs.contains(this.state.contact.uid),isSelected:this.props.selectedEntryIDs&&this.props.selectedEntryIDs.contains(this.state.contact.uid),onAction:this._handleAction,onRenderHighlight:this.props.onRenderHighlight,onScrollIntoView:this.props.onScrollIntoView,onMouseEnter:this._handleMouseEnter,onSelect:this._handleSelect,presenceStatus:this._getPresenceStatus(),viewer:this.props.viewer,adminIds:this.props.adminIds}));},_handleMouseEnter:function(){if(!this.props.hasHoverState)return;this.props.onHighlight&&this.props.onHighlight(this.props.rawContact);},_handleAction:function(j,event){switch(j){case c('MessengerContactActions').SELECT:this.props.onSelect(this.props.rawContact,event);break;default:this.props.onAction&&this.props.onAction(j,this.props.rawContact);break;}},_getPresenceStatus:function(){var j=this.state.contact;if(!this.props.showPresence||j.type!==c('MercuryParticipantTypes').FRIEND&&j.type!==c('MercuryParticipantTypes').USER)return false;var k=c('MercuryIDs').getUserIDFromParticipantID(j.uid);return c('PresenceStatus').get(k)==c('AvailableListConstants').ACTIVE;}});f.exports=i;},null);
__d('MessengerContactList.react',['cx','fbt','MessengerContactListRowContainer.react','ImageBlock.react','immutable','MessengerSpinner.react','ReactComponentWithPureRenderMixin','React'],function a(b,c,d,e,f,g,h,i){'use strict';if(c.__markCompiled)c.__markCompiled();var j=c('React').PropTypes,k=c('React').createClass({displayName:'MessengerContactList',mixins:[c('ReactComponentWithPureRenderMixin')],propTypes:{actionsClass:j.func,ariaOwneeID:j.string,contactAdapter:j.func.isRequired,disableRole:j.bool,extraActionsEnabled:j.bool,hasHoverState:j.bool,highlightedEntry:j.object,isLoading:j.bool,listSections:j.instanceOf(c('immutable').OrderedMap).isRequired,onHighlight:j.func,onRenderHighlight:j.func,onScrollIntoView:j.func,onSelect:j.func.isRequired,onAction:j.func,originalEntryIDs:j.instanceOf(c('immutable').Set),queryString:j.string,rowClassName:j.string,selectedEntryIDs:j.instanceOf(c('immutable').Set),showPresence:j.bool,viewer:j.string.isRequired,adminIds:j.arrayOf(j.string)},render:function(){return (c('React').createElement('div',{className:this.props.className},this.props.listSections.map(this._renderListSection).toArray(),this._renderSpinner(),this._renderEmptyResult()));},_renderListSection:function(l,m){return (c('React').createElement('div',{key:m,className:"_29hk"},this._renderHeader(m),c('React').createElement('ul',{id:this.props.ariaOwneeID,role:this.props.disableRole?undefined:'listbox',className:"_29hl"},l.map(function(n){return (c('React').createElement(c('MessengerContactListRowContainer.react'),{actionsClass:this.props.actionsClass,contactAdapter:this.props.contactAdapter,disableRole:this.props.disableRole,extraActionsEnabled:!!this.props.extraActionsEnabled,hasHoverState:this.props.hasHoverState,isHighlighted:this.props.highlightedEntry===n,key:n.id||n.getUniqueID(),onHighlight:this.props.onHighlight,onAction:this.props.onAction,onRenderHighlight:this.props.onRenderHighlight,onSelect:this.props.onSelect,onScrollIntoView:this.props.onScrollIntoView,rawContact:n,originalEntryIDs:this.props.originalEntryIDs,rowClassName:this.props.rowClassName,selectedEntryIDs:this.props.selectedEntryIDs,showPresence:this.props.showPresence,viewer:this.props.viewer,adminIds:this.props.adminIds}));}.bind(this)))));},_renderHeader:function(l){if(!l)return null;return (c('React').createElement('div',{className:"_225b"},l));},_renderSpinner:function(){if(!this.props.isLoading)return null;return (c('React').createElement(c('ImageBlock.react'),{className:"_225c",spacing:'medium'},c('React').createElement(c('MessengerSpinner.react'),{className:"_2i59",color:'grey'}),c('React').createElement('div',{className:"_4g0h"},i._("Searching..."))));},_renderEmptyResult:function(){if(this.props.isLoading||this.props.listSections.size>0||!this.props.queryString||this.props.queryString.length===0)return null;return (c('React').createElement('div',{className:"_3xcx"},i._("No results found")));}});f.exports=k;},null);
__d('MessengerTypeaheadView.react',['cx','immutable','MessengerContactAdapters','MessengerContactList.react','MessengerTypeaheadUtils','ReactComponentWithPureRenderMixin','React','joinClasses'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=c('React').PropTypes,j=c('React').createClass({displayName:'MessengerTypeaheadView',mixins:[c('ReactComponentWithPureRenderMixin')],propTypes:{ariaOwneeID:i.string,entries:i.array.isRequired,hasHoverState:i.bool,highlightedEntry:i.object,isLoading:i.bool,onHighlight:i.func,onRenderHighlight:i.func,onScrollIntoView:i.func,onSelect:i.func,originalEntryIDs:i.instanceOf(c('immutable').Set),queryString:i.string,selectedEntryIDs:i.instanceOf(c('immutable').Set),viewer:i.string.isRequired},render:function(){return (c('React').createElement(c('MessengerContactList.react'),{ariaOwneeID:this.props.ariaOwneeID,className:c('joinClasses')(this.props.className,"_5t4c"),contactAdapter:c('MessengerContactAdapters').fromSearchableEntry,hasHoverState:this.props.hasHoverState,highlightedEntry:this.props.highlightedEntry,isLoading:this.props.isLoading,listSections:c('MessengerTypeaheadUtils').buildListSections(this.props.entries,this.props.queryString),onHighlight:this.props.onHighlight,onRenderHighlight:this.props.onRenderHighlight,onScrollIntoView:this.props.onScrollIntoView,onSelect:this.props.onSelect,originalEntryIDs:this.props.originalEntryIDs,queryString:this.props.queryString,selectedEntryIDs:this.props.selectedEntryIDs,showPresence:false,viewer:this.props.viewer}));}});f.exports=j;},null);
__d('MessengerSearchTypeahead.react',['cx','fbt','ix','AbstractTypeahead.react','Image.react','MercuryIDs','MercuryThreadIDMap','MercuryThreads','MercuryTypeaheadConstants','MercuryVanityIDMap','MessengerSearchSource','MessengerTypeaheadUtils','MessengerTypeaheadView.react','React','TypeaheadNavigation','WorkModeConfig'],function a(b,c,d,e,f,g,h,i,j){'use strict';if(c.__markCompiled)c.__markCompiled();var k=c('MercuryThreadIDMap').get(),l=c('MercuryThreads').get(),m=c('React').PropTypes,n=j('/images/mercury/clients/messenger/threadlist/InboxThreadDismiss.png'),o=100,p=c('React').createClass({displayName:'MessengerSearchTypeahead',propTypes:{isFacebookChat:m.bool,isFocused:m.bool,maxEntries:m.number,onBlur:m.func,onChange:m.func,onClear:m.func,onFocus:m.func,onSelect:m.func.isRequired,onScrollIntoView:m.func,queryString:m.string,viewer:m.string.isRequired},getInitialState:function(){return {isLoading:false};},componentWillMount:function(){var q=c('TypeaheadNavigation').moveUp,r=c('TypeaheadNavigation').moveDown;if(this.props.isFacebookChat){q=c('TypeaheadNavigation').moveDown;r=c('TypeaheadNavigation').moveUp;}var s=function(t){var u=[];c('MessengerTypeaheadUtils').getEntryOrder(this.props.queryString).forEach(function(v){return u.push.apply(u,t.filter(function(w){return w.getType()===v;}));});return u;}.bind(this);this._moveUp=function(t){for(var u=arguments.length,v=Array(u>1?u-1:0),w=1;w<u;w++)v[w-1]=arguments[w];return q.apply(undefined,[s(t)].concat(v));};this._moveDown=function(t){for(var u=arguments.length,v=Array(u>1?u-1:0),w=1;w<u;w++)v[w-1]=arguments[w];return r.apply(undefined,[s(t)].concat(v));};},render:function(){var q=this.props.isFacebookChat?i._("Search"):i._("Search for people and groups");return (c('React').createElement('div',{className:"_3rh8"},c('React').createElement(c('AbstractTypeahead.react'),{autoHighlight:this.props.isFacebookChat,className:"_5iwm"+(this.props.isFocused||!!this.props.queryString?' '+"_5iwn":'')+(' '+"_150g"),inputClassName:"_3rhb",navigation:{moveUp:function(){return this._moveUp.apply(this,arguments);}.bind(this),moveDown:function(){return this._moveDown.apply(this,arguments);}.bind(this)},onBlur:this.props.onBlur,onChange:this.props.onChange,onFocus:this.props.onFocus,onSelectAttempt:this._handleSelect,placeholder:q,presenter:{ViewRenderer:c('MessengerTypeaheadView.react'),alwaysVisibleOnFocus:true,extraRendererProps:{className:"_11_d",hasHoverState:this.props.isFacebookChat,isLoading:this.state.isLoading,onScrollIntoView:this.props.onScrollIntoView,viewer:this.props.viewer},maxEntries:this.props.maxEntries||o,sortEntries:this._sortEntries,useLayer:false},queryString:this.props.queryString,role:'search',searchSource:c('MessengerSearchSource').getForFBID(this.props.viewer),searchSourceOptions:{onQueryFinished:this._handleQueryFinished,onQueryStarted:this._handleQueryStarted,showDefaultEntries:true},selectOnTab:true,showEntriesOnFocus:!this.props.isFacebookChat}),c('React').createElement(c('Image.react'),{onMouseDown:this.props.onClear,className:(!this.props.queryString?"hidden_elem":'')+(' '+"_2xme"),src:n})));},_handleQueryStarted:function(q){if(q===this.props.queryString)this.setState({isLoading:true});},_handleQueryFinished:function(q){if(q===this.props.queryString)this.setState({isLoading:false});},_sortEntries:function(q){return c('MessengerTypeaheadUtils').sortEntries(q,this.props.queryString);},_handleSelect:function(q){var r=q.getUniqueID(),s=q.getType(),t=q.getAuxiliaryData().alias;if(t)c('MercuryVanityIDMap').set(t,c('MercuryIDs').getParticipantIDFromUserID(r));if(s===c('MercuryTypeaheadConstants').THREAD_TYPE){k.getClientIDFromServerID(r,function(u){this.props.onSelect(u,s);}.bind(this));}else l.getThreadMeta(c('MercuryIDs').getThreadIDFromUserID(r),function(u){this.props.onSelect(u.thread_id,s);}.bind(this));}});f.exports=p;},null);
__d('ChatTypeaheadWrapper.react',['cx','Arbiter','Bootloader','ChatConfig','ChatOpenTab','ChatSidebarComposeLink.react','ChatSidebarSections','ChatSidebarSheet.react','MessengerSearchTypeahead.react','React','Run','emptyFunction','getActiveElement'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=40,j=c('ChatConfig').get('divebar_rounded_profile',false);function k(m){c('Arbiter').inform('sidebar/typeahead/active',m);}var l=c('React').createClass({displayName:'ChatTypeaheadWrapper',getInitialState:function(){return {height:0,value:'',isSearching:false,dropdownComponent:null};},componentDidMount:function(){if(this.props.isSidebar){c('Arbiter').subscribe('sidebar/resized',function(m,n){this.setState({height:n});}.bind(this));c('Run').onAfterLoad(function(){c('Bootloader').loadModules(["ChatSidebarDropdown.react","SidebarType","ChatSidebarActions"],function(m,n,o){this.setState({dropdownComponent:c('React').createElement(m,{sidebarType:n.SIDEBAR,onToggleSidebar:o.disable})});}.bind(this));}.bind(this));}else c('Arbiter').subscribe('buddyList/resized',function(m,n){this.setState({height:n});}.bind(this));},componentWillUpdate:function(m,n){if(n.isSearching!==this.state.isSearching)k(n.isSearching);},render:function(){var m=this.state.height!=null?Math.floor((this.state.height-i*2)/i):null;return (c('React').createElement('div',{className:!j?"squareProfile":''},c('React').createElement(c('ChatSidebarSheet.react'),{className:'fbChatSidebarMessage'}),c('React').createElement(c('MessengerSearchTypeahead.react'),{isFacebookChat:true,isFocused:true,maxEntries:m,queryString:this.state.value,viewer:this.props.id,onBlur:function(){return this.setState({isSearching:false,value:''});}.bind(this),onChange:function(n){var o=n.target.value;this.setState({isSearching:o!=='',value:o});}.bind(this),onClear:c('emptyFunction'),onFocus:c('emptyFunction'),onScrollIntoView:c('emptyFunction'),onSelect:function(n,o){c('getActiveElement')().blur();c('ChatOpenTab').openTabByType(n,o,c('ChatSidebarSections').TYPEAHEAD);}}),this.props.isSidebar?c('React').createElement('div',{className:"_531b"},this.state.dropdownComponent,c('React').createElement(c('ChatSidebarComposeLink.react'),{className:"_3a-4 _5q85"})):null));}});f.exports=l;},null);
__d('ChatTypeaheadCore',['ChatTypeaheadWrapper.react','React','ReactDOM'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h={init:function(i,j,k){c('ReactDOM').render(c('React').createElement(c('ChatTypeaheadWrapper.react'),{id:j,isSidebar:k}),i);}};f.exports=h;},null);
__d('NotificationBeeperItemCloseButton.react',['cx','fbt','React','XUIAbstractGlyphButton.react'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();var j=c('React').createClass({displayName:'NotificationBeeperItemCloseButton',render:function(){return (c('React').createElement(c('XUIAbstractGlyphButton.react'),babelHelpers['extends']({},this.props,{className:"_3soc",title:i._("Close")})));}});f.exports=j;},null);
__d('SyncRequestAcceptedMessage.react',['fbt','cx','React'],function a(b,c,d,e,f,g,h,i){'use strict';if(c.__markCompiled)c.__markCompiled();var j=c('React').PropTypes,k=c('React').createClass({displayName:'SyncRequestAcceptedMessage',propTypes:{appName:j.string.isRequired,isSender:j.bool.isRequired,receiverName:j.string.isRequired,senderName:j.string.isRequired},render:function(){if(this.props.isSender){return (c('React').createElement('div',null,h._("{receiver} accepted your invite to play {app name}.",[h.param('receiver',c('React').createElement('span',{className:"_dg4"},this.props.receiverName)),h.param('app name',c('React').createElement('span',{className:"_dg5"},this.props.appName))])));}else return (c('React').createElement('div',null,h._("You accepted an invite from {sender} to play {app name}.",[h.param('sender',c('React').createElement('span',{className:"_dg4"},this.props.senderName)),h.param('app name',c('React').createElement('span',{className:"_dg5"},this.props.appName))])));}});f.exports=k;},null);
__d('SyncRequestCanceledMessage.react',['cx','fbt','React'],function a(b,c,d,e,f,g,h,i){'use strict';if(c.__markCompiled)c.__markCompiled();var j=c('React').PropTypes,k=c('React').createClass({displayName:'SyncRequestCanceledMessage',propTypes:{appName:j.string.isRequired,isSender:j.bool.isRequired,receiverName:j.string.isRequired,senderName:j.string.isRequired},render:function(){if(this.props.isSender){return (c('React').createElement('div',null,i._("You canceled an invite to {receiver} to play {app name}.",[i.param('receiver',c('React').createElement('span',{className:"_dg4"},this.props.receiverName)),i.param('app name',c('React').createElement('span',{className:"_dg5"},this.props.appName))])));}else return (c('React').createElement('div',null,i._("{sender} canceled an invitation to play {app name}.",[i.param('sender',c('React').createElement('span',{className:"_dg4"},this.props.senderName)),i.param('app name',c('React').createElement('span',{className:"_dg5"},this.props.appName))])));}});f.exports=k;},null);
__d('SyncRequestExpiredMessage.react',['fbt','cx','React'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();var j=c('React').PropTypes,k=c('React').createClass({displayName:'SyncRequestExpiredMessage',propTypes:{appName:j.string.isRequired,isSender:j.bool.isRequired,receiverName:j.string.isRequired,senderName:j.string.isRequired},render:function(){if(this.props.isSender){return (c('React').createElement('div',null,h._("{receiver} missed your invite to play {app name}.",[h.param('receiver',c('React').createElement('span',{className:"_dg4"},this.props.receiverName)),h.param('app name',c('React').createElement('span',{className:"_dg5"},this.props.appName))])));}else return (c('React').createElement('div',null,h._("You missed an invite from {sender} to play {app name}.",[h.param('sender',c('React').createElement('span',{className:"_dg4"},this.props.senderName)),h.param('app name',c('React').createElement('span',{className:"_dg5"},this.props.appName))])));}});f.exports=k;},null);
__d('SyncRequestRejectedMessage.react',['cx','fbt','AsyncRequest','Link.react','React','URI'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();var j=c('React').PropTypes,k=c('React').createClass({displayName:'SyncRequestRejectedMessage',propTypes:{requestId:j.string.isRequired,app:j.object.isRequired,isSender:j.bool.isRequired,receiver:j.object.isRequired,sender:j.object.isRequired},render:function(){if(this.props.isSender){return (c('React').createElement('div',null,i._("{receiver} declined your invite to play {app_name}.",[i.param('receiver',c('React').createElement('span',{className:"_dg4"},this.props.receiver.name)),i.param('app_name',c('React').createElement('span',{className:"_dg5"},this.props.app.name))])));}else return (c('React').createElement('div',null,i._("You declined an invite from {sender} to play {app_name}.",[i.param('sender',c('React').createElement('span',{className:"_dg4"},this.props.sender.name)),i.param('app_name',c('React').createElement('span',{className:"_dg5"},this.props.app.name))]),c('React').createElement('div',{className:"_13n7"},c('React').createElement('div',null,c('React').createElement(c('Link.react'),{onClick:this._submitBlockApp},i._("Block {app}",[i.param('app',this.props.app.name)]))),c('React').createElement('div',null,c('React').createElement(c('Link.react'),{onClick:this._submitBlockUser},i._("Block requests from {sender}",[i.param('sender',this.props.sender.name)]))))));},_submitBlockApp:function(){var l=new (c('URI'))('/games/block_app/'),m=new (c('AsyncRequest'))().setURI(l);m.setData({app_id:this.props.app.id,source:'sync_request'});m.send();},_submitBlockUser:function(){var l=new (c('URI'))('/games/block_user/'),m=new (c('AsyncRequest'))().setURI(l);m.setData({app_id:this.props.app.id,blockee_uid:this.props.sender.id});m.send();}});f.exports=k;},null);
__d('SyncRequestTimer.react',['fbt','React'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=c('React').PropTypes;function j(l){if(l){l=Math.ceil(l);var m=l%60;if(m<10)m='0'+m;var n=Math.floor(l/60);return n+':'+m;}else return "0:00";}var k=c('React').createClass({displayName:'SyncRequestTimer',propTypes:{timeRemaining:i.number.isRequired,isSender:i.bool.isRequired,receiverName:i.string.isRequired},render:function(){if(this.props.isSender){return (c('React').createElement('div',null,h._("({time_remaining} remaining)",[h.param('time_remaining',j(this.props.timeRemaining))])));}else return (c('React').createElement('div',null,h._("You have {time_remaining} to accept.",[h.param('time_remaining',j(this.props.timeRemaining))])));}});f.exports=k;},null);
__d('SyncRequestTitle.react',['fbt','cx','React'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();var j=c('React').PropTypes,k=c('React').createClass({displayName:'SyncRequestTitle',propTypes:{appName:j.string.isRequired,isSender:j.bool.isRequired,receiverName:j.string.isRequired,senderName:j.string.isRequired},render:function(){if(this.props.isSender){return (c('React').createElement('div',null,h._("Waiting for {receiver} to accept your invite to play {app_name}.",[h.param('receiver',c('React').createElement('span',{className:"_dg4"},this.props.receiverName)),h.param('app_name',c('React').createElement('span',{className:"_dg5"},this.props.appName))])));}else return (c('React').createElement('div',null,h._("{sender} wants to play {app_name} with you, right now.",[h.param('sender',c('React').createElement('span',{className:"_dg4"},this.props.senderName)),h.param('app_name',c('React').createElement('span',{className:"_dg5"},this.props.appName))])));}});f.exports=k;},null);
__d("XSyncRequestSubmitController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/platform\/games\/sync_requests\/submit\/",{request_id:{type:"Int",required:true},sender:{type:"Int",required:true},action:{type:"Int",required:true}});},null);
__d('SyncRequest.react',['cx','fbt','Arbiter','AsyncRequest','ChannelConstants','React','SyncRequestStatusEnum','SyncRequestTitle.react','SyncRequestAcceptedMessage.react','SyncRequestRejectedMessage.react','SyncRequestExpiredMessage.react','SyncRequestCanceledMessage.react','SyncRequestTimer.react','XUIButton.react','XSyncRequestSubmitController','getObjectValues'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();var j=c('React').PropTypes,k=c('React').createClass({displayName:'SyncRequest',propTypes:{app:j.object.isRequired,creationTime:j.number.isRequired,requestId:j.string.isRequired,receiver:j.object.isRequired,sender:j.object.isRequired,status:j.oneOf(c('getObjectValues')(c('SyncRequestStatusEnum'))).isRequired,timeout:j.number.isRequired,timeRemaining:j.number.isRequired,viewerId:j.number.isRequired,onStatusUpdate:j.func},componentWillMount:function(){if(this.props.status===c('SyncRequestStatusEnum').PENDING){var l=c('Arbiter').subscribe(c('ChannelConstants').getArbiterType('sync_request_updated'),function(o,p){p=p.obj;if(p.id.toString()!==this.props.requestId)return;this.setState({status:p.status});}.bind(this));this.setState({statusEvent:l});}var m=null;if(this.props.status===c('SyncRequestStatusEnum').PENDING){var n=function(){this.setState({time_remaining:this.state.time_remaining-1});if(this.state.time_remaining<=0){clearInterval(this.state.counter);var o={counter:null,time_remaining:0};if(this.state.status===c('SyncRequestStatusEnum').PENDING)o.status=c('SyncRequestStatusEnum').EXPIRED;this.setState(o);}};m=setInterval(n.bind(this),1000);}this.setState({time_remaining:this.props.timeRemaining,counter:m});},componentWillUnmount:function(){if(this.state.counter)clearInterval(this.state.counter);c('Arbiter').unsubscribe(this.state.statusEvent);},getInitialState:function(){return {buttonsDisabled:false,time:Date.now(),status:this.props.status,viewerIsSender:this.props.viewerId===this.props.sender.id};},componentDidUpdate:function(l,m){if(this.props.status!=c('SyncRequestStatusEnum').PENDING)this.state.status=this.props.status;if(this.props.onStatusUpdate)this.props.onStatusUpdate(this.state.status,m.status);},render:function(){var l;switch(this.state.status){case c('SyncRequestStatusEnum').PENDING:var m;if(!this.state.viewerIsSender){m=[c('React').createElement(c('XUIButton.react'),{use:'confirm',onClick:this._handleAccept,disabled:this.state.buttonsDisabled,label:i._("Accept")}),c('React').createElement(c('XUIButton.react'),{use:'default',onClick:this._handleReject,disabled:this.state.buttonsDisabled,label:i._("Decline")})];}else m=c('React').createElement(c('XUIButton.react'),{use:'default',onClick:this._handleCancel,disabled:this.state.buttonsDisabled,label:i._("Cancel")});l=c('React').createElement('div',null,c('React').createElement('div',{className:"_372m"},c('React').createElement(c('SyncRequestTitle.react'),{appName:this.props.app.name,isSender:this.state.viewerIsSender,receiverName:this.props.receiver.name,senderName:this.props.sender.name})),c('React').createElement('div',{className:"_372n"},c('React').createElement(c('SyncRequestTimer.react'),{isSender:this.state.viewerIsSender,timeRemaining:this.state.time_remaining,receiverName:this.props.receiver.name})),c('React').createElement('div',{className:"_372o"},m));break;case c('SyncRequestStatusEnum').ACCEPTED:l=c('React').createElement('div',{className:"_372p mvs"},c('React').createElement(c('SyncRequestAcceptedMessage.react'),{appName:this.props.app.name,isSender:this.state.viewerIsSender,receiverName:this.props.receiver.name,senderName:this.props.sender.name}));break;case c('SyncRequestStatusEnum').REJECTED:l=c('React').createElement('div',{className:"_372p mvs"},c('React').createElement(c('SyncRequestRejectedMessage.react'),{requestId:this.props.requestId,app:this.props.app,isSender:this.state.viewerIsSender,receiver:this.props.receiver,sender:this.props.sender}));break;case c('SyncRequestStatusEnum').EXPIRED:l=c('React').createElement('div',{className:"_372p mvs"},c('React').createElement(c('SyncRequestExpiredMessage.react'),{appName:this.props.app.name,isSender:this.state.viewerIsSender,receiverName:this.props.receiver.name,senderName:this.props.sender.name}));break;case c('SyncRequestStatusEnum').CANCELED:l=c('React').createElement('div',{className:"_372p mvs"},c('React').createElement(c('SyncRequestCanceledMessage.react'),{appName:this.props.app.name,isSender:this.state.viewerIsSender,receiverName:this.props.receiver.name,senderName:this.props.sender.name}));break;default:throw new Error('The request status `%s` is unknown.',this.state.status);}return (c('React').createElement('div',{className:"_372q"},l));},_handleAccept:function(){this._handleStatusUpdate(c('SyncRequestStatusEnum').ACCEPTED);var l=window.open(this.props.app.uri);if(l)l.focus();},_handleReject:function(){this._handleStatusUpdate(c('SyncRequestStatusEnum').REJECTED);},_handleCancel:function(){this._handleStatusUpdate(c('SyncRequestStatusEnum').CANCELED);},_handleStatusUpdate:function(l){this.setState({status:l,buttonsDisabled:true});var m=c('XSyncRequestSubmitController').getURIBuilder().setInt('request_id',this.props.requestId).setInt('sender',this.props.sender.id).setInt('action',l).getURI();new (c('AsyncRequest'))().setURI(m).setHandler(function(n){this.setState({status:l});}.bind(this)).setErrorHandler(function(n){this.setState({buttonsDisabled:false});}.bind(this)).send();}});f.exports=k;},null);
__d('isSoftNewlineEvent',['Keys'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();function h(i){return i.which===c('Keys').RETURN&&(i.getModifierState('Shift')||i.getModifierState('Alt')||i.getModifierState('Control'));}f.exports=h;},null);
__d('getTextAfterNearestEntity',[],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();function h(i,j){var k=j;while(k>0&&i.getEntityAt(k-1)===null)k--;return i.getText().slice(k,j);}f.exports=h;},null);
__d('applyEmoticonToContentState',['EmoticonsList','applyEmoticonToContentBlock','getTextAfterNearestEntity'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h=new RegExp(c('EmoticonsList').regexp.source,'g');function i(j,k){var l=k.getAnchorKey(),m=k.getAnchorOffset(),n=j.getBlockForKey(l),o=c('getTextAfterNearestEntity')(n,m),p,q;while(q!==null){q=h.exec(o);if(q!==null)p=q;}if(!p)return j;var r=p[1];if(!r&&m!==o.length)return j;var s=p[2],t=m-o.length,u=t+p.index+p[1].length,v=j.getBlockMap().set(l,c('applyEmoticonToContentBlock')(n,s,u));m-=s.length-1;return j.merge({blockMap:v,selectionBefore:k,selectionAfter:k.merge({anchorOffset:m,focusOffset:m})});}f.exports=i;},null);
__d('handleBeforeInputForEmoticon',['DraftModifier','EditorState','applyEmoticonToContentState'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=new RegExp(/[\s'".,!?]/);function i(j,k){var l=j.getSelection();if(!l.isCollapsed()||!k||!h.test(k))return j;var m=j.getCurrentContent(),n=c('applyEmoticonToContentState')(m,l);if(n===m)return j;var o=c('DraftModifier').insertText(n,n.getSelectionAfter(),k);return c('EditorState').push(j,o,'insert-characters');}f.exports=i;},null);
__d('handleSoftNewlineForEmoticon',['DraftModifier','EditorState','applyEmoticonToContentState'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(i){var j=i.getCurrentContent(),k=i.getSelection(),l=c('applyEmoticonToContentState')(j,k);if(l===j)return i;var m=c('DraftModifier').splitBlock(l,l.getSelectionAfter());return c('EditorState').push(i,m,'split-block');}f.exports=h;},null);
__d("XQuickPromotionSimpleLoggingController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/qp\/action\/log\/",{qp_id:{type:"Int",required:true},qp_action:{type:"Enum",enumType:1},qp_instance_log_data:{type:"StringToStringMap",defaultValue:{}},qp_event:{type:"String"}});},null);
__d('QPRenderer',['$','CSS','XQuickPromotionSimpleLoggingController','AsyncSignal'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=function(m,event,n){var o=c('XQuickPromotionSimpleLoggingController').getURIBuilder().setInt('qp_id',m).setString('qp_event',event).setStringToStringMap('qp_instance_log_data',n).getURI();new (c('AsyncSignal'))(o,{}).send();},i=function(m,n,o){var p=c('XQuickPromotionSimpleLoggingController').getURIBuilder().setInt('qp_id',m).setEnum('qp_action',n).setStringToStringMap('qp_instance_log_data',o).getURI();new (c('AsyncSignal'))(p,{}).send();},j=function(m,n,o,p,q,r){l(m,o,c('$')(p),r,function(){if(q)c('CSS').hide(n);});},k=function(m,n,o){n.show();h(m,'view',{});n.subscribe('cancel',function(){h(m,'dialog_cancel',{});});for(var p=0;p<o.length;p++){var q=o[p],r=c('$')(q.element_id);l(m,q.action,r,q.instance_log_data,function(){if(q.should_close)n.hide();});if(q.action=='primary')r.focus();}},l=function(m,n,o,p,q){o.addEventListener('click',function(){var r=c('XQuickPromotionSimpleLoggingController').getURIBuilder().setInt('qp_id',m).setEnum('qp_action',n).setStringToStringMap('qp_instance_log_data',p).getURI();new (c('AsyncSignal'))(r,{}).send();q();});};g.setAction=j;g.setDialogActionsAndShow=k;g.logAction=i;g.logEvent=h;},null);
__d("XGamesGripperNoteUpdaterController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/async\/games\/gripper_note_viewed\/",{});},null);
__d('SidebarAppTickerResizer',['cx','Animation','Arbiter','AsyncRequest','ChatSidebarActions','ChatSidebarStore','CSS','debounce','Event','SidebarType','SimpleDrag','TickerController','$','ge','queryThenMutateDOM','XGamesGripperNoteUpdaterController'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=1e-07,j=1,k=85,l=173,m=165,n=300,o=46,p=90,q=82,r=150;function s(t,u,v,w,x,y){'use strict';this.$SidebarAppTickerResizer1=c('$')('pagelet_ticker');this.$SidebarAppTickerResizer2=c('$')('pagelet_canvas_nav_content');this.$SidebarAppTickerResizer3=this.$SidebarAppTickerResizer1.parentNode;this.$SidebarAppTickerResizer4=x;this.$SidebarAppTickerResizer5=y;var z=parseInt(v,10);if(!isNaN(z)){if(z>k)if(z!=this.$SidebarAppTickerResizer6())v=this.$SidebarAppTickerResizer6()+'px';this.$SidebarAppTickerResizer7(z);}this.$SidebarAppTickerResizer2.style.height=v;this.$SidebarAppTickerResizer8(t,u);if(v===null)if(w!==null){this.$SidebarAppTickerResizer9();this.$SidebarAppTickerResizer10(this.$SidebarAppTickerResizer6());}else c('Arbiter').subscribe('AppsDivebar/show-apps',this.$SidebarAppTickerResizer9.bind(this));if(!x){this.$SidebarAppTickerResizer11();c('CSS').hide(t);}c('Arbiter').subscribe('ChatSidebarDropdown/closeTicker',this.$SidebarAppTickerResizer11.bind(this));c('Arbiter').subscribe('ChatSidebarDropdown/openTicker',this.$SidebarAppTickerResizer12.bind(this));c('Arbiter').subscribe('sidebar/visibility',function(fa,ga){if(ga)this.$SidebarAppTickerResizer13();}.bind(this));if(w){var aa=c('ge')('pagelet_ticker'),ba=aa&&aa.parentNode,ca,da=function(){w.hide();if(ca)ca.unsubscribe();},ea=function(){if(!c('CSS').shown(ba))return;var fa=c('XGamesGripperNoteUpdaterController').getURIBuilder().getURI();new (c('AsyncRequest'))().setURI(fa).send();w.show();if(ca)ca.unsubscribe();ca=c('Arbiter').subscribe('sidebar/visibility',function(ga,ha){if(!ha)da();});};if(ba&&c('CSS').shown(ba)){ea();}else ca=c('Arbiter').subscribe('ticker/show',ea);}this.$SidebarAppTickerResizer14=c('debounce')(this.$SidebarAppTickerResizer9.bind(this),200);c('Event').listen(window,'resize',this.$SidebarAppTickerResizer14);c('Arbiter').inform('Ticker/resized');}s.prototype.$SidebarAppTickerResizer13=function(){'use strict';c('TickerController').show(this.$SidebarAppTickerResizer1);};s.prototype.$SidebarAppTickerResizer9=function(t){'use strict';c('queryThenMutateDOM')(function(){this.$SidebarAppTickerResizer15();}.bind(this),function(){var u=Math.round(parseFloat(this.$SidebarAppTickerResizer1.style.height));if(u>Math.round(this.$SidebarAppTickerResizer16())||this.$SidebarAppTickerResizer17&&this.$SidebarAppTickerResizer17>j){var v=this.$SidebarAppTickerResizer17/this.$SidebarAppTickerResizer18*100,w=this.$SidebarAppTickerResizer19(0,this.$SidebarAppTickerResizer16()-v);if(!(t&&t.type==='resize'))this.$SidebarAppTickerResizer20(w);c('ChatSidebarActions').show();}}.bind(this));};s.prototype.$SidebarAppTickerResizer16=function(){'use strict';if(!this.$SidebarAppTickerResizer4)return 0;if(c('ChatSidebarStore').getVisibleType()!==c('SidebarType').SIDEBAR)return p;return Math.min(p,(this.$SidebarAppTickerResizer18-this.$SidebarAppTickerResizer21-q)*100/this.$SidebarAppTickerResizer18);};s.prototype.$SidebarAppTickerResizer8=function(t,u){'use strict';var v=new (c('SimpleDrag'))(t);v.subscribe('start',this.$SidebarAppTickerResizer22.bind(this));v.subscribe(['update','end'],this.$SidebarAppTickerResizer23.bind(this));var w=new (c('SimpleDrag'))(u);w.subscribe('start',this.$SidebarAppTickerResizer22.bind(this));w.subscribe('update',this.$SidebarAppTickerResizer24.bind(this));w.subscribe('end',this.$SidebarAppTickerResizer25.bind(this));};s.prototype.$SidebarAppTickerResizer22=function(t,event){'use strict';this.$SidebarAppTickerResizer26=event.clientY;this.$SidebarAppTickerResizer15();this.$SidebarAppTickerResizer27();};s.prototype.$SidebarAppTickerResizer15=function(){'use strict';this.$SidebarAppTickerResizer21=this.$SidebarAppTickerResizer2.offsetTop;this.$SidebarAppTickerResizer28=this.$SidebarAppTickerResizer1.offsetHeight;this.$SidebarAppTickerResizer18=this.$SidebarAppTickerResizer3.offsetHeight;this.$SidebarAppTickerResizer17=this.$SidebarAppTickerResizer2.offsetHeight;this.$SidebarAppTickerResizer29=this.$SidebarAppTickerResizer17;};s.prototype.$SidebarAppTickerResizer27=function(){'use strict';c('CSS').addClass(this.$SidebarAppTickerResizer3,"_4vfq");};s.prototype.$SidebarAppTickerResizer30=function(){'use strict';c('CSS').removeClass(this.$SidebarAppTickerResizer3,"_4vfq");};s.prototype.$SidebarAppTickerResizer23=function(t,event){'use strict';var u=this.$SidebarAppTickerResizer17/this.$SidebarAppTickerResizer18*100,v=this.$SidebarAppTickerResizer19(event.clientY-this.$SidebarAppTickerResizer26,this.$SidebarAppTickerResizer16()-u);if(t=='end'){this.$SidebarAppTickerResizer30();this.$SidebarAppTickerResizer20(v);}c('ChatSidebarActions').show();};s.prototype.$SidebarAppTickerResizer24=function(t,event){'use strict';var u=-this.$SidebarAppTickerResizer17,v=this.$SidebarAppTickerResizer6()-this.$SidebarAppTickerResizer17,w=this.$SidebarAppTickerResizer31(event.clientY-this.$SidebarAppTickerResizer26,u,v);this.$SidebarAppTickerResizer19(-w,this.$SidebarAppTickerResizer16());this.$SidebarAppTickerResizer29=this.$SidebarAppTickerResizer17+w;this.$SidebarAppTickerResizer29=Math.max(j,this.$SidebarAppTickerResizer29);this.$SidebarAppTickerResizer2.style.height=this.$SidebarAppTickerResizer29+'px';};s.prototype.$SidebarAppTickerResizer25=function(t,event){'use strict';var u=this.$SidebarAppTickerResizer29,v=this.$SidebarAppTickerResizer32(this.$SidebarAppTickerResizer29);this.$SidebarAppTickerResizer7(v);var w=this.$SidebarAppTickerResizer19(this.$SidebarAppTickerResizer17-v,this.$SidebarAppTickerResizer16());if(this.$SidebarAppTickerResizer17!=v){this.$SidebarAppTickerResizer10(v);this.$SidebarAppTickerResizer20(w);}new (c('Animation'))(this.$SidebarAppTickerResizer2).from('height',u).to('height',v).duration(n).go();};s.prototype.$SidebarAppTickerResizer7=function(t){'use strict';if(!this.$SidebarAppTickerResizer5)return;var u="_3qrt",v=document.getElementsByClassName(u),w='';if(t==this.$SidebarAppTickerResizer33()){w='inline';}else w='';for(var x=0;x<v.length;x++)v[x].style.display=w;};s.prototype.$SidebarAppTickerResizer19=function(t,u){'use strict';var v=this.$SidebarAppTickerResizer28+t,w=v/this.$SidebarAppTickerResizer18*100;w=Math.max(i,Math.min(u,w));this.$SidebarAppTickerResizer1.style.height=w+'%';if(w!=i){c('CSS').removeClass(this.$SidebarAppTickerResizer1,'hidden_elem');this.$SidebarAppTickerResizer13();}return w;};s.prototype.$SidebarAppTickerResizer32=function(t){'use strict';var u=this.$SidebarAppTickerResizer33(),v=this.$SidebarAppTickerResizer6();return t<v-o?t<u-o?j:u:v;};s.prototype.$SidebarAppTickerResizer33=function(){'use strict';return k;};s.prototype.$SidebarAppTickerResizer6=function(){'use strict';if(this.$SidebarAppTickerResizer5){return m;}else return l;};s.prototype.$SidebarAppTickerResizer34=function(t){'use strict';var u=this.$SidebarAppTickerResizer6();return t<0?j:t>u?u:t;};s.prototype.$SidebarAppTickerResizer31=function(t,u,v){'use strict';return t<u?u:t>v?v:t;};s.prototype.$SidebarAppTickerResizer20=function(t){'use strict';new (c('AsyncRequest'))('/ajax/feed/ticker/resize').setData({height:''+t}).setMethod('POST').send();c('Arbiter').inform('Ticker/resized');};s.prototype.$SidebarAppTickerResizer10=function(t){'use strict';new (c('AsyncRequest'))('/ajax/feed/apps/resize').setData({height:''+t}).setMethod('POST').send();};s.prototype.$SidebarAppTickerResizer35=function(t){'use strict';var u=this.$SidebarAppTickerResizer28,v=this.$SidebarAppTickerResizer18*t/100;new (c('Animation'))(this.$SidebarAppTickerResizer1).from('height',u).to('height',v).duration(r).ondone(function(){this.$SidebarAppTickerResizer1.style.height=t+'%';this.$SidebarAppTickerResizer20(t===0?'0.0':t);c('ChatSidebarActions').show();}.bind(this)).go();};s.prototype.$SidebarAppTickerResizer11=function(){'use strict';this.$SidebarAppTickerResizer15();this.$SidebarAppTickerResizer35(0);};s.prototype.$SidebarAppTickerResizer12=function(){'use strict';this.$SidebarAppTickerResizer1.style.height='40px';c('TickerController').show(this.$SidebarAppTickerResizer1,function(){this.$SidebarAppTickerResizer15();var t=(this.$SidebarAppTickerResizer18-this.$SidebarAppTickerResizer21-q-this.$SidebarAppTickerResizer17)*50/this.$SidebarAppTickerResizer18;this.$SidebarAppTickerResizer35(t);}.bind(this));};f.exports=s;},null);
__d('JewelQPLogging',['QPRenderer'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=false,i=null,j=false;function k(){if(j)return;if(h&&i){j=true;c('QPRenderer').logEvent(i.promotion_id,'view',i.instance_log_data?i.instance_log_data:{});}}var l={onJewelOpened:function(){h=true;k();},updateQPLogData:function(m){i=m;k();}};f.exports=l;},null);
__d('RequestsJewel',['fbt','Animation','AccessibilityLogger','Arbiter','AsyncRequest','AsyncSignal','ChannelConstants','CSS','DOM','Event','LinkController','Parent','ScrollableArea','Vector','MarauderLogger','$','debounce','ge','shield','JewelQPLogging','requireWeak'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=null;c('requireWeak')('FriendBrowserCheckboxController',function(n){return i=n;});var j=530,k=30,l=160;m.instance=null;m.getInstance=function(){'use strict';return m.instance;};m.replaceJewelTitle=function(n,o){'use strict';c('DOM').setContent(c('$')(n),o);};m.updateFromDOM=function(){'use strict';if(m.instance)m.instance.fromDom();};m.setupScroll=function(){'use strict';if(m.instance)m.instance.setupScroll();};m.setInitialHeight=function(){'use strict';if(m.instance)m.instance.setHeight();};m.maybeLoadJewel=function(){'use strict';if(m.instance)m.instance.maybeLoadJewel();};function m(n,o,p){'use strict';var q=o;if(typeof o!=='string'){q=o.inbox_folder;p=o.do_new_mark_read;}m.instance=this;this.countNew=0;this.jewel=n;this.jewelFlyoutCase=n.getRoot();this.jewelFlyout=c('ge')('fbRequestsFlyout');this.newCountSpan=c('ge')('newRequestCount');this.folder=q;this.doNewMarkRead=p;this.openTimestamp=0;this.$RequestsJewel1={};this.$RequestsJewel2=0;this.shouldClearPredictionAssocOnClick=false;this.$RequestsJewel3=-1;this.jewel.subscribe('marked-seen',c('shield')(this.$RequestsJewel4,this));this.jewel.subscribe('closed',c('shield')(this.$RequestsJewel5,this));this.jewel.subscribe('updated',this.$RequestsJewel6.bind(this));this.jewel.subscribe('opened',this.$RequestsJewel7.bind(this));c('LinkController').registerHandler(this.$RequestsJewel8.bind(this));c('Arbiter').subscribe(c('ChannelConstants').getArbiterType('jewel_requests_add'),this.$RequestsJewel9.bind(this));c('Arbiter').subscribe(c('ChannelConstants').getArbiterType('jewel_friending_notifs'),this.$RequestsJewel10.bind(this));c('Arbiter').subscribe(c('ChannelConstants').getArbiterType('jewel_requests_remove_old'),this.$RequestsJewel11.bind(this));c('Arbiter').subscribe(c('ChannelConstants').getArbiterType('friend_requests_seen'),this.$RequestsJewel12.bind(this));c('Event').listen(this.jewelFlyout,'submit',function(s){var t=c('Parent').byClass(s.getTarget(),'objectListItem');if(t){c('CSS').removeClass(t,'jewelItemNew');c('CSS').addClass(t,'jewelItemResponded');}});var r=c('DOM').find(c('ge')('fbRequestsJewel'),'a[rel="toggle"]');c('Event').listen(r,'focus',function(){c('AccessibilityLogger').logFocusIn();});this.setupScroll();c('Event').listen(window,'resize',c('debounce')(function(){this.$RequestsJewel13();}.bind(this)));c('Arbiter').subscribe('pymk-x-out',function(s,t){var u=t.location;if(u==='pymk_jewel_first_page'||u==='pymk_jewel')this.$RequestsJewel14();}.bind(this));}m.prototype.setupScroll=function(){'use strict';var n=c('DOM').scry(this.jewelFlyout,'.uiScrollableAreaWrap')[0];if(n){this.$RequestsJewel15=n;this.$RequestsJewel16=0;this.$RequestsJewel17=c('Event').listen(n,'scroll',this.$RequestsJewel18.bind(this),c('Event').Priority.$RequestsJewel19);this.$RequestsJewel14();}};m.prototype.fromDom=function(){'use strict';c('DOM').scry(this.jewelFlyout,'.jewelItemList li.objectListItem').forEach(function(n){var o=n.getAttribute('id');if(o){var p=this.$RequestsJewel20(o);if(p.requester)this.$RequestsJewel1[p.requester]=o;++this.$RequestsJewel2;}}.bind(this));this.$RequestsJewel21();};m.prototype.$RequestsJewel22=function(n){'use strict';var o=n.match(/^(\d+)_(\d+)/);return o?{requester:o[1],type:o[2]}:undefined;};m.prototype.$RequestsJewel20=function(n){'use strict';var o=n?this.$RequestsJewel22(n):undefined,p;if(o&&o.requester){p=parseInt(o.requester,10);if(isNaN(p))p=undefined;}var q;if(o&&o.type){q=parseInt(o.type,10);if(isNaN(q))q=undefined;}return {requester:p,type:q};};m.prototype.$RequestsJewel23=function(){'use strict';if(this.countNew>0)this.countNew-=1;};m.prototype.$RequestsJewel8=function(n,event){'use strict';var o=c('Parent').byClass(n,'jewelItemNew');if(o&&c('Parent').byClass(o,'fbRequestList')&&c('Parent').byClass(o,'beeperEnabled')){var p=this.$RequestsJewel22(o.id);p&&this.$RequestsJewel4(p.requester,p.type);this.$RequestsJewel23();c('Arbiter').inform('jewel/count-updated',{jewel:'requests',count:this.countNew});c('CSS').removeClass(o,'jewelItemNew');}return true;};m.prototype.$RequestsJewel24=function(){'use strict';return c('DOM').scry(this.jewelFlyout,'.uiScrollableArea')[0];};m.prototype.$RequestsJewel18=function(){'use strict';var n=c('DOM').scry(this.$RequestsJewel15,'.uiMorePager');if(!n)return;var o=n.pop();if(o){var p=c('Vector').getElementPosition(o,'viewport').y;if(p>0)c('CSS').addClass(c('Parent').byClass(this.$RequestsJewel15,'uiScrollableArea'),'contentAfter');var q=c('DOM').find(o,'a');if(!q)return;var r=c('Vector').getElementPosition(q,'viewport').y;if(r==this.$RequestsJewel16)return;var s=c('Vector').getElementPosition(this.$RequestsJewel15,'viewport').y+c('Vector').getElementDimensions(this.$RequestsJewel15).y;if(r-300<s&&r>0){this.$RequestsJewel16=r;var t=q.getAttribute('ajaxify');if(t){new (c('AsyncRequest'))(t).setRelativeTo(q).setStatusElement(c('Parent').byClass(q,'stat_elem')).send();}else i&&i.getInstance('jewel').showMore();}}this.$RequestsJewel14();};m.prototype.$RequestsJewel25=function(){var n=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];'use strict';var o=!c('ge')('fbRequestsJewelLoading');new (c('AsyncRequest'))().setURI('/ajax/requests/loader/').setData(babelHelpers['extends']({},n,{reloadcontent:o})).send();};m.prototype.$RequestsJewel10=function(n,o){'use strict';if(!o||this.jewel.isOpen())return;if(o.obj.notif_type!=='friend_confirmed')return;this.$RequestsJewel25();};m.prototype.$RequestsJewel9=function(n,o){'use strict';if(!o)return;var p=o.obj,q=p.from,r=p.suggester,s=this.$RequestsJewel20(this.$RequestsJewel1[q]).type,t=s===19&&!r;if(!t&&(s||this.jewel.isOpen()))return;this.$RequestsJewel25();};m.prototype.$RequestsJewel11=function(n,o){'use strict';if(!o||this.jewel.isOpen()||c('ge')('fbRequestsJewelLoading')!==null)return;var p=this.$RequestsJewel1[o.obj.from],q=p&&c('ge')(p);if(q){if(c('CSS').hasClass(q,'jewelItemNew')){this.$RequestsJewel23();c('Arbiter').inform('jewel/count-updated',{jewel:'requests',count:this.countNew});}if(!c('CSS').hasClass(q,'jewelItemResponded')){c('DOM').remove(q);delete this.$RequestsJewel1[o.obj.from];--this.$RequestsJewel2;this.$RequestsJewel21();}}};m.prototype.$RequestsJewel4=function(n,o){'use strict';var p=c('DOM').scry(this.jewelFlyout,'li');new (c('AsyncSignal'))('/ajax/gigaboxx/endpoint/UpdateLastSeenTime.php',{folder:this.folder,first_item:p[0].id}).send();var q=n!==undefined&&o!==undefined?{requester:n,type:o}:{};this.doNewMarkRead&&new (c('AsyncSignal'))('/ajax/requests/mark_read/',q).send();};m.prototype.$RequestsJewel12=function(n,o){'use strict';c('Arbiter').inform('jewel/count-updated',{jewel:'requests',count:0});};m.prototype.$RequestsJewel26=function(n,o){'use strict';c('DOM').scry(this.jewel.root,'li.jewelItemNew').forEach(function(p){c('CSS').removeClass(p,'jewelItemNew');});};m.prototype.$RequestsJewel6=function(n,o){'use strict';this.countNew=o.count;c('CSS').conditionClass(this.jewelFlyout,'beeperUnread',this.countNew>0);c('CSS').conditionClass(this.jewelFlyoutCase,'showRequests',this.countNew>0);if(this.newCountSpan){var p=this.countNew==1?h._("{num} NEW REQUEST",[h.param('num',this.countNew)]):h._({"*":"{num} NEW REQUESTS"},[h.param('num',this.countNew,[0])]);c('DOM').setContent(this.newCountSpan,p);}};m.prototype.$RequestsJewel21=function(){'use strict';c('DOM').scry(this.jewelFlyout,'li.empty').forEach(function(n){c('CSS').conditionShow(n,this.$RequestsJewel2<=0);}.bind(this));};m.prototype.$RequestsJewel7=function(){'use strict';c('Arbiter').inform('requestsJewel/opened');var n=c('ge')('fbRequestsJewelLoading'),o=this.$RequestsJewel24();if(!n&&!o){this.unhandledRequest=true;}else if(n){var p=Date.now();if(this.openTimestamp+5000<p){this.openTimestamp=p;this.$RequestsJewel25({log_impressions:true});}}else{var q=Object.keys(this.$RequestsJewel1);if(q.length>0)new (c('AsyncRequest'))().setURI('/friends/requests/log_impressions').setData({ids:q.join(','),ref:'jewel'}).send();}o&&c('ScrollableArea').poke(o);c('JewelQPLogging').onJewelOpened();};m.prototype.$RequestsJewel5=function(){'use strict';c('Arbiter').inform('requestsJewel/closed');this.$RequestsJewel26();};m.prototype.$RequestsJewel27=function(){'use strict';return Math.min(Math.max(c('Vector').getViewportDimensions().y-l,k),j);};m.prototype.$RequestsJewel13=function(){'use strict';if(this.$RequestsJewel24())new (c('Animation'))(this.$RequestsJewel24()).to('height',this.$RequestsJewel27()+'px').duration(100).go();};m.prototype.$RequestsJewel14=function(){'use strict';if(!this.$RequestsJewel15)return;var n=c('DOM').scry(this.jewelFlyout,'li.friendBrowserListUnit'),o=c('Vector').getElementPosition(this.$RequestsJewel15,'viewport').y+c('Vector').getElementDimensions(this.$RequestsJewel15).y,p=n.length-1;while(p>this.$RequestsJewel3){var q=c('Vector').getElementPosition(n[p],'viewport').y;if(q>0&&q+c('Vector').getElementDimensions(n[p]).y<=o)break;p-=1;}var r=p;while(p>this.$RequestsJewel3){var s=c('DOM').find(n[p],'input.friendBrowserID'),t=parseInt(s.value,10),u={pymk_id:t,pymk_location:'pymk_jewel'};c('MarauderLogger').log('regular_pymk_imp',undefined,u);p-=1;}this.$RequestsJewel3=Math.max(this.$RequestsJewel3,r);};m.prototype.setHeight=function(){'use strict';this.$RequestsJewel24().style.height=this.$RequestsJewel27()+'px';};m.prototype.maybeLoadJewel=function(){'use strict';if(this.unhandledRequest){this.unhandledRequest=false;this.$RequestsJewel7();}};f.exports=m;},null);
__d('ChatInput.react',['ContentState','CompositeDraftDecorator','DraftEditor.react','DraftModifier','EditorState','EmoticonSpan.react','React','ReactDOM','clearImmediate','emptyFunction','getDefaultKeyBinding','getEntityMatcher','getVisibleValueForContentState','handleBeforeInputForEmoticon','handleSoftNewlineForEmoticon','insertEmoticonIntoEditorState','isSoftNewlineEvent','setImmediate'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h=c('React').PropTypes,i=c('emptyFunction').thatReturnsNull,j=c('React').createClass({displayName:'ChatInput',propTypes:{blockStyleFn:h.func,initializeThingsWithInputFn:h.func,inputKeyDown:h.func,keyBindingFn:h.func,onBlur:h.func,onEscape:h.func,onFocus:h.func,onTab:h.func,resizeFn:h.func},getDefaultProps:function(){return {blockStyleFn:i,keyBindingFn:c('getDefaultKeyBinding')};},componentDidMount:function(){this._oldHeight=c('ReactDOM').findDOMNode(this).getBoundingClientRect().height;this.props.resizeFn(this._oldHeight);this.props.initializeThingsWithInputFn(c('ReactDOM').findDOMNode(this.refs.input),this.getValue);this.setState({triggeredWord:this.props.triggeredWord});},componentWillUnmount:function(){if(this._updateToken)c('clearImmediate')(this._updateToken);this._updateToken=null;},componentWillReceiveProps:function(k){if(this.state.triggeredWord!==k.triggeredWord)this.setState({triggeredWord:k.triggeredWord},this._updateDecorator);},componentDidUpdate:function(){this._updateToken=c('setImmediate')(function(){this._updateToken=null;var k=c('ReactDOM').findDOMNode(this).getBoundingClientRect(),l=k.height;if(this._oldHeight!==l)this.props.resizeFn(l);this._oldHeight=l;}.bind(this));},getInitialState:function(){return {editorState:this._createEmptyEditorState()};},_createEmptyEditorState:function(){return c('EditorState').createWithContent(c('ContentState').createFromText(''),this._getDecorator());},resetState:function(){if(this.state.typeaheadReporter){this.state.typeaheadReporter.sessionEnd();this.state.typeaheadReporter.sessionStart();}this.setState({editorState:c('EditorState').moveFocusToEnd(this._createEmptyEditorState()),triggeredWord:null});},_updateDecorator:function(){var k=this._getDecorator();c('setImmediate')(function(){var l=c('EditorState').set(this.state.editorState,{decorator:k});this.setState({editorState:l});}.bind(this));},_getDecorator:function(){return new (c('CompositeDraftDecorator'))([{strategy:c('getEntityMatcher')(function(k){return k.getType()==='EMOTICON';}),component:c('EmoticonSpan.react')}]);},onChange:function(k){this.setState({editorState:k});},onReturn:function(event){if(c('isSoftNewlineEvent')(event)){var k=c('handleSoftNewlineForEmoticon')(this.state.editorState);if(k===this.state.editorState)return false;this.setState({editorState:k});return true;}this.props.inputKeyDown(event,this.getValue());return true;},getValueFromEditorState:function(k){var l=k.getCurrentContent();return c('getVisibleValueForContentState')(l);},getValue:function(){return this.getValueFromEditorState(this.state.editorState);},focus:function(){this.refs.input.focus();},_handleBeforeInput:function(k){var l=c('handleBeforeInputForEmoticon')(this.state.editorState,k);if(l===this.state.editorState)return false;this.setState({editorState:l});return true;},_handleFiles:function(k){var l=/^image\//,m=k.filter(function(n){return l.test(n.type);});if(m.length){this.props.uploadPhotoFn(m[0]);return true;}return false;},_handlePastedFiles:function(k){return this._handleFiles(k);},_handleDroppedFiles:function(k,l){return this._handleFiles(l);},insertEmoticon:function(k){var l=c('insertEmoticonIntoEditorState')(k,this.state.editorState);if(l!==this.state.editorState)this.setState({editorState:l});},appendText:function(k){var l=this.state.editorState,m=l.getSelection(),n=l.getCurrentContent();n=c('DraftModifier').insertText(n,m,k);l=c('EditorState').push(l,n,'insert-characters');this.setState({editorState:l});},render:function(){return (c('React').createElement(c('DraftEditor.react'),babelHelpers['extends']({ref:'input'},this.props,{editorState:this.state.editorState,onChange:this.onChange,handleBeforeInput:this._handleBeforeInput,handlePastedFiles:this._handlePastedFiles,handleDroppedFiles:this._handleDroppedFiles,handleReturn:this.onReturn,spellCheck:true,stripPastedStyles:true})));}});f.exports=j;},null);
__d('ChatTabTypeaheadDataSource',['MercuryConfig','MercuryTypeaheadConstants','MercuryTypeaheadDataSource'],function a(b,c,d,e,f,g){var h,i;if(c.__markCompiled)c.__markCompiled();h=babelHelpers.inherits(j,c('MercuryTypeaheadDataSource'));i=h&&h.prototype;function j(k){'use strict';k=k||{};k.maxResults=c('MercuryTypeaheadConstants').COMPOSER_CHATTAB_MAX;i.constructor.call(this,k);this.$ChatTabTypeaheadDataSource1=true;}j.prototype.buildData=function(k){'use strict';var l=[],m=[],n=[],o=[],p=[],q=[];k.forEach(function(s){var t=i.getEntry.call(this,s);switch(t.render_type){case c('MercuryTypeaheadConstants').FRIEND_TYPE:l.push(s);break;case c('MercuryTypeaheadConstants').THREAD_TYPE:if(this.$ChatTabTypeaheadDataSource1)m.push(s);break;case c('MercuryTypeaheadConstants').NON_FRIEND_TYPE:n.push(s);break;case c('MercuryTypeaheadConstants').FB4C_TYPE:o.push(s);break;case c('MercuryTypeaheadConstants').PAGE_TYPE:if(this.$ChatTabTypeaheadDataSource1)if(c('MercuryConfig').LinkedAgents&&c('MercuryConfig').LinkedAgents.indexOf(s.toString())>-1){q.push(s);}else p.push(s);break;default:this.logQuery({event:'chat_tab_render_type_error'});break;}},this);var r=q.concat(l,o,m,p,n);return i.buildData.call(this,r);};j.prototype.query=function(k,l,m,n){'use strict';this.logQuery({event:'query_chat_tab',query:k});return i.query.call(this,k,l,m,n);};j.prototype.respond=function(k,l,m){'use strict';var n=i.respond.call(this,k,l,m);this.logResponse({event:'query_response_chat_tab',response_query:k,response_uids:l});return n;};j.prototype.setShowThreads=function(k){'use strict';this.$ChatTabTypeaheadDataSource1=k;};f.exports=j;},null);
__d('getURLRanges',['URI','URLScraper'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();function h(i){var j=arguments.length<=1||arguments[1]===undefined?0:arguments[1],k=i.substr(j),l=c('URLScraper').match(k);if(!l)return [];var m=l;if(!/^[a-z][a-z0-9\-+.]+:\/\//i.test(l))m='http://'+l;if(!c('URI').isValidURI(m))return [];j+=k.indexOf(l);var n=l.length,o=[{offset:j,length:l.length,entity:{url:m}}];return o.concat(h(i,j+n));}f.exports=h;},null);
__d('SyncRequestNotificationBeeperItemContents.react',['cx','Animation','Image.react','ImageBlock.react','NotificationBeeperItemCloseButton.react','NotificationUserActions','React','ReactDOM','SyncRequest.react','SyncRequestStatusEnum'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=c('React').createClass({displayName:'SyncRequestNotificationBeeperItemContents',_markAsRead:function(){c('NotificationUserActions').markNotificationsAsRead([this.props.beep.notificationID]);this.props.onHide();},_onClose:function(){this._markAsRead();this.props.onHide();},_doFlash:function(){new (c('Animation'))(c('ReactDOM').findDOMNode(this.refs.inner)).from('opacity','0').to('opacity','1').duration(200).go();},componentDidMount:function(){if(this.props.beep.rendererData.status!=c('SyncRequestStatusEnum').PENDING)this.props.onReadyToHide(this.props.beep.notificationID);},componentDidUpdate:function(j){if(this.props.beep.rendererData.status!=c('SyncRequestStatusEnum').PENDING&&j.beep.rendererData.status==c('SyncRequestStatusEnum').PENDING)this.props.onReadyToHide(this.props.beep.notificationID);},onRequestStatusUpdate:function(j,k){if(j!=c('SyncRequestStatusEnum').PENDING&&k==c('SyncRequestStatusEnum').PENDING)this.props.onReadyToHide(this.props.beep.notificationID);},render:function(){var j=this.props.beep,k=j.rendererData;return (c('React').createElement('div',{ref:'inner'},c('React').createElement(c('NotificationBeeperItemCloseButton.react'),{onClick:this._onClose}),c('React').createElement(c('ImageBlock.react'),{className:"_3soj"},c('React').createElement(c('Image.react'),{src:j.actors[0].profile_picture.uri,className:"_3sok"}),c('React').createElement('div',{className:"_3sol"},c('React').createElement(c('SyncRequest.react'),{app:k.app,creationTime:k.creation_time,requestId:k.id.toString(),receiver:k.receiver,sender:k.sender,status:k.status,timeout:k.timeout,timeRemaining:k.time_remaining,viewerId:k.receiver.id,onStatusUpdate:this.onRequestStatusUpdate})))));}});f.exports=i;},null);
__d('LiveMessageReceiver',['Arbiter','ChannelConstants','emptyFunction','shield'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(i){this.eventName=i;this.subs=null;this.handler=c('emptyFunction');this.shutdownHandler=null;this.registered=false;this.appId=1;}Object.assign(h,{getAppMessageType:function(i,j){return 'live_message/'+i+':'+j;},route:function(i){var j=function(k){var l=h.getAppMessageType(i.app_id,i.event_name);c('Arbiter').inform(l,k,c('Arbiter').BEHAVIOR_PERSISTENT);};j(i.response);}});Object.assign(h.prototype,{setAppId:function(i){this.appId=i;return this;},setHandler:function(i){this.handler=i;this._dirty();return this;},setRestartHandler:c('emptyFunction'),setShutdownHandler:function(i){this.shutdownHandler=c('shield')(i);this._dirty();return this;},_dirty:function(){if(this.registered){this.unregister();this.register();}},register:function(){var i=function(k,l){return this.handler(l);}.bind(this),j=h.getAppMessageType(this.appId,this.eventName);this.subs={};this.subs.main=c('Arbiter').subscribe(j,i);if(this.shutdownHandler)this.subs.shut=c('Arbiter').subscribe(c('ChannelConstants').ON_SHUTDOWN,this.shutdownHandler);this.registered=true;return this;},unregister:function(){if(!this.subs)return this;for(var i in this.subs)if(this.subs[i])this.subs[i].unsubscribe();this.subs=null;this.registered=false;return this;}});f.exports=h;},null);
__d('initLiveMessageReceiver',['Arbiter','ChannelConstants','LiveMessageReceiver'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();c('Arbiter').subscribe(c('ChannelConstants').getArbiterType('app_msg'),function(h,i){c('LiveMessageReceiver').route(i.obj);});},null);