/*!CK:592212053!*//*1457922685,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["C3jQW"]); }

__d('P2PChatThreadBanner.react',['cx','ix','Image.react','Layout.react','P2PAPI','P2PLogger','P2PPaymentLoggerEvent','React','Set'],function a(b,c,d,e,f,g,h,i){'use strict';if(c.__markCompiled)c.__markCompiled();var j=c('Layout.react').FillColumn,k=c('Layout.react').Column,l=new (c('Set'))(),m=c('React').PropTypes,n=c('React').createClass({displayName:'P2PChatThreadBanner',propTypes:{bannerType:m.string.isRequired,bodyText:m.string,buttonText:m.string,loggerEventFlow:m.string.isRequired,onClick:m.func,titleText:m.string.isRequired},_isRendered:false,componentDidMount:function(){var o=this.props.bannerType;if(!l.has(o)){l.add(o);this._isRendered=true;this.log(c('P2PPaymentLoggerEvent').UI_ACTN_CHAT_THREAD_BANNER_VIEWED,{});c('P2PAPI').incrementBannerViews(this.props.bannerType);}},log:function(o,p){c('P2PLogger').log(o,babelHelpers['extends']({www_event_flow:this.props.loggerEventFlow},p));},handleClick:function(o){o.stopPropagation();if(this.props.onClick)this.props.onClick();this.log(c('P2PPaymentLoggerEvent').UI_ACTN_CHAT_THREAD_BANNER_CLICKED,{});c('P2PAPI').incrementBannerDismissals(this.props.bannerType);},handleClose:function(o){o.stopPropagation();this.log(c('P2PPaymentLoggerEvent').UI_ACTN_CHAT_THREAD_BANNER_DISMISSED,{});c('P2PAPI').incrementBannerDismissals(this.props.bannerType);},hasRenderedSameBanner:function(){return !this._isRendered&&l.has(this.props.bannerType);},render:function(){var o,p;if(this.hasRenderedSameBanner())return null;if(this.props.bodyText)o=c('React').createElement('div',{className:"_1w2e"},this.props.bodyText);if(this.props.buttonText)p=c('React').createElement('a',{className:"_2hrk"},this.props.buttonText);return (c('React').createElement('div',{className:"_1w2f",onClick:this.handleClick},c('React').createElement('div',{className:"_3jht",onClick:this.handleClose},c('React').createElement(c('Image.react'),{className:"_47dg",height:9,src:i('/images/p2p/chat-thread-banner-close.png'),width:9})),c('React').createElement(c('Layout.react'),null,c('React').createElement(k,{className:"_1w2g"},c('React').createElement(c('Image.react'),{className:"_1w2h",height:15,src:i('/images/p2p/thread-banner-dollar.png'),width:15})),c('React').createElement(j,{className:"_1w2i"},c('React').createElement('div',{className:"_1w2j"+(!!o?' '+"_1w2k":'')},this.props.titleText),o,p))));}});f.exports=n;},null);
__d('P2PProductItemChatThreadBanner.react',['cx','fbt','ix','AsyncRequest','ContextualLayerAutoFlip','BackgroundImage.react','Image.react','Layout.react','LineClamp.react','Link.react','MercuryIDs','MercuryMessages','P2PActions','P2PAPI','P2PGKValues','P2PLogger','P2PLinkConstants','P2PMessageSellerConfirmationDialog.react','P2PPaymentLoggerEvent','P2PPaymentLoggerEventFlow','P2PPlatformContextShape','P2PPlatformContextStore','P2PUserEligibilityStore','PopoverMenu.react','ReactComponentWithPureRenderMixin','React','ReactLayeredComponentMixin','ReactXUIMenu','Set','StoreAndPropBasedStateMixin','Tooltip.react','URI','XC2CPayNUXBannerImpressionsUpdateController','XUIAmbientNUX.react','XUIButton.react','XUIGrayText.react'],function a(b,c,d,e,f,g,h,i,j){'use strict';if(c.__markCompiled)c.__markCompiled();var k=c('Layout.react').Column,l=c('Layout.react').FillColumn,m=c('ReactXUIMenu').Item,n=false,o=new (c('Set'))(),p=c('React').createClass({displayName:'P2PProductItemChatThreadBanner',mixins:[c('ReactLayeredComponentMixin'),c('ReactComponentWithPureRenderMixin'),c('StoreAndPropBasedStateMixin')(c('P2PUserEligibilityStore'))],propTypes:{platformContext:c('P2PPlatformContextShape').isRequired},getInitialState:function(){return {requestEnabled:c('P2PGKValues').P2PGroupCommerceRequestEnabled,showConfirmationDialog:false,showNUX:false};},statics:{calculateState:function(q){return {canSendToRecipient:c('P2PUserEligibilityStore').getEligibilityByThreadID(c('P2PPlatformContextStore').getThreadIDFromPlatformContext(q.platformContext))};}},componentDidMount:function(){var q=this.props.platformContext,r=c('P2PPlatformContextStore').getThreadIDFromPlatformContext(q);this.handleShouldShowPayNUX();if(!o.has(r)){o.add(r);if(c('P2PPlatformContextStore').isViewerSellerForPlatformContext(q)){this.log(c('P2PPaymentLoggerEvent').UI_ACTN_PLATFORM_BANNER_SELLER_VIEWED);}else this.log(c('P2PPaymentLoggerEvent').UI_ACTN_PLATFORM_BANNER_BUYER_VIEWED);}},componentDidUpdate:function(q,r){if(!r.canSendToRecipient&&this.state.canSendToRecipient)this.handleShouldShowPayNUX();},log:function(q,r){var s={platform_logging_data:this.props.platformContext.product.loggingData};c('P2PLogger').log(q,babelHelpers['extends']({www_event_flow:c('P2PPaymentLoggerEventFlow').UI_FLOW_PLATFORM_BANNER},s,r));},handleShouldShowPayNUX:function(){var q=this.props.platformContext,r=!n&&this.shouldRenderPayButton()&&q.banner.shouldShowPayNux;if(r){this.log(c('P2PPaymentLoggerEvent').UI_ACTN_PLATFORM_BANNER_PAY_NUX_SHOWN);n=true;this.setState({showNUX:true});new (c('AsyncRequest'))().setURI(c('XC2CPayNUXBannerImpressionsUpdateController').getURIBuilder().getURI()).setMethod('POST').send();}},handleDismissClick:function(q){q.preventDefault();var r=this.props.platformContext;c('P2PAPI').dismissPlatformContextBanner(r.id);if(c('P2PPlatformContextStore').isViewerSellerForPlatformContext(r)){this.log(c('P2PPaymentLoggerEvent').UI_ACTN_PLATFORM_BANNER_SELLER_HIDE_CLICKED);}else this.log(c('P2PPaymentLoggerEvent').UI_ACTN_PLATFORM_BANNER_BUYER_HIDE_CLICKED);},handleSoldClick:function(q){q.preventDefault();c('P2PAPI').markSoldPlatformContextProductItem(this.props.platformContext.id);this.log(c('P2PPaymentLoggerEvent').UI_ACTN_PLATFORM_BANNER_SOLD_CLICKED);},handleRequestClick:function(q){q.preventDefault();this.openSendMoneyFlyoutRequestTab();this.log(c('P2PPaymentLoggerEvent').UI_ACTN_PLATFORM_BANNER_REQUEST_CLICKED);},hasNoMessagesFromSeller:function(){var q=this.props.platformContext,r=c('P2PPlatformContextStore').getThreadIDFromPlatformContext(q),s=c('MercuryMessages').get().getCurrentlyLoadedMessages(r);if(!s)return true;var t=c('MercuryIDs').getParticipantIDFromUserID(q.sellerID),u=s.some(function(v){return v.author===t;});return !u;},handlePayClick:function(q){q.preventDefault();if(this.hasNoMessagesFromSeller()){this.setState({showConfirmationDialog:true});this.log(c('P2PPaymentLoggerEvent').UI_ACTN_MESSAGE_SELLER_CONFIRM_DIALOG_SHOWN);}else this.openSendMoneyFlyout();},openSendMoneyFlyoutRequestTab:function(){var q=this.props.platformContext,r=q.product,s=c('P2PPlatformContextStore').getThreadIDFromPlatformContext(q);c('P2PActions').chatSendViewOpened({amount:r.formattedAmount,memoText:r.name,openRequestTab:true,platformData:{platformContextID:q.id,loggingData:r.loggingData},threadID:s});},openSendMoneyFlyout:function(){var q=this.props.platformContext,r=q.product,s=c('P2PPlatformContextStore').getThreadIDFromPlatformContext(q);c('P2PActions').chatSendViewOpened({threadID:s,amount:r.formattedAmount,platformData:{platformContextID:q.id,loggingData:r.loggingData}});this.setState({showNUX:false});this.log(c('P2PPaymentLoggerEvent').UI_ACTN_PLATFORM_BANNER_PAY_CLICKED);},handleImageClicked:function(){this.log(c('P2PPaymentLoggerEvent').UI_ACTN_PLATFORM_BANNER_IMAGE_CLICKED);},handleTitleClicked:function(){this.log(c('P2PPaymentLoggerEvent').UI_ACTN_PLATFORM_BANNER_TITLE_CLICKED);},renderMarkSold:function(){var q=this.props.platformContext,r;if(!q.product.isAvailable)return null;if(c('P2PPlatformContextStore').isViewerSellerForPlatformContext(q))r=c('React').createElement(c('Link.react'),{href:'#',onClick:this.handleSoldClick},i._("Mark Sold"));return r;},renderPayButton:function(){if(!this.shouldRenderPayButton())return null;var q=c('React').createElement(c('XUIButton.react'),{label:i._("Pay"),onClick:this.handlePayClick,ref:'pay_button',use:'confirm'});if(!this.state.showNUX)q=c('React').createElement(c('Tooltip.react'),{alignH:'right',display:'block',tooltip:i._("You can confirm the amount next.")},q);return (c('React').createElement('div',{className:!this.isCompactMode()?"_3-8x":''},q));},renderRequestButton:function(){if(!this.shouldRenderRequestButton())return null;return (c('React').createElement(c('Link.react'),{className:"_f-n",href:'#',onClick:this.handleRequestClick},i._("Request Payment")));},shouldRenderPayButton:function(){var q=this.props.platformContext,r=c('P2PPlatformContextStore').isViewerBuyerForPlatformContext(this.props.platformContext);return !!(this.state.canSendToRecipient&&q.product.isAvailable&&r&&q.product.rawAmount.amount>0);},shouldRenderSellerActionsRow:function(){var q=this.props.platformContext,r=c('P2PPlatformContextStore').isViewerSellerForPlatformContext(q);return r&&q.product.isAvailable;},shouldRenderRequestButton:function(){return !!(this.state.requestEnabled&&this.state.canSendToRecipient&&this.props.platformContext.product.rawAmount.amount>0);},getAmountText:function(){var q=this.props.platformContext,r=q.product;return (r.rawAmount.amount>0?r.formattedAmount:i._("FREE"));},renderAskingPriceRow:function(){var q=this.props.platformContext,r=q.product;if(r.isAvailable)return (c('React').createElement(c('LineClamp.react'),{lines:1,lineHeight:16},c('React').createElement(c('XUIGrayText.react'),{shade:'light'},i._("Price: {price of the item}",[i.param('price of the item',this.getAmountText())]))));},renderNameLine:function(){var q=this.props.platformContext,r=q.product,s='dark',t;if(!r.isAvailable){s='light';t=i._("SOLD");}return (c('React').createElement(c('Link.react'),{href:r.refURL||'#',onClick:this.handleTitleClicked},c('React').createElement(c('XUIGrayText.react'),{shade:s},t?'('+t+') ':null,r.name)));},renderSellerActionsRow:function(){if(!this.shouldRenderSellerActionsRow())return null;return (c('React').createElement('div',{className:"_f-o"},this.renderMarkSold(),this.renderRequestButton()));},renderImageColumn:function(){var q=this.props.platformContext,r=q.product;if(this.isCompactMode())return null;return (c('React').createElement(k,{className:"_3-90"},c('React').createElement('div',{className:"_5qnr"},c('React').createElement('div',{className:"_5qn-"},c('React').createElement(c('Link.react'),{href:r.refURL||'#',onClick:this.handleImageClicked},c('React').createElement(c('BackgroundImage.react'),{backgroundPosition:'50% 50%',backgroundSize:'cover',height:45,src:r.image,width:45}))))));},renderPopoverMenu:function(){var q=this.props.platformContext,r=q.product,s=c('React').createElement(c('ReactXUIMenu'),{className:"_1z1u"},c('React').createElement(m,{className:"_1z1_"},c('React').createElement('div',{onClick:this.handleDismissClick},i._("Hide from conversation"))),c('React').createElement(m,{ajaxify:new (c('URI'))('/ajax/groups/mall/report_to_admin').addQueryData({message_id:r.loggingData.post_id}),rel:'async-post'},i._("Report to admin")),c('React').createElement(m,{href:c('P2PLinkConstants').helpCenterURI,target:'_blank'},i._("Learn more")));return (c('React').createElement(c('PopoverMenu.react'),{alignh:'right',layerBehaviors:[c('ContextualLayerAutoFlip')],menu:s,className:"_3fqa"},c('React').createElement('div',{className:"_1z20"},c('React').createElement(c('Link.react'),{className:"_1z21",href:'#'}))));},isCompactMode:function(){var q=this.props.platformContext,r=q.product;return !r.image||!r.isAvailable;},onNUXCloseButtonClick:function(){this.setState({showNUX:false});},renderLayers:function(){var q={};if(this.state.showNUX){q.ambientNUX=c('React').createElement(c('XUIAmbientNUX.react'),{alignment:'left',contextRef:function(){return this.refs.pay_button;}.bind(this),customwidth:234,onCloseButtonClick:this.onNUXCloseButtonClick,position:'above',shown:true,width:'custom'},c('React').createElement('div',{className:"_3-95"},i._("You can pay for this item right from your messages.")),c('React').createElement('div',null,c('React').createElement(c('Image.react'),{className:"_3fqb",height:14,src:j('/images/p2p/white-privacy-lock.png'),width:10}),c('React').createElement('span',{className:"_3fqc"},i._("It's free and secure."))));}else if(this.state.showConfirmationDialog)q.confirmationDialog=c('React').createElement(c('P2PMessageSellerConfirmationDialog.react'),{onCancel:function(){this.setState({showConfirmationDialog:false});this.log(c('P2PPaymentLoggerEvent').UI_ACTN_MESSAGE_SELLER_CONFIRM_DIALOG_CANCEL_CLICK);}.bind(this),onPay:function(){this.setState({showConfirmationDialog:false});this.openSendMoneyFlyout();this.log(c('P2PPaymentLoggerEvent').UI_ACTN_MESSAGE_SELLER_CONFIRM_DIALOG_PAY_CLICK);}.bind(this)});return q;},render:function(){return (c('React').createElement('div',{className:"_319c"+(this.isCompactMode()?' '+"_5qn_":'')},c('React').createElement(c('Layout.react'),null,this.renderImageColumn(),c('React').createElement(l,null,c('React').createElement('div',{className:"_5qo0"},c('React').createElement('div',{className:"_5qo1"},c('React').createElement(c('LineClamp.react'),{lines:1,lineHeight:16},this.renderNameLine()),this.renderAskingPriceRow(),this.renderSellerActionsRow()))),c('React').createElement(k,null,c('React').createElement('div',{className:"_1_68"},this.renderPopoverMenu(),this.renderPayButton())))));}});f.exports=p;},null);
__d('P2PSendMoneyNUXChatThreadBanner.react',['MercuryIDs','P2PActions','P2PChatThreadBanner.react','P2PUserEligibilityStore','React','StoreAndPropBasedStateMixin'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h=c('React').PropTypes,i=c('React').createClass({displayName:'P2PSendMoneyNUXChatThreadBanner',mixins:[c('StoreAndPropBasedStateMixin')(c('P2PUserEligibilityStore'))],propTypes:{bannerType:h.string.isRequired,bodyText:h.string,buttonText:h.string,loggerEventFlow:h.string.isRequired,openRequestTab:h.bool,threadID:h.string.isRequired,titleText:h.string.isRequired},getDefaultProps:function(){return {openRequestTab:false};},statics:{calculateState:function(j){var k=c('MercuryIDs').isGroupChat(j.threadID)||c('P2PUserEligibilityStore').getEligibilityByThreadID(j.threadID);return {isThreadEligible:k};}},handleClick:function(){c('P2PActions').chatSendViewOpened({openRequestTab:this.props.openRequestTab,threadID:this.props.threadID});},render:function(){if(!this.state.isThreadEligible)return null;return (c('React').createElement(c('P2PChatThreadBanner.react'),babelHelpers['extends']({},this.props,{onClick:this.handleClick})));}});f.exports=i;},null);