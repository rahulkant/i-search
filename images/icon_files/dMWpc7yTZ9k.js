/*!CK:2551891955!*//*1459223367,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["aaP\/z"]); }

__d("FBRTCCallConstants",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={FBRTCCallConnectionType:{MISSED_CALL:4,CONNECTED_CALL:5},FBRTCCallType:{VOICE_CALL:1,VIDEO_CALL:2}};},null);
__d("LinkshimCallsites",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={INTERNAL_WIKI:1,MZERO_UPSELL:2,EVENTS_TICKET:3,UNIT_TEST:4,WEB_RESULT:5,OG_COMMENT_NOTIF:6,M_DATA_UPSELL:7,FBURL:8,M_URI:9,THIRD_PARTY_URL:10,UI_LINK:11,LANDING_CAMPAIGN:12,STREAM_CONTENT_TICKER:13,SOCIAL_WIFI_DEPRECATED:14,TIMELINE_APP_COLLECTION:15,SAVED_LATER_VIEW_ITEM:16,REQUESTS_CONTROLLER:17,LOGIN_BUTTON:18,COMMENT_PLUGIN_REDIRECT_ENTAPP:19,COMMENT_PLUGIN_REDIRECT_APPOWNED:20,M_DEEPLINK:21,M_DEEPLINK_INVALID:22,EVENT_BUY_TICKET:23,PAGE_TYPEAHEAD:24,EGO_ACTION:25,INTERN_SURVEY:26,RETIRED_ENDPOINT:27,OG_COMMENT_FEEDBACK_TARGET:28,LIKE_COMMON_RENDERER:29,NOTIFICATIONS_LINK:30,COUPON_OFFSITE_LINK:31,MZERO_MAILTO:32,MZERO:33,MERCURY_SHARE_ATTACHMENT:34,EXTERNAL_TOKEN_SURVEY:35,FBURL_INTERN:36,LANDING_PAGE_EXPERIMENT:37,OG_FEEDBACK_TARGET:38,GAMEDAY:39,ENTISH:40,JS_ENV:41,LINKSHIM_AUTOMATION:42,HEADER_FLUSHER:43,PLUGIN_HEADER_FLUSHER:44,TASKS_APP:45,FEEDBACK_MODEL:46,JP_EMAIL_LINK:47,NOTIFICATION_REWRITE:48,OG_ACTION_PERMALINK:49,MALWARE_SCAN:50,EMAIL_LINK:51,EMAIL_ATTACHMENT:52,RENDER_EMAIL_LEGACY:53,TAGGED_WITH_STORY_EMAIL_NOTIF:54,MSG_INTRO_NOTIF:55,GROUP_COMMENT_NOTIF:56,EVENT_INVITE_LOCATION_EMAIL:57,EVENT_INVITE_MESSAGE_EMAIL:58,CLOSE_FRIEND_ACTIVITY:59,GROUP_DOC_CREATED_URL:60,GROUP_DOC_CREATED_NAME:61,MALL_POST_EMAIL_NOTIF:62,MALL_POST_SOCIAL_MSG:63,NOTIFICATION_REWRITE_RSS:64,WALL_POST_SOCIAL_MSG:65,TITAN_MSG_BODY_EMAIL:66,TITAN_MSG_BODY_SUBJECT:67,GROUP_POST_EMAIL:68,GROUP_POST_URL_EMAIL:69,GROUP_POST_PERMALINK_EMAIL:70,GROUP_POST_OPTOUT_EMAIL:71,GROUP_POST_TEXT_NOTIF:72,CLOSE_FRIEND_EMAIL_SHARE:73,PLACE_TAGGED_IN_CHECKIN:74,QUESTIONS_ANSWER_EMAIL:75,SUPPORT_TASK_COMMENT:76,INVITE_MESSAGE_EMAIL:77,GROUP_REQUEST_TO_JOIN_EMAIL:78,GROUP_POST_COMMENT_PERMALINK:79,GROUP_POST_COMMENT_OPTOUT:80,GROUP_POST_COMMENT_TEXT:81,EVENT_NAME_CHANGE_NOTIF:82,EVENT_NAME_CHANGE_OLD_NAME_NOTIF:83,EVENT_NAME_CHANGE_NEW_NAME_NOTIF:84,EVENT_CANCEL_NOTIFICATION:85,BASE_COMMENT_NOTIF:86,FBPAGE_FAN_INVITE_NAME:87,FBPAGE_FAN_INVITE_MSG:88,MESSAGING_HTML_EMAIL:89,ROLLOUT_TEXT_EMAIL:90,COMMENT_EMAIL_TEXT:91,SHARE_CONTENT_LEGACY_EMAIL:92,MZERO_UPSELL_NOTIF:93,INTERN_DEBUG:94,CALL_TO_ACTION:95,QUICK_PROMOTION_ACTION:96,COMPOSED_TEXT:97,GIF_SEARCH:98,OFFERS:99,MZERO_ATTACHMENTS:100,MZERO_UPLOADS:101,CCTA_LINK:102,M_CCTA_LINK:103,SAVED_ITEM_REDIRECT:104,ADS_PROMOTED_OBJECT:105,EMBEDS_MTOUCH_SELECT:106,IORG_BOOKMARK:107,PAYPAL_INIT:108,FUNDRAISER_NOTIF:109,COMMENTS_PLUGIN_NOTIF:110,INSTANT_SHOPPING_ACTION:111,LINK_MENU:112,TALENT_SEARCH:113,COMET:114,INTERVIEW_STATS:115,SCHEDULR:116,BULK_SCHEDULR:117,CIRCA_LINK:118,MZERO_CHANGE_DESTINATION:119,LINK_REACT:120,LYNX_EXTRA_REDIRECT:121,UI_LINK_EXPERIMENTAL:122};},null);
__d("ScreenSharingWebDriverIDs",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={SHARE_SCREEN_BUTTON:"shareScreenButton",INSTALL_EXT_DIALOG:"install_extension_dialog"};},null);
__d("VideoCallWebDriverIDs",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={END_CALL_BUTTON:"endCallButton",STAR_RATING_VIEW:"starRatingView"};},null);
__d("XLinkshimLinkAsyncController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/linkshim\/ajax\/link\/",{href:{type:"String",required:true},callsite:{type:"Enum",required:true,enumType:0}});},null);
__d('LinkshimURI',['AsyncRequest','XLinkshimLinkAsyncController','isFacebookURI'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h={asyncGet:function(i,j,k){if(c('isFacebookURI')(i)){k(i);return;}var l=c('XLinkshimLinkAsyncController').getURIBuilder().setString('href',i.toString()).setEnum('callsite',j).getURI();new (c('AsyncRequest'))(l).setHandler(function(m){var n=m.getPayload();k(n.uri);}).send();}};f.exports=h;},null);
__d('LinkshimLink.react',['Link.react','LinkshimURI','React','URI','areEqual'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h=c('React').PropTypes,i=c('React').createClass({displayName:'LinkshimLink',propTypes:{uri:h.instanceOf(c('URI')).isRequired,callsite:h.number.isRequired,loadingPlaceholder:h.element},getInitialState:function(){return {shimURI:undefined};},componentWillMount:function(){this._asyncGetLinkShimURI(this.props);},componentWillReceiveProps:function(j){if(!c('areEqual')(this.props,j))this._asyncGetLinkShimURI(j);},_asyncGetLinkShimURI:function(j){c('LinkshimURI').asyncGet(j.uri,j.callsite,function(k){return this.setState({shimURI:k});}.bind(this));},render:function(){if(!this.state.shimURI)return this.props.loadingPlaceholder?this.props.loadingPlaceholder:null;var j=this.props,k=j.children,l=babelHelpers.objectWithoutProperties(j,['children']);return (c('React').createElement(c('Link.react'),babelHelpers['extends']({href:this.state.shimURI},l),k));}});f.exports=i;},null);
__d('MessengerDialogTitle.react',['cx','React','joinClasses'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=c('React').createClass({displayName:'MessengerDialogTitle',render:function(){return (c('React').createElement('div',{className:c('joinClasses')("_19jt",this.props.className)},this.props.children));}});f.exports=i;},null);
__d("XVideoCallAdminMessageController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/videocall\/admin_msg\/",{});},null);
__d('FBRTCAdminMessage',['FBRTCConstants','FBRTCCallConstants','FBRTCLogger','FBRTCUtils','XVideoCallAdminMessageController','emptyFunction','performanceNow'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(i,j){'use strict';this.$FBRTCAdminMessage1=i;this.$FBRTCAdminMessage2=j;this.$FBRTCAdminMessage3=Date.now();this.$FBRTCAdminMessage4=null;this.$FBRTCAdminMessage5=null;}h.prototype.onCallConnected=function(){'use strict';if(!this.$FBRTCAdminMessage4)this.$FBRTCAdminMessage4=c('performanceNow')();};h.prototype.onCallEnded=function(){'use strict';if(!this.$FBRTCAdminMessage5)this.$FBRTCAdminMessage5=c('performanceNow')();};h.prototype.submit=function(i,j){'use strict';if(!this.$FBRTCAdminMessage5)this.onCallEnded();var k=0,l=c('FBRTCCallConstants').FBRTCCallConnectionType.MISSED_CALL;if(this.$FBRTCAdminMessage4){k=Math.ceil(this.$FBRTCAdminMessage5-this.$FBRTCAdminMessage4);l=c('FBRTCCallConstants').FBRTCCallConnectionType.CONNECTED_CALL;}var m=l===c('FBRTCCallConstants').FBRTCCallConnectionType.CONNECTED_CALL||j===c('FBRTCConstants').CallEndReason.IGNORE_CALL;this.$FBRTCAdminMessage6({peer_id:this.$FBRTCAdminMessage1,call_id:this.$FBRTCAdminMessage2,start_time:this.$FBRTCAdminMessage3,call_duration:k,message_type:l,call_category:i,call_acknowledged:m});};h.prototype.$FBRTCAdminMessage6=function(i){'use strict';var j=c('XVideoCallAdminMessageController').getURIBuilder().getURI();c('FBRTCUtils').sendServerRequest(j,c('emptyFunction'),this.$FBRTCAdminMessage7.bind(this,i.peer_id,i.call_id),false,null,i);};h.prototype.$FBRTCAdminMessage7=function(i,j,k){'use strict';var l;if(k){l='Fail to log admin message, error '+k.error;}else l='Server timed out on logging admin message';c('FBRTCLogger').getInstance().logError(i,j,l);};f.exports=h;},null);
__d('FBRTCPCConfig',['FBRTCVersionDetection'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h="stun:stun.fbsbx.com:3478",i=function(k,l,m){if(c('FBRTCVersionDetection').isChrome()&&c('FBRTCVersionDetection').webrtcVersion()>=34){var n={urls:k};if(l&&m){n.username=l;n.credential=m;}return [n];}var o=[];for(var p=0;p<k.length;p++)if(l&&m){o.push({url:k[p],username:l,credential:m});}else o.push({url:k[p]});return o;},j={setTurnCredentials:function(k){this.turnIP=k.ip;this.udpPort=k.udp_port;this.tcpPort=k.tcp_port;this.sslPort=k.ssl_tcp_port;this.turnUsername=k.username;this.turnPassword=k.password;},getConfig:function(){var k=i([h]).concat(i(this._turnUrls(),this.turnUsername,this.turnPassword));return {iceServers:k};},getConstraints:function(){return {mandatory:{},optional:[{DtlsSrtpKeyAgreement:'true'}]};},_turnUrls:function(){if(c('FBRTCVersionDetection').isFirefox()&&c('FBRTCVersionDetection').webrtcVersion()<27){return ['turn:'+this.turnIP+':'+this.udpPort];}else return ['turn:'+this.turnIP+':'+this.udpPort+'?transport=udp','turn:'+this.turnIP+':'+this.tcpPort+'?transport=tcp','turn:'+this.turnIP+':'+this.sslPort+'?transport=tcp'];}};f.exports=j;},null);
__d('FBRTCSdpUtils',['UserAgent'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h='m=video 0',i=function(l){return l.match(/^a=rtpmap:(\d+)\s/)[1];},j=function(l,m,n){var o=i(l[m]),p=l[n].split('RTP/SAVPF'),q=p[1].split(/\s+/),r=q.indexOf(o);q.splice(r,1);p[1]=q.join(' ');l[n]=p.join('RTP/SAVPF');l.splice(m,1);},k={replaceRTPSAVPFProfile:function(l){var m='UDP/TLS/RTP/SAVPF',n='RTP/SAVPF';while(l.indexOf(m)>=0)l=l.replace(m,n);return l;},addIceOptionToSdp:function(l,m){"use strict";var n="a=ice-options:",o=l.indexOf(n);if(o>=0){var p=l.indexOf("\r",o);return [l.slice(0,p)," ",m,l.slice(p)].join('');}var q=n+m,r=l.split("\r\n"),s=false,t=-1;for(var u=0;u<r.length;u++){var v=r[u].slice(0,2);if(v=="s="){s=true;continue;}if(s&&v=="a="){t=u;break;}}if(t>=0){r.splice(t,0,q);return r.join("\r\n");}return [l,q,"\r\n"].join('');},preferIsac:function(l){var m=l.split("\r\n"),n=-1,o=-1,p=-1;for(var q=0;q<m.length;q++){var r=m[q];if(r.match(/m=audio\s+\d+\s+RTP\/SAVPF(\s+\d+)+/))n=q;if(p===-1&&n>-1&&r.match(/^a=rtpmap:/))p=q;if(r.match(/^a=rtpmap:\d+\s+ISAC\/16000/))o=q;}if(n===-1||o===-1||p===-1)return m.join("\r\n");var s=m[o];j(m,o,n);m.splice(p,0,s);m[n]=m[n].replace('RTP/SAVPF','RTP/SAVPF '+i(s));return m.join("\r\n");},disableVideo:function(l){var m=/m=video\s+\S+/;l=l.replace(m,h);if(c('UserAgent').isBrowser('Firefox <= 37'))l=this._makeDisabledVideoReceiveOnly(l);return l;},_makeDisabledVideoReceiveOnly:function(l){if(l.indexOf(h)>-1){var m=l.split(h);m[1]=m[1].replace(/send(recv|only)/,'recvonly');l=m.join(h);}return l;},fixMobileIceSdp:function(l){l=l.replace(/^a=/,'');l=l.split(/\s+username\s+.+password.+/)[0];var m=l.match(/\s+relay\s+|\s+srflx\s+/),n=l.match(/raddr.+rport.+/);if(m&&!n){m=m[0];var o=l.split(m),p=o[1].match(/^(\d+\.\d+\.\d+\.\d+)\s+(\d+)\s+/),q,r;if(p){q=p[1];r=p[2];o[1]=o[1].replace(p[0],'');}else{p=o[0].split(/\s+/);q=p[4];r=p[5];}l=''+o[0]+m+'raddr '+q+' rport '+r+' '+o[1];}return l;},removeFEC:function(l){var m=l.split('\r\n'),n,o;for(var p=0;p<m.length;p++){if(m[p].match(/^a=rtpmap:\d+\s+red\//))n=p;if(m[p].match(/^m=video/))o=p;}if(n&&o)j(m,n,o);return m.join('\r\n');},isVideoSupported:function(l){return (l&&l.indexOf('m=video')>-1&&l.indexOf(h)===-1);},setDtlsRole:function(l,m){if(!l.match(/setup:(active|passive|actpass)/)){return l.replace(/(a=fingerprint:.+)/g,'$1\r\na=setup:'+m);}else return l.replace(/setup:actpass/g,'setup:'+m);},setVideoBitrateConstraint:function(l){var m=720;if(l.match(/^b=AS:/m))return l;l=l.replace(/^a=mid:video\r\n/m,'a=mid:video\r\nb=AS:'+m+'\r\n');return l;},removeSdparta:function(l){var m=l.split('\r\n'),n='audio',o=false,p=-1;for(var q=0;q<m.length;q++){var r=m[q];if(r.indexOf('m=audio')===0)n='audio';if(r.indexOf('m=video')===0){o=true;n='video';}if(r.indexOf('a=mid:sdparta_')===0)m[q]='a=mid:'+n;if(r.indexOf('a=group:BUNDLE sdparta_')===0)p=q;}if(p>-1)if(o){m[p]='a=group:BUNDLE audio video';}else m[p]='a=group:BUNDLE audio';return m.join('\r\n');}};f.exports=k;},null);
__d('FBRTCStatsHelpers',['FBRTCLogger'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=function(j){if(j==='host'||j==='local')return 'local';if(j==='serverreflexive')return 'srflx';if(j==='peerreflexive')return 'prflx';if(j==='relayed'||j==='relay')return 'relay';return 'unknown';},i={connectionType:function(j,k,l,m){return ['l:',h(j),'-',k,';','r:',h(l),'-',m].join('');},logReport:function(j){var k=c('FBRTCLogger').getInstance(),l=['connectionType','audioCodec','videoCodec','audioRtt','videoRtt','audioPacketsLost','videoPacketsLost','audioBytesSent','videoBytesSent','audioPacketsSent','videoPacketsSent'];for(var m=0;m<l.length;m++){var n=j[l[m]].call(j);k.logToConsole(l[m]+' => '+n);}}};f.exports=i;},null);
__d('FBRTCChromeStatsReport',['FBRTCStatsHelpers'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=function(j,k){return parseInt(j.stat(k),10);};function i(){'use strict';this.$FBRTCChromeStatsReport1=[];this.$FBRTCChromeStatsReport2=null;this.$FBRTCChromeStatsReport3=null;this.$FBRTCChromeStatsReport4=null;this.$FBRTCChromeStatsReport5=null;this.$FBRTCChromeStatsReport6=null;}i.prototype.parseReport=function(j){'use strict';j.result().forEach(function(k){if(k.type==="googCandidatePair"&&k.stat('googActiveConnection')==='true')this.$FBRTCChromeStatsReport1.push(k);if(this.$FBRTCChromeStatsReport7(k))this.$FBRTCChromeStatsReport2=k;if(this.$FBRTCChromeStatsReport8(k))this.$FBRTCChromeStatsReport3=k;if(this.$FBRTCChromeStatsReport9(k))this.$FBRTCChromeStatsReport4=k;if(this.$FBRTCChromeStatsReport10(k))this.$FBRTCChromeStatsReport5=k;if(k.type==='VideoBwe')this.$FBRTCChromeStatsReport6=k;}.bind(this));};i.prototype.isConnected=function(){'use strict';return true;};i.prototype.audioRtt=function(){'use strict';if(!this.$FBRTCChromeStatsReport2)return 0;return h(this.$FBRTCChromeStatsReport2,'googRtt');};i.prototype.videoRtt=function(){'use strict';if(!this.$FBRTCChromeStatsReport3)return 0;return h(this.$FBRTCChromeStatsReport3,'googRtt');};i.prototype.audioCodec=function(){'use strict';if(!this.$FBRTCChromeStatsReport2)return 'unknown';return this.$FBRTCChromeStatsReport2.stat('googCodecName');};i.prototype.videoCodec=function(){'use strict';if(!this.$FBRTCChromeStatsReport3)return 'unknown';return this.$FBRTCChromeStatsReport3.stat('googCodecName');};i.prototype.audioPacketsLost=function(){'use strict';if(!this.$FBRTCChromeStatsReport2)return 0;return h(this.$FBRTCChromeStatsReport2,'packetsLost');};i.prototype.setVideoPacketsLost=function(j){'use strict';this.$FBRTCChromeStatsReport11=j;};i.prototype.videoPacketsLost=function(){'use strict';if(!this.$FBRTCChromeStatsReport3)return 0;if(this.$FBRTCChromeStatsReport11)return this.$FBRTCChromeStatsReport11;return h(this.$FBRTCChromeStatsReport3,'packetsLost');};i.prototype.audioBytesSent=function(){'use strict';if(!this.$FBRTCChromeStatsReport2)return 0;return h(this.$FBRTCChromeStatsReport2,'bytesSent');};i.prototype.videoBytesSent=function(){'use strict';if(!this.$FBRTCChromeStatsReport3)return 0;return h(this.$FBRTCChromeStatsReport3,'bytesSent');};i.prototype.audioPacketsSent=function(){'use strict';if(!this.$FBRTCChromeStatsReport2)return 0;return h(this.$FBRTCChromeStatsReport2,'packetsSent');};i.prototype.videoPacketsSent=function(){'use strict';if(!this.$FBRTCChromeStatsReport3)return 0;return h(this.$FBRTCChromeStatsReport3,'packetsSent');};i.prototype.videoFrameRateSent=function(){'use strict';if(!this.$FBRTCChromeStatsReport3)return 0;return h(this.$FBRTCChromeStatsReport3,'googFrameRateSent');};i.prototype.videoFrameRateCaptured=function(){'use strict';if(!this.$FBRTCChromeStatsReport3)return 0;return h(this.$FBRTCChromeStatsReport3,'googFrameRateInput');};i.prototype.connectionType=function(){'use strict';var j='unknown',k='unknown',l='unknown';for(var m=0;m<this.$FBRTCChromeStatsReport1.length;m++){var n=this.$FBRTCChromeStatsReport1[m];k=n.stat('googLocalCandidateType');l=n.stat('googRemoteCandidateType');j=n.stat('googTransportType');}return c('FBRTCStatsHelpers').connectionType(k,j,l,j);};i.prototype.$FBRTCChromeStatsReport7=function(j){'use strict';return j.type==='ssrc'&&j.names().indexOf('audioInputLevel')>-1;};i.prototype.$FBRTCChromeStatsReport8=function(j){'use strict';return j.type==='ssrc'&&j.names().indexOf('googFrameHeightInput')>-1;};i.prototype.$FBRTCChromeStatsReport9=function(j){'use strict';return j.type==='ssrc'&&j.names().indexOf('audioOutputLevel')>-1;};i.prototype.$FBRTCChromeStatsReport10=function(j){'use strict';return j.type==='ssrc'&&j.names().indexOf('googFrameHeightReceived')>-1;};f.exports=i;},null);
__d('FBRTCMozStatsReport',['Map','FBRTCLogger','FBRTCStatsHelpers'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(){'use strict';this.$FBRTCMozStatsReport1=null;this.$FBRTCMozStatsReport2=null;this.$FBRTCMozStatsReport3=null;this.$FBRTCMozStatsReport4=null;this.candidates=new (c('Map'))();this.candidatePairs=new (c('Map'))();this.$FBRTCMozStatsReport5=c('FBRTCLogger').getInstance();}h.prototype.parseReport=function(i){'use strict';i.forEach(function(j){switch(j.type){case 'inboundrtp':if(!j.remoteId)break;var k={inbound:j,outbound:i[j.remoteId]};if(j.isRemote){if(k.outbound.hasOwnProperty('framerateMean')){this.$FBRTCMozStatsReport2=k;}else this.$FBRTCMozStatsReport1=k;}else if(k.outbound.hasOwnProperty('framerateMean')){this.$FBRTCMozStatsReport4=k;}else this.$FBRTCMozStatsReport3=k;break;case 'outboundrtp':break;case 'candidatepair':if(j.state==='succeeded')this.candidatePairs.set(j.id,j);break;case 'localcandidate':this.candidates.set(j.id,j);break;case 'remotecandidate':this.candidates.set(j.id,j);break;default:this.$FBRTCMozStatsReport5.logToConsole('unrecognized webrtc stats type '+j.type);break;}}.bind(this));};h.prototype.isConnected=function(){'use strict';return !!this.$FBRTCMozStatsReport1;};h.prototype.audioRtt=function(){'use strict';if(!this.$FBRTCMozStatsReport1)return 0;return this.$FBRTCMozStatsReport1.inbound.mozRtt;};h.prototype.videoRtt=function(){'use strict';if(!this.$FBRTCMozStatsReport2)return 0;return this.$FBRTCMozStatsReport2.inbound.mozRtt;};h.prototype.audioCodec=function(){'use strict';return 'opus';};h.prototype.videoCodec=function(){'use strict';return 'VP8';};h.prototype.audioPacketsLost=function(){'use strict';if(!this.$FBRTCMozStatsReport1)return 0;return this.$FBRTCMozStatsReport1.inbound.packetsLost;};h.prototype.setVideoPacketsLost=function(i){'use strict';};h.prototype.videoPacketsLost=function(){'use strict';if(!this.$FBRTCMozStatsReport2)return 0;return this.$FBRTCMozStatsReport2.inbound.packetsLost;};h.prototype.audioBytesSent=function(){'use strict';if(!this.$FBRTCMozStatsReport1)return 0;return this.$FBRTCMozStatsReport1.outbound.bytesSent;};h.prototype.videoBytesSent=function(){'use strict';if(!this.$FBRTCMozStatsReport2)return 0;return this.$FBRTCMozStatsReport2.outbound.bytesSent;};h.prototype.audioPacketsSent=function(){'use strict';if(!this.$FBRTCMozStatsReport1)return 0;return this.$FBRTCMozStatsReport1.outbound.packetsSent;};h.prototype.videoPacketsSent=function(){'use strict';if(!this.$FBRTCMozStatsReport2)return 0;return this.$FBRTCMozStatsReport2.outbound.packetsSent;};h.prototype.videoFrameRateSent=function(){'use strict';if(!this.$FBRTCMozStatsReport2)return 0;return this.$FBRTCMozStatsReport2.outbound.framerateMean;};h.prototype.videoFrameRateCaptured=function(){'use strict';if(!this.$FBRTCMozStatsReport2)return 0;return 30;};h.prototype.connectionType=function(){'use strict';var i='unknown',j='unknown',k='unknown',l='unknown';this.candidatePairs.forEach(function(m){var n=this.candidates.get(m.localCandidateId),o=this.candidates.get(m.remoteCandidateId);i=n.transport;k=o.transport;j=n.candidateType;l=o.candidateType;}.bind(this));return c('FBRTCStatsHelpers').connectionType(j,i,l,k);};f.exports=h;},null);
__d('FBRTCStatsReportFactory',['FBRTCMozStatsReport','FBRTCChromeStatsReport','FBRTCLogger','FBRTCVersionDetection'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=function(k,l){k.getStats(null,function(m){var n=new (c('FBRTCMozStatsReport'))();n.parseReport(m);l(n);},function(){c('FBRTCLogger').getInstance().logToConsole('Firefox stats collection failed');});},i=function(k,l){k.getStats(function(m){var n=new (c('FBRTCChromeStatsReport'))();n.parseReport(m);l(n);});},j={getStats:function(k,l){if(c('FBRTCVersionDetection').isFirefox())h(k,l);if(c('FBRTCVersionDetection').isChrome())i(k,l);}};f.exports=j;},null);
__d('FBRTCCallConnection',['invariant','Base64','FBRTCConfig','FBRTCLogger','FBRTCPCConfig','FBRTCConstants','FBRTCSdpUtils','FBRTCStatsReportFactory','Queue','UserAgent','mixInEventEmitter'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=300000,j=12000,k=10000,l='data',m=1000,n=100;function o(){'use strict';this.$FBRTCCallConnection1=c('FBRTCLogger').getInstance();this.$FBRTCCallConnection2();this.$FBRTCCallConnection3=null;this.$FBRTCCallConnection4=null;this.$FBRTCCallConnection5=new (c('Queue'))({interval:1,processor:this.$FBRTCCallConnection6.bind(this)});this.$FBRTCCallConnection7=null;this.$FBRTCCallConnection8=null;this.$FBRTCCallConnection9=false;this.$FBRTCCallConnection10=0;this.$FBRTCCallConnection11=[];this.$FBRTCCallConnection12=false;this.$FBRTCCallConnection13='passive';this.$FBRTCCallConnection14=true;this.$FBRTCCallConnection15=0;this.$FBRTCCallConnection16={};this.$FBRTCCallConnection17=null;}o.prototype.init=function(p){'use strict';this.$FBRTCCallConnection1.logToConsole('Creating a new peer connection with: '+JSON.stringify(c('FBRTCPCConfig').getConfig())+', '+JSON.stringify(c('FBRTCPCConfig').getConstraints()));this.$FBRTCCallConnection18=p;};o.prototype.setStream=function(p){'use strict';this.$FBRTCCallConnection18=p;};o.prototype.addScreenStream=function(p){'use strict';if(p&&p.getStream()){this.$FBRTCCallConnection1.logToConsole('Screen stream added');this.$FBRTCCallConnection19=p;}else this.$FBRTCCallConnection1.logToConsole('Trying to add invalid stream');};o.prototype.removeScreenStream=function(p){'use strict';if(p&&p.getStream()){this.$FBRTCCallConnection1.logToConsole('Screen stream removed');try{this.$FBRTCCallConnection3.removeStream(p.getStream());}catch(q){this.$FBRTCCallConnection1.logToConsole('Missing connection to remove stream from');}}else this.$FBRTCCallConnection1.logToConsole('Trying to remove an invalid stream');this.$FBRTCCallConnection19=null;};o.prototype.setPeerSupportsVideo=function(p){'use strict';this.$FBRTCCallConnection14=p;};o.prototype.$FBRTCCallConnection20=function(){'use strict';var p={};if(this.$FBRTCCallConnection18&&this.$FBRTCCallConnection18.hasStream()){var q=this.$FBRTCCallConnection18.hasVideoTracks()?c('FBRTCConstants').StreamType.AUDIO_VIDEO:c('FBRTCConstants').StreamType.AUDIO_ONLY;p[this.$FBRTCCallConnection18.getStreamId()]={type:q};}if(this.$FBRTCCallConnection19&&this.$FBRTCCallConnection19.hasStream())p[this.$FBRTCCallConnection19.getStreamId()]={type:c('FBRTCConstants').StreamType.SCREEN_CONTENT};return {streams:p};};o.prototype.$FBRTCCallConnection21=function(p){'use strict';this.$FBRTCCallConnection1.logToConsole('Setting new remote attributes: '+JSON.stringify(p));this.$FBRTCCallConnection17=p;};o.prototype.getRemoteAttributesForStream=function(p){'use strict';var q=p&&this.$FBRTCCallConnection17&&this.$FBRTCCallConnection17.streams;return q&&q[p.id];};o.prototype.isScreenStream=function(p){'use strict';var q=this.getRemoteAttributesForStream(p);if(q){this.$FBRTCCallConnection1.logToConsole('Stream '+p.id+' type attribute is: '+q.type);return q.type===c('FBRTCConstants').StreamType.SCREEN_CONTENT;}else{this.$FBRTCCallConnection1.logToConsole('No attributes found for stream '+p.id);return false;}};o.prototype.getRemoteStreamsCount=function(){'use strict';return this.$FBRTCCallConnection3.getRemoteStreams().length;};o.prototype.$FBRTCCallConnection22=function(p,q){'use strict';this.$FBRTCCallConnection23(null);p.onaddstream=null;p.onremovestream=null;p.onicecandidate=null;p.oniceconnectionstatechange=null;this.$FBRTCCallConnection11=[];var r=q?5000:1;setTimeout(function(){if(p.iceConnectionState!=='closed')p.close();},r);};o.prototype.$FBRTCCallConnection24=function(){'use strict';if(this.$FBRTCCallConnection3)this.$FBRTCCallConnection22(this.$FBRTCCallConnection3,true);var p=new this.nativePeerConnection(c('FBRTCPCConfig').getConfig(),c('FBRTCPCConfig').getConstraints());this.$FBRTCCallConnection13='passive';p.onaddstream=this.$FBRTCCallConnection25.bind(this);p.onremovestream=this.$FBRTCCallConnection26.bind(this);p.onicecandidate=this.$FBRTCCallConnection27.bind(this);p.oniceconnectionstatechange=this.$FBRTCCallConnection28.bind(this);p.addStream(this.$FBRTCCallConnection29());return p;};o.prototype.$FBRTCCallConnection23=function(p){'use strict';this.$FBRTCCallConnection5.stop(true);if(this.isDataChannelOpen())this.$FBRTCCallConnection4.close();this.$FBRTCCallConnection4=p;if(!p)return;this.$FBRTCCallConnection4.onopen=this.$FBRTCCallConnection30.bind(this);this.$FBRTCCallConnection4.onclose=this.$FBRTCCallConnection31.bind(this);this.$FBRTCCallConnection4.onerror=this.$FBRTCCallConnection32.bind(this);this.$FBRTCCallConnection4.onmessage=this.$FBRTCCallConnection33.bind(this);};o.prototype.$FBRTCCallConnection30=function(event){'use strict';this.$FBRTCCallConnection5.start();this.emit('data_opened',event);};o.prototype.$FBRTCCallConnection31=function(event){'use strict';this.$FBRTCCallConnection23(null);this.emit('data_closed',event);};o.prototype.$FBRTCCallConnection32=function(event){'use strict';this.$FBRTCCallConnection23(null);this.emit('data_error',event);};o.prototype.$FBRTCCallConnection33=function(event){'use strict';var p=JSON.parse(event.data);if(p.batchID===undefined){this.emit('data_message',p.data);return;}if(this.$FBRTCCallConnection16[p.batchID]===undefined)this.$FBRTCCallConnection16[p.batchID]=[];var q=this.$FBRTCCallConnection16[p.batchID];q.push(p.data);if(!p.isLast)return;var r=c('Base64').decodeObject(q.join(''));delete this.$FBRTCCallConnection16[p.batchID];this.emit('data_message',r.data);};o.prototype.isDataChannelOpen=function(){'use strict';return !!this.$FBRTCCallConnection4&&this.$FBRTCCallConnection4.readyState==='open';};o.prototype.sendData=function(p){'use strict';this.$FBRTCCallConnection5.enqueue({data:p});};o.prototype.$FBRTCCallConnection6=function(p){'use strict';if(!this.isDataChannelOpen()){h(0);return;}if(p.batchID!==undefined){this.$FBRTCCallConnection34(p);return;}var q=JSON.stringify(p);try{this.$FBRTCCallConnection4.send(q);return;}catch(r){}if(q.length<m){setTimeout(function(){this.$FBRTCCallConnection5.enqueue(p);}.bind(this),n);return;}var s={batchID:this.$FBRTCCallConnection15.toString(),dataStr:c('Base64').encode(q)};this.$FBRTCCallConnection15++;this.$FBRTCCallConnection34(s);};o.prototype.$FBRTCCallConnection34=function(p){'use strict';while(this.isDataChannelOpen()&&p.dataStr.length>0){var q={batchID:p.batchID,data:p.dataStr.slice(0,m)},r=p.dataStr.slice(m);if(r.length<=0)q.isLast=true;try{this.$FBRTCCallConnection4.send(JSON.stringify(q));}catch(s){setTimeout(function(){this.$FBRTCCallConnection5.enqueue(p);}.bind(this),n);return;}p.dataStr=r;}};o.prototype.createOffer=function(){'use strict';this.$FBRTCCallConnection3=this.$FBRTCCallConnection24();if(c('FBRTCConfig').shouldCreateDataChannel())this.$FBRTCCallConnection23(this.$FBRTCCallConnection3.createDataChannel(l));this.$FBRTCCallConnection35('offer');this.$FBRTCCallConnection13='active';};o.prototype.createSdpUpdate=function(p){'use strict';if(p){var q=this.$FBRTCCallConnection3.getLocalStreams();for(var r=0;r<q.length;r++)this.$FBRTCCallConnection3.removeStream(q[r]);this.$FBRTCCallConnection3.addStream(this.$FBRTCCallConnection18.getStream());if(this.$FBRTCCallConnection19)this.$FBRTCCallConnection3.addStream(this.$FBRTCCallConnection19.getStream());}else this.$FBRTCCallConnection29();this.$FBRTCCallConnection35('sdp_update');};o.prototype.$FBRTCCallConnection29=function(){'use strict';var p=this.$FBRTCCallConnection18.getStream();if(!this.$FBRTCCallConnection19){if(this.$FBRTCCallConnection36){this.$FBRTCCallConnection37(this.$FBRTCCallConnection36);this.$FBRTCCallConnection36=null;}}else{this.$FBRTCCallConnection36=p.getVideoTracks()[0];var q=this.$FBRTCCallConnection19.getStream().getVideoTracks(),r=q[0];this.$FBRTCCallConnection37(r);}return p;};o.prototype.$FBRTCCallConnection37=function(p){'use strict';var q=this.$FBRTCCallConnection18.getStream(),r=q.getVideoTracks(),s=r.length;while(s--)q.removeTrack(r[s]);q.addTrack(p);};o.prototype.$FBRTCCallConnection35=function(p){'use strict';this.$FBRTCCallConnection12=true;this.$FBRTCCallConnection3.createOffer(this.$FBRTCCallConnection38.bind(this,p),this.$FBRTCCallConnection39.bind(this,'CreateOfferFailed'),this.$FBRTCCallConnection40());};o.prototype.$FBRTCCallConnection40=function(){'use strict';if(c('UserAgent').isBrowser('Chrome <= 37')||c('UserAgent').isBrowser('Opera <= 25'))return {mandatory:{OfferToReceiveAudio:true,OfferToReceiveVideo:this.$FBRTCCallConnection14}};return {offerToReceiveAudio:true,offerToReceiveVideo:this.$FBRTCCallConnection14};};o.prototype.end=function(){'use strict';this.$FBRTCCallConnection1.logToConsole('Ending connection...');if(this.$FBRTCCallConnection3){this.emit('isEnding');this.$FBRTCCallConnection22(this.$FBRTCCallConnection3,false);this.$FBRTCCallConnection3=null;}};o.prototype.onReceivedOfferSDP=function(p,q){'use strict';this.$FBRTCCallConnection3=this.$FBRTCCallConnection24();if(c('FBRTCConfig').shouldCreateDataChannel())this.$FBRTCCallConnection3.ondatachannel=function(event){this.$FBRTCCallConnection23(event.channel);}.bind(this);var r=new this.nativeSessionDescription({type:'offer',sdp:p});this.$FBRTCCallConnection21(q);this.$FBRTCCallConnection3.setRemoteDescription(r,this.$FBRTCCallConnection41.bind(this,r),this.$FBRTCCallConnection39.bind(this,'SetRemoteOfferFailed'));};o.prototype.onReceivedAnswerSDP=function(p,q){'use strict';var r=new this.nativeSessionDescription({type:'answer',sdp:p});this.$FBRTCCallConnection21(q);this.$FBRTCCallConnection3.setRemoteDescription(r,this.$FBRTCCallConnection41.bind(this,r),this.$FBRTCCallConnection39.bind(this,'SetRemoteAnswerFailed'));};o.prototype.onReceivedSdpUpdate=function(p,q){'use strict';if(this.$FBRTCCallConnection12)setTimeout(function(){this.onReceivedSdpUpdate(p,q);}.bind(this),200);switch(this.$FBRTCCallConnection3.signalingState){case 'stable':this.$FBRTCCallConnection42(p,'offer',q);break;case 'have-local-offer':p=c('FBRTCSdpUtils').setDtlsRole(p,this.$FBRTCCallConnection13);this.$FBRTCCallConnection42(p,'answer',q);break;case 'have-remote-offer':setTimeout(function(){this.onReceivedSdpUpdate(p,q);}.bind(this),1000);break;case 'have-local-pranswer':case 'have-remote-pranswer':break;case 'closed':break;}};o.prototype.$FBRTCCallConnection42=function(p,q,r){'use strict';var s=new this.nativeSessionDescription({type:q,sdp:p});this.$FBRTCCallConnection12=true;this.$FBRTCCallConnection21(r);this.$FBRTCCallConnection3.setRemoteDescription(s,function(){this.$FBRTCCallConnection1.logToConsole('sdp update '+s.type+' set');if(this.$FBRTCCallConnection3&&s.type==='offer'){this.$FBRTCCallConnection3.createAnswer(this.$FBRTCCallConnection38.bind(this,'sdp_update'),this.$FBRTCCallConnection39.bind(this,'CreateSdpUpdateFailed'));}else this.$FBRTCCallConnection12=false;}.bind(this),this.$FBRTCCallConnection39.bind(this,'SetRemoteSdpUpdateFailed'));};o.prototype.onReceivedRemoteIceCandidate=function(p){'use strict';p.sdp=c('FBRTCSdpUtils').fixMobileIceSdp(p.sdp);var q=new this.nativeIceCandidate({sdpMLineIndex:p.label,candidate:p.sdp,sdpMid:p.sdp_mid});this.$FBRTCCallConnection3.addIceCandidate(q);};o.prototype.getStats=function(p){'use strict';c('FBRTCStatsReportFactory').getStats(this.$FBRTCCallConnection3,p);};o.prototype.getCreatedIceCandidates=function(){'use strict';return this.$FBRTCCallConnection11;};o.prototype.$FBRTCCallConnection38=function(p,q){'use strict';this.$FBRTCCallConnection1.logToConsole('Created '+p+' sdp');if(!this.$FBRTCCallConnection3){this.$FBRTCCallConnection1.logToConsole('_onSDPCreated: pc has been deallocated');return;}if(!this.$FBRTCCallConnection14&&p==='sdp_update')q.sdp=c('FBRTCSdpUtils').disableVideo(q.sdp);q.sdp=c('FBRTCSdpUtils').addIceOptionToSdp(q.sdp,"fb-force-5245");q.sdp=c('FBRTCSdpUtils').preferIsac(q.sdp);q.sdp=c('FBRTCSdpUtils').removeSdparta(q.sdp);q.sdp=c('FBRTCSdpUtils').replaceRTPSAVPFProfile(q.sdp);this.$FBRTCCallConnection3.setLocalDescription(q,function(){this.$FBRTCCallConnection12=false;this.$FBRTCCallConnection1.logToConsole('Local '+p+' set');this.emit('sdpCreated',{type:p,sdp:q.sdp,attributes:this.$FBRTCCallConnection20()});}.bind(this),this.$FBRTCCallConnection39.bind(this,'SetLocalDescriptionFailed:'+p));};o.prototype.$FBRTCCallConnection41=function(p){'use strict';this.$FBRTCCallConnection1.logToConsole('Remote '+p.type+' set');if(!this.$FBRTCCallConnection3){this.$FBRTCCallConnection1.logToConsole('_onRemoteDescriptionSet: pc has been deallocated');return;}if(p.type==='offer')this.$FBRTCCallConnection3.createAnswer(this.$FBRTCCallConnection38.bind(this,'answer'),this.$FBRTCCallConnection39.bind(this,'CreateAnswerFailed'));this.emit('remoteDescriptionSet');};o.prototype.$FBRTCCallConnection25=function(event){'use strict';this.$FBRTCCallConnection1.logToConsole('Remote stream added');this.emit('remoteStreamAdded',{stream:event.stream});};o.prototype.$FBRTCCallConnection26=function(event){'use strict';this.$FBRTCCallConnection1.logToConsole('Remote stream removed');this.emit('remoteStreamRemoved',{stream:event.stream});};o.prototype.$FBRTCCallConnection27=function(event){'use strict';if(event.candidate){this.$FBRTCCallConnection11.push(event.candidate);this.emit('localIceCandidateCreated',event.candidate);}};o.prototype.$FBRTCCallConnection28=function(event){'use strict';var p=event.target.iceConnectionState;this.$FBRTCCallConnection1.logToConsole('Ice candidate state changed from '+this.$FBRTCCallConnection7+' to '+p);if(p===this.$FBRTCCallConnection7)return;this.$FBRTCCallConnection43();if(this.$FBRTCCallConnection44(p)){if(!this.$FBRTCCallConnection9){this.emit('connected');this.$FBRTCCallConnection9=true;}}else if(p==='disconnected'){this.$FBRTCCallConnection45();}else if(p==='failed')this.$FBRTCCallConnection46();this.$FBRTCCallConnection7=p;};o.prototype.$FBRTCCallConnection44=function(p){'use strict';return p==='completed'||p==='connected';};o.prototype.$FBRTCCallConnection45=function(){'use strict';if(this.$FBRTCCallConnection44(this.$FBRTCCallConnection7)){var p=Date.now();if(this.$FBRTCCallConnection47-p>=i)this.$FBRTCCallConnection10=0;this.$FBRTCCallConnection10=this.$FBRTCCallConnection10+1;this.$FBRTCCallConnection47=p;if(this.$FBRTCCallConnection10>=2)this.emit('connectionUnstable');}var q=this;this.$FBRTCCallConnection8=setTimeout(function(){q.emit('disconnected');},j);};o.prototype.$FBRTCCallConnection46=function(){'use strict';var p=this;this.$FBRTCCallConnection8=setTimeout(function(){var q={details:'Ice candidate state failed',endCallSubreason:'IceFailed'};p.emit('connectionError',q);},k);};o.prototype.$FBRTCCallConnection43=function(){'use strict';if(this.$FBRTCCallConnection8)clearTimeout(this.$FBRTCCallConnection8);this.$FBRTCCallConnection8=null;};o.prototype.$FBRTCCallConnection39=function(p,q){'use strict';var r={details:q,endCallSubreason:p};this.emit('connectionError',r);};o.prototype.$FBRTCCallConnection2=function(){'use strict';if(window.webkitRTCPeerConnection){this.$FBRTCCallConnection1.logToConsole('Using Chrome WebRTC APIs...');this.nativePeerConnection=window.webkitRTCPeerConnection;this.nativeIceCandidate=window.RTCIceCandidate;this.nativeSessionDescription=window.RTCSessionDescription;}else{this.$FBRTCCallConnection1.logToConsole('Using Firefox WebRTC APIs...');this.nativePeerConnection=window.mozRTCPeerConnection;this.nativeIceCandidate=window.mozRTCIceCandidate;this.nativeSessionDescription=window.mozRTCSessionDescription;}};c('mixInEventEmitter')(o,{remoteStreamAdded:true,remoteStreamRemoved:true,sdpCreated:true,localIceCandidateCreated:true,remoteDescriptionSet:true,connected:true,disconnected:true,connectionUnstable:true,connectionError:true,isEnding:true,data_opened:true,data_closed:true,data_error:true,data_message:true});f.exports=o;},null);
__d('FBRTCRttAggregator',[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(){'use strict';this.$FBRTCRttAggregator1=[{count:0,ave:0},{count:0,ave:0},{count:0,ave:0},{count:0,ave:0}];}h.prototype.addRtt=function(i){'use strict';var j=this.$FBRTCRttAggregator1[this.$FBRTCRttAggregator2(i)];j.ave=this.$FBRTCRttAggregator3(j.ave,j.count,i);j.count+=1;};h.prototype.toString=function(){'use strict';return [this.$FBRTCRttAggregator4('50',this.$FBRTCRttAggregator1[0]),this.$FBRTCRttAggregator4('100',this.$FBRTCRttAggregator1[1]),this.$FBRTCRttAggregator4('200',this.$FBRTCRttAggregator1[2]),this.$FBRTCRttAggregator4('0',this.$FBRTCRttAggregator1[3])].join('|');};h.prototype.$FBRTCRttAggregator4=function(i,j){'use strict';return i+'='+j.count+','+Math.round(j.ave);};h.prototype.$FBRTCRttAggregator2=function(i){'use strict';if(i<50)return 0;if(i<100)return 1;if(i<200)return 2;return 3;};h.prototype.$FBRTCRttAggregator3=function(i,j,k){'use strict';return (i*j+k)/(j+1);};f.exports=h;},null);
__d('FBRTCStatsInterpreter',['FBRTCLogger'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={rtt_weight:2,frr_weight:800,plr_weight:500,score_threshold:1000,bad_score_count:3};function i(j){'use strict';this.$FBRTCStatsInterpreter1=babelHelpers['extends']({},h,j);this.$FBRTCStatsInterpreter2=c('FBRTCLogger').getInstance();this.$FBRTCStatsInterpreter3=0;}i.prototype.interpretStats=function(j,k){'use strict';var l=j.videoRtt(),m=this.$FBRTCStatsInterpreter4(j),n=this.$FBRTCStatsInterpreter5(j,k),o=this.$FBRTCStatsInterpreter6(l,m,n);if(o>=this.$FBRTCStatsInterpreter1.score_threshold&&!this.isNetworkPoor())this.$FBRTCStatsInterpreter3+=1;if(o<this.$FBRTCStatsInterpreter1.score_threshold&&this.$FBRTCStatsInterpreter3>0)this.$FBRTCStatsInterpreter3-=1;};i.prototype.isNetworkPoor=function(){'use strict';return this.$FBRTCStatsInterpreter3>=this.$FBRTCStatsInterpreter1.bad_score_count;};i.prototype.$FBRTCStatsInterpreter6=function(j,k,l){'use strict';return j*this.$FBRTCStatsInterpreter1.rtt_weight+k*this.$FBRTCStatsInterpreter1.frr_weight+l*this.$FBRTCStatsInterpreter1.plr_weight;};i.prototype.$FBRTCStatsInterpreter5=function(j,k){'use strict';var l,m;if(k){l=j.videoPacketsLost()-k.videoPacketsLost();m=j.videoPacketsSent()-k.videoPacketsSent();}else{l=j.videoPacketsLost();m=j.videoPacketsSent();}if(l<0||m===0)return 0;return l/m;};i.prototype.$FBRTCStatsInterpreter4=function(j){'use strict';if(j.videoFrameRateCaptured()===0)return 0;return 1-j.videoFrameRateSent()/j.videoFrameRateCaptured();};f.exports=i;},null);
__d("RingBuffer",[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(i){"use strict";this.$RingBuffer1=i;this.$RingBuffer2=-1;this.$RingBuffer3=[];}h.prototype.add=function(i){"use strict";this.$RingBuffer2=(this.$RingBuffer2+1)%this.$RingBuffer1;this.$RingBuffer3[this.$RingBuffer2]=i;};h.prototype.size=function(){"use strict";return this.$RingBuffer3.length;};h.prototype.head=function(){"use strict";if(this.$RingBuffer2===-1)return null;return this.$RingBuffer3[this.$RingBuffer2];};h.prototype.tail=function(){"use strict";if(this.$RingBuffer2===-1)return null;return this.$RingBuffer3[this.$RingBuffer4()];};h.prototype.forEach=function(i){"use strict";for(var j=0;j<this.$RingBuffer3.length;j++){var k=(this.$RingBuffer2+1+j)%this.$RingBuffer3.length;i(this.$RingBuffer3[k]);}};h.prototype.$RingBuffer4=function(){"use strict";return (this.$RingBuffer2+1)%this.$RingBuffer3.length;};f.exports=h;},null);
__d('FBRTCCallConnectionMonitor',['RingBuffer','FBRTCRttAggregator','FBRTCStatsInterpreter','FBRTCConfig','mixInEventEmitter'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=3000,i=1,j=0,k=3;function l(m,n){'use strict';this.$FBRTCCallConnectionMonitor1=new (c('FBRTCStatsInterpreter'))(c('FBRTCConfig').statsInterpreterConfig());this.$FBRTCCallConnectionMonitor2=new (c('FBRTCRttAggregator'))();this.$FBRTCCallConnectionMonitor3=new (c('FBRTCRttAggregator'))();this.$FBRTCCallConnectionMonitor4=m;this.$FBRTCCallConnectionMonitor5=n;this.$FBRTCCallConnectionMonitor6=null;this.$FBRTCCallConnectionMonitor7=[];this.$FBRTCCallConnectionMonitor8=new (c('RingBuffer'))(i);this.$FBRTCCallConnectionMonitor9=0;this.$FBRTCCallConnectionMonitor4.addListener('connected',this.$FBRTCCallConnectionMonitor10,this);this.$FBRTCCallConnectionMonitor4.addListener('isEnding',this.$FBRTCCallConnectionMonitor11,this);}l.prototype.$FBRTCCallConnectionMonitor10=function(){'use strict';var m=this.$FBRTCCallConnectionMonitor12.bind(this);this.$FBRTCCallConnectionMonitor6=setInterval(m,h);this.$FBRTCCallConnectionMonitor12();};l.prototype.$FBRTCCallConnectionMonitor11=function(){'use strict';if(this.$FBRTCCallConnectionMonitor6!==null){this.$FBRTCCallConnectionMonitor12();clearInterval(this.$FBRTCCallConnectionMonitor6);this.$FBRTCCallConnectionMonitor6=null;}};l.prototype.$FBRTCCallConnectionMonitor12=function(){'use strict';this.$FBRTCCallConnectionMonitor4.getStats(function(m){var n;if(this.$FBRTCCallConnectionMonitor8.size()>0){n=this.$FBRTCCallConnectionMonitor8.head();this.$FBRTCCallConnectionMonitor13(m,n);}if(this.$FBRTCCallConnectionMonitor7.length<j)this.$FBRTCCallConnectionMonitor7.push(m);if(n&&n.isConnected()&&!m.isConnected())this.$FBRTCCallConnectionMonitor9+=1;this.$FBRTCCallConnectionMonitor9>=k;if(m.isConnected()){this.$FBRTCCallConnectionMonitor9=0;this.$FBRTCCallConnectionMonitor8.add(m);this.$FBRTCCallConnectionMonitor2.addRtt(m.audioRtt());this.$FBRTCCallConnectionMonitor3.addRtt(m.videoRtt());this.$FBRTCCallConnectionMonitor5.setPcStats(this.$FBRTCCallConnectionMonitor14());this.$FBRTCCallConnectionMonitor15(m,n);}}.bind(this));};l.prototype.$FBRTCCallConnectionMonitor14=function(){'use strict';var m=this.$FBRTCCallConnectionMonitor8.head();return {end:{conn_type:m.connectionType()},sender:{bytes:m.audioBytesSent(),codec:{'0':m.audioCodec()},plost:m.audioPacketsLost(),psent:m.audioPacketsSent(),rtt:this.$FBRTCCallConnectionMonitor2.toString()},video:{sender:{bytes:m.videoBytesSent(),codec:{'0':m.videoCodec()},plost:m.videoPacketsLost(),psent:m.videoPacketsSent(),rtt:this.$FBRTCCallConnectionMonitor3.toString()}}};};l.prototype.$FBRTCCallConnectionMonitor13=function(m,n){'use strict';if(n.videoPacketsLost()>m.videoPacketsLost())m.setVideoPacketsLost(n.videoPacketsLost());};l.prototype.$FBRTCCallConnectionMonitor15=function(m,n){'use strict';this.$FBRTCCallConnectionMonitor1.interpretStats(m,n);if(this.$FBRTCCallConnectionMonitor1.isNetworkPoor())this.emit('connectionPoor');};c('mixInEventEmitter')(l,{connectionPoor:true});f.exports=l;},null);
__d('FBRTCFullScreenController',['FBRTCCallControlActions','FBRTCStore'],function a(b,c,d,e,f,g){var h,i;if(c.__markCompiled)c.__markCompiled();var j,k,l=document.documentElement;if(l.requestFullscreen){j=l.requestFullscreen.bind(l);k='fullscreenchange';}else if(l.msRequestFullscreen){j=l.msRequestFullscreen.bind(l);k='msfullscreenchange';}else if(l.mozRequestFullScreen){j=l.mozRequestFullScreen.bind(l);k='mozfullscreenchange';}else if(l.webkitRequestFullscreen){j=l.webkitRequestFullscreen.bind(l,Element.ALLOW_KEYBOARD_INPUT);k='webkitfullscreenchange';}var m;if(document.exitFullscreen){m=document.exitFullscreen.bind(document);}else if(document.msExitFullscreen){m=document.msExitFullscreen.bind(document);}else if(document.mozCancelFullScreen){m=document.mozCancelFullScreen.bind(document);}else if(document.webkitExitFullscreen)m=document.webkitExitFullscreen.bind(document);h=babelHelpers.inherits(n,c('FBRTCStore'));i=h&&h.prototype;function n(){'use strict';i.constructor.call(this);this.$FBRTCFullScreenController1=this.$FBRTCFullScreenController2.bind(this);document.addEventListener(k,this.$FBRTCFullScreenController1);}n.prototype.destroy=function(){'use strict';document.removeEventListener(k,this.$FBRTCFullScreenController1);i.destroy.call(this);};n.prototype.$FBRTCFullScreenController2=function(){'use strict';this.__emitChange();};n.prototype.supportsFullScreen=function(){'use strict';return j&&m;};n.prototype.isFullScreen=function(){'use strict';return !!(document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement);};n.prototype.$FBRTCFullScreenController3=function(){'use strict';if(this.isFullScreen()){m();}else j();};n.prototype.__onDispatch=function(o){'use strict';switch(o.type){case c('FBRTCCallControlActions').Types.TOGGLE_FULL_SCREEN:this.$FBRTCFullScreenController3();break;}};f.exports=new n();},null);
__d("XVideoCallUserInfoController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/videocall\/userinfo\/",{user_id:{type:"Int",required:true}});},null);
__d('FBRTCPeerInfo',['ix','XVideoCallUserInfoController','FBRTCUtils'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();function i(j){'use strict';this.peerID=j;this.peerPicUrl=null;this.selfPicUrl=h('/images/chat/webrtc/no_profile_pic.png');this.backgroundUrl=null;this.peerName='';this.peerShortName=null;this.isVCEndpoint=c('FBRTCUtils').isVCEndpointCallable(j);}i.prototype.fetch=function(j,k){'use strict';var l=c('XVideoCallUserInfoController').getURIBuilder().setInt('user_id',this.peerID).getURI(),m=this;c('FBRTCUtils').sendServerRequest(l,function(n){m.peerPicUrl=n.payload.profile_pic_url;m.backgroundUrl=n.payload.cover_pic_url;m.peerName=n.payload.name;m.peerShortName=n.payload.peer_short_name;if(n.payload.self_profile_pic_url)m.selfPicUrl=n.payload.self_profile_pic_url;if(j)j();},k);};f.exports=i;},null);
__d('FBRTCScreenSharingConstants',['keyMirror'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h=c('keyMirror')({DIRECT_SENDER:null,DIRECT_RECIPIENT:null,FROM_VIDEO_CALL:null}),i={UITypes:h};f.exports=i;},null);
__d('FBRTCScreenSharingActions',['FBRTCDispatcher','keyMirror'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h=c('keyMirror')({END_SESSION:null,SWITCH_SCREEN:null}),i=c('keyMirror')({SDP_CREATED:null,REMOTE_DESCRIPTION_SET:null,LOCAL_ICE_CANDIDATE_CREATED:null,REMOTE_STREAM_ADDED:null,OFFER_ACK:null}),j={ConnectionEventTypes:i,ControlEventTypes:h,endSession:function(){c('FBRTCDispatcher').dispatch({type:h.END_SESSION});},switchScreen:function(){c('FBRTCDispatcher').dispatch({type:h.SWITCH_SCREEN});},sdpCreated:function(k){c('FBRTCDispatcher').dispatch({type:i.SDP_CREATED,description:k});},remoteDescriptionSet:function(){c('FBRTCDispatcher').dispatch({type:i.REMOTE_DESCRIPTION_SET});},localIceCandidateCreated:function(k){c('FBRTCDispatcher').dispatch({type:i.LOCAL_ICE_CANDIDATE_CREATED,candidate:k});},remoteStreamAdded:function(k){c('FBRTCDispatcher').dispatch({type:i.REMOTE_STREAM_ADDED,stream:k});},offerAckReceived:function(){c('FBRTCDispatcher').dispatch({type:i.OFFER_ACK_RECEIVED});}};f.exports=j;},null);
__d('FBRTCActiveMouseMixin',[],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h=3000,i=[],j=null,k=false;function l(o){m(true);if(j!==null)clearTimeout(j);j=setTimeout(function(){j=null;m(false);},h);}function m(o){if(o===k)return;k=o;i.map(function(p){p(k);});}var n={componentWillMount:function(){if(this.activeMouseCallback){if(i.length==0)window.addEventListener('mousemove',l);i.push(this.activeMouseCallback);}},componentWillUnmount:function(){if(this.activeMouseCallback){var o=i.indexOf(this.activeMouseCallback);if(o>-1)i.splice(o,1);if(i.length==0){if(j!==null)clearTimeout(j);window.removeEventListener('mousemove',l);}}}};f.exports=n;},null);
__d('FBRTCCallControlButton.react',['cx','ReactComponentWithPureRenderMixin','React','emptyFunction'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=c('React').PropTypes,j={END:0,FULL_SCREEN:1,MUTE:2,SETTINGS:3,SHARE_SCREEN:4,VIDEO:5},k=c('React').createClass({displayName:'FBRTCCallControlButton',mixins:[c('ReactComponentWithPureRenderMixin')],propTypes:{active:i.bool,disabled:i.bool,endButton:i.bool,highlighted:i.bool,iconType:i.number.isRequired,onClick:i.func.isRequired,ref:i.string,title:i.string},defaultProps:function(){return {active:false,disabled:false,endButton:false,highlighted:false};},render:function(){var l="_5lms"+(this.props.highlighted?' '+"_5lmy":'')+(this.props.endButton?' '+"_5lmz":''),m=this.props,n=m.iconType,o=m.active,p=m.disabled;return (c('React').createElement('button',{onClick:this.props.disabled?c('emptyFunction'):this.props.onClick,className:l,ref:this.props.ref,'data-testid':this.props['data-testid'],title:this.props.title,tabIndex:'0',role:'button','aria-label':this.props.title,'data-hover':p?undefined:'tooltip','data-tooltip-alignh':'center','data-tooltip-content':this.props.title},this._icon(n,!!o,!!p)));},_icon:function(l,m,n){if(m)return (c('React').createElement('i',{className:"_5ln2"+(l===j.END?' '+"_5ln3":'')+(l===j.FULL_SCREEN?' '+"_5lng":'')+(l===j.MUTE?' '+"_5lnh":'')+(l===j.SETTINGS?' '+"_5lni":'')+(l===j.SHARE_SCREEN?' '+"_5lnj":'')+(l===j.VIDEO?' '+"_5lnk":'')}));return (c('React').createElement('i',{className:"_5ln2"+(n?' '+"_5h3-":'')+(l===j.END?' '+"_5ln3":'')+(l===j.FULL_SCREEN?' '+"_5lnl":'')+(l===j.MUTE?' '+"_5lnm":'')+(l===j.SETTINGS?' '+"_5lni":'')+(l===j.SHARE_SCREEN?' '+"_5lnn":'')+(l===j.VIDEO?' '+"_5lnp":'')}));}});k.IconTypes=j;f.exports=k;},null);
__d('FBRTCScreenSharingControls.react',['cx','fbt','FBRTCActiveMouseMixin','FBRTCCallControlButton.react','FBRTCScreenSharingActions','FBRTCScreenSharingConstants','React'],function a(b,c,d,e,f,g,h,i){'use strict';if(c.__markCompiled)c.__markCompiled();var j=c('React').PropTypes,k=c('React').createClass({displayName:'FBRTCScreenSharingControls',mixins:[c('FBRTCActiveMouseMixin')],propTypes:{uiType:j.string,canSwitchScreens:j.bool.isRequired},activeMouseCallback:function(l){this.setState({mouseActive:l});},getDefaultProps:function(){return {uiType:c('FBRTCScreenSharingConstants').UITypes.DIRECT_SENDER};},getInitialState:function(){return {mouseActive:true};},_endSession:function(){c('FBRTCScreenSharingActions').endSession();},_switchScreen:function(){c('FBRTCScreenSharingActions').switchScreen();},render:function(){return (c('React').createElement('div',{className:"_4bbt"},c('React').createElement('div',{className:this._wrapperClasses()},this._endSessionButton(),this._switchScreenButton())));},_endSessionButton:function(){var l=i._("End screen share");return (c('React').createElement(c('FBRTCCallControlButton.react'),{endButton:true,title:l,iconType:c('FBRTCCallControlButton.react').IconTypes.END,onClick:this._endSession}));},_switchScreenButton:function(){if(this.props.canSwitchScreens){var l=i._("Share new screen");return (c('React').createElement(c('FBRTCCallControlButton.react'),{iconType:c('FBRTCCallControlButton.react').IconTypes.SHARE_SCREEN,title:l,onClick:this._switchScreen}));}},_wrapperClasses:function(){var l=this._isSender()?true:this.state.mouseActive;return "_4bbx"+(l?' '+"_4bbz":'');},_isSender:function(){return this.props.uiType===c('FBRTCScreenSharingConstants').UITypes.DIRECT_SENDER;}});f.exports=k;},null);
__d('FBRTCStreamWrapper',['mixInEventEmitter','FBRTCUtils'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=100,i=window.AudioContext||window.webkitAudioContext||window.mozAudioContext,j;function k(){'use strict';this.$FBRTCStreamWrapper1=true;this.$FBRTCStreamWrapper2=true;this.$FBRTCStreamWrapper3=null;this.$FBRTCStreamWrapper4=null;this.aspectRatio=k.aspectRatios.other;this.videoWidth=0;this.videoHeight=0;}k.prototype.setStream=function(l){var m=arguments.length<=1||arguments[1]===undefined?true:arguments[1];'use strict';var n=this.hasStream();this.stop();this.$FBRTCStreamWrapper3=l;this.$FBRTCStreamWrapper5();this.$FBRTCStreamWrapper6();if(m){this.$FBRTCStreamWrapper3.onaddtrack=this.$FBRTCStreamWrapper7.bind(this);this.$FBRTCStreamWrapper3.onremovetrack=this.$FBRTCStreamWrapper7.bind(this);this.$FBRTCStreamWrapper3.onended=this.$FBRTCStreamWrapper8.bind(this);if(n)this.emit('tracksChanged');}};k.prototype.getStreamId=function(){'use strict';return this.$FBRTCStreamWrapper3&&this.$FBRTCStreamWrapper3.id;};k.prototype.getStream=function(){'use strict';return this.$FBRTCStreamWrapper3;};k.prototype.hasStream=function(){'use strict';return !!this.$FBRTCStreamWrapper3;};k.prototype.stop=function(){'use strict';if(this.$FBRTCStreamWrapper3){k.stopStream(this.$FBRTCStreamWrapper3);this.$FBRTCStreamWrapper3=null;}};k.prototype.hasVideoTracks=function(){'use strict';if(this.$FBRTCStreamWrapper3&&this.$FBRTCStreamWrapper3.hasOwnProperty(this.$FBRTCStreamWrapper3.getVideoTracks))return this.$FBRTCStreamWrapper3.getVideoTracks().length>0;return true;};k.prototype.hasVideo=function(){'use strict';return this.$FBRTCStreamWrapper2&&this.hasVideoTracks();};k.prototype.hasAudioTracks=function(){'use strict';if(this.$FBRTCStreamWrapper3&&this.$FBRTCStreamWrapper3.getAudioTracks)return this.$FBRTCStreamWrapper3.getAudioTracks().length>0;return true;};k.prototype.hasAudio=function(){'use strict';return this.$FBRTCStreamWrapper1&&this.hasAudioTracks();};k.prototype.attachToVideoTag=function(l){'use strict';if(this.$FBRTCStreamWrapper3){this.$FBRTCStreamWrapper4=l;c('FBRTCUtils').attachMediaStream(l,this.$FBRTCStreamWrapper3);this.$FBRTCStreamWrapper9(l);}};k.prototype.getAudioAnalyser=function(){'use strict';if(this.$FBRTCStreamWrapper3){var l=this.$FBRTCStreamWrapper10(),m=l.createMediaStreamSource(this.$FBRTCStreamWrapper3),n=l.createAnalyser();n.fftSize=2048;m.connect(n);return n;}};k.prototype.$FBRTCStreamWrapper10=function(){'use strict';if(!j)j=new i();return j;};k.prototype.toggleMuteAudio=function(){'use strict';if(!this.hasAudioTracks())return;this.$FBRTCStreamWrapper1=!this.$FBRTCStreamWrapper1;this.$FBRTCStreamWrapper5();};k.prototype.$FBRTCStreamWrapper5=function(){'use strict';if(this.$FBRTCStreamWrapper3){var l=this.$FBRTCStreamWrapper3.getAudioTracks();for(var m=0;m<l.length;m++)l[m].enabled=this.$FBRTCStreamWrapper1;}};k.prototype.toggleMuteVideo=function(){'use strict';this.$FBRTCStreamWrapper2=!this.$FBRTCStreamWrapper2;if(this.$FBRTCStreamWrapper2){this.$FBRTCStreamWrapper6();}else setTimeout(this.$FBRTCStreamWrapper6.bind(this),500);this.$FBRTCStreamWrapper7();};k.prototype.$FBRTCStreamWrapper6=function(){'use strict';if(this.$FBRTCStreamWrapper3){var l=this.$FBRTCStreamWrapper3.getVideoTracks();for(var m=0;m<l.length;m++)l[m].enabled=this.$FBRTCStreamWrapper2;}};k.prototype.setVideoEnabled=function(l){'use strict';this.$FBRTCStreamWrapper2=l;this.$FBRTCStreamWrapper6();this.$FBRTCStreamWrapper7();};k.prototype.$FBRTCStreamWrapper9=function(l){'use strict';if(!this.hasVideo()||l.currentTime>0){this.$FBRTCStreamWrapper11(l);}else setTimeout(this.$FBRTCStreamWrapper9.bind(this,l),h);};k.prototype.$FBRTCStreamWrapper12=function(l){'use strict';this.videoWidth=l.videoWidth;this.videoHeight=l.videoHeight;var m=l.videoWidth/l.videoHeight;if(c('FBRTCUtils').aboutEqual(m,16/9))return k.aspectRatios['16:9'];if(c('FBRTCUtils').aboutEqual(m,4/3))return k.aspectRatios['4:3'];return k.aspectRatios.other;};k.prototype.$FBRTCStreamWrapper11=function(l){'use strict';if(this.hasVideo()){this.aspectRatio=this.$FBRTCStreamWrapper12(l);}else this.aspectRatio=k.aspectRatios.other;this.emit('streamStarted');};k.prototype.$FBRTCStreamWrapper8=function(){'use strict';this.emit('streamEnded');};k.prototype.$FBRTCStreamWrapper7=function(event){'use strict';if(this.$FBRTCStreamWrapper13(event))this.attachToVideoTag(this.$FBRTCStreamWrapper4);this.emit('tracksChanged');};k.prototype.$FBRTCStreamWrapper13=function(l){'use strict';return this.$FBRTCStreamWrapper4&&l&&l.type==='addtrack'&&l.track.kind==='video';};k.aspectRatios={'16:9':1,'4:3':2,other:3};c('mixInEventEmitter')(k,{streamStarted:true,streamEnded:true,tracksChanged:true});k.stopStream=function(l){if('active' in l){if(l.active)l.getTracks().forEach(function(m){m.stop();});}else if('stop' in l)l.stop();};f.exports=k;},null);
__d('FBRTCScreenStreamWrapper',['FBRTCStreamWrapper'],function a(b,c,d,e,f,g){'use strict';var h,i;if(c.__markCompiled)c.__markCompiled();h=babelHelpers.inherits(j,c('FBRTCStreamWrapper'));i=h&&h.prototype;j.prototype.toggleMuteAudio=function(){return;};j.prototype.toggleMuteVideo=function(){return;};function j(){h.apply(this,arguments);}f.exports=j;},null);
__d('FBRTCVideo.react',['cx','React','ReactDOM','joinClasses'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=c('React').createClass({displayName:'FBRTCVideo',hideContextMenu:function(j){j.preventDefault();},componentDidMount:function(){this._attachStream();},shouldComponentUpdate:function(j,k){return this._streamDidChange();},componentDidUpdate:function(j,k){this._attachStream();},_attachStream:function(){if(this.props.stream){var j=c('ReactDOM').findDOMNode(this);this.props.stream.attachToVideoTag(j);this._currentStream=this.props.stream.getStream();}},_streamDidChange:function(){var j=this.props.stream?this.props.stream.getStream():null;return j!==this._currentStream;},render:function(){return (c('React').createElement('video',{className:c('joinClasses')(this.props.className,"_4bad"),autoPlay:'true',muted:this.props.muted,onContextMenu:this.hideContextMenu}));}});f.exports=i;},null);
__d('FBRTCScreenSharingView.react',['cx','FBRTCCallControlActions','FBRTCScreenSharingConstants','FBRTCScreenStreamWrapper','FBRTCScreenSharingControls.react','FBRTCVideo.react','React'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=c('React').PropTypes,j=c('React').createClass({displayName:'FBRTCScreenSharingView',propTypes:{canSwitchScreens:i.bool.isRequired,isStandalone:i.bool,screenStream:i.instanceOf(c('FBRTCScreenStreamWrapper')),screenSrc:i.string,uiType:i.string},getDefaultProps:function(){return {isStandalone:false,uiType:c('FBRTCScreenSharingConstants').UITypes.FROM_VIDEO_CALL,showOverlay:false};},render:function(){var k=this.props.isStandalone,l=this.props.screenStream,m=this.props.screenSrc;if(l&&l.hasStream()){return (c('React').createElement('div',{className:this._baseClasses()},this._renderOpenInNewButton(),this._renderDirectScreenSharingButtons(),c('React').createElement('div',{className:this._wrapperClass()},c('React').createElement(c('FBRTCVideo.react'),{className:"_3pb5 _4bad",stream:l}))));}else if(k&&m){return this._renderStandalone(m);}else return c('React').createElement('div',{className:"_2uql"});},_baseClasses:function(){return "_2uqm"+(this.props.isStandalone?' '+"_2uqn":'');},_buttonClasses:function(){return "_2uqo";},_buttonIconClasses:function(){return "_2uqp";},_wrapperClass:function(){return "_2uqq"+(this.props.showOverlay?' '+"_1k3o":'');},_renderOpenInNewButton:function(){if(!this.props.isStandalone)return (c('React').createElement('button',{className:this._buttonClasses(),onClick:c('FBRTCCallControlActions').openScreenInNewWindow},c('React').createElement('i',{className:this._buttonIconClasses()})));},_renderDirectScreenSharingButtons:function(){if(this._isDirect())return (c('React').createElement(c('FBRTCScreenSharingControls.react'),{canSwitchScreens:this.props.canSwitchScreens,uiType:this.props.uiType}));},_isSender:function(){return this.props.uiType===c('FBRTCScreenSharingConstants').UITypes.DIRECT_SENDER;},_isRecipient:function(){return this.props.uiType===c('FBRTCScreenSharingConstants').UITypes.DIRECT_RECIPIENT;},_isDirect:function(){return this._isSender()||this._isRecipient();},_renderStandalone:function(k){return (c('React').createElement('div',{className:this._baseClasses()},c('React').createElement('div',{className:this._wrapperClass()},c('React').createElement('video',{className:"_3pb5 _4bad",autoPlay:'true',muted:false,onContextMenu:function(l){l.preventDefault();},src:decodeURIComponent(k)}))));}});f.exports=j;},null);
__d("XScreenSharingController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/videocall\/screen_sharing\/",{peer_id:{type:"Int",required:true}});},null);
__d('FBRTCScreenSharingUI',['FBRTCCallControlActions','FBRTCDispatcher','FBRTCScreenSharingActions','FBRTCScreenSharingConstants','FBRTCScreenSharingView.react','FBRTCScreenStreamWrapper','FBRTCUtils','React','ReactDOM','XScreenSharingController'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=false,i=null,j=null,k=false,l='FBRTCScreenSharingView/container',m={open:function(n,o,p){k=false;var q=this._getUnsignedUri(p),r=n===c('FBRTCScreenSharingConstants').UITypes.DIRECT_SENDER;if(i){i.location.href=q.toString();}else i=this._openWindow(q.toString(),r);if(r)h=!c('FBRTCUtils').isCollabCallable(p);if(i)this._renderView(o,5,n,r);},close:function(){if(i){var n=null;if(i.opener&&!i.opener.closed)n=i.opener;i.close();i=null;if(n)n.postMessage({recipient:'SC_CONTENT_SCRIPT',type:'SC_RESET_PORT',text:'reset comm port'},'*');}},switchScreen:function(n,o){this._renderView(o,5,n);},hideRingingOverlay:function(){if(!j)return;j=c('ReactDOM').render(c('React').createElement(c('FBRTCScreenSharingView.react'),babelHelpers['extends']({},j.props,{showOverlay:false})),m._getContainerNode());},isOpen:function(){return i!==null;},openTempWindow:function(){i=this._openWindow('',true);},_openWindow:function(n,o){var p=this._windowPosition(o),q=['menubar=no','location=no','scrollbars=no','status=no','personalbar=no',p.height,p.width,p.top,p.left].join(','),r=window.open(n,'Screen Sharing',q);if(window.focus)r.focus();return r;},_onUnload:function(n,o){if(this._isDirect(n)){c('FBRTCScreenSharingActions').endSession();}else{m.close();c('FBRTCDispatcher').dispatch({type:c('FBRTCCallControlActions').Types.CLOSE_STANDALONE_SCREEN});}},_getContainerNode:function(){if(!i)return null;return i.document.getElementById(l);},_renderView:function(n,o,p){var q=arguments.length<=3||arguments[3]===undefined?false:arguments[3];setTimeout(function(){setTimeout(function(){if(i!==null){var r=m._getContainerNode();if(r){j=c('ReactDOM').render(c('React').createElement(c('FBRTCScreenSharingView.react'),{isStandalone:true,uiType:p,screenStream:n,canSwitchScreens:h,showOverlay:q}),r);k=true;i.onunload=this._onUnload.bind(this,p);}}}.bind(this),1);if(o>1&&!k){this._renderView(n,o-1,p,q);}else k=false;}.bind(this),500);},_isDirect:function(n){return n===c('FBRTCScreenSharingConstants').UITypes.DIRECT_RECIPIENT||n===c('FBRTCScreenSharingConstants').UITypes.DIRECT_SENDER;},_windowPosition:function(n){var o=screen.availLeft,p=screen.availTop,q=n?448:960,r=n?252:540,s=Math.min(q,screen.width-o),t=Math.min(r,screen.height-p);return {height:'height='+t.toString(),width:'width='+s.toString(),top:'top='+p.toString(),left:'left='+o.toString()};},_getUnsignedUri:function(n){return c('XScreenSharingController').getURIBuilder().setInt('peer_id',n).getURI();}};f.exports=m;},null);
__d('FBRTCCallModel',['FBRTCAdminMessage','FBRTCCallConstants','FBRTCCallControlActions','FBRTCConfig','FBRTCFullScreenController','FBRTCLogger','FBRTCPCConfig','FBRTCPeerInfo','FBRTCScreenSharingConstants','FBRTCScreenSharingUI','FBRTCStore','FBRTCStreamWrapper','FBRTCStruct','FBRTCUtils','FBRTCVideoDurationTracker'],function a(b,c,d,e,f,g){var h,i;if(c.__markCompiled)c.__markCompiled();h=babelHelpers.inherits(j,c('FBRTCStore'));i=h&&h.prototype;function j(k){'use strict';i.constructor.call(this);this.$FBRTCCallModel1=c('FBRTCLogger').getInstance();this.isCaller=k.isCaller;this.peerID=k.peerID;this.$FBRTCCallModel2=new (c('FBRTCPeerInfo'))(k.peerID);this.$FBRTCCallModel3=false;this.$FBRTCCallModel4(k.callID);this.$FBRTCCallModel5();this.$FBRTCCallModel6(true);if(this.$FBRTCCallModel2)this.isVCEndpointCall=this.$FBRTCCallModel2.isVCEndpoint;}j.prototype.resetForReconnect=function(k){'use strict';this.isCaller=false;this.$FBRTCCallModel4(k);this.$FBRTCCallModel6(false);};j.prototype.fetchPeerInfo=function(){'use strict';if(c('FBRTCUtils').isGroupCallable(this.peerID))return;var k=this,l=function(){k.isVCEndpointCall=k.$FBRTCCallModel2.isVCEndpoint;k.__emitChange();},m=function(){k.$FBRTCCallModel1.logError(k.peerID,k.callID,'Failed to get remote photos');};this.$FBRTCCallModel2.fetch(l,m);};j.prototype.setSignalingExperiments=function(k){'use strict';if(k||k===[])this.$FBRTCCallModel7=k;};j.prototype.supportsSdpUpdate=function(){'use strict';var k='sdp_update';return this.$FBRTCCallModel7.indexOf(k)!==-1&&c('FBRTCConfig').supportedSignalingExperiments().indexOf(k)!==-1;};j.prototype.supportsMultipleStreamsPlanB=function(){'use strict';var k='multiple_streams_plan_b';return this.$FBRTCCallModel7.indexOf(k)!==-1&&c('FBRTCConfig').supportedSignalingExperiments().indexOf(k)!==-1;};j.prototype.canPeerReceiveScreenSharing=function(){'use strict';return this.$FBRTCCallModel7.indexOf('screen_sharing')!==-1||this.isVCEndpointCall;};j.prototype.onSDPMessageFromPeer=function(k){'use strict';this.isRemoteVideoSupported=k.isRemoteVideoSupported();this.isPeerOnMobile=k.isFromMobile();if(!this.isRemoteVideoSupported)this.localStream.setVideoEnabled(false);};j.prototype.$FBRTCCallModel5=function(){'use strict';this.remoteStream=new (c('FBRTCStreamWrapper'))();this.localStream=new (c('FBRTCStreamWrapper'))();this.localStream.addListener('tracksChanged',function(){if(!this.$FBRTCCallModel8&&this.localStream.hasVideo())this.$FBRTCCallModel9=true;this.__emitChange();}.bind(this));this.$FBRTCCallModel10=new (c('FBRTCVideoDurationTracker'))(this.remoteStream);this.$FBRTCCallModel11=new (c('FBRTCVideoDurationTracker'))(this.localStream);};j.prototype.$FBRTCCallModel4=function(k){'use strict';this.callID=k;this.$FBRTCCallModel12=new (c('FBRTCAdminMessage'))(this.peerID,k);this.startTime=new Date();this.endCallReason=null;this.isRemoteEnded=null;this.wasConnected=false;this.receivedNack=false;this.isRemoteVideoSupported=true;this.isPeerOnMobile=false;this.$FBRTCCallModel13=null;this.$FBRTCCallModel8=true;this.$FBRTCCallModel9=false;this.$FBRTCCallModel7=[];this.$FBRTCCallModel14=null;};j.prototype.$FBRTCCallModel6=function(k){'use strict';this.selfViewOpen=true;this.uiState=j.UIState.INIT;this.__emitChange();};j.prototype.getLocalVideoDuration=function(){'use strict';return this.$FBRTCCallModel11.getDuration();};j.prototype.getRemoteVideoDuration=function(){'use strict';return this.$FBRTCCallModel10.getDuration();};j.prototype.setLocalStream=function(k){'use strict';this.localStream.setStream(k);};j.prototype.setLocalScreenStream=function(k){'use strict';this.$FBRTCCallModel3=k!==null;this.selfViewOpen=true;this.$FBRTCCallModel13=k;this.__emitChange();};j.prototype.getLocalScreenStream=function(){'use strict';return this.$FBRTCCallModel13;};j.prototype.setRemoteStream=function(k){'use strict';this.remoteStream.setStream(k);this.remoteStream.once('streamStarted',function(){this.setStateFrom(j.UIState.CALL_CONNECTING,j.UIState.CALL_CONNECTED);}.bind(this));this.remoteStream.addListener('tracksChanged',function(){this.__emitChange();}.bind(this));this.__emitChange();};j.prototype.setRemoteScreenStream=function(k){'use strict';this.$FBRTCCallModel14=k;this.__emitChange();};j.prototype.getRemoteScreenStream=function(){'use strict';return this.$FBRTCCallModel14;};j.prototype.canStartCall=function(){'use strict';return this.localStream.hasStream()&&c('FBRTCPCConfig').turnIP;};j.prototype.isAwaitingUserStart=function(){'use strict';return this.uiState===j.UIState.AWAITING_USER_START;};j.prototype.canBeStartedByParentWindow=function(){'use strict';return this.uiState===j.UIState.INIT;};j.prototype.isInProgress=function(){'use strict';return this.uiState>=j.UIState.CONTACTING&&this.uiState<j.UIState.CALL_ENDED;};j.prototype.isUserMediaPending=function(){'use strict';return this.uiState===j.UIState.PENDING_LOCAL_MEDIA;};j.prototype.isUserMediaDenied=function(){'use strict';return this.uiState===j.UIState.USER_MEDIA_DENIED;};j.prototype.isConnected=function(){'use strict';return this.uiState===j.UIState.CALL_CONNECTED;};j.prototype.isRemoteVideoActive=function(){'use strict';return this.uiState===j.UIState.CALL_CONNECTED&&this.remoteStream.hasVideo();};j.prototype.isEnded=function(){'use strict';return this.uiState>=j.UIState.CALL_ENDED;};j.prototype.isAwaitingAnswer=function(){'use strict';return this.uiState==j.UIState.CONTACTING||this.uiState==j.UIState.RINGING;};j.prototype.isFullScreen=function(){'use strict';return c('FBRTCFullScreenController').isFullScreen();};j.prototype.isScreenSharingEnabled=function(){'use strict';return this.$FBRTCCallModel3;};j.prototype.peerPicUrl=function(){'use strict';return this.$FBRTCCallModel2.peerPicUrl;};j.prototype.selfPicUrl=function(){'use strict';return this.$FBRTCCallModel2.selfPicUrl;};j.prototype.backgroundUrl=function(){'use strict';return this.$FBRTCCallModel2.backgroundUrl;};j.prototype.peerName=function(){'use strict';return this.$FBRTCCallModel2.peerName;};j.prototype.peerShortName=function(){'use strict';if(this.$FBRTCCallModel2.peerShortName)return this.$FBRTCCallModel2.peerShortName;return this.$FBRTCCallModel2.peerName;};j.prototype.autoDisableVideo=function(){'use strict';if(this.$FBRTCCallModel8){this.$FBRTCCallModel8=false;this.$FBRTCCallModel1.logCallAction(this.peerID,this.callID,c('FBRTCLogger').CallAction.AUTO_DISABLE_VIDEO);this.localStream.setVideoEnabled(false);}};j.prototype.videoIsAutoDisabled=function(){'use strict';return !this.$FBRTCCallModel8&&!this.$FBRTCCallModel9&&!this.localStream.hasVideo();};j.prototype.$FBRTCCallModel15=function(){'use strict';this.localStream.toggleMuteAudio();this.$FBRTCCallModel1.logCallAction(this.peerID,this.callID,c('FBRTCLogger').CallAction.SET_MUTE,!this.localStream.hasAudio()?'true':'false');this.__emitChange();};j.prototype.$FBRTCCallModel16=function(k){'use strict';this.localStream.toggleMuteVideo();this.$FBRTCCallModel1.logCallAction(this.peerID,this.callID,c('FBRTCLogger').CallAction.SET_VIDEO_ON,this.localStream.hasVideo());this.__emitChange();};j.prototype.toggleSelfView=function(){'use strict';this.selfViewOpen=!this.selfViewOpen;this.$FBRTCCallModel1.logCallAction(this.peerID,this.callID,c('FBRTCLogger').CallAction.SET_SELF_VIEW_ON,!this.selfViewOpen?'true':'false');this.__emitChange();};j.prototype.setState=function(k){'use strict';if(k===this.uiState)return;var l=this.uiState;this.uiState=k;switch(k){case j.UIState.CALL_CONNECTED:this.wasConnected=true;this.$FBRTCCallModel12.onCallConnected();this.$FBRTCCallModel10.startTracking();this.$FBRTCCallModel11.startTracking();break;case j.UIState.CALL_ENDED:this.$FBRTCCallModel12.onCallEnded();this.$FBRTCCallModel10.stopTracking();this.$FBRTCCallModel11.stopTracking();if(this.isCaller&&l>j.UIState.MORE_INIT){var m=this.isRemoteVideoSupported?c('FBRTCCallConstants').FBRTCCallType.VIDEO_CALL:c('FBRTCCallConstants').FBRTCCallType.VOICE_CALL;this.$FBRTCCallModel12.submit(m,this.endCallReason);}break;}this.$FBRTCCallModel1.logInfo(this.peerID,this.callID,'UI: state change - "'+j.UIState.strNames[l]+'" to "'+j.UIState.strNames[k]+'"');this.__emitChange();};j.prototype.setStateFrom=function(k,l){'use strict';if(this.uiState===k){this.setState(l);}else this.$FBRTCCallModel1.logInfo(this.peerID,this.callID,'UI: Not at "'+j.UIState.strNames[k]+'", not moving to "'+j.UIState.strNames[l]+'"');};j.prototype.__onDispatch=function(k){'use strict';switch(k.type){case c('FBRTCCallControlActions').Types.TOGGLE_MUTE_AUDIO:this.$FBRTCCallModel15();break;case c('FBRTCCallControlActions').Types.TOGGLE_MUTE_VIDEO:this.$FBRTCCallModel16();break;case c('FBRTCCallControlActions').Types.CLOSE_STANDALONE_SCREEN:this.__emitChange();break;case c('FBRTCCallControlActions').Types.TOGGLE_SELF_VIEW:this.toggleSelfView();break;case c('FBRTCCallControlActions').Types.OPEN_SCREEN_IN_NEW:c('FBRTCScreenSharingUI').open(c('FBRTCScreenSharingConstants').UITypes.FROM_VIDEO_CALL,this.$FBRTCCallModel14,this.peerID);this.__emitChange();break;}};j.UIState=new (c('FBRTCStruct'))(['INIT','AWAITING_USER_START','PENDING_LOCAL_MEDIA','USER_MEDIA_DENIED','MORE_INIT','CONTACTING','RINGING','CALL_CONNECTING','CALL_CONNECTED','CALL_ENDED','COLLECT_RATING']);f.exports=j;},null);
__d('FBRTCDialog.react',['MessengerDialog.react','XUIDialog.react','FBRTCConfig'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();f.exports=c('FBRTCConfig').isMessengerDotCom()?c('MessengerDialog.react'):c('XUIDialog.react');},null);
__d('FBRTCDialogBody.react',['MessengerDialogBody.react','XUIDialogBody.react','FBRTCConfig'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();f.exports=c('FBRTCConfig').isMessengerDotCom()?c('MessengerDialogBody.react'):c('XUIDialogBody.react');},null);
__d('FBRTCDialogTitle.react',['FBRTCConfig','MessengerDialogTitle.react','MessengerDialogHeader.react','ReactComponentWithPureRenderMixin','React','XUIDialogTitle.react'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h=c('React').PropTypes,i=c('React').createClass({displayName:'FBRTCDialogTitle',mixins:[c('ReactComponentWithPureRenderMixin')],propTypes:{showCloseButton:h.bool.isRequired},render:function(){var j=this.props,k=j.className,l=j.showCloseButton,m=babelHelpers.objectWithoutProperties(j,['className','showCloseButton']);if(c('FBRTCConfig').isMessengerDotCom())return (c('React').createElement(c('MessengerDialogHeader.react'),null,c('React').createElement(c('MessengerDialogTitle.react'),babelHelpers['extends']({className:k,showCloseButton:l},m),this.props.children)));return (c('React').createElement(c('XUIDialogTitle.react'),babelHelpers['extends']({className:k,showCloseButton:l},m),this.props.children));}});f.exports=i;},null);
__d('FBRTCMediaAccessErrorDialog.react',['fbt','React','Link.react','FBRTCDialog.react','FBRTCDialogBody.react','FBRTCDialogFooter.react','FBRTCDialogTitle.react','FBRTCConfig'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=c('React').createClass({displayName:'FBRTCMediaAccessErrorDialog',render:function(){return (c('React').createElement(c('FBRTCDialog.react'),{shown:true,width:440,layerHideOnBlur:false},c('React').createElement(c('FBRTCDialogTitle.react'),{showCloseButton:false},c('React').createElement('span',null,h._("Can't Make Call"))),c('React').createElement(c('FBRTCDialogBody.react'),null,this._dialogBody()),c('React').createElement(c('FBRTCDialogFooter.react'),{leftContent:this._footerContent()})));},_dialogBody:function(){return (c('React').createElement('p',null,h._("Connect a camera and a microphone to make a call. If they're already connected, try restarting your browser and closing any other applications that use a camera or microphone.")));},_footerContent:function(){return (c('React').createElement('span',null,h._("Still need help? See our {troubleShootingGuideLink}",[h.param('troubleShootingGuideLink',c('React').createElement(c('Link.react'),{href:c('FBRTCConfig').userMediaErrorUrl(),target:'_blank'},h._("Troubleshooting Guide")))])));}});f.exports=i;},null);
__d('FBRTCPeerBrowserUnsupportedDialog.react',['fbt','React','Link.react','XUIDialog.react','XUIDialogBody.react','XUIDialogFooter.react','XUIDialogTitle.react','FBRTCConfig'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=c('React').createClass({displayName:'FBRTCPeerBrowserUnsupportedDialog',render:function(){return (c('React').createElement(c('XUIDialog.react'),{shown:true,width:440},c('React').createElement(c('XUIDialogTitle.react'),{showCloseButton:false},c('React').createElement('span',null,h._("Can't Connect Call"))),c('React').createElement(c('XUIDialogBody.react'),null,this._dialogBody()),c('React').createElement(c('XUIDialogFooter.react'),{leftContent:this._footerContent()})));},_dialogBody:function(){var j=this.props.peerName;return (c('React').createElement('p',null,h._("{name} isn't using a browser that supports video calling yet.",[h.param('name',j)])));},_footerContent:function(){return (c('React').createElement('span',null,h._("Still need help? See our {troubleShootingGuideLink}",[h.param('troubleShootingGuideLink',c('React').createElement(c('Link.react'),{href:c('FBRTCConfig').unsupportedBrowserUrl(),target:'_blank'},h._("Troubleshooting Guide")))])));}});f.exports=i;},null);
__d('FBRTCScreenSharingInstallExtensionDialog.react',['fbt','React','FBRTCCallControlActions','FBRTCLogger','FBRTCScreenSharingLogger','LinkshimCallsites','ScreenSharingWebDriverIDs','URI','FBRTCDialogFooter.react','LinkshimLink.react','XUIDialog.react','XUIDialogBody.react','XUIDialogButton.react','XUIDialogCancelButton.react','XUIDialogTitle.react'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=c('React').PropTypes,j='https://chrome.google.com/webstore/detail/degmgkchmbgaognjjlhggmhbcpicdifm',k=c('React').createClass({displayName:'FBRTCScreenSharingInstallExtensionDialog',propTypes:{onToggle:i.func.isRequired,peerID:i.number.isRequired,sessionID:i.number.isRequired},componentDidMount:function(){c('FBRTCScreenSharingLogger').getInstance().logAction(this.props.peerID,this.props.sessionID,c('FBRTCScreenSharingLogger').Action.SCREEN_SHARING_EXT_DIALOG,false);},render:function(){return (c('React').createElement(c('XUIDialog.react'),{shown:true,width:440,layerHideOnBlur:false},c('React').createElement(c('XUIDialogTitle.react'),{showCloseButton:true},c('React').createElement('span',null,h._("Please Install Screen Sharing Extension"))),c('React').createElement(c('XUIDialogBody.react'),{'data-testid':c('ScreenSharingWebDriverIDs').INSTALL_EXT_DIALOG},this._dialogBody()),c('React').createElement(c('FBRTCDialogFooter.react'),null,c('React').createElement(c('XUIDialogCancelButton.react'),null),c('React').createElement(c('XUIDialogButton.react'),{label:h._("Call Again"),use:'confirm',onClick:this._onResetCall}))));},_dialogBody:function(){return (c('React').createElement('div',null,c('React').createElement('p',null,h._("To share your screen, you'll need to install an extension. Then you can return here to start your call again.")),c('React').createElement(c('LinkshimLink.react'),{uri:new (c('URI'))(j),callsite:c('LinkshimCallsites').THIRD_PARTY_URL,target:'_blank',onClick:this._onExtLinkClick},h._("Install Screen Sharing Extension"))));},_onExtLinkClick:function(){c('FBRTCScreenSharingLogger').getInstance().logAction(this.props.peerID,this.props.sessionID,c('FBRTCScreenSharingLogger').Action.SCREEN_SHARING_EXT_LINK,false);},_onResetCall:function(){c('FBRTCCallControlActions').resetCall(c('FBRTCLogger').Trigger.RESET_CALL);}});f.exports=k;},null);
__d('FBRTCScreenSharingModel',['Event','FBRTCScreenSharingLogger','FBRTCScreenStreamWrapper','FBRTCStore'],function a(b,c,d,e,f,g){'use strict';var h,i;if(c.__markCompiled)c.__markCompiled();h=babelHelpers.inherits(j,c('FBRTCStore'));i=h&&h.prototype;function j(k,l){i.constructor.call(this);this.$FBRTCScreenSharingModel3=null;this.$FBRTCScreenSharingModel4=new (c('FBRTCScreenStreamWrapper'))();this.$FBRTCScreenSharingModel5=c('FBRTCScreenSharingLogger').getInstance();this.$FBRTCScreenSharingModel1=k;this.$FBRTCScreenSharingModel2=l;}j.prototype.isEnabled=function(){return !!this.$FBRTCScreenSharingModel3;};j.prototype.setStream=function(k){var l=arguments.length<=1||arguments[1]===undefined?false:arguments[1],m=arguments.length<=2||arguments[2]===undefined?false:arguments[2];if(k&&(!l||m))c('Event').listen(k.getVideoTracks()[0],'ended',this.__emitChange.bind(this));if(this.$FBRTCScreenSharingModel4===null)this.$FBRTCScreenSharingModel4=new (c('FBRTCScreenStreamWrapper'))();this.$FBRTCScreenSharingModel4.setStream(k,!l);};j.prototype.getStream=function(){return this.$FBRTCScreenSharingModel4;};j.prototype.getPeerID=function(){return this.$FBRTCScreenSharingModel1;};j.prototype.getSessionID=function(){return this.$FBRTCScreenSharingModel2;};j.prototype.onStart=function(k){if(!k){this.$FBRTCScreenSharingModel5.logToConsole(null,null,'Invalid stream id');return;}this.$FBRTCScreenSharingModel5.logToConsole(null,null,'Enabling screen sharing');this.$FBRTCScreenSharingModel3=k;};j.prototype.onStop=function(){this.$FBRTCScreenSharingModel3=null;if(this.$FBRTCScreenSharingModel4)this.$FBRTCScreenSharingModel4.stop();};j.prototype.__onDispatch=function(k){};f.exports=j;},null);
__d('FBRTCScreenSharingUnsupportedBrowserDialog.react',['cx','fbt','ix','React','Image.react','Link.react','Layout.react','XUIDialog.react','XUIDialogBody.react','XUIDialogTitle.react','XUIText.react','FBRTCVersionDetection'],function a(b,c,d,e,f,g,h,i,j){'use strict';if(c.__markCompiled)c.__markCompiled();var k=c('Layout.react').Column,l=c('React').createClass({displayName:'FBRTCScreenSharingUnsupportedBrowserDialog',render:function(){return (c('React').createElement(c('XUIDialog.react'),{shown:true,width:440,layerHideOnBlur:false},c('React').createElement(c('XUIDialogTitle.react'),{showCloseButton:true},this._title()),c('React').createElement(c('XUIDialogBody.react'),null,this._dialogBody(),this._installLinks())));},_title:function(){var m=null;if(c('FBRTCVersionDetection').isChrome()){m=i._("Update Browser to Share Your Screen");}else m=i._("Switch Browsers to Share Your Screen");return (c('React').createElement('span',null,m));},_dialogBody:function(){var m=null;if(c('FBRTCVersionDetection').isChrome()){m=this._updateBrowserMessage();}else m=this._switchBrowserMessage();return (c('React').createElement('p',null,m));},_updateBrowserMessage:function(){return i._("Screen sharing doesn't work in the older version of Google Chrome you're using. To share your screen, please update Google Chrome.");},_switchBrowserMessage:function(){if(c('FBRTCVersionDetection').isFirefox()){return i._("Screen sharing doesn't work in Mozilla Firefox yet. To share your screen, please open Facebook in Google Chrome.");}else return i._("Screen sharing doesn't work in your browser yet. To share your screen, please open Facebook in Google Chrome.");},_installLinks:function(){return (c('React').createElement(c('Layout.react'),null,c('React').createElement(k,{style:{width:'100%',textAlign:'center'}},c('React').createElement(c('Link.react'),{href:'https://www.google.com/chrome/index.html',target:'_blank'},c('React').createElement(c('Image.react'),{className:"_4_if",src:j('/images/chat/webrtc/chrome.png'),alt:'Chrome',width:'64'}),c('React').createElement(c('XUIText.react'),{display:'block'},'Google Chrome')))));}});f.exports=l;},null);
__d('FBRTCAudioSpectrumAnalyser.react',['React','ReactDOM','cancelAnimationFrame','requestAnimationFrame'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=7,i=3,j=9,k='#3B5998',l='#CCCCCC',m=function(p,q,r,s){var t=s?l:k;q+=i;r-=i;p.beginPath();p.arc(q,r,i,0,2*Math.PI,false);p.fillStyle=t;p.strokeStyle=t;p.fill();},n=function(p,q,r){var s,t,u=q.width/j,v=Math.floor(q.height/h),w=new Uint8Array(2048);p.getByteFrequencyData(w);r.clearRect(0,0,q.width,q.height);var x=Math.floor(w.length/(j*3));for(var y=0;y<j;y+=1){s=0;for(var z=0;z<x;z+=1)s+=w[y*x+z];t=s*h/(x*256);if(t<1)t=.6;for(var aa=0;aa<Math.floor(t);aa++)m(r,y*u,q.height-aa*v);if(t-Math.floor(t)>=.5)m(r,y*u,q.height-aa*v,true);}},o=c('React').createClass({displayName:'FBRTCAudioSpectrumAnalyser',_isAnimating:false,_animationLoop:null,componentDidMount:function(){this._startAnimation();},componentWillUnmount:function(){this._stopAnimation();},shouldComponentUpdate:function(p,q){return this._streamDidChange();},componentDidUpdate:function(p,q){this._stopAnimation();this._startAnimation();},_streamDidChange:function(){var p=this.props.stream?this.props.stream.getStream():null;return p!==this._currentStream;},_stopAnimation:function(){this._isAnimating=false;c('cancelAnimationFrame')(this._animationLoop);},_startAnimation:function(){var p=this.props.stream.getAudioAnalyser();if(!this._isAnimating&&p){this._isAnimating=true;var q=c('ReactDOM').findDOMNode(this),r=q.getContext('2d');this._animate(p,q,r);}},render:function(){return c('React').createElement('canvas',{width:'106',height:'80'});},_animate:function(p,q,r){this._animationLoop=c('requestAnimationFrame')(function(){if(!this._isAnimating)return;n(p,q,r);this._animate(p,q,r);}.bind(this));}});f.exports=o;},null);
__d('FBRTCAudioConstraints',['FBRTCConstants','FBRTCVersionDetection'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();function h(i){var j=arguments.length<=1||arguments[1]===undefined?null:arguments[1];this.streamType=i;this.audioSource=j;}h.prototype.getConstraints=function(){if(this.streamType===c('FBRTCConstants').StreamType.SCREEN_CONTENT&&c('FBRTCVersionDetection').isChrome())return false;if(!this.audioSource)return true;return {optional:[{sourceId:this.audioSource}]};};f.exports=h;},null);
__d('FBRTCVideoConstraints',['UserAgent','FBRTCConstants','RTCConfig'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h=1080,i=720,j=180,k=480,l=1920,m=1280,n=320,o=854,p=15,q=30;function r(s,t){var u=arguments.length<=2||arguments[2]===undefined?null:arguments[2];this.streamType=s;this.videoQuality=t;this.videoSource=u;}r.prototype.getConstraints=function(){if(this.streamType===c('FBRTCConstants').StreamType.AUDIO_ONLY)return false;if(this.streamType===c('FBRTCConstants').StreamType.SCREEN_CONTENT){if(this.videoSource){var s={width:l,height:h,frameRate:q},t=this.$FBRTCVideoConstraints1(c('RTCConfig').CollaborationCallQuality.screen,s),u=t.width,v=t.height,w=t.frameRate;return {mandatory:{chromeMediaSource:'desktop',chromeMediaSourceId:this.videoSource,minHeight:v,maxHeight:v,minWidth:u,maxWidth:u,minFrameRate:p,maxFrameRate:w}};}return false;}var x=this.$FBRTCVideoConstraints1(c('RTCConfig').CollaborationCallQuality.videoToRoom),y=x.width,z=x.height,aa=x.frameRate;if(this.$FBRTCVideoConstraints2())return {height:{min:j,max:i,ideal:z},width:{min:320,max:1280,ideal:z*16/9},frameRate:{min:10,max:30,ideal:aa}};var ba={mandatory:{},optional:[{minHeight:z},{maxHeight:z},{minFrameRate:aa},{maxFrameRate:aa},{googLeakyBucket:true}]};if(this.videoSource)ba.optional=ba.optional.concat({sourceId:this.videoSource});if(this.videoQuality===c('FBRTCConstants').VideoQuality.CUSTOM_VIDEO)ba.optional=ba.optional.concat({minWidth:y},{maxWidth:y});return ba;};r.prototype.$FBRTCVideoConstraints1=function(s){var t=arguments.length<=1||arguments[1]===undefined?{width:o,height:k,frameRate:q}:arguments[1];switch(this.videoQuality){case c('FBRTCConstants').VideoQuality.HD_VIDEO:return {width:m,height:i,frameRate:q};case c('FBRTCConstants').VideoQuality.LQ_VIDEO:return {width:n,height:j,frameRate:p};case c('FBRTCConstants').VideoQuality.SD_VIDEO:return {width:o,height:k,frameRate:q};case c('FBRTCConstants').VideoQuality.CUSTOM_VIDEO:return s;default:return t;}};r.prototype.$FBRTCVideoConstraints2=function(){return !!navigator.mediaDevices&&c('UserAgent').isBrowser('Firefox >= 38');};f.exports=r;},null);
__d('FBRTCUserMediaRequest',['FBRTCAudioConstraints','FBRTCConstants','FBRTCVideoConstraints','UserAgent','mixInEventEmitter'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h=function(){return !!navigator.mediaDevices&&c('UserAgent').isBrowser('Firefox >= 38');};function i(j){var k=arguments.length<=1||arguments[1]===undefined?c('FBRTCConstants').VideoQuality.SD_VIDEO:arguments[1];this.streamType=j;this.videoQuality=k;this.audioSource=null;this.videoSource=null;}i.prototype.$FBRTCUserMediaRequest1=function(){var j=new (c('FBRTCAudioConstraints'))(this.streamType,this.audioSource),k=new (c('FBRTCVideoConstraints'))(this.streamType,this.videoQuality,this.videoSource);return {audio:j.getConstraints(),video:k.getConstraints()};};i.prototype.$FBRTCUserMediaRequest2=function(j,k,l){if(h()&&navigator.mediaDevices){navigator.mediaDevices.getUserMedia(j).then(k)['catch'](l);}else if(navigator.getUserMedia){navigator.getUserMedia(j,k,l);}else if(navigator.webkitGetUserMedia){navigator.webkitGetUserMedia(j,k,l);}else if(navigator.mozGetUserMedia){navigator.mozGetUserMedia(j,k,l);}else if(navigator.msGetUserMedia)navigator.msGetUserMedia(j,k,l);};i.prototype.request=function(){this.$FBRTCUserMediaRequest2(this.$FBRTCUserMediaRequest1(),function(j){this.emit('success',j);}.bind(this),function(j){this.emit('failed',j);}.bind(this));};c('mixInEventEmitter')(i,{success:true,failed:true});f.exports=i;},null);
__d('FBRTCUserSettings',['mixInEventEmitter','FBRTCConfig','FBRTCConstants','FBRTCUserMediaRequest','FBRTCStreamWrapper'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=window.MediaStreamTrack,i=null,j={stream:new (c('FBRTCStreamWrapper'))(),audioSources:[],videoSources:[],selectedCamera:null,savedCamera:null,selectedMic:null,savedMic:null,isLoading:false,_cameraLabel:null,_micLabel:null,isEnabled:function(){return c('FBRTCConfig').settingsEnabled()&&h&&!!h.getSources;},isDirty:function(){return this.savedCamera!==this.selectedCamera||this.savedMic!==this.selectedMic;},refresh:function(){if(h&&h.getSources){h.getSources(function(k){for(var l=0;l<k.length;l++){var m=k[l];if(m.kind==='audio')this.audioSources.push(m);if(m.kind==='video')this.videoSources.push(m);}this._refreshSelectedOptions();this._getUserMedia();this.isLoading=false;this._scheduleChangeEvent();}.bind(this));this.isLoading=true;this.audioSources=[];this.videoSources=[];}this._scheduleChangeEvent();},cleanUp:function(){this.selectedMic=this.savedMic;this.selectedCamera=this.savedCamera;this.stream.stop();},_refreshSelectedOptions:function(){if(this.selectedMic===null)if(this.savedMic){this.selectedMic=this.savedMic;}else if(this.audioSources.length>0){for(var k=0;k<this.audioSources.length;k++)if(this._micLabel&&this._micLabel===this.audioSources[k].label){this.selectedMic=this.audioSources[k].id;break;}if(!this.selectedMic)this.selectedMic=this.audioSources[0].id;this.savedMic=this.selectedMic;}if(this.selectedCamera===null)if(this.savedCamera){this.selectedCamera=this.savedCamera;}else if(this.videoSources.length>0){for(var l=0;l<this.videoSources.length;l++)if(this._cameraLabel&&this._cameraLabel===this.videoSources[l].label){this.selectedCamera=this.videoSources[l].id;break;}if(!this.selectedCamera)this.selectedCamera=this.videoSources[0].id;this.savedCamera=this.selectedCamera;}},save:function(){this.savedMic=this.selectedMic;this.savedCamera=this.selectedCamera;this.emit('saved');this.cleanUp();},selectCameraOption:function(k){this.selectedCamera=k;this._scheduleChangeEvent();this._getUserMedia();},selectMicOption:function(k){this.selectedMic=k;this._scheduleChangeEvent();this._getUserMedia();},updateForLocalStream:function(k){if(k.videoMediaSourceId){this.savedCamera=k.videoMediaSourceId;}else{var l=k.getVideoTracks()[0];if(l)this._cameraLabel=l.label;}if(k.audioMediaSourceId){this.savedMic=k.audioMediaSourceId;}else{var m=k.getAudioTracks()[0];if(m)this._micLabel=m.label;}},_scheduleChangeEvent:function(){if(i!==null)clearTimeout(i);i=setTimeout(function(){this.emit('changed');i=null;}.bind(this),50);},_getUserMedia:function(){var k=new (c('FBRTCUserMediaRequest'))(c('FBRTCConstants').StreamType.AUDIO_VIDEO);k.videoSource=this.selectedCamera;k.audioSource=this.selectedMic;k.addListener('success',this._gumSuccess,this);k.addListener('failed',this._gumFailed,this);k.request();},_gumSuccess:function(k){this.stream.setStream(k);this._scheduleChangeEvent();},_gumFailed:function(k){}};c('mixInEventEmitter')(j,{changed:true,saved:true});f.exports=j;},null);
__d('FBRTCSettingsDialog.react',['cx','fbt','React','Link.react','FBRTCDialog.react','FBRTCDialogBody.react','FBRTCDialogFooter.react','FBRTCDialogTitle.react','XUIDialogSaveButton.react','XUIDialogCancelButton.react','XUIGrayText.react','XUISelector.react','FBRTCAudioSpectrumAnalyser.react','FBRTCConfig','FBRTCUserSettings','FBRTCVideo.react'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();var j=c('XUISelector.react').Option,k=function(m){var n=[],o=0;for(var p=0;p<m.length;p++){var q=m[p],r=q.label;if(!r){var s=q.kind==='audio'?'Microphone':'Camera';r=i._({"Camera":"Camera{number}","Microphone":"Microphone{number}"},[i['enum'](s,{Camera:'Camera',Microphone:'Microphone'}),i.param('number',++o)]);}n.push(c('React').createElement(j,{value:q.id,key:q.id},r));}return n;},l=c('React').createClass({displayName:'FBRTCSettingsDialog',componentDidMount:function(){this._renderSubscription=c('FBRTCUserSettings').addListener('changed',function(){this.forceUpdate();}.bind(this));c('FBRTCUserSettings').refresh();},componentWillUnmount:function(){this._renderSubscription.remove();c('FBRTCUserSettings').cleanUp();},render:function(){return (c('React').createElement(c('FBRTCDialog.react'),{width:365,shown:true,onToggle:this.props.onToggle},c('React').createElement(c('FBRTCDialogTitle.react'),{showCloseButton:true},c('React').createElement('span',null,i._("Settings"))),c('React').createElement(c('FBRTCDialogBody.react'),null,this._dialogBody()),c('React').createElement(c('FBRTCDialogFooter.react'),{leftContent:this._helpLink()},c('React').createElement(c('XUIDialogCancelButton.react'),null),c('React').createElement(c('XUIDialogSaveButton.react'),{use:'confirm',disabled:!c('FBRTCUserSettings').isDirty(),onClick:this._onConfirmClicked}))));},_dialogBody:function(){if(c('FBRTCUserSettings').isLoading)return c('React').createElement('div',{className:"_48fc"});return (c('React').createElement('div',{className:"_48fc"},this._cameraOptions(),this._microphoneOptions(),c('React').createElement(c('XUIGrayText.react'),{shade:'light'},i._("Tip: Try restarting your browser if you're having trouble with your camera or microphone."))));},_cameraOptions:function(){if(c('FBRTCUserSettings').videoSources.length<1)return null;return (c('React').createElement('div',{className:"_48fd"},c('React').createElement(c('XUIGrayText.react'),{display:'block',size:'medium',shade:'medium',className:"_48fe"},i._("Camera")),c('React').createElement(c('XUISelector.react'),{name:'camera_selection',onChange:this._onCamSelectionChanged,defaultValue:c('FBRTCUserSettings').selectedCamera,width:'200px'},k(c('FBRTCUserSettings').videoSources)),c('React').createElement('div',{className:"_48ff"},c('React').createElement(c('FBRTCVideo.react'),{stream:c('FBRTCUserSettings').stream,muted:true,className:"_48fg"}))));},_microphoneOptions:function(){if(c('FBRTCUserSettings').audioSources.length<1)return null;return (c('React').createElement('div',{className:"_48fd"},c('React').createElement(c('XUIGrayText.react'),{display:'block',size:'medium',shade:'medium',className:"_48fe"},i._("Microphone")),c('React').createElement(c('XUISelector.react'),{name:'microphone_selection',onChange:this._onMicSelectionChanged,defaultValue:c('FBRTCUserSettings').selectedMic,width:'200px'},k(c('FBRTCUserSettings').audioSources)),c('React').createElement('div',{className:"_48fh"},c('React').createElement(c('FBRTCAudioSpectrumAnalyser.react'),{stream:c('FBRTCUserSettings').stream}))));},_onCamSelectionChanged:function(m){c('FBRTCUserSettings').selectCameraOption(m.value);},_onMicSelectionChanged:function(m){c('FBRTCUserSettings').selectMicOption(m.value);},_onConfirmClicked:function(m){c('FBRTCUserSettings').save();},_helpLink:function(){return (c('React').createElement('div',null,c('React').createElement(c('XUIGrayText.react'),{shade:'light'},c('React').createElement(c('Link.react'),{href:c('FBRTCConfig').userMediaErrorUrl(),target:'_blank'},i._("Get help")))));}});f.exports=l;},null);
__d('FBRTCVideoEscalationDialog.react',['fbt','FBRTCCallControlActions','React','XUIDialog.react','XUIDialogBody.react','XUIDialogButton.react','XUIDialogFooter.react'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=c('React').PropTypes,j=c('React').createClass({displayName:'FBRTCVideoEscalationDialog',propTypes:{peerName:i.string.isRequired,hideDialog:i.func.isRequired},render:function(){var k=this.props.peerName;return (c('React').createElement(c('XUIDialog.react'),{layerHideOnBlur:false,shown:true,width:440},c('React').createElement(c('XUIDialogBody.react'),null,c('React').createElement('p',null,h._("{name} would like to video chat. Click \"Accept\" to enable your camera.",[h.param('name',k)]))),c('React').createElement(c('XUIDialogFooter.react'),null,c('React').createElement(c('XUIDialogButton.react'),{action:'cancel',label:h._("Decline"),onClick:this._onDeclineClicked}),c('React').createElement(c('XUIDialogButton.react'),{action:'confirm',label:h._("Accept"),onClick:this._onAcceptClicked,use:'confirm'}))));},_onDeclineClicked:function(k){c('FBRTCCallControlActions').declineEscalation();},_onAcceptClicked:function(k){this.props.hideDialog();c('FBRTCCallControlActions').acceptEscalation();}});f.exports=j;},null);
__d('FBRTCCallDialogController',['FBRTCCallModel','FBRTCScreenSharingModel','FBRTCSettingsDialog.react','FBRTCStruct','FBRTCMediaAccessErrorDialog.react','FBRTCPeerBrowserUnsupportedDialog.react','FBRTCScreenSharingUnsupportedBrowserDialog.react','FBRTCScreenSharingInstallExtensionDialog.react','FBRTCUserSettings','FBRTCVideoEscalationDialog.react','React','ReactDOM','ReactLayeredComponentMixin'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=new (c('FBRTCStruct'))(['ERROR_ACCESSING_MEDIA','PEER_BROWSER_UNSUPPORTED','SETTINGS','SCREEN_SHARING_UNSUPPORTED','INSTALL_SCREEN_SHARING_EXT','VIDEO_ESCALATION']),i=c('React').createClass({displayName:'DialogOwner',mixins:[c('ReactLayeredComponentMixin')],renderLayers:function(){if(this.props.dialogType===h.ERROR_ACCESSING_MEDIA)return {dialog:c('React').createElement(c('FBRTCMediaAccessErrorDialog.react'),null)};if(this.props.dialogType===h.PEER_BROWSER_UNSUPPORTED)if(this.props.peerName)return {dialog:c('React').createElement(c('FBRTCPeerBrowserUnsupportedDialog.react'),{peerName:this.props.peerName})};if(this.props.dialogType===h.SETTINGS)return {dialog:c('React').createElement(c('FBRTCSettingsDialog.react'),{onToggle:this._onToggle})};if(this.props.dialogType===h.SCREEN_SHARING_UNSUPPORTED)return {dialog:c('React').createElement(c('FBRTCScreenSharingUnsupportedBrowserDialog.react'),{onToggle:this._onToggle})};if(this.props.dialogType===h.INSTALL_SCREEN_SHARING_EXT)return {dialog:c('React').createElement(c('FBRTCScreenSharingInstallExtensionDialog.react'),{onToggle:this._onToggle,peerID:this.props.peerID,sessionID:this.props.sessionID})};if(this.props.dialogType===h.VIDEO_ESCALATION)if(this.props.peerName)return {dialog:c('React').createElement(c('FBRTCVideoEscalationDialog.react'),{hideDialog:function(){j.hideDialog();},onToggle:this._onToggle,peerName:this.props.peerName})};return {};},_onToggle:function(k){setTimeout(function(){if(!k)j.hideDialog();},0);},render:function(){return c('React').createElement('div',null);}}),j={dialogTypes:h,container:null,setDialogContainer:function(k){this.container=k;this.currentDialogType=null;this.callModel=null;this._render();},showDialog:function(k,l){this.currentDialogType=k;this._setCallModel(l);this._render();},hideDialog:function(){this.currentDialogType=null;this._render();},hideDialogType:function(k){if(k===this.currentDialogType)this.hideDialog();},_render:function(){var k,l,m;if(this.callModel instanceof c('FBRTCCallModel')){k=this.callModel.peerID;l=this.callModel.callID;m=this.callModel.peerName();}else if(this.callModel instanceof c('FBRTCScreenSharingModel')){k=this.callModel.getPeerID();l=this.callModel.getSessionID();}c('ReactDOM').render(c('React').createElement(i,{dialogType:this.currentDialogType,peerID:k,sessionID:l,peerName:m,callModel:this.callModel}),this.container);},_setCallModel:function(k){if(k!==this.callModel){this.callModel=k;if(this.callModel)this.callModel.addListener(this._onCallModelChanged.bind(this));}},_onCallModelChanged:function(){var k=[h.SETTINGS,h.SCREEN_SHARING_UNSUPPORTED,h.INSTALL_SCREEN_SHARING_EXT,h.VIDEO_ESCALATION];if(this.callModel.isEnded()&&k.indexOf(this.currentDialogType)>-1)this.hideDialog();}};c('FBRTCUserSettings').addListener('saved',j.hideDialog,j);f.exports=j;},null);
__d('FBRTCStarRatingActions',['FBRTCDispatcher','keyMirror'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h=c('keyMirror')({SUBMIT_RATING:null,SUBMIT_FEEDBACK:null,RATING_SHOWN:null,FEEDBACK_SHOWN:null}),i={Types:h,submitRating:function(j){c('FBRTCDispatcher').dispatch({type:h.SUBMIT_RATING,rating:j});},submitFeedback:function(j){c('FBRTCDispatcher').dispatch({type:h.SUBMIT_FEEDBACK,feedback:j});},ratingShown:function(){c('FBRTCDispatcher').dispatch({type:h.RATING_SHOWN});},feedbackShown:function(){c('FBRTCDispatcher').dispatch({type:h.FEEDBACK_SHOWN});}};f.exports=i;},null);
__d('FBRTCCallModelStatePusher',['FBRTCCallModel','FBRTCConstants','FBRTCDispatcher','FBRTCStarRatingActions'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=30000,i=10000;function j(k){'use strict';this.$FBRTCCallModelStatePusher1=null;this.$FBRTCCallModelStatePusher2=k;this.$FBRTCCallModelStatePusher2.addListener(this.$FBRTCCallModelStatePusher3.bind(this));c('FBRTCDispatcher').register(this.$FBRTCCallModelStatePusher4.bind(this));}j.prototype.$FBRTCCallModelStatePusher5=function(){'use strict';return this.$FBRTCCallModelStatePusher2.uiState===c('FBRTCCallModel').UIState.CALL_ENDED&&this.$FBRTCCallModelStatePusher2.wasConnected&&this.$FBRTCCallModelStatePusher2.endCallReason===c('FBRTCConstants').CallEndReason.HANGUP_CALL;};j.prototype.$FBRTCCallModelStatePusher3=function(){'use strict';if(this.$FBRTCCallModelStatePusher2.uiState===c('FBRTCCallModel').UIState.CALL_ENDED){if(this.$FBRTCCallModelStatePusher5()){this.$FBRTCCallModelStatePusher6(3000,c('FBRTCCallModel').UIState.CALL_ENDED,c('FBRTCCallModel').UIState.COLLECT_RATING);}else this.$FBRTCCallModelStatePusher7(i);}else if(this.$FBRTCCallModelStatePusher2.uiState===c('FBRTCCallModel').UIState.COLLECT_RATING)this.$FBRTCCallModelStatePusher7(h);};j.prototype.$FBRTCCallModelStatePusher4=function(k){'use strict';if(k.type===c('FBRTCStarRatingActions').Types.FEEDBACK_SHOWN)this.$FBRTCCallModelStatePusher8();};j.prototype.$FBRTCCallModelStatePusher7=function(k){'use strict';this.$FBRTCCallModelStatePusher1=setTimeout(function(){window.close();},k);};j.prototype.$FBRTCCallModelStatePusher8=function(){'use strict';clearTimeout(this.$FBRTCCallModelStatePusher1);this.$FBRTCCallModelStatePusher1=null;};j.prototype.$FBRTCCallModelStatePusher6=function(k,l,m){'use strict';var n=this.$FBRTCCallModelStatePusher2;setTimeout(function(){n.setStateFrom(l,m);},k);};f.exports=j;},null);
__d('FBRTCCallMonitor',['FBRTCCallSummaryStore'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=10000,i=3000;function j(k){'use strict';this.$FBRTCCallMonitor1=k;this.$FBRTCCallMonitor2=null;this.$FBRTCCallMonitor3=c('FBRTCCallSummaryStore').getInstance();}j.prototype.startHeartbeat=function(k){'use strict';if(this.$FBRTCCallMonitor1.isEnded())return;var l=k();if(l)this.onCallHeartbeat(l);var m=this;setTimeout(function(){m.startHeartbeat(k);},h);};j.prototype.onCallHeartbeat=function(k){'use strict';var l=new Date().valueOf();if(!this.$FBRTCCallMonitor2||l-this.$FBRTCCallMonitor2>i)k.save(this.$FBRTCCallMonitor3);};f.exports=j;},null);
__d('FBRTCExperiment',['FBRTCExperimentsConfig','QE'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();h.gen=function(i){var j={params:{},in_experiment:false,auto_exposure:false},k=c('FBRTCExperimentsConfig')[i]||j,l=new h(i,k.params,k.in_experiment);if(k.auto_exposure)l.logExposure(i);return l;};function h(i,j,k){this.$FBRTCExperiment2=i;this.$FBRTCExperiment3=j;this.$FBRTCExperiment1=k;}h.prototype.logExposure=function(){if(this.$FBRTCExperiment1)c('QE').logExposure(this.$FBRTCExperiment2);};h.prototype.getParam=function(i,j){if(this.$FBRTCExperiment3[i])return this.$FBRTCExperiment3[i].toString();return j;};h.prototype.getInt=function(i,j){if(this.$FBRTCExperiment3[i])return parseInt(this.$FBRTCExperiment3[i],10);return j;};h.prototype.getBool=function(i,j){var k=this.$FBRTCExperiment3;if(k[i])return k[i]==='1'||k[i]===1||k[i]==='true';return j;};f.exports=h;},null);
__d("FBRTCIceCache",[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(){"use strict";this.$FBRTCIceCache1={};}h.prototype.reset=function(i,j){"use strict";if(!this.$FBRTCIceCache1[i])this.$FBRTCIceCache1[i]={};this.$FBRTCIceCache1[i][j]=[];};h.prototype.cacheCandidate=function(i,j,k){"use strict";if(!this.$FBRTCIceCache1[i])this.$FBRTCIceCache1[i]={};if(!this.$FBRTCIceCache1[i][j])this.$FBRTCIceCache1[i][j]=[];this.$FBRTCIceCache1[i][j].unshift(k);};h.prototype.drainCandidates=function(i,j,k){"use strict";if(this.$FBRTCIceCache1[i]&&this.$FBRTCIceCache1[i][j]){var l;while(this.$FBRTCIceCache1[i][j].length>0){l=this.$FBRTCIceCache1[i][j].pop();k(l);}}};f.exports=h;},null);
__d('FBRTCMessage',['FBRTCConstants','FBRTCSdpUtils','FBRTCSupport'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h='mobile';function i(j){'use strict';if(!this.$FBRTCMessage1(j))throw 'invalid webrtc message';this.originalMessageData=j;this.peerID=j.from;this.callID=parseInt(j.call_id,10);this.msg=JSON.parse(j.payload);this.msgType=this.msg.type;this.msgID=this.msg.msg_id;this.ackID=this.msg.ack_id;this.source=j.source;this.peerSupportsVideoInterop=!!this.msg.supports_video_interop;this.$FBRTCMessage2();this.$FBRTCMessage3();}i.prototype.$FBRTCMessage1=function(j){'use strict';return j.from&&j.call_id&&j.payload;};i.prototype.$FBRTCMessage2=function(){'use strict';if(c('FBRTCSupport').isVideoInteropSupported()&&this.peerSupportsVideoInterop)return;if(this.isFromMobile())this.disableVideo();};i.prototype.disableVideo=function(){'use strict';if(this.msg.sdp)this.msg.sdp=c('FBRTCSdpUtils').disableVideo(this.msg.sdp);if(this.msgType===c('FBRTCConstants').PayloadType.SET_VIDEO||this.msgType===c('FBRTCConstants').PayloadType.OFFER||this.msgType===c('FBRTCConstants').PayloadType.ICERESTART_OFFER||this.msgType===c('FBRTCConstants').PayloadType.ANSWER||this.msgType===c('FBRTCConstants').PayloadType.ICERESTART_ANSWER)this.msg.videoon=false;};i.prototype.$FBRTCMessage3=function(){'use strict';if(this.isFromMobile()&&this.msg.sdp&&this.msgType!==c('FBRTCConstants').PayloadType.ICE_CANDIDATE)this.msg.sdp=c('FBRTCSdpUtils').removeFEC(this.msg.sdp);};i.prototype.isOffer=function(){'use strict';return this.msgType===c('FBRTCConstants').PayloadType.OFFER;};i.prototype.isFromMobile=function(){'use strict';return this.source===h;};i.prototype.isRemoteVideoSupported=function(){'use strict';if(!this.msg.sdp||this.msgType===c('FBRTCConstants').PayloadType.ICE_CANDIDATE)return true;return c('FBRTCSdpUtils').isVideoSupported(this.msg.sdp);};i.prototype.isRetry=function(){'use strict';return !!this.msg.flag;};i.prototype.isForCall=function(j){'use strict';return !j.callID||j.callID===this.callID||this.msgType===c('FBRTCConstants').PayloadType.OFFER||this.msgType===c('FBRTCConstants').PayloadType.ICERESTART_OFFER||this.msgType===c('FBRTCConstants').PayloadType.PCRESTART_OFFER||this.msgType===c('FBRTCConstants').PayloadType.ICE_CANDIDATE;};i.prototype.getSignalingExperiments=function(){'use strict';if(this.isFromMobile()&&!this.msg.experiments)return ['sdp_update'];return this.msg.experiments;};f.exports=i;},null);
__d("FBRTCMessageDedup",[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={},i={check:function(j,k,l){if(!h[j])h[j]={};if(!h[j][k])h[j][k]={};if(h[j][k][l])return false;h[j][k][l]=true;return true;}};f.exports=i;},null);
__d("XCollabCallSendMessageController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/collab\/sendmessage\/",{recipient_id:{type:"Int",required:true},msg_id:{type:"Int",required:true},message_info:{type:"String",required:true},webrtc_fbtrace:{type:"Int"}});},null);
__d("XVideoCallSendMessageController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/videocall\/sendmessage\/",{recipient_id:{type:"Int",required:true},msg_id:{type:"Int",required:true},message_info:{type:"String",required:true},webrtc_fbtrace:{type:"Int"}});},null);
__d('FBRTCMessageSender',['errorCode','CurrentUser','FBRTCConfig','FBRTCConstants','FBRTCLogger','FBRTCUtils','Fbtrace','Map','SiteData','FBRTCSupport','XVideoCallSendMessageController','XCollabCallSendMessageController'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=0;function j(){'use strict';this.onSendFailure=null;this.$FBRTCMessageSender1=c('FBRTCLogger').getInstance();}j.prototype.sendOffer=function(k,l,m,n,o){'use strict';return this.$FBRTCMessageSender2(c('FBRTCConstants').PayloadType.OFFER,k,l,m,n,o);};j.prototype.sendAnswer=function(k,l,m,n,o){'use strict';return this.$FBRTCMessageSender2(c('FBRTCConstants').PayloadType.ANSWER,k,l,m,n,o);};j.prototype.sendPCRestartOffer=function(k,l,m,n,o){'use strict';return this.$FBRTCMessageSender2(c('FBRTCConstants').PayloadType.PCRESTART_OFFER,k,l,m,n,o);};j.prototype.sendSdpUpdate=function(k,l,m,n,o){'use strict';return this.$FBRTCMessageSender2(c('FBRTCConstants').PayloadType.SDP_UPDATE,k,l,m,n,o);};j.prototype.resendSdpMessage=function(k,l){'use strict';l.flag=1;this.$FBRTCMessageSender3(k,l);};j.prototype.resendPayload=function(k,l){'use strict';l.flag=1;this.$FBRTCMessageSender4(k,l);};j.prototype.$FBRTCMessageSender2=function(k,l,m,n,o,p){'use strict';var q=this.$FBRTCMessageSender5(m,k);q.sdp=n;if(k===c('FBRTCConstants').PayloadType.OFFER){q.handlescollision=true;q.pranswer=false;}if(k===c('FBRTCConstants').PayloadType.OFFER||k===c('FBRTCConstants').PayloadType.ANSWER){q.icerestart=false;q.experiments=c('FBRTCConfig').supportedSignalingExperiments();}q.videoon=o;q.attributes=p;this.$FBRTCMessageSender3(l,q);return q;};j.prototype.sendIceCandidate=function(k,l,m){'use strict';var n=this.$FBRTCMessageSender5(l,c('FBRTCConstants').PayloadType.ICE_CANDIDATE);n.sdp_mid=m.sdpMid;n.label=m.sdpMLineIndex;n.sdp=m.candidate;if(m.isDirectScreenShareFromRecipient){n.attributes={};n.attributes.isDirectScreenShareFromRecipient=m.isDirectScreenShareFromRecipient;}this.$FBRTCMessageSender4(k,n);};j.prototype.sendHangup=function(k,l,m,n,o){'use strict';var p=this.$FBRTCMessageSender5(l,c('FBRTCConstants').PayloadType.HANGUP);p.reason=c('FBRTCConstants').callEndReasonString(m);p.subreason=o||'';this.$FBRTCMessageSender4(k,p,n);};j.prototype.sendOtherDismiss=function(k){'use strict';var l=this.$FBRTCMessageSender5(k,c('FBRTCConstants').PayloadType.OTHER_DISMISS);this.$FBRTCMessageSender4(c('CurrentUser').getID(),l);};j.prototype.sendOfferAck=function(k,l,m){var n=arguments.length<=3||arguments[3]===undefined?new (c('Map'))():arguments[3];'use strict';this.$FBRTCMessageSender6(k,l,m,c('FBRTCConstants').PayloadType.OFFER_ACK,n);};j.prototype.sendOfferNack=function(k,l,m){'use strict';this.$FBRTCMessageSender6(k,l,m,c('FBRTCConstants').PayloadType.OFFER_NACK,new (c('Map'))([['error_code',1356043]]));};j.prototype.sendAnswerAck=function(k,l,m){'use strict';this.$FBRTCMessageSender6(k,l,m,c('FBRTCConstants').PayloadType.ANSWER_ACK);};j.prototype.sendAck=function(k,l,m){'use strict';this.$FBRTCMessageSender6(k,l,m,c('FBRTCConstants').PayloadType.ACK,new (c('Map'))([['ack_type',m.type]]));};j.prototype.sendMuteStateUpdate=function(k,l,m){'use strict';var n=this.$FBRTCMessageSender5(l,c('FBRTCConstants').PayloadType.SET_VIDEO);n.videoon=m;this.$FBRTCMessageSender4(k,n);};j.prototype.sendVideoEscalationRequest=function(k,l,m){'use strict';return this.sendVideoRequestResponse(k,l,0,m);};j.prototype.sendVideoRequestResponse=function(k,l,m,n){'use strict';var o=this.$FBRTCMessageSender5(l,c('FBRTCConstants').PayloadType.VIDEO_REQUEST);o.ack_id=m;o.videoon=n;o.capability=c('FBRTCSupport').getCapabilities();this.$FBRTCMessageSender4(k,o);return o;};j.prototype.sendMsgAck=function(){'use strict';};j.prototype.sendOk=function(){'use strict';};j.prototype.sendPranswer=function(){'use strict';};j.prototype.sendIcerestartAnswer=function(){'use strict';};j.prototype.$FBRTCMessageSender5=function(k,l){'use strict';var m=c('FBRTCUtils').generateRandomInt(),n={version:i,type:l,call_id:k,msg_id:m};if(this.$FBRTCMessageSender7(l))n.supports_video_interop=true;return n;};j.prototype.$FBRTCMessageSender7=function(k){'use strict';if(c('FBRTCSupport').isVideoInteropSupported())return (k===c('FBRTCConstants').PayloadType.OFFER||k===c('FBRTCConstants').PayloadType.ANSWER||k===c('FBRTCConstants').PayloadType.PRANSWER||k===c('FBRTCConstants').PayloadType.ICERESTART_OFFER||k===c('FBRTCConstants').PayloadType.ICERESTART_ANSWER||k===c('FBRTCConstants').PayloadType.PCRESTART_OFFER||k===c('FBRTCConstants').PayloadType.PCRESTART_ANSWER||k===c('FBRTCConstants').PayloadType.SDP_UPDATE||k===c('FBRTCConstants').PayloadType.SET_VIDEO||k===c('FBRTCConstants').PayloadType.VIDEO_REQUEST);return false;};j.prototype.$FBRTCMessageSender3=function(k,l){'use strict';this.$FBRTCMessageSender4(k,l,false,true,true);};j.prototype.$FBRTCMessageSender6=function(k,l,m,n){'use strict';var o=(arguments.length<=4?undefined:arguments[4])||new (c('Map'))(),p=this.$FBRTCMessageSender5(l,n);p.ack_id=m.msg_id;if(m.flag===1)p.flag=1;o.forEach(function(q,r,s){p[r]=q;});this.$FBRTCMessageSender4(k,p);};j.prototype.$FBRTCMessageSender4=function(k,l,m,n,o){'use strict';var p=l.msg_id,q={peer_id:k,call_id:l.call_id,msg_id:p,msg_type:l.type},r={call_id:l.call_id,msg_id:p,user_id:c('CurrentUser').getID(),recipient_id:k,msg_type:l.type,app_id:256281040558,app_version:String(c('SiteData').revision||'dev'),op:'sendServerRequest:'+l.type,policy:'WebRTC'},s=c('Fbtrace').requestReceive('browser',String(c('SiteData').revision||'dev'),r),t=(c('FBRTCUtils').isCollabCallable(k)?c('XCollabCallSendMessageController'):c('XVideoCallSendMessageController')).getURIBuilder().setInt('recipient_id',k).setInt('msg_id',p).setString('message_info',JSON.stringify(l)).setInt('webrtc_fbtrace',s.isOn()?1:0).getURI();if(n)var u=this.$FBRTCMessageSender4.bind(this,k,l,m,false,o);var v=this.$FBRTCMessageSender8.bind(this,q),w=this.$FBRTCMessageSender9.bind(this,q,u,o);c('Fbtrace').withDefaultNode(s,function(){c('FBRTCUtils').sendServerRequest(t,v,w,m);});if(this.onMessageSent)this.onMessageSent(k,l);this.$FBRTCMessageSender1.logSentMessage(k,l.call_id,l);};j.prototype.$FBRTCMessageSender8=function(k){'use strict';this.$FBRTCMessageSender1.logSentMessageSuccess(k.peer_id,k.call_id,k.msg_type,k.msg_id);};j.prototype.$FBRTCMessageSender9=function(k,l,m,n){'use strict';if(n)var o=n.getError?n.getError():n;this.$FBRTCMessageSender1.logSentMessageFailure(k.peer_id,k.call_id,k.msg_type,k.msg_id,o);var p=null;if(o===1356001||o===1356049){p=c('FBRTCConstants').CallEndReason.NO_PERMISSION;}else if(o===1356046||o===1356045){p=c('FBRTCConstants').CallEndReason.CALLER_NOT_VISIBLE;}else if(o===1356003||o===1356002||o===1356044)p=c('FBRTCConstants').CallEndReason.OTHER_NOT_CAPABLE;if(!p&&l){l();return;}if(m&&this.onSendFailure){if(!p)p=c('FBRTCConstants').CallEndReason.SIGNALING_MESSAGE_FAILED;this.onSendFailure(p,o,k.msg_type);}};f.exports=j;},null);
__d('FBRTCRetriableMessage',['mixInEventEmitter','FBRTCConstants'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=10000,i=7000,j=1;function k(l){'use strict';this.$FBRTCRetriableMessage1=l;this.$FBRTCRetriableMessage2=h;this.$FBRTCRetriableMessage3=j;this.$FBRTCRetriableMessage4=null;this.$FBRTCRetriableMessage5=null;this.$FBRTCRetriableMessage6=null;}k.prototype.sendMessage=function(l,m,n,o,p,q){'use strict';this.$FBRTCRetriableMessage4=m;switch(l){case c('FBRTCConstants').PayloadType.PCRESTART_OFFER:this.$FBRTCRetriableMessage5=this.$FBRTCRetriableMessage1.sendPCRestartOffer(m,n,o,p,q);break;case c('FBRTCConstants').PayloadType.OFFER:this.$FBRTCRetriableMessage5=this.$FBRTCRetriableMessage1.sendOffer(m,n,o,p,q);break;case c('FBRTCConstants').PayloadType.ANSWER:this.$FBRTCRetriableMessage2=i;this.$FBRTCRetriableMessage5=this.$FBRTCRetriableMessage1.sendAnswer(m,n,o,p,q);break;}this.$FBRTCRetriableMessage7();};k.prototype.isAckMsg=function(l){'use strict';return this.$FBRTCRetriableMessage5&&this.$FBRTCRetriableMessage5.msg_id===l.ack_id;};k.prototype.stopRetrying=function(){'use strict';if(this.$FBRTCRetriableMessage6){clearTimeout(this.$FBRTCRetriableMessage6);this.$FBRTCRetriableMessage4=null;this.$FBRTCRetriableMessage5=null;this.$FBRTCRetriableMessage6=null;}};k.prototype.$FBRTCRetriableMessage7=function(){'use strict';this.$FBRTCRetriableMessage6=setTimeout(this.$FBRTCRetriableMessage8.bind(this),this.$FBRTCRetriableMessage2);};k.prototype.$FBRTCRetriableMessage8=function(){'use strict';if(this.$FBRTCRetriableMessage3<1){this.emit('timeoutFailure');}else{this.emit('sendingRetry');this.$FBRTCRetriableMessage1.resendSdpMessage(this.$FBRTCRetriableMessage4,this.$FBRTCRetriableMessage5);this.$FBRTCRetriableMessage7();this.$FBRTCRetriableMessage3-=1;}};c('mixInEventEmitter')(k,{sendingRetry:true,timeoutFailure:true});f.exports=k;},null);
__d('FBRTCScreenMedia',['FBRTCConstants','FBRTCDispatcher','FBRTCUserMediaRequest','keyMirror'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h=c('keyMirror')({STREAM_READY:null,STREAM_FAILED:null}),i={STREAM_TYPE:c('FBRTCConstants').StreamType.SCREEN_CONTENT,Types:h,requestScreenMedia:function(j){var k=c('FBRTCConstants').VideoQuality.CUSTOM_VIDEO,l=new (c('FBRTCUserMediaRequest'))(this.STREAM_TYPE,k);l.videoSource=j;l.audioSource=null;l.addListener('success',this._onRequestSuccess,this);l.addListener('failed',this._onRequestFailure,this);l.request();},_onRequestSuccess:function(j){c('FBRTCDispatcher').dispatch({type:h.STREAM_READY,stream:j});},_onRequestFailure:function(j){var k=j.name?j.name:j;c('FBRTCDispatcher').dispatch({type:h.STREAM_FAILED,error:k});}};f.exports=i;},null);
__d('FBRTCOfferOptions',['UserAgent'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();function h(){var i=arguments.length<=0||arguments[0]===undefined?false:arguments[0],j=arguments.length<=1||arguments[1]===undefined?false:arguments[1];this.$FBRTCOfferOptions2(i,j);}h.prototype.getOptions=function(){return this.$FBRTCOfferOptions1;};h.prototype.setOptions=function(i){this.$FBRTCOfferOptions1=i;};h.prototype.$FBRTCOfferOptions2=function(i,j){if(c('UserAgent').isBrowser('Chrome <= 37')){this.setOptions({mandatory:{OfferToReceiveAudio:i,OfferToReceiveVideo:j}});}else this.setOptions({offerToReceiveAudio:i,offerToReceiveVideo:j});};f.exports=h;},null);
__d('FBRTCScreenSharingConnection',['FBRTCConstants','FBRTCOfferOptions','FBRTCPCConfig','FBRTCScreenSharingActions','FBRTCScreenSharingLogger','FBRTCScreenStreamWrapper'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();function h(){this.$FBRTCScreenSharingConnection1=c('FBRTCScreenSharingLogger').getInstance();this.$FBRTCScreenSharingConnection5=new (c('FBRTCOfferOptions'))(false,true);this.$FBRTCScreenSharingConnection2=window.RTCIceCandidate;this.$FBRTCScreenSharingConnection3=window.RTCSessionDescription;this.$FBRTCScreenSharingConnection4=window.webkitRTCPeerConnection;this.$FBRTCScreenSharingConnection7=null;this.$FBRTCScreenSharingConnection6=null;}h.prototype.setStream=function(i){this.$FBRTCScreenSharingConnection7=i;};h.prototype.createSdpUpdate=function(){var i=this.$FBRTCScreenSharingConnection6,j=this.$FBRTCScreenSharingConnection7;if(i&&j){var k=i.getLocalStreams();for(var l=0;l<k.length;l++)i.removeStream(k[l]);i.addStream(j.getStream());this.$FBRTCScreenSharingConnection8(c('FBRTCConstants').PayloadType.SDP_UPDATE);}};h.prototype.createOffer=function(){if(!this.$FBRTCScreenSharingConnection6)this.$FBRTCScreenSharingConnection6=this.$FBRTCScreenSharingConnection9();this.$FBRTCScreenSharingConnection8(c('FBRTCConstants').PayloadType.OFFER);};h.prototype.onReceivedAnswerSDP=function(i){var j=new this.$FBRTCScreenSharingConnection3({type:c('FBRTCConstants').PayloadType.ANSWER,sdp:i}),k=this.$FBRTCScreenSharingConnection6;if(k)k.setRemoteDescription(j,this.$FBRTCScreenSharingConnection10.bind(this,j),this.$FBRTCScreenSharingConnection11);};h.prototype.onReceivedOfferSDP=function(i){var j=this.$FBRTCScreenSharingConnection6;if(!j){j=this.$FBRTCScreenSharingConnection9();this.$FBRTCScreenSharingConnection6=j;}var k=new this.$FBRTCScreenSharingConnection3({type:c('FBRTCConstants').PayloadType.OFFER,sdp:i});j.setRemoteDescription(k,this.$FBRTCScreenSharingConnection10.bind(this,k),this.$FBRTCScreenSharingConnection11);};h.prototype.onReceivedRemoteIceCandidate=function(i){if(typeof i.sdp!=='string')return;var j=new this.$FBRTCScreenSharingConnection2({sdpMLineIndex:i.label,candidate:i.sdp,sdpMid:i.sdp_mid}),k=this.$FBRTCScreenSharingConnection6;if(k)k.addIceCandidate(j);};h.prototype.cleanPeerConnection=function(){var i=this.$FBRTCScreenSharingConnection6;if(i){i.onaddstream=null;i.onremovestream=null;i.onicecandidate=null;i.oniceconnectionstatechange=null;if(i.iceConnectionState!=='closed')i.close();}};h.prototype.$FBRTCScreenSharingConnection9=function(){var i=new this.$FBRTCScreenSharingConnection4(c('FBRTCPCConfig').getConfig(),c('FBRTCPCConfig').getConstraints());i.onaddstream=this.$FBRTCScreenSharingConnection12.bind(this);i.onicecandidate=this.$FBRTCScreenSharingConnection13.bind(this);if(this.$FBRTCScreenSharingConnection7)i.addStream(this.$FBRTCScreenSharingConnection7.getStream());return i;};h.prototype.$FBRTCScreenSharingConnection13=function(event){if(event.candidate)c('FBRTCScreenSharingActions').localIceCandidateCreated(event.candidate);};h.prototype.$FBRTCScreenSharingConnection12=function(event){c('FBRTCScreenSharingActions').remoteStreamAdded(event.stream);};h.prototype.$FBRTCScreenSharingConnection8=function(i){var j=this.$FBRTCScreenSharingConnection6;if(j)j.createOffer(this.$FBRTCScreenSharingConnection14.bind(this,i),this.$FBRTCScreenSharingConnection11,this.$FBRTCScreenSharingConnection5.getOptions());};h.prototype.$FBRTCScreenSharingConnection14=function(i,j){var k=this.$FBRTCScreenSharingConnection6;j.sdp=this.$FBRTCScreenSharingConnection15(j.sdp);if(k)k.setLocalDescription(j,c('FBRTCScreenSharingActions').sdpCreated.bind(this,{type:i,sdp:j.sdp}),this.$FBRTCScreenSharingConnection11);};h.prototype.$FBRTCScreenSharingConnection15=function(i){return i.replace('UDP/TLS/RTP/SAVPF','RTP/SAVPF');};h.prototype.$FBRTCScreenSharingConnection10=function(i){if(i.type===c('FBRTCConstants').PayloadType.OFFER){var j=this.$FBRTCScreenSharingConnection6;if(j)j.createAnswer(this.$FBRTCScreenSharingConnection14.bind(this,c('FBRTCConstants').PayloadType.ANSWER),this.$FBRTCScreenSharingConnection11);}else if(i.type===c('FBRTCConstants').PayloadType.ANSWER)c('FBRTCScreenSharingActions').remoteDescriptionSet();};h.prototype.$FBRTCScreenSharingConnection11=function(i){this.$FBRTCScreenSharingConnection1.logToConsole(null,null,JSON.stringify(i,null,'\t'));};f.exports=h;},null);
__d('FBRTCScreenSharingController',['invariant','Promise','FBRTCCallDialogController','FBRTCConstants','FBRTCLocalMessageQueue','FBRTCMessageHandler','FBRTCMessageListener','FBRTCMessageSender','FBRTCScreenMedia','FBRTCScreenSharingActions','FBRTCScreenSharingConnection','FBRTCScreenSharingConstants','FBRTCScreenSharingLogger','FBRTCScreenSharingModel','FBRTCScreenSharingUI','FBRTCScreenSharingUtils','FBRTCStore','Random'],function a(b,c,d,e,f,g,h){'use strict';var i,j;if(c.__markCompiled)c.__markCompiled();i=babelHelpers.inherits(k,c('FBRTCStore'));j=i&&i.prototype;function k(l,m,n){j.constructor.call(this);this.$FBRTCScreenSharingController2=this.$FBRTCScreenSharingController15.bind(this);this.$FBRTCScreenSharingController3=n;this.$FBRTCScreenSharingController4=false;this.$FBRTCScreenSharingController5=false;this.$FBRTCScreenSharingController6=false;this.$FBRTCScreenSharingController7=false;this.$FBRTCScreenSharingController8=null;this.$FBRTCScreenSharingController10=c('FBRTCScreenSharingLogger').getInstance();this.$FBRTCScreenSharingController13=l;this.$FBRTCScreenSharingController14=m!=null?m:c('Random').uint32();this.$FBRTCScreenSharingController12=new (c('FBRTCScreenSharingModel'))(this.$FBRTCScreenSharingController13,this.$FBRTCScreenSharingController14);!(this.$FBRTCScreenSharingController14!==null&&this.$FBRTCScreenSharingController14!==undefined)?h(0):void 0;this.initPromise=new (c('Promise'))(function(o,p){if(c('FBRTCScreenSharingUtils').isScreenSharingSupported()){c('FBRTCScreenSharingUtils').checkExtensionInstalled(o,p);if(n){this.$FBRTCScreenSharingController16(m);}else this.$FBRTCScreenSharingController12.addListener(this.$FBRTCScreenSharingController17.bind(this));}else p();}.bind(this));}k.prototype.isEnabled=function(){return this.$FBRTCScreenSharingController6&&this.$FBRTCScreenSharingController12.isEnabled();};k.prototype.getStream=function(){return this.$FBRTCScreenSharingController12.getStream();};k.prototype.onStop=function(){this.$FBRTCScreenSharingController12.onStop();};k.prototype.onEndCall=function(){c('FBRTCScreenSharingUI').close();this.onStop();};k.prototype.setRemoteStream=function(l){if(!l){c('FBRTCScreenSharingUI').close();this.$FBRTCScreenSharingController12.setStream(l,true);}else this.$FBRTCScreenSharingController12.setStream(l,true);};k.prototype.initializeAsSender=function(){this.$FBRTCScreenSharingController4=false;};k.prototype.initializeAsReceiver=function(l,m){this.$FBRTCScreenSharingController4=true;this.$FBRTCScreenSharingController1.onReceivedOfferSDP(l);this.$FBRTCScreenSharingController8=m;};k.prototype.onSdpUpdateReceived=function(l){this.$FBRTCScreenSharingController1.onReceivedOfferSDP(l);this.$FBRTCScreenSharingController7=true;this.$FBRTCScreenSharingController9=true;};k.prototype.toggleScreenSharing=function(){var l=arguments.length<=0||arguments[0]===undefined?null:arguments[0];if(this.$FBRTCScreenSharingController18(l)){var m=this.$FBRTCScreenSharingController12.isEnabled()||this.$FBRTCScreenSharingController5?'SC_CANCEL':'SC_REQUEST';if(m==='SC_REQUEST'&&this.$FBRTCScreenSharingController3)c('FBRTCScreenSharingUI').openTempWindow();this.$FBRTCScreenSharingController19(m);this.$FBRTCScreenSharingController10.logAction(this.$FBRTCScreenSharingController13,this.$FBRTCScreenSharingController14,c('FBRTCScreenSharingLogger').Action.SCREEN_SHARING_TOGGLED,this.$FBRTCScreenSharingController3,'status: '+(this.isEnabled()?'enabled':'disabled'));}};k.prototype.onDirectScreenSharingEndSession=function(){this.onStop();};k.prototype.$FBRTCScreenSharingController18=function(l){var m=l?l:this.$FBRTCScreenSharingController12;if(!c('FBRTCCallDialogController').container)c('FBRTCCallDialogController').setDialogContainer(document.body.appendChild(document.createElement('div')));if(!c('FBRTCScreenSharingUtils').isSupportedBrowser()){c('FBRTCCallDialogController').showDialog(c('FBRTCCallDialogController').dialogTypes.SCREEN_SHARING_UNSUPPORTED,m);return false;}else if(!c('FBRTCScreenSharingUtils').isExtensionInstalled()){c('FBRTCCallDialogController').showDialog(c('FBRTCCallDialogController').dialogTypes.INSTALL_SCREEN_SHARING_EXT,m);return false;}return true;};k.prototype.$FBRTCScreenSharingController20=function(){var l=arguments.length<=0||arguments[0]===undefined?false:arguments[0];if(this.$FBRTCScreenSharingController7)return;this.$FBRTCScreenSharingController5=true;this.toggleScreenSharing();c('FBRTCScreenSharingUI').close();if(this.$FBRTCScreenSharingController1)this.$FBRTCScreenSharingController1.cleanPeerConnection();if(!this.$FBRTCScreenSharingController4)c('FBRTCMessageHandler').resetListener();if(l)this.$FBRTCScreenSharingController21();};k.prototype.$FBRTCScreenSharingController22=function(){this.$FBRTCScreenSharingController7=true;this.$FBRTCScreenSharingController9=true;this.$FBRTCScreenSharingController19('SC_RESET_PORT');this.$FBRTCScreenSharingController19('SC_REQUEST');};k.prototype.$FBRTCScreenSharingController19=function(l){!(l==='SC_REQUEST'||l==='SC_CANCEL'||l==='SC_RESET_PORT')?h(0):void 0;window.postMessage({recipient:c('FBRTCScreenSharingUtils').RECIPIENT,type:l,text:'communicate with screen sharing extension'},'*');if(l==='SC_REQUEST'||l==='SC_CANCEL')window.addEventListener('message',this.$FBRTCScreenSharingController15.bind(this));};k.prototype.$FBRTCScreenSharingController16=function(l){this.$FBRTCScreenSharingController19('SC_RESET_PORT');this.$FBRTCScreenSharingController11=new (c('FBRTCMessageSender'))();this.$FBRTCScreenSharingController1=new (c('FBRTCScreenSharingConnection'))();this.$FBRTCScreenSharingController9=false;this.$FBRTCScreenSharingController12.addListener(this.$FBRTCScreenSharingController20.bind(this,true));};k.prototype.$FBRTCScreenSharingController23=function(l){var m=JSON.parse(l.payload);switch(l.msg_type){case c('FBRTCConstants').PayloadType.ICE_CANDIDATE:this.$FBRTCScreenSharingController1.onReceivedRemoteIceCandidate(m);break;case c('FBRTCConstants').PayloadType.ANSWER:c('FBRTCScreenSharingUI').hideRingingOverlay();this.$FBRTCScreenSharingController1.onReceivedAnswerSDP(m.sdp);break;case c('FBRTCConstants').PayloadType.HANGUP:this.onDirectScreenSharingEndSession();break;default:break;}};k.prototype.$FBRTCScreenSharingController15=function(event){if(event.origin!=window.location.origin)return;if(!event.data.recipient||event.data.recipient!='SC_DOM')return;if(!event.data.type)return;if(event.data.type==='SC_EXT_INSTALLED')return;window.removeEventListener('message',this.$FBRTCScreenSharingController2,false);switch(event.data.type){case 'SC_DIALOG_SUCCESS':this.$FBRTCScreenSharingController24(event.data.streamId);break;case 'SC_DIALOG_CANCEL':break;case 'SC_CANCELLED':this.$FBRTCScreenSharingController10.logAction(this.$FBRTCScreenSharingController13,this.$FBRTCScreenSharingController14,c('FBRTCScreenSharingLogger').Action.SCREEN_SHARING_CANCELLED,this.$FBRTCScreenSharingController3);this.$FBRTCScreenSharingController17();break;default:this.$FBRTCScreenSharingController10.logToConsole(this.$FBRTCScreenSharingController13,this.$FBRTCScreenSharingController14,'Unexpected event type');}};k.prototype.$FBRTCScreenSharingController24=function(l){if(this.$FBRTCScreenSharingController6&&!this.$FBRTCScreenSharingController3){this.$FBRTCScreenSharingController10.logToConsole(this.$FBRTCScreenSharingController13,this.$FBRTCScreenSharingController14,'Screen sharing already enabled, do nothing');return;}this.$FBRTCScreenSharingController12.onStart(l);if(this.$FBRTCScreenSharingController12.isEnabled())c('FBRTCScreenMedia').requestScreenMedia(l);};k.prototype.$FBRTCScreenSharingController17=function(){if(!this.$FBRTCScreenSharingController6){this.$FBRTCScreenSharingController10.logToConsole(this.$FBRTCScreenSharingController13,this.$FBRTCScreenSharingController14,'Screen sharing already disabled, do nothing');return;}this.$FBRTCScreenSharingController10.logAction(this.$FBRTCScreenSharingController13,this.$FBRTCScreenSharingController14,c('FBRTCScreenSharingLogger').Action.SCREEN_SHARING_DISABLED,this.$FBRTCScreenSharingController3);this.$FBRTCScreenSharingController6=false;this.__emitChange();};k.prototype.$FBRTCScreenSharingController25=function(l){this.$FBRTCScreenSharingController6=!!l.stream;this.$FBRTCScreenSharingController12.setStream(l.stream,false);if(this.$FBRTCScreenSharingController3){this.$FBRTCScreenSharingController1.setStream(this.$FBRTCScreenSharingController12.getStream());if(this.$FBRTCScreenSharingController7){this.$FBRTCScreenSharingController1.createSdpUpdate();}else this.$FBRTCScreenSharingController1.createOffer();}this.$FBRTCScreenSharingController10.logAction(this.$FBRTCScreenSharingController13,this.$FBRTCScreenSharingController14,c('FBRTCScreenSharingLogger').Action.SCREEN_SHARING_ENABLED,this.$FBRTCScreenSharingController3);this.__emitChange();};k.prototype.$FBRTCScreenSharingController26=function(l){this.$FBRTCScreenSharingController10.logError(this.$FBRTCScreenSharingController13,this.$FBRTCScreenSharingController14,this.$FBRTCScreenSharingController3,'Failed retrieving the screen stream with error: '+l.error);};k.prototype.$FBRTCScreenSharingController27=function(l){if(l&&l.candidate){l.isDirectScreenShareFromRecipient=this.$FBRTCScreenSharingController4;this.$FBRTCScreenSharingController11.sendIceCandidate(this.$FBRTCScreenSharingController13,this.$FBRTCScreenSharingController14,l);}};k.prototype.$FBRTCScreenSharingController28=function(l){this.$FBRTCScreenSharingController11.sendOffer(this.$FBRTCScreenSharingController13,this.$FBRTCScreenSharingController14,l,false,{isDirectScreenShareFromRecipient:this.$FBRTCScreenSharingController4});};k.prototype.$FBRTCScreenSharingController29=function(l){this.$FBRTCScreenSharingController11.sendAnswer(this.$FBRTCScreenSharingController13,this.$FBRTCScreenSharingController14,l,false,{isDirectScreenShareFromRecipient:this.$FBRTCScreenSharingController4});};k.prototype.$FBRTCScreenSharingController21=function(){this.$FBRTCScreenSharingController11.sendHangup(this.$FBRTCScreenSharingController13,this.$FBRTCScreenSharingController14,c('FBRTCConstants').CallEndReason.HANGUP_CALL,true,'DirectScreenSharing');};k.prototype.$FBRTCScreenSharingController30=function(l){this.$FBRTCScreenSharingController11.sendSdpUpdate(this.$FBRTCScreenSharingController13,this.$FBRTCScreenSharingController14,l,true,{isDirectScreenShareFromRecipient:this.$FBRTCScreenSharingController4});};k.prototype.$FBRTCScreenSharingController31=function(){var l=this.$FBRTCScreenSharingController8;if(l)l.drainQueue(this.$FBRTCScreenSharingController13,this.$FBRTCScreenSharingController32.bind(this));};k.prototype.$FBRTCScreenSharingController32=function(l){var m=JSON.parse(l.payload);this.$FBRTCScreenSharingController1.onReceivedRemoteIceCandidate(m);};k.prototype.$FBRTCScreenSharingController33=function(l){switch(l.description.type){case c('FBRTCConstants').PayloadType.OFFER:this.$FBRTCScreenSharingController34(l.description.sdp);break;case c('FBRTCConstants').PayloadType.ANSWER:this.$FBRTCScreenSharingController35(l.description.sdp);break;case c('FBRTCConstants').PayloadType.SDP_UPDATE:this.$FBRTCScreenSharingController36(l.description.sdp);break;default:break;}};k.prototype.$FBRTCScreenSharingController34=function(l){c('FBRTCScreenSharingUI').open(c('FBRTCScreenSharingConstants').UITypes.DIRECT_SENDER,this.$FBRTCScreenSharingController12.getStream(),this.$FBRTCScreenSharingController13);this.$FBRTCScreenSharingController28(l);};k.prototype.$FBRTCScreenSharingController35=function(l){this.$FBRTCScreenSharingController29(l);if(!this.$FBRTCScreenSharingController9)this.$FBRTCScreenSharingController31();};k.prototype.$FBRTCScreenSharingController36=function(l){c('FBRTCScreenSharingUI').switchScreen(c('FBRTCScreenSharingConstants').UITypes.DIRECT_SENDER,this.$FBRTCScreenSharingController12.getStream());this.$FBRTCScreenSharingController7=false;this.$FBRTCScreenSharingController30(l);};k.prototype.$FBRTCScreenSharingController37=function(l){if(!this.$FBRTCScreenSharingController4)return;this.$FBRTCScreenSharingController12.setStream(l.stream,true,true);if(this.$FBRTCScreenSharingController7){c('FBRTCScreenSharingUI').switchScreen(c('FBRTCScreenSharingConstants').UITypes.DIRECT_RECIPIENT,this.$FBRTCScreenSharingController12.getStream());this.$FBRTCScreenSharingController7=false;}else c('FBRTCScreenSharingUI').open(c('FBRTCScreenSharingConstants').UITypes.DIRECT_RECIPIENT,this.$FBRTCScreenSharingController12.getStream(),this.$FBRTCScreenSharingController13);};k.prototype.$FBRTCScreenSharingController38=function(l){if(!this.$FBRTCScreenSharingController9)this.$FBRTCScreenSharingController27(l.candidate);};k.prototype.$FBRTCScreenSharingController39=function(){c('FBRTCMessageListener').removeMessageHandler();c('FBRTCMessageListener').init(false,this.$FBRTCScreenSharingController13);c('FBRTCMessageListener').setMessageHandler(this.$FBRTCScreenSharingController23,this);};k.prototype.__onDispatch=function(l){if(this.$FBRTCScreenSharingController5)return;switch(l.type){case c('FBRTCScreenMedia').Types.STREAM_READY:this.$FBRTCScreenSharingController25(l);break;case c('FBRTCScreenMedia').Types.STREAM_FAILED:this.$FBRTCScreenSharingController26(l);break;case c('FBRTCScreenSharingActions').ConnectionEventTypes.SDP_CREATED:this.$FBRTCScreenSharingController33(l);break;case c('FBRTCScreenSharingActions').ConnectionEventTypes.REMOTE_STREAM_ADDED:this.$FBRTCScreenSharingController37(l);break;case c('FBRTCScreenSharingActions').ConnectionEventTypes.LOCAL_ICE_CANDIDATE_CREATED:this.$FBRTCScreenSharingController38(l);break;case c('FBRTCScreenSharingActions').ControlEventTypes.END_SESSION:this.onDirectScreenSharingEndSession();break;case c('FBRTCScreenSharingActions').ControlEventTypes.SWITCH_SCREEN:this.$FBRTCScreenSharingController22();break;case c('FBRTCScreenSharingActions').ConnectionEventTypes.OFFER_ACK_RECEIVED:this.$FBRTCScreenSharingController39();break;case c('FBRTCScreenSharingActions').ConnectionEventTypes.REMOTE_DESCRIPTION_SET:break;default:break;}};f.exports=k;},null);
__d("XVideoCallTurnDiscoveryController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/videocall\/turndiscovery\/",{version:{type:"Int",required:true}});},null);
__d('FBRTCTurnDiscovery',['FBRTCLogger','FBRTCUtils','XVideoCallTurnDiscoveryController','mixInEventEmitter'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=3,i={requestTurnCreds:function(j,k){if(this._turnCreds)this.emit('receivedTurnCreds',this._turnCreds);if(k===undefined)k=h;var l=1,m=c('XVideoCallTurnDiscoveryController').getURIBuilder().setInt('version',l).getURI();c('FBRTCUtils').sendServerRequest(m,this._onServerRequestSuccess.bind(this),this._onServerRequestFailure.bind(this,j,k));},_onServerRequestSuccess:function(j){this._turnCreds=j.payload;this.emit('receivedTurnCreds',this._turnCreds);},_onServerRequestFailure:function(j,k,l){if(k>0){c('FBRTCLogger').getInstance().logError(j.peerID,j.callID,'Failed turn; going to retry');this.requestTurnCreds(j,k-1);}else this.emit('failed');}};c('mixInEventEmitter')(i,{receivedTurnCreds:true,failed:true});f.exports=i;},null);
__d('FBRTCStreamTester',['mixInEventEmitter','FBRTCUtils'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=100,i=30;function j(k){'use strict';if(!k)k={};this.$FBRTCStreamTester1=k.retries||i;this.$FBRTCStreamTester2=k.testInterval||h;this.$FBRTCStreamTester3=null;this.$FBRTCStreamTester4=null;this.$FBRTCStreamTester5=false;}j.prototype.testStream=function(k,l){'use strict';this.$FBRTCStreamTester3=k;if(!l){this.$FBRTCStreamTester5=true;this.$FBRTCStreamTester4=document.createElement('video');this.$FBRTCStreamTester4.muted=true;c('FBRTCUtils').attachMediaStream(this.$FBRTCStreamTester4,this.$FBRTCStreamTester3);this.$FBRTCStreamTester4.play();}else{this.$FBRTCStreamTester5=false;this.$FBRTCStreamTester4=l;}this.$FBRTCStreamTester6(this.$FBRTCStreamTester1);};j.prototype.$FBRTCStreamTester6=function(k){'use strict';if(this.$FBRTCStreamTester3.getVideoTracks().length===0||this.$FBRTCStreamTester4.currentTime>0){this.$FBRTCStreamTester7();this.emit('streamWorking');}else if(k<1){this.$FBRTCStreamTester7();this.emit('streamBroken');}else setTimeout(this.$FBRTCStreamTester6.bind(this,k-1),this.$FBRTCStreamTester2);};j.prototype.$FBRTCStreamTester7=function(){'use strict';if(this.$FBRTCStreamTester5)this.$FBRTCStreamTester4.pause();this.$FBRTCStreamTester4=null;this.$FBRTCStreamTester3=null;};c('mixInEventEmitter')(j,{streamWorking:true,streamBroken:true});f.exports=j;},null);
__d('FBRTCUserMedia',['mixInEventEmitter','FBRTCConstants','FBRTCLogger','FBRTCStreamTester','FBRTCStreamWrapper','FBRTCUserMediaRequest'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={_localStream:null,_accessGranted:false,_pendingRequest:null,_failedVideoSources:[],_failedAudioSources:[],requestUserMedia:function(i,j,k,l){if(this._localStream&&!k&&!l){this.emit('streamReady',this._localStream);}else{this._startRequestListeners();this._pendingRequest=new (c('FBRTCUserMediaRequest'))(i,j);this._pendingRequest.audioSource=k;this._pendingRequest.videoSource=l;this._pendingRequest.addListener('success',this._onRequestSuccess,this);this._pendingRequest.addListener('failed',this._onRequestFailure,this);this._pendingRequest.request();}},end:function(){this._stopEventListeners();if(this._localStream){c('FBRTCStreamWrapper').stopStream(this._localStream);this._localStream=null;}},_startRequestListeners:function(){if(navigator.mozGetUserMedia){this._evListener=this._onMediaPromptHidden.bind(this);document.addEventListener('mousedown',this._evListener);document.addEventListener('focus',this._evListener);}},_stopEventListeners:function(){if(navigator.mozGetUserMedia){if(this._promptTimeout)clearTimeout(this._promptTimeout);document.removeEventListener('mousedown',this._evListener);document.removeEventListener('focus',this._evListener);}},_onMediaPromptHidden:function(){this._promptTimeout=setTimeout(function(){if(!this._accessGranted&&this._pendingRequest)this._pendingRequest.request();}.bind(this),1500);},_onRequestSuccess:function(i){this._stopEventListeners();if(!this._accessGranted){this._accessGranted=true;this.emit('accessGranted');}i.videoMediaSourceId=this._pendingRequest.videoSource;i.audioMediaSourceId=this._pendingRequest.audioSource;var j=new (c('FBRTCStreamTester'))();j.addListener('streamWorking',function(){this._pendingRequest=null;if(this._localStream&&this._localStream!==i)c('FBRTCStreamWrapper').stopStream(this._localStream);this._localStream=i;this.emit('streamReady',this._localStream);}.bind(this));j.addListener('streamBroken',function(){c('FBRTCStreamWrapper').stopStream(i);this._onRequestFailure('StreamFailedToStart');}.bind(this));j.testStream(i);},_onRequestFailure:function(i){this._stopEventListeners();var j=this._getErrorName(i);if(this._shouldRetryRequest(j,this._pendingRequest)){this._configureRequestForRetry(this._pendingRequest,j);return;}if(j==='InvalidStateError'){c('FBRTCLogger').getInstance().logErrorWithoutID('Invalid state while requesting user media');return;}this._pendingRequest=null;if(j==='PERMISSION_DENIED'||j==='PermissionDeniedError'||j==='PermissionDismissedError'){this.emit('accessDenied',j);}else{if(j==='NO_DEVICES_FOUND')j='DevicesNotFoundError';c('FBRTCLogger').getInstance().logErrorWithoutID('getUserMedia error: '+j);this.emit('accessFailed',j);}},_getErrorName:function(i){if(i.name)return i.name;return i;},_shouldRetryRequest:function(i,j){return j.streamType!==c('FBRTCConstants').StreamType.AUDIO_ONLY&&(i==='DevicesNotFoundError'||i==='StreamFailedToStart');},_configureRequestForRetry:function(i,j){if(j==='StreamFailedToStart'&&window.MediaStreamTrack&&window.MediaStreamTrack.getSources){if(i.videoSource)this._failedVideoSources.push(i.videoSource);window.MediaStreamTrack.getSources(function(k){for(var l=0;l<k.length;l++){var m=k[l];if(m.kind==='video'&&this._failedVideoSources.indexOf(m.id)===-1){i.videoSource=m.id;i.request();return;}}i.streamType=c('FBRTCConstants').StreamType.AUDIO_ONLY;i.request();}.bind(this));}else{i.streamType=c('FBRTCConstants').StreamType.AUDIO_ONLY;i.request();}}};c('mixInEventEmitter')(h,{streamReady:true,accessGranted:true,accessDenied:true,accessFailed:true});f.exports=h;},null);
__d('FBRTCVideoEscalationStore',['FBRTCCallControlActions','FBRTCConstants','FBRTCStore','keyMirror'],function a(b,c,d,e,f,g){'use strict';var h,i;if(c.__markCompiled)c.__markCompiled();var j=25000,k=10000,l=c('keyMirror')({direct_video:null,escalated:null,escalation_declined:null,voip:null});h=babelHelpers.inherits(m,c('FBRTCStore'));i=h&&h.prototype;function m(n,o,p){i.constructor.call(this);this.$FBRTCVideoEscalationStore7=n;this.$FBRTCVideoEscalationStore2=o;this.$FBRTCVideoEscalationStore1=p;this.$FBRTCVideoEscalationStore4=p;this.$FBRTCVideoEscalationStore3=false;this.$FBRTCVideoEscalationStore5=null;this.$FBRTCVideoEscalationStore8=null;}m.prototype.isPending=function(){return !!this.$FBRTCVideoEscalationStore5;};m.prototype.callHasEscalated=function(){return this.$FBRTCVideoEscalationStore1;};m.prototype.getCallType=function(){if(!this.$FBRTCVideoEscalationStore2.isRemoteVideoSupported){return l.voip;}else if(this.$FBRTCVideoEscalationStore4){return l.direct_video;}else if(this.$FBRTCVideoEscalationStore1){return l.escalated;}else if(this.$FBRTCVideoEscalationStore3)return l.escalation_declined;return l.voip;};m.prototype.__onDispatch=function(n){switch(n.type){case c('FBRTCCallControlActions').Types.RECEIVED_SIGNALING_MESSAGE:var o=n.message;if(n.message_type===c('FBRTCConstants').PayloadType.VIDEO_REQUEST){this.$FBRTCVideoEscalationStore3=true;if(o.ackID){this.$FBRTCVideoEscalationStore10(o);}else this.$FBRTCVideoEscalationStore11(o);}if(n.message_type===c('FBRTCConstants').PayloadType.ACK&&o.msg.ack_type===c('FBRTCConstants').PayloadType.VIDEO_REQUEST)this.$FBRTCVideoEscalationStore12(o);break;case c('FBRTCCallControlActions').Types.ACCEPT_ESCALATION:this.$FBRTCVideoEscalationStore13(true);break;case c('FBRTCCallControlActions').Types.DECLINE_ESCALATION:this.$FBRTCVideoEscalationStore13(false);break;case c('FBRTCCallControlActions').Types.TOGGLE_MUTE_VIDEO:this.$FBRTCVideoEscalationStore3=true;this.getDispatcher().waitFor([this.$FBRTCVideoEscalationStore2.getDispatchToken()]);this.$FBRTCVideoEscalationStore14();break;}};m.prototype.$FBRTCVideoEscalationStore12=function(n){if(this.$FBRTCVideoEscalationStore8&&this.$FBRTCVideoEscalationStore8.msg_id===n.ackID)this.$FBRTCVideoEscalationStore15();};m.prototype.$FBRTCVideoEscalationStore15=function(){clearTimeout(this.$FBRTCVideoEscalationStore6);};m.prototype.$FBRTCVideoEscalationStore16=function(){this.$FBRTCVideoEscalationStore6=setTimeout(function(){if(!this.$FBRTCVideoEscalationStore8)return;this.$FBRTCVideoEscalationStore7.resendPayload(this.$FBRTCVideoEscalationStore2.peerID,this.$FBRTCVideoEscalationStore8);}.bind(this),k);};m.prototype.$FBRTCVideoEscalationStore10=function(n){if(!this.$FBRTCVideoEscalationStore8||n.ackID!==this.$FBRTCVideoEscalationStore8.msg_id)return;clearTimeout(this.$FBRTCVideoEscalationStore9);this.$FBRTCVideoEscalationStore15();var o=n.msg,p=n.peerID,q=n.callID,r=this.$FBRTCVideoEscalationStore17(o);this.$FBRTCVideoEscalationStore7.sendAck(p,q,o);this.$FBRTCVideoEscalationStore8=null;this.$FBRTCVideoEscalationStore1=r;this.$FBRTCVideoEscalationStore18(r);if(!r&&this.$FBRTCVideoEscalationStore2.localStream.hasVideo())this.$FBRTCVideoEscalationStore2.localStream.toggleMuteVideo();this.__emitChange();};m.prototype.$FBRTCVideoEscalationStore11=function(n){if(this.$FBRTCVideoEscalationStore1){if(this.$FBRTCVideoEscalationStore17(n.msg)){this.$FBRTCVideoEscalationStore5=n;this.$FBRTCVideoEscalationStore13(true);}else this.$FBRTCVideoEscalationStore2.remoteStream.setVideoEnabled(false);return;}var o=n.msg,p=n.peerID,q=n.callID;this.$FBRTCVideoEscalationStore7.sendAck(p,q,o);if(this.$FBRTCVideoEscalationStore17(o)){this.$FBRTCVideoEscalationStore5=n;this.$FBRTCVideoEscalationStore9=setTimeout(function(){c('FBRTCCallControlActions').declineEscalation();},j);}else this.$FBRTCVideoEscalationStore5=null;this.__emitChange();};m.prototype.$FBRTCVideoEscalationStore13=function(n){clearTimeout(this.$FBRTCVideoEscalationStore9);if(this.$FBRTCVideoEscalationStore5){var o=this.$FBRTCVideoEscalationStore5,p=o.peerID,q=o.callID,r=o.msgID;this.$FBRTCVideoEscalationStore8=this.$FBRTCVideoEscalationStore7.sendVideoRequestResponse(p,q,r,n);this.$FBRTCVideoEscalationStore16();this.$FBRTCVideoEscalationStore1=n;this.$FBRTCVideoEscalationStore5=null;this.__emitChange();}};m.prototype.$FBRTCVideoEscalationStore14=function(){if(this.$FBRTCVideoEscalationStore1){this.$FBRTCVideoEscalationStore19();return;}this.$FBRTCVideoEscalationStore8=this.$FBRTCVideoEscalationStore7.sendVideoEscalationRequest(this.$FBRTCVideoEscalationStore2.peerID,this.$FBRTCVideoEscalationStore2.callID,this.$FBRTCVideoEscalationStore2.localStream.hasVideo());if(this.$FBRTCVideoEscalationStore2.localStream.hasVideo()){this.$FBRTCVideoEscalationStore16();this.$FBRTCVideoEscalationStore9=setTimeout(function(){if(this.$FBRTCVideoEscalationStore2.localStream.hasVideo())c('FBRTCCallControlActions').toggleMuteVideo();}.bind(this),j);}else{this.$FBRTCVideoEscalationStore15();clearTimeout(this.$FBRTCVideoEscalationStore9);this.$FBRTCVideoEscalationStore8=null;}this.__emitChange();};m.prototype.$FBRTCVideoEscalationStore19=function(){if(!this.$FBRTCVideoEscalationStore2.isRemoteVideoSupported)return;this.$FBRTCVideoEscalationStore7.sendMuteStateUpdate(this.$FBRTCVideoEscalationStore2.peerID,this.$FBRTCVideoEscalationStore2.callID,this.$FBRTCVideoEscalationStore2.localStream.hasVideo());};m.prototype.$FBRTCVideoEscalationStore18=function(n){this.$FBRTCVideoEscalationStore2.remoteStream.setVideoEnabled(n);};m.prototype.$FBRTCVideoEscalationStore17=function(n){return !!(n.reqVideoOn||n.videoon);};f.exports=m;},null);
__d('FBRTCRingback',['RTCConfig','Sound','FBRTCCallModel'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=[c('RTCConfig').ringback_mp3_url,c('RTCConfig').ringback_ogg_url],i={monitorCallModel:function(j){if(this._subscription)this._subscription.remove();this._callModel=j;this._subscription=j.addListener(this._onChange.bind(this));},_soundIsPlaying:false,_onChange:function(){if(this._callModel.uiState===c('FBRTCCallModel').UIState.RINGING){this._startSound();}else this._stopSound();},_startSound:function(){if(!this._soundIsPlaying){c('Sound').play(h,this._syncToken(),true);this._soundIsPlaying=true;}},_syncToken:function(){return 'ring_back_'+this._callModel.callID.toString();},_stopSound:function(){if(this._soundIsPlaying){c('Sound').stop(h);this._soundIsPlaying=false;}}};f.exports=i;},null);
__d('FBRTCStarRatingStore',['FBRTCLogger','FBRTCStore','FBRTCStarRatingActions'],function a(b,c,d,e,f,g){'use strict';var h,i;if(c.__markCompiled)c.__markCompiled();h=babelHelpers.inherits(j,c('FBRTCStore'));i=h&&h.prototype;function j(k,l){i.constructor.call(this);this.$FBRTCStarRatingStore1=k;this.$FBRTCStarRatingStore2=l;}j.prototype.setCallSummary=function(k){this.$FBRTCStarRatingStore1=k;};j.prototype.__onDispatch=function(k){switch(k.type){case c('FBRTCStarRatingActions').Types.SUBMIT_RATING:this.$FBRTCStarRatingStore3(k.rating);break;case c('FBRTCStarRatingActions').Types.SUBMIT_FEEDBACK:this.$FBRTCStarRatingStore4(k.feedback);break;case c('FBRTCStarRatingActions').Types.RATING_SHOWN:this.$FBRTCStarRatingStore5();break;}};j.prototype.$FBRTCStarRatingStore3=function(k){this.$FBRTCStarRatingStore1.addExtraInfo(c('FBRTCLogger').Key.RATING,k);this.$FBRTCStarRatingStore1.save(this.$FBRTCStarRatingStore2);};j.prototype.$FBRTCStarRatingStore4=function(k){this.$FBRTCStarRatingStore1.addExtraInfo(c('FBRTCLogger').Key.SURVEY_DETAILS,k);this.$FBRTCStarRatingStore1.save(this.$FBRTCStarRatingStore2);};j.prototype.$FBRTCStarRatingStore5=function(){this.$FBRTCStarRatingStore1.addExtraInfo(c('FBRTCLogger').Key.RATING_SHOWN,'1');this.$FBRTCStarRatingStore1.save(this.$FBRTCStarRatingStore2);};f.exports=j;},null);
__d('FBRTCViewController',['FBRTCCallModel','FBRTCConstants','FBRTCLogger','FBRTCRingback','FBRTCScreenSharingUI','FBRTCStarRatingStore'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=500;function i(j,k,l){'use strict';this.$FBRTCViewController1=j;this.$FBRTCViewController2=new (c('FBRTCStarRatingStore'))(k,l);this.$FBRTCViewController3=false;this.$FBRTCViewController4=c('FBRTCLogger').getInstance();}i.prototype.init=function(){'use strict';c('FBRTCRingback').monitorCallModel(this.$FBRTCViewController1);this.$FBRTCViewController1.fetchPeerInfo();};i.prototype.onLocalStreamReady=function(j){'use strict';this.$FBRTCViewController1.setLocalStream(j);if(this.$FBRTCViewController1.uiState>c('FBRTCCallModel').UIState.MORE_INIT){this.$FBRTCViewController4.logInfo(this.$FBRTCViewController1.peerID,this.$FBRTCViewController1.callID,'UI: Already @ MORE_INIT, no update');}else if(this.$FBRTCViewController1.canStartCall()&&!this.$FBRTCViewController1.isCaller){this.$FBRTCViewController1.setState(c('FBRTCCallModel').UIState.CALL_CONNECTING);}else this.$FBRTCViewController1.setState(c('FBRTCCallModel').UIState.MORE_INIT);};i.prototype.waitForUserInput=function(){'use strict';this.$FBRTCViewController1.setStateFrom(c('FBRTCCallModel').UIState.INIT,c('FBRTCCallModel').UIState.AWAITING_USER_START);};i.prototype.userMediaRequested=function(){'use strict';setTimeout(function(){this.$FBRTCViewController1.setStateFrom(c('FBRTCCallModel').UIState.INIT,c('FBRTCCallModel').UIState.PENDING_LOCAL_MEDIA);}.bind(this),h);};i.prototype.userMediaGranted=function(){'use strict';this.$FBRTCViewController1.setState(c('FBRTCCallModel').UIState.MORE_INIT);};i.prototype.userMediaDenied=function(){'use strict';this.$FBRTCViewController1.setState(c('FBRTCCallModel').UIState.USER_MEDIA_DENIED);};i.prototype.onTurnCredentialsReady=function(j){'use strict';if(!this.$FBRTCViewController1.isCaller)this.$FBRTCViewController1.setStateFrom(c('FBRTCCallModel').UIState.MORE_INIT,c('FBRTCCallModel').UIState.CALL_CONNECTING);};i.prototype.onMessageTypeSent=function(j){'use strict';if(j!==c('FBRTCConstants').PayloadType.OFFER&&j!==c('FBRTCConstants').PayloadType.PCRESTART_OFFER)return;if(j===c('FBRTCConstants').PayloadType.PCRESTART_OFFER)this.$FBRTCViewController3=true;if(j===c('FBRTCConstants').PayloadType.OFFER)this.$FBRTCViewController1.setState(c('FBRTCCallModel').UIState.CONTACTING);};i.prototype.onMessageTypeReceived=function(j){'use strict';if(this.$FBRTCViewController3){if(j===c('FBRTCConstants').PayloadType.ANSWER)this.$FBRTCViewController1.setStateFrom(c('FBRTCCallModel').UIState.CONTACTING,c('FBRTCCallModel').UIState.CALL_CONNECTING);}else if(j===c('FBRTCConstants').PayloadType.OFFER_ACK){this.$FBRTCViewController1.setStateFrom(c('FBRTCCallModel').UIState.CONTACTING,c('FBRTCCallModel').UIState.RINGING);}else if(j===c('FBRTCConstants').PayloadType.ANSWER)if(this.$FBRTCViewController1.uiState===c('FBRTCCallModel').UIState.CONTACTING||this.$FBRTCViewController1.uiState===c('FBRTCCallModel').UIState.RINGING)this.$FBRTCViewController1.setState(c('FBRTCCallModel').UIState.CALL_CONNECTING);};i.prototype.onRemoteStreamAdded=function(event){'use strict';this.$FBRTCViewController1.setRemoteStream(event.stream);};i.prototype.end=function(j,k){'use strict';this.$FBRTCViewController1.endCallReason=j;this.$FBRTCViewController1.isRemoteEnded=k;this.$FBRTCViewController1.setState(c('FBRTCCallModel').UIState.CALL_ENDED);};i.prototype.reset=function(j,k){'use strict';this.$FBRTCViewController1.resetForReconnect(j);this.$FBRTCViewController2.setCallSummary(k);this.$FBRTCViewController1.setState(c('FBRTCCallModel').UIState.CALL_CONNECTING);};i.prototype.$FBRTCViewController5=function(j,k){'use strict';this.$FBRTCViewController4.logCallAction(this.$FBRTCViewController1.peerID,this.$FBRTCViewController1.callID,j,k?'true':'false');};f.exports=i;},null);
__d("FBRTCWindowManager",[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={height:0,width:0,top:0,left:0},i={height:447,width:675,bottomRightOffset:50},j={init:function(k,l){this._window=k;this._callModel=l;l.addListener(this._setProgressIndicator.bind(this));this._setProgressIndicator();this._monitorOpenerForChanges();this._storePosition();},updatePosition:function(k){if(!this._window)return;if(k&&h.height>0&&h.width>0){this._window.moveTo(h.left,h.top);this._window.resizeTo(h.width,h.height);return;}this._storePosition();this._window.resizeTo(i.width,i.height);var l=screen.width-i.width-i.bottomRightOffset,m=screen.height-i.height-i.bottomRightOffset;this._window.moveTo(l,m);},reload:function(){if(this._window&&!this._window.closed)this._window.location.reload();},close:function(){if(this._window&&!this._window.closed)this._window.close();},_setProgressIndicator:function(){if(this._callModel.isEnded()){this._window.rtcCallInProgessWith=null;}else this._window.rtcCallInProgessWith=this._callModel.peerID.toString();},_monitorOpenerForChanges:function(){if(this._window.opener)try{this._window.opener.addEventListener("unload",function(event){this._passWindowToOpener(10);}.bind(this));}catch(k){}},_passWindowToOpener:function(k){setTimeout(function(){setTimeout(function(){if(this._window.opener&&!this._window.opener.closed)this._window.opener.rtcCallChildWindow=this._window;}.bind(this),1);if(k>1)this._passWindowToOpener(k-1);}.bind(this),1000);},_storePosition:function(){if(this._window){if(this._window.innerWidth!==undefined){h.height=this._window.outerHeight;h.width=this._window.outerWidth;}else{h.height=this._window.screen.height;h.width=this._window.screen.width;}if(this._window.screenLeft!==undefined){h.left=this._window.screenLeft;h.top=this._window.screenTop;}else{h.left=this._window.screenX;h.top=this._window.screenY;}}}};f.exports=j;},null);
__d('FBRTCCallController',['fbt','ChannelManager','ErrorUtils','Run','FBRTCCallConnection','FBRTCCallConnectionMonitor','FBRTCCallControlActions','FBRTCCallModel','FBRTCCallMonitor','FBRTCCallSummary','FBRTCCallSummaryStore','FBRTCConfig','FBRTCConstants','FBRTCDispatcher','FBRTCExperiment','FBRTCIceCache','FBRTCLocalMessageQueue','FBRTCLogger','FBRTCMessage','FBRTCMessageDedup','FBRTCMessageListener','FBRTCMessageSender','FBRTCPCConfig','FBRTCTurnDiscovery','FBRTCUserMedia','FBRTCViewController','FBRTCCallModelStatePusher','FBRTCCallDialogController','FBRTCRetriableMessage','FBRTCUserSettings','FBRTCScreenSharingController','FBRTCScreenSharingUtils','FBRTCSdpUtils','FBRTCUrlManager','FBRTCUtils','FBRTCVideoEscalationStore','FBRTCWindowManager','RTCConfig','randomInt'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();c('ChannelManager');var i=60000,j=3000;function k(){return c('randomInt')(0,4294967295);}function l(m,n,o,p){'use strict';this.$FBRTCCallController1=c('FBRTCLogger').getInstance();this.$FBRTCCallController2=new (c('FBRTCLocalMessageQueue'))();this.$FBRTCCallController3=c('FBRTCCallSummaryStore').getInstance();this.$FBRTCCallController4=null;this.$FBRTCCallController5=false;if(!o){var q=this.$FBRTCCallController2.getOffer(m);if(q){this.$FBRTCCallController4=new (c('FBRTCMessage'))(q);c('FBRTCMessageDedup').check(m,this.$FBRTCCallController4.callID,this.$FBRTCCallController4.msgID);}else o=true;}if(!n)n=this.$FBRTCCallController4?this.$FBRTCCallController4.callID:k();this.$FBRTCCallController1.logCallAction(m,n,c('FBRTCLogger').CallAction.POPUP_OPENED);this.$FBRTCCallController6=new (c('FBRTCCallModel'))({peerID:m,callID:n,isCaller:o});if(this.$FBRTCCallController4)this.$FBRTCCallController6.onSDPMessageFromPeer(this.$FBRTCCallController4);this.$FBRTCCallController6.localStream.setVideoEnabled(!p);this.$FBRTCCallController7=new (c('FBRTCCallModelStatePusher'))(this.$FBRTCCallController6);this.$FBRTCCallController8=c('FBRTCCallSummary').restoreOrInitialize(this.$FBRTCCallController3,m,n,o,this.$FBRTCCallController4&&this.$FBRTCCallController4.msg);this.$FBRTCCallController8.onPopupOpened();c('FBRTCUrlManager').init(this.$FBRTCCallController6.peerID);c('FBRTCWindowManager').init(window,this.$FBRTCCallController6);this.$FBRTCCallController9=new (c('FBRTCScreenSharingController'))(m,n,false);if(c('FBRTCScreenSharingUtils').isScreenSharingSupported())this.$FBRTCCallController9.addListener(this.$FBRTCCallController10.bind(this));this.$FBRTCCallController11=new (c('FBRTCViewController'))(this.$FBRTCCallController6,this.$FBRTCCallController8,this.$FBRTCCallController3);this.$FBRTCCallController11.init();this.$FBRTCCallController12=new (c('FBRTCCallConnection'))();this.$FBRTCCallController12.addListener('remoteStreamAdded',this.$FBRTCCallController13,this);this.$FBRTCCallController12.addListener('remoteStreamRemoved',this.$FBRTCCallController14,this);this.$FBRTCCallController12.addListener('sdpCreated',this.$FBRTCCallController15,this);this.$FBRTCCallController12.addListener('localIceCandidateCreated',this.$FBRTCCallController16,this);this.$FBRTCCallController12.addListener('remoteDescriptionSet',this.$FBRTCCallController17,this);this.$FBRTCCallController12.addListener('connected',this.$FBRTCCallController18,this);this.$FBRTCCallController12.addListener('disconnected',this.$FBRTCCallController19,this);this.$FBRTCCallController12.addListener('connectionUnstable',this.$FBRTCCallController20,this);this.$FBRTCCallController12.addListener('connectionError',this.$FBRTCCallController21,this);this.$FBRTCCallController22=false;this.$FBRTCCallController23=new (c('FBRTCCallConnectionMonitor'))(this.$FBRTCCallController12,this.$FBRTCCallController8);this.$FBRTCCallController23.addListener('connectionPoor',this.$FBRTCCallController24,this);this.$FBRTCCallController25=new (c('FBRTCMessageSender'))();this.$FBRTCCallController25.onMessageSent=this.$FBRTCCallController26.bind(this);this.$FBRTCCallController25.onSendFailure=this.$FBRTCCallController27.bind(this);this.$FBRTCCallController28=null;this.$FBRTCCallController29=null;this.$FBRTCCallController30=new (c('FBRTCVideoEscalationStore'))(this.$FBRTCCallController25,this.$FBRTCCallController6,!p);this.$FBRTCCallController8.setCallType(this.$FBRTCCallController30.getCallType());this.$FBRTCCallController30.addListener(this.$FBRTCCallController31.bind(this));this.$FBRTCCallController32=new (c('FBRTCIceCache'))();this.$FBRTCCallController33=false;c('Run').onBeforeUnload(this.$FBRTCCallController34.bind(this),false);c('Run').onUnload(this.$FBRTCCallController35.bind(this));c('ErrorUtils').addListener(this.$FBRTCCallController36.bind(this),true);c('FBRTCMessageListener').init(true,this.$FBRTCCallController6.peerID);c('FBRTCMessageListener').setMessageHandler(this.$FBRTCCallController37,this);var r=this;this.$FBRTCCallController38=new (c('FBRTCCallMonitor'))(this.$FBRTCCallController6);this.$FBRTCCallController38.startHeartbeat(function(){return r.$FBRTCCallController8;});this.$FBRTCCallController39=null;c('FBRTCUserSettings').addListener('saved',this.$FBRTCCallController40,this);c('FBRTCTurnDiscovery').addListener('receivedTurnCreds',this.$FBRTCCallController41,this);c('FBRTCTurnDiscovery').addListener('failed',this.$FBRTCCallController42,this);c('FBRTCTurnDiscovery').requestTurnCreds(this.$FBRTCCallController6);c('FBRTCDispatcher').register(this.__onDispatch.bind(this));this.$FBRTCCallController43=setTimeout(function(){this.waitForUserInput();}.bind(this),1500);}l.prototype.__onDispatch=function(m){'use strict';switch(m.type){case c('FBRTCCallControlActions').Types.HANG_UP:this.$FBRTCCallController44(c('FBRTCConstants').CallEndReason.HANGUP_CALL,false,true,false);break;case c('FBRTCCallControlActions').Types.TOGGLE_SCREEN_SHARING:if(this.$FBRTCCallController9)this.$FBRTCCallController9.toggleScreenSharing(this.$FBRTCCallController6);break;case c('FBRTCCallControlActions').Types.SHOW_SETTINGS:c('FBRTCCallDialogController').showDialog(c('FBRTCCallDialogController').dialogTypes.SETTINGS,this.$FBRTCCallController6);break;case c('FBRTCCallControlActions').Types.ACCEPT_ESCALATION:this.$FBRTCCallController6.localStream.setVideoEnabled(true);this.$FBRTCCallController45(true);break;case c('FBRTCCallControlActions').Types.RESET_CALL:this.$FBRTCCallController46(m);break;case c('FBRTCCallControlActions').Types.PARENT_WINDOW_START_CALL:if(this.$FBRTCCallController6.canBeStartedByParentWindow())this.startCallProcess();break;case c('FBRTCCallControlActions').Types.START_CALL:this.$FBRTCCallController47(c('FBRTCLogger').Trigger.POPUP_CALL_START_BUTTON);break;}};l.prototype.getCallModel=function(){'use strict';return this.$FBRTCCallController6;};l.prototype.getConnection=function(){'use strict';return this.$FBRTCCallController12;};l.prototype.sendData=function(m,n){'use strict';this.$FBRTCCallController12.sendData({topic:m,data:n});};l.prototype.addDataChannelListener=function(m,n){'use strict';return this.$FBRTCCallController12.addListener('data_message',m,n);};l.prototype.$FBRTCCallController47=function(m){'use strict';this.$FBRTCCallController8.onCallStarted(m);this.startCallProcess();};l.prototype.startCallProcess=function(){'use strict';this.$FBRTCCallController48();this.$FBRTCCallController11.userMediaRequested();};l.prototype.waitForUserInput=function(){'use strict';this.$FBRTCCallController11.waitForUserInput();};l.prototype.$FBRTCCallController48=function(){'use strict';c('FBRTCUserMedia').once('streamReady',this.$FBRTCCallController49,this);c('FBRTCUserMedia').addListener('accessDenied',this.$FBRTCCallController50,this);c('FBRTCUserMedia').addListener('accessFailed',this.$FBRTCCallController51,this);c('FBRTCUserMedia').addListener('accessGranted',this.$FBRTCCallController52,this);this.$FBRTCCallController6.localStream.addListener('streamStarted',function(){var m=this.$FBRTCCallController6.localStream.videoWidth,n=this.$FBRTCCallController6.localStream.videoHeight;this.$FBRTCCallController8.setVideoCaptureStats(m,n);}.bind(this));this.$FBRTCCallController53();};l.prototype.$FBRTCCallController53=function(){'use strict';var m;if(!this.$FBRTCCallController6.isRemoteVideoSupported){m=c('FBRTCConstants').VideoQuality.NO_VIDEO;}else if(this.$FBRTCCallController6.isPeerOnMobile){m=c('FBRTCConstants').VideoQuality.LQ_VIDEO;}else if(c('FBRTCUtils').isCollabCallable(this.$FBRTCCallController6.peerID)){m=c('FBRTCConstants').VideoQuality.CUSTOM_VIDEO;}else if(this.$FBRTCCallController6.isCaller&&this.$FBRTCCallController6.uiState>=c('FBRTCCallModel').UIState.CALL_CONNECTING){var n=c('FBRTCExperiment').gen('rtc_web_video_quality_3'),o=n.getParam('renegotiate_to_hd','no');if(o==='yes'){m=c('FBRTCConstants').VideoQuality.HD_VIDEO;}else m=c('FBRTCConstants').VideoQuality.SD_VIDEO;}else m=c('FBRTCConstants').VideoQuality.SD_VIDEO;var p=c('FBRTCConstants').StreamType.AUDIO_ONLY;if(this.$FBRTCCallController6.localStream&&this.$FBRTCCallController6.localStream.hasVideoTracks())p=c('FBRTCConstants').StreamType.AUDIO_VIDEO;this.$FBRTCCallController54=m;c('FBRTCUserMedia').requestUserMedia(p,m,c('FBRTCUserSettings').savedMic,c('FBRTCUserSettings').savedCamera);};l.prototype.$FBRTCCallController40=function(){'use strict';this.$FBRTCCallController1.logCallAction(this.$FBRTCCallController6.peerID,this.$FBRTCCallController6.callID,c('FBRTCLogger').CallAction.USER_SETTINGS_CHANGED);c('FBRTCUserMedia').once('streamReady',function(m){c('FBRTCUserSettings').updateForLocalStream(m);this.$FBRTCCallController6.setLocalStream(m);this.$FBRTCCallController55();}.bind(this));this.$FBRTCCallController53();};l.prototype.$FBRTCCallController10=function(){'use strict';var m=this.$FBRTCCallController9.isEnabled(),n=this.$FBRTCCallController9.getStream();if(m){this.$FBRTCCallController12.addScreenStream(n);}else{this.$FBRTCCallController12.removeScreenStream(n);this.$FBRTCCallController9.onStop();}this.$FBRTCCallController55();c('FBRTCWindowManager').updatePosition(!m);if(m){this.$FBRTCCallController6.setLocalScreenStream(n);}else this.$FBRTCCallController6.setLocalScreenStream(null);};l.prototype.$FBRTCCallController13=function(event){'use strict';if(this.$FBRTCCallController12.isScreenStream(event.stream)&&this.$FBRTCCallController12.getRemoteStreamsCount()>1){this.$FBRTCCallController9.setRemoteStream(event.stream);this.$FBRTCCallController6.setRemoteScreenStream(this.$FBRTCCallController9.getStream());}else{this.$FBRTCCallController11.onRemoteStreamAdded(event);if(this.$FBRTCCallController6.isCaller&&this.$FBRTCCallController6.supportsSdpUpdate())this.$FBRTCCallController56=setTimeout(function(){this.$FBRTCCallController57();}.bind(this),j);}};l.prototype.$FBRTCCallController57=function(){'use strict';if(!this.$FBRTCCallController6.isRemoteVideoSupported&&this.$FBRTCCallController54===c('FBRTCConstants').VideoQuality.NO_VIDEO){return;}else if(this.$FBRTCCallController6.isPeerOnMobile&&this.$FBRTCCallController54===c('FBRTCConstants').VideoQuality.LQ_VIDEO)return;this.$FBRTCCallController55();};l.prototype.$FBRTCCallController14=function(event){'use strict';var m=this.$FBRTCCallController6.getRemoteScreenStream();if(m&&event.stream&&m.getStreamId()==event.stream.id){this.$FBRTCCallController6.setRemoteScreenStream(null);this.$FBRTCCallController9.setRemoteStream(null);}clearTimeout(this.$FBRTCCallController56);};l.prototype.$FBRTCCallController20=function(){'use strict';this.$FBRTCCallController1.logInfo(this.$FBRTCCallController6.peerID,this.$FBRTCCallController6.callID,'Network unstable');};l.prototype.$FBRTCCallController24=function(){'use strict';this.$FBRTCCallController1.logInfo(this.$FBRTCCallController6.peerID,this.$FBRTCCallController6.callID,'Network poor');if(c('FBRTCConfig').shouldAutoDisableVideo())this.$FBRTCCallController6.autoDisableVideo();};l.prototype.$FBRTCCallController36=function(m){'use strict';var n=m.message+'; '+m.stackFrames[0].identifier;this.$FBRTCCallController1.logError(this.$FBRTCCallController6.peerID,this.$FBRTCCallController6.callID,'JSError: '+n);};l.prototype.$FBRTCCallController34=function(){'use strict';if(this.$FBRTCCallController6.isInProgress())return h._("Leaving this page will end your call.");};l.prototype.$FBRTCCallController35=function(){'use strict';if(this.$FBRTCCallController6.isEnded())return;var m=this.$FBRTCCallController6.isUserMediaPending(),n=this.$FBRTCCallController6.isUserMediaDenied(),o=c('FBRTCConstants').CallEndReason.HANGUP_CALL,p='BrowserClosed';if(m||n){o=c('FBRTCConstants').CallEndReason.CLIENT_ERROR;p=m?'MediaPending':'MediaDenied';}else if(this.$FBRTCCallController6.isAwaitingUserStart())p='AwaitingUserStart';this.$FBRTCCallController44(o,false,true,true,p);};l.prototype.$FBRTCCallController41=function(m){'use strict';this.$FBRTCCallController1.logInfo(this.$FBRTCCallController6.peerID,this.$FBRTCCallController6.callID,'Received Turn Creds');c('FBRTCPCConfig').setTurnCredentials(m);this.$FBRTCCallController11.onTurnCredentialsReady(m);this.$FBRTCCallController58();};l.prototype.$FBRTCCallController42=function(){'use strict';this.$FBRTCCallController1.logError(this.$FBRTCCallController6.peerID,this.$FBRTCCallController6.callID,'Failed to get turn creds');this.$FBRTCCallController44(c('FBRTCConstants').CallEndReason.CLIENT_ERROR,false,!this.$FBRTCCallController6.isCaller,false,'NoTurnCreds');};l.prototype.$FBRTCCallController58=function(){'use strict';if(this.$FBRTCCallController6.canStartCall()){c('FBRTCUrlManager').onCallStarted();var m=this.$FBRTCCallController6.localStream;this.$FBRTCCallController12.init(m);if(!this.$FBRTCCallController4){this.$FBRTCCallController12.createOffer();}else{if(this.$FBRTCCallController4.isFromMobile()&&!m.hasVideoTracks())this.$FBRTCCallController4.disableVideo();if(this.$FBRTCCallController4.msg.hasOwnProperty('videoon'))this.$FBRTCCallController45(this.$FBRTCCallController4.msg.videoon);this.$FBRTCCallController6.setSignalingExperiments(this.$FBRTCCallController4.getSignalingExperiments());this.$FBRTCCallController59(this.$FBRTCCallController4.msg.sdp,true,this.$FBRTCCallController4.msg.attributes);this.$FBRTCCallController2.removeOffer(this.$FBRTCCallController6.peerID);this.$FBRTCCallController4=null;}}};l.prototype.$FBRTCCallController55=function(){'use strict';if(this.$FBRTCCallController6.isAwaitingAnswer()){this.$FBRTCCallController22=true;}else{this.$FBRTCCallController22=false;this.$FBRTCCallController53();if(this.$FBRTCCallController6.supportsSdpUpdate()){this.$FBRTCCallController12.createSdpUpdate(this.$FBRTCCallController6.supportsMultipleStreamsPlanB());}else{this.$FBRTCCallController5=true;this.$FBRTCCallController32.reset(this.$FBRTCCallController6.peerID,this.$FBRTCCallController6.callID);this.$FBRTCCallController33=false;this.$FBRTCCallController12.createOffer();}}};l.prototype.$FBRTCCallController49=function(m){'use strict';c('FBRTCUserSettings').updateForLocalStream(m);this.$FBRTCCallController11.onLocalStreamReady(m);this.$FBRTCCallController58();};l.prototype.$FBRTCCallController50=function(){'use strict';this.$FBRTCCallController1.logCallAction(this.$FBRTCCallController6.peerID,this.$FBRTCCallController6.callID,c('FBRTCLogger').CallAction.DENIED_PERMISSION);this.$FBRTCCallController11.userMediaDenied();};l.prototype.$FBRTCCallController51=function(m){'use strict';this.$FBRTCCallController44(c('FBRTCConstants').CallEndReason.CLIENT_ERROR,false,true,false,m);c('FBRTCCallDialogController').showDialog(c('FBRTCCallDialogController').dialogTypes.ERROR_ACCESSING_MEDIA,this.$FBRTCCallController6);};l.prototype.$FBRTCCallController52=function(){'use strict';this.$FBRTCCallController11.userMediaGranted();};l.prototype.$FBRTCCallController15=function(m){'use strict';switch(m.type){case 'offer':this.$FBRTCCallController60(m.sdp,m.attributes);break;case 'answer':this.$FBRTCCallController61(m.sdp,m.attributes);break;case 'sdp_update':this.$FBRTCCallController62(m.sdp,m.attributes);break;default:break;}};l.prototype.$FBRTCCallController62=function(m,n){'use strict';this.$FBRTCCallController25.sendSdpUpdate(this.$FBRTCCallController6.peerID,this.$FBRTCCallController6.callID,m,this.$FBRTCCallController6.localStream.hasVideo(),n);};l.prototype.$FBRTCCallController60=function(m,n){'use strict';var o;if(!this.$FBRTCCallController5){o=c('FBRTCConstants').PayloadType.OFFER;}else{o=c('FBRTCConstants').PayloadType.PCRESTART_OFFER;this.$FBRTCCallController5=false;}this.$FBRTCCallController28=new (c('FBRTCRetriableMessage'))(this.$FBRTCCallController25);this.$FBRTCCallController28.addListener('sendingRetry',this.$FBRTCCallController63.bind(this));this.$FBRTCCallController28.addListener('timeoutFailure',this.$FBRTCCallController64.bind(this));this.$FBRTCCallController28.sendMessage(o,this.$FBRTCCallController6.peerID,this.$FBRTCCallController6.callID,m,this.$FBRTCCallController6.localStream.hasVideo(),n);this.$FBRTCCallController39=setTimeout(function(){this.$FBRTCCallController44(c('FBRTCConstants').CallEndReason.NO_ANSWER_TIMEOUT,false,true,false);}.bind(this),i);};l.prototype.$FBRTCCallController64=function(){'use strict';var m;if(this.$FBRTCCallController6.receivedNack){m=c('FBRTCConstants').CallEndReason.UNSUPPORTED_VERSION;c('FBRTCCallDialogController').showDialog(c('FBRTCCallDialogController').dialogTypes.PEER_BROWSER_UNSUPPORTED,this.$FBRTCCallController6);}else m=c('FBRTCConstants').CallEndReason.OTHER_NOT_CAPABLE;this.$FBRTCCallController44(m,false,true,false,'TimedOut');};l.prototype.$FBRTCCallController45=function(m){'use strict';this.$FBRTCCallController6.remoteStream.setVideoEnabled(m);};l.prototype.$FBRTCCallController61=function(m,n){'use strict';var o=this.$FBRTCCallController6.localStream.hasVideo()&&this.$FBRTCCallController6.isRemoteVideoSupported;this.$FBRTCCallController29=new (c('FBRTCRetriableMessage'))(this.$FBRTCCallController25);this.$FBRTCCallController29.addListener('sendingRetry',this.$FBRTCCallController63.bind(this));this.$FBRTCCallController29.sendMessage(c('FBRTCConstants').PayloadType.ANSWER,this.$FBRTCCallController6.peerID,this.$FBRTCCallController6.callID,m,o,n);};l.prototype.$FBRTCCallController63=function(){'use strict';var m=this.$FBRTCCallController12.getCreatedIceCandidates();for(var n=0;n<m.length;n++)this.$FBRTCCallController65(m[n]);};l.prototype.$FBRTCCallController65=function(m){'use strict';this.$FBRTCCallController25.sendIceCandidate(this.$FBRTCCallController6.peerID,this.$FBRTCCallController6.callID,m);};l.prototype.$FBRTCCallController59=function(m,n,o){'use strict';this.$FBRTCCallController12.setPeerSupportsVideo(this.$FBRTCCallController6.isRemoteVideoSupported);if(this.$FBRTCCallController6.isPeerOnMobile)m=c('FBRTCSdpUtils').setVideoBitrateConstraint(m);if(n){this.$FBRTCCallController12.onReceivedOfferSDP(m,o);}else this.$FBRTCCallController12.onReceivedAnswerSDP(m,o);};l.prototype.$FBRTCCallController16=function(m){'use strict';this.$FBRTCCallController65(m);};l.prototype.$FBRTCCallController17=function(){'use strict';this.$FBRTCCallController33=true;var m=this;this.$FBRTCCallController32.drainCandidates(this.$FBRTCCallController6.peerID,this.$FBRTCCallController6.callID,function(n){m.$FBRTCCallController12.onReceivedRemoteIceCandidate(n);});};l.prototype.$FBRTCCallController18=function(){'use strict';this.$FBRTCCallController66();this.$FBRTCCallController8.onCallConnected();this.$FBRTCCallController38.onCallHeartbeat(this.$FBRTCCallController8);this.$FBRTCCallController1.logInfo(this.$FBRTCCallController6.peerID,this.$FBRTCCallController6.callID,'Call Connected');};l.prototype.$FBRTCCallController19=function(){'use strict';this.$FBRTCCallController44(c('FBRTCConstants').CallEndReason.CONNECTION_DROPPED,false,true,false);};l.prototype.$FBRTCCallController21=function(m){'use strict';this.$FBRTCCallController44(c('FBRTCConstants').CallEndReason.WEBRTC_ERROR,false,true,false,m.endCallSubreason);this.$FBRTCCallController1.logError(this.$FBRTCCallController6.peerID,this.$FBRTCCallController6.callID,'webrtc error: '+JSON.stringify(m.details));};l.prototype.$FBRTCCallController27=function(m,n){'use strict';this.$FBRTCCallController44(m,false,false,false,n);};l.prototype.$FBRTCCallController26=function(m,n){'use strict';var o=n.call_id,p=n.type;if(this.$FBRTCCallController6.isEnded()){this.$FBRTCCallController1.logError(this.$FBRTCCallController6.peerID,this.$FBRTCCallController6.callID,'Message sent after call ended: '+p);return;}if(this.$FBRTCCallController6.peerID!==m||this.$FBRTCCallController6.callID!==o)return;this.$FBRTCCallController11.onMessageTypeSent(p);this.$FBRTCCallController8.onMessageSent(n);};l.prototype.$FBRTCCallController37=function(m){'use strict';var n;try{n=new (c('FBRTCMessage'))(m);}catch(o){this.$FBRTCCallController1.logError(this.$FBRTCCallController6.peerID,this.$FBRTCCallController6.callID,'Unknown data: '+JSON.stringify(m));return;}this.$FBRTCCallController1.logReceivedMessage(n.peerID,n.callID,n.msg);if(this.$FBRTCCallController6.isEnded()){this.$FBRTCCallController1.logInfo(this.$FBRTCCallController6.peerID,this.$FBRTCCallController6.callID,'Ignoring message (call ended): '+n.msgID);return;}if(!c('FBRTCMessageDedup').check(n.peerID,n.callID,n.msgID)){this.$FBRTCCallController1.logInfo(this.$FBRTCCallController6.peerID,this.$FBRTCCallController6.callID,'Ignoring message (duplicate): '+n.msgID);return;}if(this.$FBRTCCallController6.isAwaitingUserStart())return;if(this.$FBRTCCallController6.peerID&&this.$FBRTCCallController6.peerID!==n.peerID){if(n.isOffer())this.$FBRTCCallController67(n);this.$FBRTCCallController1.logInfo(this.$FBRTCCallController6.peerID,this.$FBRTCCallController6.callID,'Ignoring message (different peer): '+n.msgID);return;}if(!n.isForCall(this.$FBRTCCallController6)){this.$FBRTCCallController1.logInfo(this.$FBRTCCallController6.peerID,this.$FBRTCCallController6.callID,'Ignoring message (different call): '+n.msgID);return;}this.$FBRTCCallController11.onMessageTypeReceived(n.msgType);if(this.$FBRTCCallController6.callID&&this.$FBRTCCallController6.callID===n.callID)this.$FBRTCCallController8.onFullMessageReceived(n);this.$FBRTCCallController6.setSignalingExperiments(n.getSignalingExperiments());switch(n.msgType){case c('FBRTCConstants').PayloadType.OFFER:case c('FBRTCConstants').PayloadType.ICERESTART_OFFER:case c('FBRTCConstants').PayloadType.PCRESTART_OFFER:this.$FBRTCCallController68(n);break;case c('FBRTCConstants').PayloadType.ANSWER:case c('FBRTCConstants').PayloadType.ICERESTART_ANSWER:case c('FBRTCConstants').PayloadType.PCRESTART_ANSWER:this.$FBRTCCallController69(n);this.$FBRTCCallController38.onCallHeartbeat(this.$FBRTCCallController8);break;case c('FBRTCConstants').PayloadType.SDP_UPDATE:this.$FBRTCCallController70(n);break;case c('FBRTCConstants').PayloadType.ICE_CANDIDATE:this.$FBRTCCallController71(n);break;case c('FBRTCConstants').PayloadType.HANGUP:this.$FBRTCCallController72(n);break;case c('FBRTCConstants').PayloadType.OFFER_ACK:this.$FBRTCCallController73();break;case c('FBRTCConstants').PayloadType.OFFER_NACK:this.$FBRTCCallController6.receivedNack=true;break;case c('FBRTCConstants').PayloadType.ANSWER_ACK:this.$FBRTCCallController74();break;case c('FBRTCConstants').PayloadType.MSG_ACK:this.$FBRTCCallController75(n);break;case c('FBRTCConstants').PayloadType.SET_VIDEO:if(this.$FBRTCCallController6.isRemoteVideoSupported&&(this.$FBRTCCallController30.callHasEscalated()||!this.$FBRTCCallController6.isPeerOnMobile))this.$FBRTCCallController45(n.msg.videoon);break;case c('FBRTCConstants').PayloadType.VIDEO_REQUEST:case c('FBRTCConstants').PayloadType.ACK:case c('FBRTCConstants').PayloadType.OK:case c('FBRTCConstants').PayloadType.PING:case c('FBRTCConstants').PayloadType.OTHER_DISMISS:case c('FBRTCConstants').PayloadType.PRANSWER:break;default:break;}c('FBRTCCallControlActions').receivedSignalingMessage(n);};l.prototype.$FBRTCCallController67=function(m){'use strict';var n=m.peerID,o=m.callID,p=m.msg,q=new (c('FBRTCCallSummary'))({peerID:n,callID:o,isCaller:false});q.onFullMessageReceived(m);this.$FBRTCCallController25.sendOfferAck(n,o,p);q.onOfferAckSent(p);var r=c('FBRTCConstants').CallEndReason.IN_ANOTHER_CALL;this.$FBRTCCallController76(n,o,r);q.onCallEnded(r,false);q.save(this.$FBRTCCallController3);};l.prototype.$FBRTCCallController68=function(m){'use strict';var n=m.msg;this.$FBRTCCallController25.sendOfferAck(this.$FBRTCCallController6.peerID,n.call_id,n);this.$FBRTCCallController25.sendOtherDismiss(n.call_id);if(this.$FBRTCCallController77(n)){this.$FBRTCCallController78(m);}else this.$FBRTCCallController79();};l.prototype.$FBRTCCallController70=function(m){'use strict';var n=m.msg,o=n.sdp;if(n.hasOwnProperty('videoon'))this.$FBRTCCallController45(n.videoon);if(this.$FBRTCCallController6.isPeerOnMobile)o=c('FBRTCSdpUtils').setVideoBitrateConstraint(o);this.$FBRTCCallController12.onReceivedSdpUpdate(o,n.attributes);};l.prototype.$FBRTCCallController77=function(m){'use strict';if(m.call_id===this.$FBRTCCallController6.callID)return true;return ((this.$FBRTCCallController39||!this.$FBRTCCallController4)&&(!this.$FBRTCCallController6.callID||m.call_id!==this.$FBRTCCallController6.callID)&&this.$FBRTCCallController6.isCaller&&(!m.handlescollision||m.call_id<this.$FBRTCCallController6.callID));};l.prototype.$FBRTCCallController78=function(m){'use strict';var n=m.msg;if(n.hasOwnProperty('videoon'))this.$FBRTCCallController45(n.videoon);this.$FBRTCCallController80();this.$FBRTCCallController81();this.$FBRTCCallController66();if(this.$FBRTCCallController6.callID!==n.call_id){var o=c('FBRTCConstants').CallEndReason.OTHER_INSTANCE_HANDLED;this.$FBRTCCallController76(this.$FBRTCCallController6.peerID,this.$FBRTCCallController6.callID,o);this.$FBRTCCallController8.onCallEnded(o,false);this.$FBRTCCallController8.save(this.$FBRTCCallController3);this.$FBRTCCallController8=new (c('FBRTCCallSummary'))({peerID:this.$FBRTCCallController6.peerID,callID:n.call_id,isCaller:false});this.$FBRTCCallController8.onFullMessageReceived(m);this.$FBRTCCallController8.onOfferAckSent(n);this.$FBRTCCallController1.logEvent(this.$FBRTCCallController6.peerID,this.$FBRTCCallController6.callID,'Handling offer collision');}else this.$FBRTCCallController1.logEvent(this.$FBRTCCallController6.peerID,this.$FBRTCCallController6.callID,'Handling offer refresh');this.$FBRTCCallController12.end();this.$FBRTCCallController33=false;this.$FBRTCCallController11.reset(n.call_id,this.$FBRTCCallController8);this.$FBRTCCallController6.onSDPMessageFromPeer(m);this.$FBRTCCallController4=m;this.$FBRTCCallController58();};l.prototype.$FBRTCCallController79=function(){'use strict';this.$FBRTCCallController1.logEvent(this.$FBRTCCallController6.peerID,this.$FBRTCCallController6.callID,'Ignoring offer');};l.prototype.$FBRTCCallController69=function(m){'use strict';var n=m.msg;this.$FBRTCCallController80();this.$FBRTCCallController81();this.$FBRTCCallController25.sendAnswerAck(this.$FBRTCCallController6.peerID,this.$FBRTCCallController6.callID,n);this.$FBRTCCallController6.onSDPMessageFromPeer(m);if(this.$FBRTCCallController22){this.$FBRTCCallController55();}else{this.$FBRTCCallController59(n.sdp,false,n.attributes);if(n.hasOwnProperty('videoon'))this.$FBRTCCallController45(n.videoon);}};l.prototype.$FBRTCCallController75=function(m){'use strict';var n=m.msg;if(this.$FBRTCCallController28&&this.$FBRTCCallController28.isAckMsg(n)){this.$FBRTCCallController8.onMsgAckReceived(m,true);this.$FBRTCCallController11.onMessageTypeReceived(c('FBRTCConstants').PayloadType.OFFER_ACK);this.$FBRTCCallController73();}else if(this.$FBRTCCallController29&&this.$FBRTCCallController29.isAckMsg(n)){this.$FBRTCCallController8.onMsgAckReceived(m,false);this.$FBRTCCallController74();}};l.prototype.$FBRTCCallController73=function(){'use strict';this.$FBRTCCallController80();this.$FBRTCCallController38.onCallHeartbeat(this.$FBRTCCallController8);};l.prototype.$FBRTCCallController74=function(){'use strict';this.$FBRTCCallController66();};l.prototype.$FBRTCCallController71=function(m){'use strict';var n=m.msg;if(n.call_id===this.$FBRTCCallController6.callID&&this.$FBRTCCallController33){this.$FBRTCCallController12.onReceivedRemoteIceCandidate(n);}else this.$FBRTCCallController32.cacheCandidate(this.$FBRTCCallController6.peerID,n.call_id,n);};l.prototype.$FBRTCCallController72=function(m){'use strict';var n=m.msg;if(n.call_id===this.$FBRTCCallController6.callID){this.$FBRTCCallController44(n.reason,true,false,false,n.subreason);}else this.$FBRTCCallController1.logError(this.$FBRTCCallController6.peerID,this.$FBRTCCallController6.callID,'Receiving hangup for a different call: '+n.call_id.toString());};l.prototype.$FBRTCCallController46=function(m){'use strict';var n=m.trigger;if(!n||n!==c('FBRTCLogger').Trigger.RESET_CALL)return;var o=c('FBRTCConstants').CallEndReason.HANGUP_CALL;this.$FBRTCCallController44(o,false,true,false,'CallReset');c('FBRTCWindowManager').reload();};l.prototype.$FBRTCCallController44=function(m,n,o,p,q){'use strict';if(typeof m=='string'||m instanceof String)m=c('FBRTCConstants').endCallReasonFromString(m);var r=c('FBRTCConstants').fullCallEndReasonString(m,n);this.$FBRTCCallController1.logCallAction(this.$FBRTCCallController6.peerID,this.$FBRTCCallController6.callID,c('FBRTCLogger').CallAction.END_CALL,r);this.$FBRTCCallController80();this.$FBRTCCallController81();this.$FBRTCCallController66();if(this.$FBRTCCallController6.isEnded()){this.$FBRTCCallController1.logError(this.$FBRTCCallController6.peerID,this.$FBRTCCallController6.callID,'Ending an already-ended call');return;}if(o)this.$FBRTCCallController76(this.$FBRTCCallController6.peerID,this.$FBRTCCallController6.callID,m,p,q);this.$FBRTCCallController9.onEndCall();this.$FBRTCCallController12.end();c('FBRTCUserMedia').end();this.$FBRTCCallController11.end(m,n);this.$FBRTCCallController8.setCallType(this.$FBRTCCallController30.getCallType());this.$FBRTCCallController8.setVideoDurations(this.$FBRTCCallController6.getLocalVideoDuration(),this.$FBRTCCallController6.getRemoteVideoDuration());this.$FBRTCCallController8.onCallEnded(m,n,null,q);this.$FBRTCCallController8.save(this.$FBRTCCallController3);clearTimeout(this.$FBRTCCallController56);if(m===c('FBRTCConstants').CallEndReason.HANGUP_CALL&&q==='CallReset'&&n)c('FBRTCWindowManager').close();};l.prototype.$FBRTCCallController76=function(m,n,o,p,q){'use strict';this.$FBRTCCallController25.sendHangup(m,n,o,p,q);this.$FBRTCCallController25.sendOtherDismiss(n);};l.prototype.$FBRTCCallController80=function(){'use strict';if(this.$FBRTCCallController28)this.$FBRTCCallController28.stopRetrying();};l.prototype.$FBRTCCallController66=function(){'use strict';if(this.$FBRTCCallController29)this.$FBRTCCallController29.stopRetrying();};l.prototype.$FBRTCCallController81=function(){'use strict';if(this.$FBRTCCallController39)clearTimeout(this.$FBRTCCallController39);this.$FBRTCCallController39=null;};l.prototype.$FBRTCCallController31=function(){'use strict';if(this.$FBRTCCallController30.isPending()){c('FBRTCCallDialogController').showDialog(c('FBRTCCallDialogController').dialogTypes.VIDEO_ESCALATION,this.$FBRTCCallController6);}else c('FBRTCCallDialogController').hideDialogType(c('FBRTCCallDialogController').dialogTypes.VIDEO_ESCALATION);this.$FBRTCCallController8.setCallType(this.$FBRTCCallController30.getCallType());this.$FBRTCCallController8.save(this.$FBRTCCallController3);};f.exports=l;},null);
__d('FBRTCBackground.react',['cx','Image.react','ReactComponentWithPureRenderMixin','React','WorkModeConfig'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i='/images/messengerdotcom/favicon/favicon.ico',j='/images/messengerdotcom/favicon/favicon_work.ico',k='/images/messengerdotcom/favicon/favicon_sandbox.ico',l=c('React').PropTypes,m=c('React').createClass({displayName:'FBRTCBackground',mixins:[c('ReactComponentWithPureRenderMixin')],propTypes:{messengerUI:l.bool.isRequired,src:l.string},getInitialState:function(){this._updateFavicon();return {showCoverPhoto:true};},render:function(){if(this.props.messengerUI)return null;var n=this.props.src;if(this.state.showCoverPhoto&&n){return (c('React').createElement('div',{className:"_1_5p"},c('React').createElement('div',{className:"_1_5q"}),c('React').createElement(c('Image.react'),{src:n,className:"_1_5r",alt:'',onError:this._imageError})));}else return c('React').createElement('div',{className:"_1_5p"});},_imageError:function(){this.setState({showCoverPhoto:false});},_updateFavicon:function(){var n=document.querySelector('link[rel*=icon][href*=".ico"]'),o=false;if(o){n.href=k;}else if(c('WorkModeConfig').is_work_user){n.href=j;}else n.href=i;}});f.exports=m;},null);
__d('FBRTCCallControlPopover.react',['fbt','LayerFadeOnHide','LayerFadeOnShow','React','ReactDOM','ReactComponentWithPureRenderMixin','XUIContextualDialog.react','XUIContextualDialogBody.react','XUIContextualDialogTitle.react'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=c('React').PropTypes,j={NONE:0,REMOTE_VIDEO_UNSUPPORTED:1,NO_VIDEO_TRACKS:2,VIDEO_AUTO_DISABLED:3,SCREENSHARING_UNAVAILABLE:4,PEER_IS_SHARING_SCREEN:5},k=c('React').createClass({displayName:'FBRTCCallControlPopover',mixins:[c('ReactComponentWithPureRenderMixin')],propTypes:{reason:i.number.isRequired,peerName:i.string.isRequired,isVCEndpointCall:i.bool,reference:i.object.isRequired,visible:i.bool.isRequired,width:i.number.isRequired},render:function(){var l=this._getTitle();if(l)return (c('React').createElement(c('XUIContextualDialog.react'),this._popoverProps(),l,this._getBody()));return (c('React').createElement(c('XUIContextualDialog.react'),this._popoverProps(),this._getBody()));},_getTitle:function(){if(this.props.reason===j.NO_VIDEO_TRACKS)return (c('React').createElement(c('XUIContextualDialogTitle.react'),null,h._("Can't find camera")));},_getBody:function(){var l=null;switch(this.props.reason){case j.NONE:break;case j.REMOTE_VIDEO_UNSUPPORTED:l=h._("Video is disabled for this call because {name}'s device does not support video.",[h.param('name',this.props.peerName)]);break;case j.NO_VIDEO_TRACKS:l=h._("Connect your camera and refresh the page to turn on video. If your camera is already connected, try restarting your browser.");break;case j.VIDEO_AUTO_DISABLED:l=h._("Video is paused because the connection is slow.");break;case j.SCREENSHARING_UNAVAILABLE:l=this.props.isVCEndpointCall?h._("Screen sharing is not currently available for Messenger to room calls."):h._("Screen sharing is disabled for this call because {name}'s device does not support receiving screen sharing.",[h.param('name',this.props.peerName)]);break;case j.PEER_IS_SHARING_SCREEN:l=h._("{name} is already sharing their screen. You can share your screen as soon as they stop sharing.",[h.param('name',this.props.peerName)]);break;}return (c('React').createElement(c('XUIContextualDialogBody.react'),null,l));},_popoverProps:function(){var l={alignment:'left',behaviors:{LayerFadeOnHide:c('LayerFadeOnHide'),LayerFadeOnShow:c('LayerFadeOnShow')},contextRef:function(){return this.props.reference;}.bind(this),hoverContext:c('ReactDOM').findDOMNode(this.props.reference),position:'above',shown:this.props.visible,width:this.props.width};return l;}});k.Types=j;f.exports=k;},null);
__d('FBRTCCallControls.react',['cx','fbt','FBRTCActiveMouseMixin','FBRTCCallControlActions','FBRTCCallControlButton.react','FBRTCCallControlPopover.react','FBRTCFullScreenController','FBRTCScreenSharingUtils','FBRTCUserSettings','React','ReactLayeredComponentMixin','ScreenSharingWebDriverIDs','VideoCallWebDriverIDs'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();var j=10000,k={READY:0,SHOWN:1,COMPLETE:2},l=c('React').createClass({displayName:'FBRTCCallControls',mixins:[c('ReactLayeredComponentMixin'),c('FBRTCActiveMouseMixin')],getInitialState:function(){return {forceVisible:k.READY,showScreenSharingPopover:false};},componentDidMount:function(){this._listener=c('FBRTCFullScreenController').addListener(this._handleFullScreenChange);},activeMouseCallback:function(m){this.setState({mouseActive:m});},componentWillUnmount:function(){if(this._listener){this._listener.remove();this._listener=null;}},_handleFullScreenChange:function(){this.forceUpdate();},_shouldForceVisible:function(m){var n=m.localStream;return m.videoIsAutoDisabled()||n.hasStream()&&!n.hasVideoTracks();},componentWillReceiveProps:function(m){if(this._shouldForceVisible(m.callModel)){if(this.state.forceVisible===k.READY){this.setState({forceVisible:k.SHOWN});setTimeout(function(){this.setState({forceVisible:k.COMPLETE});}.bind(this),j);}}else if(this.state.forceVisible===k.SHOWN)this.setState({forceVisible:k.COMPLETE});},_getPopoverWidth:function(m){var n=65;return c('FBRTCUserSettings').isEnabled()?m:m-n;},renderLayers:function(){var m,n,o=false,p={},q=this.props.callModel.peerShortName();if(!this.props.callModel.isRemoteVideoSupported){m=c('FBRTCCallControlPopover.react').Types.REMOTE_VIDEO_UNSUPPORTED;}else if(!this.props.callModel.localStream.hasVideoTracks()){m=c('FBRTCCallControlPopover.react').Types.NO_VIDEO_TRACKS;}else if(this.props.callModel.videoIsAutoDisabled())m=c('FBRTCCallControlPopover.react').Types.VIDEO_AUTO_DISABLED;if(m){o=this.state.forceVisible===k.SHOWN;p.videoPopover=c('React').createElement(c('FBRTCCallControlPopover.react'),{reason:m,peerName:q,reference:this.refs.videoButton,width:this._getPopoverWidth(320),visible:o});}if(c('FBRTCScreenSharingUtils').isScreenSharingSupported()){if(this.props.callModel.isConnected()&&!this.props.callModel.canPeerReceiveScreenSharing()){n=c('FBRTCCallControlPopover.react').Types.SCREENSHARING_UNAVAILABLE;}else if(this.props.callModel.getRemoteScreenStream()!==null)n=c('FBRTCCallControlPopover.react').Types.PEER_IS_SHARING_SCREEN;if(n){o=this.state.showScreenSharingPopover;p.screenSharingPopover=c('React').createElement(c('FBRTCCallControlPopover.react'),{reason:n,peerName:q,isVCEndpointCall:this.props.callModel.isVCEndpointCall,reference:this.refs.shareScreenButton,width:this._getPopoverWidth(255),visible:o});}}return p;},toggleMuteAudio:function(m){c('FBRTCCallControlActions').toggleMuteAudio();},toggleMuteVideo:function(m){c('FBRTCCallControlActions').toggleMuteVideo();},toggleFullScreen:function(m){c('FBRTCCallControlActions').toggleFullScreen();},endCall:function(m){c('FBRTCCallControlActions').hangUp();},showSettings:function(m){if(c('FBRTCUserSettings').isEnabled())c('FBRTCCallControlActions').showSettings();},toggleScreenSharing:function(m){if(c('FBRTCScreenSharingUtils').isScreenSharingSupported())if(this.props.callModel.canPeerReceiveScreenSharing()&&this.props.callModel.getRemoteScreenStream()===null){c('FBRTCCallControlActions').toggleScreenSharing();}else{c('FBRTCScreenSharingUtils').logFailedAttempt(this.props.callModel.peerID,this.props.callModel.callID);if(!this.state.showScreenSharingPopover){this.setState({showScreenSharingPopover:true});setTimeout(function(){this.setState({showScreenSharingPopover:false});}.bind(this),j/4);}}},render:function(){var m=this.props.callModel,n=c('FBRTCUserSettings').isEnabled()&&m.supportsSdpUpdate(),o=this._isVideoButtonDisabled(),p=!o&&!m.localStream.hasVideo(),q=c('FBRTCScreenSharingUtils').isScreenSharingSupported(),r=!m.localStream.hasAudio(),s=m.isFullScreen();return (c('React').createElement('div',{className:"_4bbt"},c('React').createElement('div',{className:this._wrapperClasses(),onFocus:this.onFocus,onBlur:this.onBlur},this._videoMuteButton(p,o),this._audioMuteButton(r),this._screenSharingButton(q),this._endCallButton(),this._settingsButton(n),this._fullScreenButton(s))));},_isVideoButtonDisabled:function(){var m=this.props.callModel;return !m.isRemoteVideoSupported||!m.localStream.hasVideoTracks()||!m.isConnected();},_videoMuteButton:function(m,n){var o=m?i._("Enable your video"):i._("Disable your video");return (c('React').createElement(c('FBRTCCallControlButton.react'),{active:m,disabled:n,highlighted:m,title:o,iconType:c('FBRTCCallControlButton.react').IconTypes.VIDEO,onClick:this.toggleMuteVideo,ref:'videoButton'}));},_audioMuteButton:function(m){var n=m?i._("Unmute your microphone"):i._("Mute your microphone");return (c('React').createElement(c('FBRTCCallControlButton.react'),{active:m,iconType:c('FBRTCCallControlButton.react').IconTypes.MUTE,highlighted:m,title:n,onClick:this.toggleMuteAudio}));},_endCallButton:function(){var m=i._("End call");return (c('React').createElement(c('FBRTCCallControlButton.react'),{endButton:true,title:m,iconType:c('FBRTCCallControlButton.react').IconTypes.END,onClick:this.endCall,'data-testid':c('VideoCallWebDriverIDs').END_CALL_BUTTON}));},_settingsButton:function(m){if(m){var n=i._("Settings");return (c('React').createElement(c('FBRTCCallControlButton.react'),{iconType:c('FBRTCCallControlButton.react').IconTypes.SETTINGS,title:n,onClick:this.showSettings}));}},_screenSharingButton:function(m){if(m){var n=this.props.callModel.canPeerReceiveScreenSharing(),o=n&&this.props.callModel.isScreenSharingEnabled(),p=!n||!this.props.callModel.isConnected()||this.props.callModel.getRemoteScreenStream()!==null,q=i._("Share your screen");return (c('React').createElement(c('FBRTCCallControlButton.react'),{active:o,disabled:p,highlighted:o,iconType:c('FBRTCCallControlButton.react').IconTypes.SHARE_SCREEN,title:q,onClick:this.toggleScreenSharing,ref:'shareScreenButton','data-testid':c('ScreenSharingWebDriverIDs').SHARE_SCREEN_BUTTON}));}},_fullScreenButton:function(m){var n=m?i._("Exit full screen"):i._("Enter full screen");return (c('React').createElement(c('FBRTCCallControlButton.react'),{active:m,title:n,iconType:c('FBRTCCallControlButton.react').IconTypes.FULL_SCREEN,onClick:this.toggleFullScreen}));},_wrapperClasses:function(){var m=!this.props.callModel.localStream.hasStream()||this.props.callModel.isEnded(),n=this.state.mouseActive||this.state.hasFocus||this.state.forceVisible===k.SHOWN;return "_4bbx"+(m?' '+"_4bby":'')+(n?' '+"_4bbz":'');},onFocus:function(m){this.setState({hasFocus:true});},onBlur:function(m){this.setState({hasFocus:false});}});f.exports=l;},null);
__d('FBRTCButton.react',['cx','MessengerButton.react','ReactComponentWithPureRenderMixin','React','XUIOverlayButton.react','joinClasses'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=c('React').PropTypes,j=c('React').createClass({displayName:'FBRTCButton',mixins:[c('ReactComponentWithPureRenderMixin')],propTypes:{label:i.string.isRequired,messengerUI:i.bool.isRequired,type:i.string.isRequired},render:function(){var k=this.props,l=k.className,m=k.messengerUI,n=k.type,o=babelHelpers.objectWithoutProperties(k,['className','messengerUI','type']);if(m)return (c('React').createElement(c('MessengerButton.react'),babelHelpers['extends']({className:l,type:n},o)));return (c('React').createElement(c('XUIOverlayButton.react'),babelHelpers['extends']({className:c('joinClasses')("_1-7l",l)},o)));}});f.exports=j;},null);
__d('FBRTCCallTimer.react',['React'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=c('React').createClass({displayName:'FBRTCCallTimer',getInitialState:function(){return {secondsElapsed:0};},tick:function(){this.setState({secondsElapsed:this.state.secondsElapsed+1});},componentDidMount:function(){this.interval=setInterval(this.tick,1000);},componentWillUnmount:function(){clearInterval(this.interval);},render:function(){var i=this.state.secondsElapsed;return (c('React').createElement('span',null,i>=3600?("0"+Math.floor(i/3600)).slice(-2)+':':'',("0"+Math.floor(i%3600/60)).slice(-2),':',("0"+i%60).slice(-2)));}});f.exports=h;},null);
__d('FBRTCSpinner.react',['MessengerSpinner.react','ReactComponentWithPureRenderMixin','React','XUISpinner.react'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h=c('React').PropTypes,i=c('React').createClass({displayName:'FBRTCSpinner',mixins:[c('ReactComponentWithPureRenderMixin')],propTypes:{messengerUI:h.bool.isRequired},render:function(){if(this.props.messengerUI)return c('React').createElement(c('MessengerSpinner.react'),{color:'blue'});return c('React').createElement(c('XUISpinner.react'),{background:'dark',size:'large'});}});f.exports=i;},null);
__d('FBRTCCallStateInfo.react',['cx','fbt','FBRTCButton.react','FBRTCCallControlActions','FBRTCCallModel','FBRTCCallTimer.react','FBRTCConstants','FBRTCSpinner.react','Image.react','MessengerContactImage.react','React'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();var j=function(m,n){switch(m){case c('FBRTCConstants').CallEndReason.NO_ANSWER_TIMEOUT:case c('FBRTCConstants').CallEndReason.IGNORE_CALL:return i._("No Answer");case c('FBRTCConstants').CallEndReason.INCOMING_TIMEOUT:case c('FBRTCConstants').CallEndReason.NO_PERMISSION:case c('FBRTCConstants').CallEndReason.OTHER_NOT_CAPABLE:case c('FBRTCConstants').CallEndReason.OTHER_CARRIER_BLOCKED:return i._("Not Reachable");case c('FBRTCConstants').CallEndReason.SIGNALING_MESSAGE_FAILED:case c('FBRTCConstants').CallEndReason.WEBRTC_ERROR:case c('FBRTCConstants').CallEndReason.NO_UI_ERROR:case c('FBRTCConstants').CallEndReason.CALLER_NOT_VISIBLE:case c('FBRTCConstants').CallEndReason.CLIENT_ERROR:return i._("Call Failed");case c('FBRTCConstants').CallEndReason.UNSUPPORTED_VERSION:return i._("Can't Connect Call");case c('FBRTCConstants').CallEndReason.IN_ANOTHER_CALL:return i._("In Another Call");case c('FBRTCConstants').CallEndReason.CARRIER_BLOCKED:return i._("Switch to Wi-Fi to complete your call");case c('FBRTCConstants').CallEndReason.CLIENT_INTERRUPTED:return i._("Call Interrupted");case c('FBRTCConstants').CallEndReason.HANGUP_CALL:case c('FBRTCConstants').CallEndReason.ACCEPT_AFTER_HANGUP:return i._("Call Ended");case c('FBRTCConstants').CallEndReason.CONNECTION_DROPPED:return i._("Connection Lost");case c('FBRTCConstants').CallEndReason.OTHER_INSTANCE_HANDLED:return '';default:return '';}},k=function(m,n){switch(m.uiState){case c('FBRTCCallModel').UIState.INIT:case c('FBRTCCallModel').UIState.PENDING_LOCAL_MEDIA:case c('FBRTCCallModel').UIState.MORE_INIT:case c('FBRTCCallModel').UIState.USER_MEDIA_DENIED:return c('React').createElement(c('FBRTCSpinner.react'),{messengerUI:n});case c('FBRTCCallModel').UIState.CONTACTING:return (c('React').createElement('p',{className:"_2ze8"},i._("Contacting...")));case c('FBRTCCallModel').UIState.RINGING:return (c('React').createElement('p',{className:"_2ze8"},i._("Ringing...")));case c('FBRTCCallModel').UIState.CALL_CONNECTING:return (c('React').createElement('p',{className:"_2ze8"},i._("Connecting...")));case c('FBRTCCallModel').UIState.CALL_CONNECTED:return (c('React').createElement('p',{className:"_2ze8"},c('React').createElement(c('FBRTCCallTimer.react'),null)));case c('FBRTCCallModel').UIState.CALL_ENDED:return (c('React').createElement('p',{className:"_2ze8"},j(m.endCallReason,m.isRemoteEnded)));default:return '';}},l=c('React').createClass({displayName:'FBRTCCallStateInfo',revealContainer:function(){var m="_4j_h",n=document.getElementsByClassName(m)[0];if(n)n.className=m;},onCloseButtonClicked:function(m){window.close();return;},componentDidMount:function(){setTimeout(function(){this.revealContainer();}.bind(this),2000);},render:function(){var m=this.props.callModel;return (c('React').createElement('div',{className:"_4j_i"},this.renderPeerImage(m),this.renderMessage(),this.renderSubMessage(),this.renderCloseWindowButton(),this.renderStartCallButton()));},renderMessage:function(){var m=this.props.callModel;if(m.uiState===c('FBRTCCallModel').UIState.AWAITING_USER_START)return (c('React').createElement('p',{className:"_4j_k"},i._("Ready to call {name}?",[i.param('name',m.peerShortName())])));return (c('React').createElement('p',{className:"_4j_k"},this.props.callModel.peerName()));},renderSubMessage:function(){return k(this.props.callModel,this.props.messengerUI);},renderPeerImage:function(m){if(m.peerPicUrl()){if(this.props.messengerUI)return (c('React').createElement(c('MessengerContactImage.react'),{className:"_3z3i",isMessengerUser:true,size:75,src:m.peerPicUrl()}));return (c('React').createElement(c('Image.react'),{className:"_4j_j",src:m.peerPicUrl(),alt:'profile pic',onLoad:this.revealContainer,onError:this.revealContainer}));}return '';},shouldRenderCloseButton:function(){var m=this.props.callModel;return m.uiState===c('FBRTCCallModel').UIState.CALL_ENDED&&(!m.wasConnected||m.endCallReason!==c('FBRTCConstants').CallEndReason.HANGUP_CALL);},renderCloseWindowButton:function(){if(this.shouldRenderCloseButton()){return (c('React').createElement(c('FBRTCButton.react'),{label:i._("Close Window"),messengerUI:this.props.messengerUI,onClick:this.onCloseButtonClicked,type:'primary'}));}else return '';},renderStartCallButton:function(){var m=this.props.callModel;if(m.uiState===c('FBRTCCallModel').UIState.AWAITING_USER_START){return (c('React').createElement(c('FBRTCButton.react'),{label:i._("Start Call"),messengerUI:this.props.messengerUI,onClick:c('FBRTCCallControlActions').startCall,type:'primary'}));}else return '';}});f.exports=l;},null);
__d('FBRTCInCallView.react',['cx','FBRTCCallModel','FBRTCScreenSharingUI','FBRTCScreenSharingView.react','FBRTCVideo.react','React'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=c('React').PropTypes,j=c('React').createClass({displayName:'FBRTCInCallView',propTypes:{callModel:i.instanceOf(c('FBRTCCallModel')).isRequired},_videoIsMuted:function(){var k=this.props.callModel.remoteStream;return k&&!k.hasVideo();},_hasRemoteScreen:function(k){var l=k.getRemoteScreenStream();return l!==null&&!c('FBRTCScreenSharingUI').isOpen();},_containerClasses:function(k){var l=k===c('FBRTCCallModel').UIState.CALL_CONNECTED,m=k===c('FBRTCCallModel').UIState.CALL_ENDED;return "_of-"+(l||m?' '+"_of_":'')+(l?' '+"_og0":'')+(m?' '+"_og1":'');},_videoWrapperClasses:function(k){var l=this._videoIsMuted();return "_og2"+(l?' '+"_og3":'')+(k?' '+"_og4":'');},render:function(){var k=this.props.callModel,l=k.remoteStream.hasStream(),m=this._hasRemoteScreen(k);if(!l&&!m){return c('React').createElement('div',{className:"_hgl"});}else{var n=k.uiState;return (c('React').createElement('div',{className:this._containerClasses(n)},c('React').createElement('div',{className:this._videoWrapperClasses(m)},c('React').createElement(c('FBRTCVideo.react'),{stream:k.remoteStream})),this._renderScreenView(k,m)));}},_renderScreenView:function(k,l){if(l)return (c('React').createElement(c('FBRTCScreenSharingView.react'),{canSwitchScreens:false,screenStream:k.getRemoteScreenStream()}));return null;}});f.exports=j;},null);
__d('FBRTCMediaAccessPrompt.react',['cx','fbt','React','ReactDOM','UserAgent','Link.react','XUIText.react','FBRTCCallModel','FBRTCConfig'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();var j=c('React').createClass({displayName:'FBRTCMediaAccessPrompt',isVisible:function(k){return (c('UserAgent').isBrowser('Chrome')||c('UserAgent').isBrowser('Firefox'))&&k===c('FBRTCCallModel').UIState.PENDING_LOCAL_MEDIA;},componentWillUpdate:function(k,l){var m=k.callModel.uiState;if(this.isVisible(m)){clearTimeout(this.timeout);c('ReactDOM').findDOMNode(this).style.display='block';}},componentDidUpdate:function(k,l){var m=this.props.callModel.uiState;if(!this.isVisible(m))this.timeout=setTimeout(function(){c('ReactDOM').findDOMNode(this).style.display='none';}.bind(this),500);},componentWillUnmount:function(){clearTimeout(this.timeout);},dialogTitle:function(){if(c('UserAgent').isBrowser('Chrome')){return i._("Click \"Allow\" to Make a Call");}else return i._("Click the camera and choose \"Share Selected Devices\"");},dialogBody:function(){return i._("To make a video call on Facebook, you need to turn on your camera and microphone. This will let your friend see and hear you during the call.");},dialogLowerBody:function(){return i._("You can always turn these off later.");},learnMoreLink:function(){return (c('React').createElement(c('Link.react'),{href:c('FBRTCConfig').userMediaPermissionErrorUrl(),target:'_blank'},i._("Learn more")));},render:function(){var k=this.props.callModel.uiState;return (c('React').createElement('div',{className:"_3jne"+(!this.isVisible(k)?' '+"_3jnf":'')},c('React').createElement('div',{className:"_3jnu"},c('React').createElement('h1',{className:"_3jnv"},this.dialogTitle()),c('React').createElement(c('XUIText.react'),{className:"_3jnw",display:'block',size:'small'},this.dialogBody()),c('React').createElement(c('XUIText.react'),{className:"_3jnw",display:'block',size:'small'},this.dialogLowerBody(),' ',this.learnMoreLink()))));}});f.exports=j;},null);
__d('FBRTCMediaDeniedPrompt.react',['cx','fbt','React','UserAgent','XUIContextualDialog.react','XUIContextualDialogBody.react','XUIContextualDialogTitle.react','ReactLayeredComponentMixin','FBRTCCallModel'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();var j=c('React').createClass({displayName:'FBRTCMediaDeniedPrompt',mixins:[c('ReactLayeredComponentMixin')],showDialog:function(){var k=this.props.callModel;return k.uiState===c('FBRTCCallModel').UIState.USER_MEDIA_DENIED;},arrowAlignment:function(){return c('UserAgent').isBrowser('Chrome')?'right':'left';},dialogTitle:function(){return i._("Click to Turn on Camera\/Microphone");},dialogBody:function(){return i._("To use video calling, you need to turn on your camera and microphone during the call.");},renderLayers:function(){return {popover:c('React').createElement(c('XUIContextualDialog.react'),{contextRef:function(){return this.refs.mpTarget;}.bind(this),shown:this.showDialog(),position:'below',alignment:this.arrowAlignment(),width:c('XUIContextualDialog.react').WIDTH.NORMAL},c('React').createElement(c('XUIContextualDialogTitle.react'),null,this.dialogTitle()),c('React').createElement(c('XUIContextualDialogBody.react'),null,this.dialogBody()))};},render:function(){return c('React').createElement('div',{className:"_3wrz",ref:'mpTarget'});}});f.exports=j;},null);
__d('FBRTCVideoMuteOverlay.react',['cx','Image.react','ReactComponentWithPureRenderMixin','React'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=c('React').PropTypes,j=c('React').createClass({displayName:'FBRTCVideoMuteOverlay',mixins:[c('ReactComponentWithPureRenderMixin')],propTypes:{videoMuted:i.bool.isRequired,imageSrc:i.oneOfType([i.string,i.object]).isRequired},render:function(){var k="_30ve"+(this.props.videoMuted?' '+"_30vf":'');return (c('React').createElement('div',{className:k},c('React').createElement(c('Image.react'),{src:this.props.imageSrc,alt:'video muted'})));}});f.exports=j;},null);
__d('FBRTCSelfView.react',['cx','FBRTCActiveMouseMixin','FBRTCCallModel','FBRTCCallControlActions','FBRTCUtils','FBRTCVideo.react','FBRTCVideoMuteOverlay.react','React'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=c('React').PropTypes,j=c('React').createClass({displayName:'FBRTCSelfView',mixins:[c('FBRTCActiveMouseMixin')],propTypes:{callModel:i.instanceOf(c('FBRTCCallModel')).isRequired},getInitialState:function(){return {};},activeMouseCallback:function(k){if(this.isMounted())this.setState({mouseActive:k});},toggleIconClass:function(k,l){return "_2q_n"+(k?' '+"_2q_o":'')+(!k?' '+"_2q_p":'')+(!l?' '+"_2q_q":'');},wrapperClasses:function(k){return "_2q_r"+(!k.selfViewOpen?' '+"_2q_s":'');},overlayClasses:function(k){var l=k.localStream.hasAudio();return "_2q_t"+(l?' '+"_2q_u":'');},buttonClasses:function(){return "_2q_w"+(this.state.mouseActive?' '+"_sxz":'');},render:function(){var k=this.props.callModel,l=k.selfViewOpen,m=k.isScreenSharingEnabled()?"_nxg":"_2q_y",n=k.isScreenSharingEnabled()?k.getLocalScreenStream():k.localStream;return (c('React').createElement('div',{className:"_2q_v"},c('React').createElement('button',{className:this.buttonClasses(),onClick:c('FBRTCCallControlActions').toggleSelfView},c('React').createElement('i',{className:this.toggleIconClass(true,!l)}),c('React').createElement('i',{className:this.toggleIconClass(false,l)})),c('React').createElement('div',{className:this.wrapperClasses(k)},c('React').createElement('div',{className:"_5aq5"},c('React').createElement(c('FBRTCVideoMuteOverlay.react'),{videoMuted:!n.hasVideo(),imageSrc:k.selfPicUrl()}),c('React').createElement('div',{className:this.overlayClasses(k)},c('React').createElement('i',{className:"_2q_x"})),c('React').createElement(c('FBRTCVideo.react'),{muted:true,className:m,stream:n})))));}});f.exports=j;},null);
__d('FBRTCFadeInMixin',['cx','ReactDOM','joinClasses'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i={componentDidMount:function(){var j=c('ReactDOM').findDOMNode(this);j.style.opacity=0;j.className=c('joinClasses')(j.className,"_2hy");setTimeout(function(){j.style.opacity=1;},1);}};f.exports=i;},null);
__d('FBRTCFeedbackCompleteView.react',['cx','fbt','FBRTCButton.react','FBRTCFadeInMixin','React'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();var j=c('React').createClass({displayName:'FBRTCFeedbackCompleteView',mixins:[c('FBRTCFadeInMixin')],onCallBackButtonClicked:function(){return;},onCloseButtonClicked:function(){window.close();return;},messageString:function(){if(this.props.skipped)return i._("Your call has ended");return i._("Thank you for your feedback!");},render:function(){return (c('React').createElement('div',{className:"_1-7k"},c('React').createElement('p',{className:"_4j_k"},this.messageString()),c('React').createElement('div',null,c('React').createElement(c('FBRTCButton.react'),{label:i._("Close Window"),messengerUI:this.props.messengerUI,onClick:this.onCloseButtonClicked,type:'primary'}))));}});f.exports=j;},null);
__d('FBRTCFeedbackView.react',['cx','fbt','FBRTCButton.react','FBRTCFadeInMixin','FBRTCFeedbackCompleteView.react','FBRTCStarRatingActions','React'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();var j=c('React').createClass({displayName:'FBRTCFeedbackView',mixins:[c('FBRTCFadeInMixin')],getInitialState:function(){return {submitted:false,skipped:false,feedbackText:''};},componentDidMount:function(){c('FBRTCStarRatingActions').feedbackShown();},onSubmitButtonClicked:function(){if(this.canSubmitFeedback()){this.setState({submitted:true});c('FBRTCStarRatingActions').submitFeedback(this.state.feedbackText);}},onNotNowClicked:function(){this.setState({skipped:true,submitted:true});return;},canSubmitFeedback:function(){return this.state.feedbackText!=='';},feedbackChanged:function(k){this.setState({feedbackText:k.target.value});k.preventDefault();},render:function(){if(this.state.submitted)return (c('React').createElement(c('FBRTCFeedbackCompleteView.react'),{messengerUI:this.props.messengerUI,skipped:this.state.skipped}));return (c('React').createElement('div',{className:"_1-7k"},c('React').createElement('p',{className:"_4j_k"},i._("Give Feedback")),c('React').createElement('div',{className:"_4ru1"},c('React').createElement('label',{htmlFor:'fbwebrtcfeedback',className:"_4j_k _4ru2"},i._("What was the worst problem you experienced?")),c('React').createElement('textarea',{className:"_4ru3",id:'fbwebrtcfeedback',rows:'4',onChange:this.feedbackChanged,placeholder:i._("Enter your feedback")}),c('React').createElement('div',{className:"_s97"},c('React').createElement(c('FBRTCButton.react'),{className:"_g6b",label:i._("Not Now"),messengerUI:this.props.messengerUI,onClick:this.onNotNowClicked,type:'secondary'}),c('React').createElement(c('FBRTCButton.react'),{className:"_g6b",disabled:!this.canSubmitFeedback(),label:i._("Submit"),messengerUI:this.props.messengerUI,onClick:this.onSubmitButtonClicked,type:'primary'})))));}});f.exports=j;},null);
__d('FBRTCStarRatingView.react',['cx','fbt','FBRTCButton.react','FBRTCFadeInMixin','FBRTCFeedbackCompleteView.react','FBRTCFeedbackView.react','FBRTCStarRatingActions','React','StarsInput.react','VideoCallWebDriverIDs'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();var j=c('React').createClass({displayName:'FBRTCStarRatingView',mixins:[c('FBRTCFadeInMixin')],getInitialState:function(){return {rating:0,submitted:false,skipped:false,feedbackText:''};},componentDidMount:function(){c('FBRTCStarRatingActions').ratingShown();},onCallBackButtonClicked:function(){return;},onCloseButtonClicked:function(){window.close();return;},onStarClicked:function(k){this.setState({rating:k});},onSubmitButtonClicked:function(){if(this.state.rating>0){this.setState({submitted:true});c('FBRTCStarRatingActions').submitRating(this.state.rating);}},onNotNowClicked:function(){this.setState({skipped:true,submitted:true});return;},getRatingString:function(){switch(this.state.rating){case 1:return i._("Poor");case 2:return i._("Fair");case 3:return i._("Good");case 4:return i._("Very Good");case 5:return i._("Excellent");default:return '---';}},shouldAskForFeedback:function(){return this.state.rating===1&&this.state.submitted&&!this.state.skipped;},render:function(){if(this.shouldAskForFeedback()){return (c('React').createElement(c('FBRTCFeedbackView.react'),{messengerUI:this.props.messengerUI}));}else if(this.state.submitted)return (c('React').createElement(c('FBRTCFeedbackCompleteView.react'),{skipped:this.state.skipped,messengerUI:this.props.messengerUI}));var k=this.getRatingString();return (c('React').createElement('div',{className:"_1-7k",'data-testid':c('VideoCallWebDriverIDs').STAR_RATING_VIEW},c('React').createElement('p',{className:"_4j_k"},this.props.hasVideo?i._("Please rate the quality of your video call."):i._("Please rate the quality of your audio call.")),c('React').createElement('p',{className:"_4j_k _a16"},k),c('React').createElement(c('StarsInput.react'),{allowMultipleSubmissions:true,onClick:this.onStarClicked}),c('React').createElement('div',{className:"_s97"},c('React').createElement(c('FBRTCButton.react'),{className:"_g6b",label:i._("Not Now"),messengerUI:this.props.messengerUI,onClick:this.onNotNowClicked,type:'secondary'}),c('React').createElement(c('FBRTCButton.react'),{className:"_g6b",label:i._("Submit"),disabled:this.state.rating===0,messengerUI:this.props.messengerUI,onClick:this.onSubmitButtonClicked,type:'primary'}))));}});f.exports=j;},null);
__d('FBRTCView.react',['cx','FBRTCBackground.react','FBRTCCallControls.react','FBRTCCallModel','FBRTCCallStateInfo.react','FBRTCConfig','FBRTCInCallView.react','FBRTCMediaAccessPrompt.react','FBRTCSelfView.react','FBRTCMediaDeniedPrompt.react','FBRTCStarRatingView.react','React'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=c('React').PropTypes,j=c('React').createClass({displayName:'FBRTCView',_listener:null,propTypes:{callModel:i.instanceOf(c('FBRTCCallModel')).isRequired,messengerUI:i.bool.isRequired,excludeSelfView:i.bool},componentDidMount:function(){this._listener=this.props.callModel.addListener(this._handleCallModelChanged);},componentWillUnmount:function(){if(this._listener){this._listener.remove();delete this._listener;}},_handleCallModelChanged:function(){this.forceUpdate();},render:function(){var k=this.props,l=k.callModel,m=k.messengerUI,n=l.backgroundUrl(),o=l.getLocalVideoDuration()>0&&l.getRemoteVideoDuration()>0;if(l.uiState===c('FBRTCCallModel').UIState.COLLECT_RATING){return (c('React').createElement('div',{className:this._wrapperClass()},c('React').createElement(c('FBRTCBackground.react'),{src:n,messengerUI:m}),this._renderLogo(),c('React').createElement(c('FBRTCStarRatingView.react'),{messengerUI:m,hasVideo:o})));}else return (c('React').createElement('div',{className:this._wrapperClass()},c('React').createElement(c('FBRTCMediaAccessPrompt.react'),{callModel:l}),c('React').createElement(c('FBRTCMediaDeniedPrompt.react'),{callModel:l}),c('React').createElement(c('FBRTCCallStateInfo.react'),{callModel:l,messengerUI:m}),c('React').createElement(c('FBRTCBackground.react'),{src:n,messengerUI:m}),this._renderLogo(),c('React').createElement(c('FBRTCInCallView.react'),{callModel:l}),this._renderSelfView(l),c('React').createElement(c('FBRTCCallControls.react'),{callModel:l})));},_renderSelfView:function(k){if(!this.props.excludeSelfView&&k.isRemoteVideoSupported&&!k.isEnded())return c('React').createElement(c('FBRTCSelfView.react'),{callModel:k});return null;},_renderLogo:function(){if(!this.props.messengerUI){var k="_263g"+(' '+"_56ut");return c('React').createElement('i',{className:k});}},_wrapperClass:function(){return "_3ref"+(this.props.messengerUI?' '+"_17cj":'');}});f.exports=j;},null);
__d('FBRTCApplication',['PageHooks','FBRTCLogger','FBRTCCallController','FBRTCConfig','FBRTCView.react','React','ReactDOM','FBRTCSupport'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();if(!window.PageHooks)c('PageHooks');var h={init:function(i,j,k,l,m,n,o){n=n||document.getElementById('fbRTC/container');var p=c('FBRTCLogger').getInstance();p.logInfo(i,j,'Starting Call Controller');document.documentElement.style.overflow='hidden';if(!c('FBRTCSupport').isWebrtcSupported()){p.logError(i,j,'Webrtc not supported');}else{var q=new (c('FBRTCCallController'))(i,j,k,m);c('ReactDOM').render(c('React').createElement(c('FBRTCView.react'),{callModel:q.getCallModel(),messengerUI:c('FBRTCConfig').useMessengerCallUI()}),n);}}};f.exports=h;},null);