/*!CK:2552620856!*//*1459433078,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["jJ8cR"]); }

__d('MercurySharePreview.react',['cx','invariant','AsyncRequest','LeftRight.react','MercuryFallbackShareAttachment.react','MercuryShareAttachmentRenderLocations','React','XUICloseButton.react','XUISpinner.react'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();var j=c('React').PropTypes,k=c('React').createClass({displayName:'MercurySharePreview',propTypes:{imageSize:j.shape({width:j.number.isRequired,height:j.number.isRequired}).isRequired,location:j.oneOf(c('MercuryShareAttachmentRenderLocations').getValues()).isRequired,share:j.shape({params:j.array,type:j.number}),uri:j.string,onClose:j.func,onUpdate:j.func},getInitialState:function(){return {attachmentData:null,loading:false};},componentWillMount:function(){this._requestID=1337;this._currentRequest=null;},componentWillUnmount:function(){this._reset();},componentWillReceiveProps:function(l){!!(l.share&&l.uri)?i(0):void 0;if(!l.share&&!l.uri)return this._reset();var m=this.state.attachmentData||this.state.loading;if(l.share&&!m){this._loadFromShare(l.share);}else if(l.uri&&!(m&&this.props.uri==l.uri))this._loadFromURI(l.uri);},componentDidUpdate:function(l,m){this.props.onUpdate&&this.props.onUpdate(this);},getShareData:function(){return this.state.attachmentData&&this.state.attachmentData.share_data;},isLoading:function(){return this.state.loading;},_loadFromShare:function(l){this._currentRequest=new (c('AsyncRequest'))().setURI('/message_share_attachment/fromParams/').setData({image_height:this.props.imageSize.height,image_width:this.props.imageSize.width,share_params:l.params,share_type:l.type}).setHandler(this._onShareLoaded.bind(this,this._getNextRequestID()));this._currentRequest.send();this.setState({loading:true,attachmentData:null});},_loadFromURI:function(l){this._currentRequest=new (c('AsyncRequest'))().setURI('/message_share_attachment/fromURI/').setData({image_height:this.props.imageSize.height,image_width:this.props.imageSize.width,uri:l}).setHandler(this._onShareLoaded.bind(this,this._getNextRequestID()));this._currentRequest.send();this.setState({loading:true,attachmentData:null});},_getNextRequestID:function(){return ++this._requestID;},_getCurrentRequestID:function(){return this._requestID;},_onShareLoaded:function(l,m){if(this._getCurrentRequestID()!==l)return;this.setState({loading:false,attachmentData:m.payload});},_close:function(){this._reset();this.props.onClose&&this.props.onClose();},_reset:function(){this._getNextRequestID();this._currentRequest&&this._currentRequest.abort();this._currentRequest=null;this.setState({loading:false,attachmentData:null});},render:function(){var l="_tig"+(' '+"_tih");if(this.state.loading)return (c('React').createElement(c('LeftRight.react'),{direction:c('LeftRight.react').DIRECTION.right,className:l},c('React').createElement(c('XUISpinner.react'),{className:"_tii",size:'large',background:'light'}),c('React').createElement(c('XUICloseButton.react'),{className:"_tij",shade:'dark',size:'small',onClick:this._close})));var m=this.state.attachmentData;if(!m)return c('React').createElement('div',null);return (c('React').createElement('div',null,c('React').createElement(c('MercuryFallbackShareAttachment.react'),{attachment:m,location:c('MercuryShareAttachmentRenderLocations').CHAT_PREVIEW}),c('React').createElement(c('XUICloseButton.react'),{className:"_tij",shade:'dark',size:'small',onClick:this._close})));}});f.exports=k;},null);