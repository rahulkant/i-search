/*!CK:3292216232!*//*1459381640,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["xddsb"]); }

__d('MessagingRecipientTypeaheadItem.react',['cx','BackgroundImage.react','ChatTypeaheadConstants','ImageBlock.react','LeftRight.react','React','SplitImage.react','MercuryThreadMetadataRawRenderer','TypeaheadViewItem','joinClasses'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=c('React').PropTypes,j=c('React').createClass({displayName:'MessagingRecipientTypeaheadItem',propTypes:babelHelpers['extends']({},c('TypeaheadViewItem').propTypes,{imageSize:i.number.isRequired}),mixins:[c('TypeaheadViewItem').Mixin],isThreadRecipient:function(){return this.props.entry.getType()===c('ChatTypeaheadConstants').THREAD_TYPE;},_getImage:function(){var k=this.props.entry;if(k.getType()===c('ChatTypeaheadConstants').THREAD_TYPE&&!k.getPhoto()){var l=k.getAuxiliaryData();return (c('React').createElement(c('SplitImage.react'),{size:this.props.imageSize,srcs:l.participantsToRender.map(function(m){return m.image_src;})}));}if(k.getPhoto())return (c('React').createElement(c('BackgroundImage.react'),{width:this.props.imageSize,height:this.props.imageSize,backgroundSize:'cover',src:k.getPhoto()}));return c('React').createElement('span',null);},_getThreadParticipantList:function(){if(!this.isThreadRecipient())return null;var k=this.props.entry;return c('MercuryThreadMetadataRawRenderer').renderRawParticipantList(k.getUniqueID(),k.getAuxiliaryData().participantsToRender,k.getAuxiliaryData().thread.participants.length-1,{names_renderer:c('MercuryThreadMetadataRawRenderer').renderShortNames});},_getTitle:function(){var k=this.props.entry;if(this.isThreadRecipient()&&!k.getTitle())return this._getThreadParticipantList();return k.getTitle();},_getSubtitle:function(){var k=this.props.entry;if(this.isThreadRecipient()&&!k.getTitle())return this._getThreadParticipantList();return k.getSubtitle()?k.getSubtitle().split(' \u00b7 ')[0]:null;},render:function(){var k=this._getSubtitle(),l=c('joinClasses')("_599m"+(' '+"_55xn")+(!k?' '+"_5mne":'')+(this.props.highlighted?' '+"_599n":''),this.props.className);return (c('React').createElement('li',{'aria-selected':this.props.selected,className:l,onMouseDown:this._onSelect,onMouseEnter:this._onHighlight,role:this.props.role},c('React').createElement(c('ImageBlock.react'),{spacing:'medium'},this._getImage(),c('React').createElement(c('LeftRight.react'),null,c('React').createElement('div',null,c('React').createElement('div',{className:"_55xt _599p"},this._getTitle()),c('React').createElement('div',{className:"_55z3 _599q"},k)),this.props.children))));}});f.exports=j;},null);
__d('MessagingRecipientSelectedList.react',['cx','fbt','xuiglyph','Image.react','LeftRight.react','Map','MessagingRecipientTypeaheadItem.react','React'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();var k=c('React').PropTypes,l=c('React').createClass({displayName:'MessagingRecipientSelectedList',propTypes:{entries:k.instanceOf(c('Map')),onSelect:k.func.isRequired},_renderSelectedEntry:function(m){var n=j({name:'cross',shade:'dark',size:'small'});return (c('React').createElement(c('MessagingRecipientTypeaheadItem.react'),{key:m.getUniqueID(),entry:m,imageSize:24,onSelect:this.props.onSelect},c('React').createElement(c('Image.react'),{className:"_1jm4",src:n})));},render:function(){var m=i._("Send to:"),n=[];this.props.entries.forEach(function(o){return n.push(this._renderSelectedEntry(o));}.bind(this));return (c('React').createElement('div',{className:"_1jm5"},c('React').createElement(c('LeftRight.react'),{className:"_1jm6 _2ph-"},c('React').createElement('span',null,m),c('React').createElement('span',null,this.props.entries.size)),c('React').createElement('ul',null,n)));}});f.exports=l;},null);
__d('MessagingRecipientTypeaheadView.react',['cx','fbt','CenteredContainer.react','Link.react','Map','MessagingRecipientTypeaheadItem.react','React','TypeaheadViewPropTypes','XUISpinner.react'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();var j=c('React').PropTypes,k=32,l=c('React').createClass({displayName:'MessagingRecipientTypeaheadView',propTypes:babelHelpers['extends']({},c('TypeaheadViewPropTypes'),{selectedEntries:j.instanceOf(c('Map')),loading:j.bool}),getDefaultProps:function(){return {role:'listbox'};},_renderItem:function(m){var n=m===this.props.highlightedEntry,o=this.props.selectedEntries.has(m.getUniqueID());return (c('React').createElement(c('MessagingRecipientTypeaheadItem.react'),{key:m.getUniqueID(),entry:m,highlighted:n,imageSize:k,selected:o,onSelect:this.props.onSelect,onHighlight:this.props.onHighlight,onRenderHighlight:this.props.onRenderHighlight},c('React').createElement(c('Link.react'),{'aria-checked':o,className:"_2i83"+(o?' '+"_2i85":'')+(!o?' '+"_2i86":''),href:'#',role:'checkbox',tabIndex:'0'})));},render:function(){if(this.props.entries.length===0&&!this.props.loading)return (c('React').createElement(c('CenteredContainer.react'),{className:"_2pi1"},i._("No results")));return (c('React').createElement('ul',{id:this.props.ariaOwneeID,className:"_51do",role:this.props.role},this.props.entries.map(this._renderItem),c('React').createElement('div',{className:"_51dq"},this.props.loading?c('React').createElement(c('XUISpinner.react'),null):null)));}});f.exports=l;},null);
__d("XMessagingForwardAttachmentController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/mercury\/attachments\/forward\/",{});},null);
__d('MessagingForwardAttachmentDialog.react',['ix','cx','fbt','AsyncRequest','ChatSearchSource','Image.react','LayerFadeOnHide','Layout.react','Map','MessagingRecipientSelectedList.react','MessagingRecipientTypeaheadView.react','React','SearchableTextInput.react','ScrollableArea.react','XMessagingForwardAttachmentController','XUIDialog.react','XUIDialogBody.react','XUIDialogButton.react','XUIDialogCancelButton.react','XUIDialogFooter.react','XUIDialogTitle.react','XUISpinner.react','fbglyph','requireWeak'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();var k=c('Layout.react').Column,l=c('Layout.react').FillColumn,m=c('React').PropTypes,n=c('React').createClass({displayName:'MessagingForwardAttachmentDialog',propTypes:{attachmentID:m.string.isRequired,onClose:m.func,shown:m.bool.isRequired,title:m.string.isRequired},getInitialState:function(){return {bootstrappedEntries:[],entries:[],loading:true,selectedEntries:new (c('Map'))(),sendError:null,sending:false,startingThreadingID:Date.now(),query:''};},componentWillMount:function(){this._dataSource=new (c('ChatSearchSource'))({queryRequests:[{uri:'/ajax/mercury/composer_query.php'}]});},componentDidMount:function(){c('requireWeak')('OrderedFriendsList',function(o){return (o.getSearchableEntries(20,function(p){this.setState({bootstrappedEntries:p,loading:false});}.bind(this)));}.bind(this));},_onSelectEntry:function(o){var p=o.getUniqueID(),q=new (c('Map'))(this.state.selectedEntries);if(q.has(p)){q['delete'](p);}else q.set(p,o);this.setState({selectedEntries:q});},_onSearchChange:function(o){var p=o.target.value;this.setState({loading:true,query:p});},_onSearchEntriesFound:function(o){this.setState({entries:o});},_onSearchFinished:function(o){o===this.state.query&&this.setState({loading:false});},_onSubmit:function(){var o={},p=this.state.startingThreadingID;this.state.selectedEntries.forEach(function(r){o[p++]=r.getUniqueID();});var q=c('XMessagingForwardAttachmentController').getURIBuilder().getURI();new (c('AsyncRequest'))(q).setMethod('POST').setHandler(this._onSubmitResponse).setData({attachment_id:this.props.attachmentID,recipient_map:o}).send();this.setState({sending:true,sendError:null});},_onSubmitResponse:function(o){if(o.payload.success){this.props.onClose&&this.props.onClose();this.setState({bootstrappedEntries:[],selectedEntries:new (c('Map'))(),sending:false,startingThreadID:Date.now(),query:''});return;}this.setState({sending:false,sendError:o.payload.error});},_onToggle:function(o){if(!o)this.props.onClose();},render:function(){var o=j._("Send"),p=null;if(this.state.sending){p=c('React').createElement('div',null,c('React').createElement(c('XUISpinner.react'),null),c('React').createElement('span',{className:"_5s0d _3-99"},j._("Sending")));}else if(this.state.sendError){var q=h("\/images\/assets_DO_NOT_HARDCODE\/fb_glyphs\/caution-solid_16_bluegray-40.png");p=c('React').createElement('div',{className:"_5s0d"},c('React').createElement(c('Image.react'),{src:q}),c('React').createElement('span',{className:"_3-99"},this.state.sendError));}var r=j._("Search for people and groups");return (c('React').createElement(c('XUIDialog.react'),{shown:this.props.shown,behaviors:{LayerFadeOnHide:c('LayerFadeOnHide')},onToggle:this._onToggle,width:560},c('React').createElement(c('XUIDialogTitle.react'),null,this.props.title),c('React').createElement(c('XUIDialogBody.react'),{useCustomPadding:true},c('React').createElement(c('Layout.react'),null,c('React').createElement(k,{className:"_5s0e"},c('React').createElement('div',{className:"_2ph_"},c('React').createElement(c('SearchableTextInput.react'),{className:"_5s0f autofocus",onChange:this._onSearchChange,onEntriesFound:this._onSearchEntriesFound,placeholder:r,queryString:this.state.query,searchSource:this._dataSource,searchSourceOptions:{onQueryFinished:this._onSearchFinished}})),c('React').createElement(c('ScrollableArea.react'),{className:"_5s0g",height:400,width:360},c('React').createElement(c('MessagingRecipientTypeaheadView.react'),{entries:this.state.query?this.state.entries:this.state.bootstrappedEntries,loading:this.state.loading,selectedEntries:this.state.selectedEntries,onSelect:this._onSelectEntry}))),c('React').createElement(l,{className:"_5s0h"},c('React').createElement(c('ScrollableArea.react'),{height:457,shadow:false},c('React').createElement(c('MessagingRecipientSelectedList.react'),{entries:this.state.selectedEntries,onSelect:this._onSelectEntry}))))),c('React').createElement(c('XUIDialogFooter.react'),{leftContent:p},c('React').createElement(c('XUIDialogCancelButton.react'),{onClick:this.props.onClose}),c('React').createElement(c('XUIDialogButton.react'),{use:'confirm',disabled:!this.state.selectedEntries.size||this.state.sending,label:o,onClick:this._onSubmit}))));}});f.exports=n;},null);